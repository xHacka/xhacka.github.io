# Deeper

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.151:22
Open 10.0.2.151:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.151
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2 (protocol 2.0)
| ssh-hostkey: 
|   256 37:d1:6f:b5:a4:96:e8:78:18:c7:77:d0:3e:20:4e:55 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBP0G2tWy4w/Qxs8qOXl67kW082JT6kvWM9CaV4Ycd5xfbh2YW6SbvGD7LUGAq+dlr4hMsmqlb3qa5OxGXxqfEjU=
|   256 cf:5d:90:f3:37:3f:a4:e2:ba:d5:d7:25:c6:4a:a0:61 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMznQqkhSVgCjaHlx4JkgMQc2Ecl+JjVdL7tTAgj9Fyy
80/tcp open  http    syn-ack Apache httpd 2.4.57 ((Debian))
|_http-server-header: Apache/2.4.57 (Debian)
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
|_http-title: Deeper
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/deeper/writeup.png)

```html
└─$ curl http://10.0.2.151/deeper/ -s | grep '<!--'
<!-- GO evendeeper -->

└─$ curl http://10.0.2.151/deeper/evendeeper/ -s | grep '<!--'
<!-- USER .- .-.. .. -.-. . -->
<!-- PASS 53586470624778486230526c5a58426c63673d3d -->
```

```bash
Username 
	-> Morse Decode -> ALICE

Password
└─$ echo 53586470624778486230526c5a58426c63673d3d | xxd -r -p | base64 -d
IwillGoDeeper 
```

## SSH

> Creds: `alice:IwillGoDeeper`

```bash
└─$ sshpass -p 'IwillGoDeeper' ssh alice@10.0.2.151
alice@deeper:~$ id
uid=1000(alice) gid=1000(alice) groups=1000(alice)
```

### User.txt

```bash
alice@deeper:~$ cat user.txt
7e267b737cc121c29b496dc3bcffa5a7
```

## Privilege Escalation (bob)

```bash
alice@deeper:~$ grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
alice:x:1000:1000:alice,,,:/home/alice:/bin/bash
bob:x:1001:1001:bob,,,:/home/bob:/bin/bash
alice@deeper:~$ find . -ls
   130561      4 drwxr--r--   3 alice    alice        4096 Aug 26  2023 .
   130571      4 drwxr-xr-x   3 alice    alice        4096 Aug 26  2023 ./.local
   130574      4 drwx------   3 alice    alice        4096 Aug 26  2023 ./.local/share
   130575      4 drwx------   2 alice    alice        4096 Aug 26  2023 ./.local/share/nano
   130562      4 -rw-r--r--   1 alice    alice        3526 Aug 25  2023 ./.bashrc
   130566      0 lrwxrwxrwx   1 alice    alice           9 Aug 25  2023 ./.bash_history -> /dev/null
   130563      4 -rw-r--r--   1 alice    alice         807 Aug 25  2023 ./.profile
   130583      4 -rw-r--r--   1 alice    alice          41 Aug 25  2023 ./.bob.txt
   130564      4 -rw-r--r--   1 alice    alice         220 Aug 25  2023 ./.bash_logout
   130577      4 -rw-r--r--   1 alice    alice          33 Aug 26  2023 ./user.txt
alice@deeper:~$ cat .bob.txt
535746745247566c634556756233566e61413d3d
```

```bash
└─$ echo 535746745247566c634556756233566e61413d3d | xxd -r -p | base64 -d
IamDeepEnough
```

> Creds: `bob:IamDeepEnough`

## Privilege Escalation

Password protected zip file
```bash
bob@deeper:~$ busybox unzip root.zip
Archive:  root.zip
unzip: zip flag 1 (encryption) is not supported
```

```bash
└─$ sshpass -p 'IamDeepEnough' scp bob@10.0.2.151:root.zip .
└─$ zip2john root.zip | tee root.zip.hash
Created directory: /home/woyag/.john
ver 1.0 efh 5455 efh 7875 root.zip/root.txt PKZIP Encr: 2b chk, TS_chk, cmplen=33, decmplen=21, crc=2D649941 ts=BA81 cs=ba81 type=0
root.zip/root.txt:$pkzip$1*2*2*0*21*15*2d649941*0*42*0*21*ba81*7c9d67fef010fc7de3b9bb50c5ff91f4a75873a386f0e377d4363edb8a8dda9417*$/pkzip$:root.txt:root.zip::root.zip
└─$ john root.zip.hash --wordlist=$rockyou
bob              (root.zip/root.txt)
└─$ unzip -P bob root.zip
└─$ cat root.txt
root:IhateMyPassword
```

> Creds: `root:IhateMyPassword`

### Root.txt

```bash
└─$ sshpass -p 'IwillGoDeeper' ssh alice@10.0.2.151 'timeout 1 echo "IhateMyPassword" | su - root -c "cat /root/root.txt"'
Password: dbc56c8328ee4d00bbdb658a8fc3e895
```

