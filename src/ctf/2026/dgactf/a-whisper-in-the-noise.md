# A whisper in the noise

## Description

[challenge.pcap](https://dgactf.com/files/39a35946873d9719fed8f613b5d6e121/challenge.pcap?token=eyJ1c2VyX2lkIjoyMCwidGVhbV9pZCI6bnVsbCwiZmlsZV9pZCI6MTJ9.aZsFVg.FDbUulaxskCTZuTuV1LRlIRl-aE)

## Solution

Looks like we are looking at DNS exfiltration

![a-whisper-in-the-noise.png](/assets/ctf/dgactf/a-whisper-in-the-noise.png)

Get all domains
```bash
└─$ tshark -r challenge.pcap -Y "dns.qry.name" -T fields -e dns.qry.name | sort -u
```

Extract suspicious looking
```bash
└─$ tshark -r challenge.pcap -Y "dns.qry.name" -T fields -e dns.qry.name | sort -u | grep ^be
be8d.TMTSSTUUXJUP3X5KA6PBU5.adobe-licensing-svc.com
be8e.2WJQ7VOF3YDIL.adobe-licensing-svc.com
be8f.UZGUPU476KUZ5J.adobe-licensing-svc.com
bea0.mdc47dblda4l3jl3jm334ojwz4w3qdk4.windowsupdate-security.com
bea0.NOHHEC75XT3PUSRJFR7F6AZUXH.adobe-licensing-svc.com
...
befe.vtvd7k66sttz34f4snppaygq3mmoyco4.windowsupdate-security.com
beff.6HAF4R5PD23Z6WR6PJIBZWGL253N.svchost-telemetry.com
beff.ML7DRMHWLENZ2VF62WFWMST.adobe-licensing-svc.com
beff.t7zno4ma75h74u366md435m6ak4bnvy3.windowsupdate-security.com
beff.ZF2YGXAP4ZNFJQBHPFSQ22F.ms-diagnostics-cdn.net
```

It looks like Base32 payloads, but decoding gives nothing
```bash
Domain: adobe-licensing-svc.com, Data: TMTSSTUUXJUP3X5KA6PBU52WJQ7VOF3YDILUZGUPU476KUZ5JNOHHEC75XT3PUSRJFR7F6AZUXHNVUX5OQNZ5UF73KZIB7GZPZAXONR5M3EVYAKQ5PCQL2VEVEGUYEEKKD2YUQTATTZKZC2GZJJ7QEXA6IMIPMIS2JG6XE2QU5T5XBRKKDEOVZQZV42N6E446BLDYSSCXVPM655CRPPAHC7SKLSSU3XPHP3N6KT5KRKRU2DEZMN4L4HNQ3HYQF7I3PQK7FMVEZM2UBZD4YIDOKFDU7VT3CLTLXNMDQ47RET3LY2K2UNDAZACFGEDDM4XRCE7Z5LVJ343PRGK4IRELD7YNDHSUGGTQHITBNBW62TTGTVI2UMJT6P2ZKKGTGRIKPN7LR4R5CVLYK3USXABJYHVEFDK62V2O3VUG4KMDIUVVNL7BWE6DL6RSWK2JBIM7IQMEPFWT7C2J27PXCOZCE46SRFSG22BFARDGXQWGROGKCFI4BUTB63C3CBZ7AXCDLFEMWX37BS5YQL6C7QWMP2VTLI7VHENO5DBV5VJZV7S3FFWD7UE3DI532NG7EN5IRJFGWT777FCHN5ZG2GW6PGE2XZQ5ET5QCNHETE7YSCHZL4DR2GYUTFNUH4QX6MOARD2XB6Y4IQKNC6TWAL2W34QOMSICRZKUPLFPSJIJFO6JZLM2XAXQ76USGOAU4GU2WG7C6IBFS73WNVZBYEAEP4LEWGLV62PA3DPUFZCWOOFAPLW2LPUC2IWJWSPPLDFBA7YFE55LM4RK5F726OQWDWUWQ4FM5YOBOO63JVOT2HHYTOEIXJA6X2SFQQOJPEHKJIAZHQUKRCUK5HRXEKHWBSZMLJNHF6T6GQO7ZVXM322644RDMHGYOH3ZLRABHNDI3YYK3EEHCRPAUJFFJOCY6HNRI52WLOD4QWKUDOEQOGAOIHY4TPRYHKS6IQ6SX6U6BJUFSMMIVZ5D35LP5U62GRDOEKBOQ36SVXXKEMUMNRHVRS3RCMKIGD4H67NIFWZTXML47EIJ2YJIYAARXLNQTJ76W6SZNRHCX64ASGYF2OK4CKRJXU3CXWEUAZ6FNMLXWM6EHYDO4QBY75WCC3NNT2DLC3DBWQMGTUEQBIGX3UHKE326QJLYMVAFL34HVXRV5DGDV56DTK4BUUXDKQTUS3DX5KLVV56HKYL54CEN7G2QRTMIXA5EYM25W7Q7MPBHKJGLZWPZT6R54GI2YES34JBYK7A6BGNNLLRSF52NXPH2KM4ZTNMDUNTG2DVAEYSRUOCQTI45GINLRN6CPNAFPITDOQBZMKGKC77QELK4TK5WRQC3M3WQIIO2VOHDHNWV55ZBABLXAYIQCRORQ5NVSAB5P7W7JHKX6KUW7ZHUIRHUC4LYCVJ26GUQFXTSZZREA7ACL6S3OMGGXECGYMKE5V3AOWTUZYJCFZ6U7QPIOEF6RBR7E2IPRIM4RZ6S7BJBIBGUAVV4GI7U5HH6GBK7VUZJDWS5GX5MGM3AYZKW5FSGZEEO32JSB6XDICE7OV3MUKDD53THDH7NNJDQDEJMXXPN5JNZLL66GINJZJYUKOQ6KWR23IXCFN3KRWTVQRHICQNHMUWZAYCKQX6QB7ZJGNYX77ESDEO2C72MS4ZTKD4IXA5D42TKTTM25LL5YOC564N4HW4GYBEHIS5RHHCFJYXR42SKEPRHGQT45KBYQLFA4JWVFWCQXL2BRHPNNRMMOYAX3BIL5J3OEUUOE56ZQ7YD55Z3YUPJUGI25VSIS5JLLJVXKYCSLOFM3HZMUKMML7DRMHWLENZ2VF62WFWMST, Charset: 32

Domain: windowsupdate-security.com, Data: mdc47dblda4l3jl3jm334ojwz4w3qdk447pccx44fu5w32lqvh7eepn2hmzkvbt5oohxfwol3hlnow6f44dt74hz5h6ozwkzzhsp5mxenjfrs63wvt7eeplyfsier3edjeu33a3z32wb3l4vd4xi6733xr3ljfuz3an6ilxeeqoh4evdmzmkolhxjvlteux2e5rljdgmjsthw22xbsi2zdd5n6wpcyrd2gmt2o437f3sn722x33tpklii5sl4plx4v3rttisn7fjgrgestjgjsp4qmuym5b6wapy5ikdr2kb46hiex4ap7cfw5lyawvzft7utx54nctohmxmwtlgsk54f4kjd4f6ioheq32mzje3qiyush3g33mfd7x2dlbxzz7oc5leircizgwr3xoblelqo7mp7wgho6c72ygfbplznje4pdjz56lh2ppg6l72nq57ptw4vwlxtxumw32hhef3sdv53lmep2ztqwjmdqv7rx7syukbc2j53knhwhx4omgciddlcbg3waaaaaaesrkoisxeeyecafiigyabkcbwaakqqnqacuedmaavby37afiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3ahwbqkaflyl7reasqqnqacuedmaavba3adn74n57put7ccp5jerr56hk3spkyag3j7fei6fr4dcca7tovfd7uvpxq5l575r5pe3c4brtfjrgezlgxxgn46nen74nkkhypk7xzpbqoxhmmaoxjqgl3vbdiloklxggls3gjkrn7zgawsb66ju3clpjnth7wjesnnpryprshlsutk3kf3mrrc2l7xzwz3mje2nyo454wtqwllwwqrwdgwsbe6wl6vnmxnseer22qzp4zey7pwob53a4pgos6ossgz3ou57unxtgh7ibmggvim44pmpx3cgz76zjdn7syfslei52e2zmuwre2j437gj7szw7jh3lngenem6kplg5ceixnf63k2m2w4fugdrcfaen56wt6q6kxwn6xxws5xxo4v7trpxwkuwdrymfqjz5oajjpygiobk2bp3kc4hrnz3xtamhnyc55dvri755f4rhsi3drq4nr5znw57fblbcbek4z7xj2yzgernxyrzt7j2xtm5dd4hsuf4kikfclvg53oj767oth3t3bpwqdu73l72jhmoe7pgrh7nu2xpsx6w76g66ttz55ndlwiyrnfww3jje6c6bbxizvu6daprjvyo266n7o3vjhfe5x6yfugwze4d7jfsymdlkzwcjevux43c4he5mgufby5fa6pduck5b62mytyi33jhtvghptqkm54ypuwtdbki66csfur7gbqzxgypg35dk5movvzqgur5ssg37ebhgy7czwf24rkzrxfzfxjnls6kdrsl7mvkovrdgh7xrtelzq6mmrddpnkf4jrcep2nn3y65zklmvzl3mv6eb6hum5sb2nw2w634ls6z52t3wiwspru3cpfhtt7tifqrjffpox42zhdrm6x2au3denmm2ztvhho437znscnlhvb3ltn3oqpgljihzzxws3lpsvpwup3n54zyhb6gpvfrhh6oy65seeijg3c5mf7lohd6e6yj7msqhzl2h6gcynxey2ixwwj5gt26nkv4kkibc3f7wi6676kml6npl6hgxd63tnvesjsjfeljl5plnjvnseyu5l23b433zkppozooz33fxa6yy3yp3u352ztgb23v5mxgyoesqmqwyhflecnuyxzhgvba3aafiigyabkcbwaakrmm6yfvd5u7uvba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaavba3aafiigyabkcbwaakqqnqacuedmaal5tpmoddmjreeacaqpghudyaaavulmaapo33hn3xs5ohh56d57t5l3pmzr7x445qc6wqq2kaitihb26n5tb6zthm52gc75tswvkuquciumw7irltq6tclrwyka2ddcgbqxkd4ifb2sknanbwbiuyut2q2dlifewcbllvqfmfeklib6cgvex2yl5curg5fvfgkr4jz3o3nweby5y5ydy573hozq7nztooaaaaazaiaiaaaabhvhysaaaaa4zusrcbrfie4rynbinauaaaaagusscekiaaaamq7v7osrzfngfyqfd6lyyaeq5seiresmkjkfsm27xhycg3ozupqsdg7db5huloyc74apv2ib2on6yr7m45lwhlhszj7svfb7cfexrdh4fo74g56pdhhi5r34545epvzrperm4wpf2tp24ny6fowgvgg257vts75gutkkglmrx5ym55o676d374snnykmf7mbvzuoovczlhuvzfprp4unmx7pw6353vwvb456yce4lwhhhl2ttzo447y4qy3yj3nn5u46phjk37v6fer2lqff4cqwhzjgay3y52vms6kzavcmhkzey2hc62k7ve5zgxtxuusl5gjpl2ph4m4a7pe3s2i5vm4364nky5bzocqkjg6wrxk36kon76ortxisvruklr2pojnyebub2lrndiwx32vvzwi3vwb262koxhxuvnxvniwpy4z7xry7bftd45otd4vtvd7k66sttz34f4snppaygq3mmoyco4t7zno4ma75h74u366md435m6ak4bnvy3, Charset: 32

Domain: ms-diagnostics-cdn.net, Data: W2FJLP67XOELHZCBLXEQQY2SSQDQL4SBTDT5SCZLEVQWAFQBRBW2GD5ODZIOE6SXUDI3NNMU52LMMQGGGYAB3CU2DVDWWQWG7OUMGXO6HKZ2L36YUMVIFYT437K4HD4QNAAXOPIAJE6KQMFJZV6YDHFZTQ2LU4K4TYA6GPZENTVJJ4HRL2EIOKWVNSC7GYJ5A2SJZJGWB37JN35P7U2SIBQ2J2Z4ITIFB5SYJDZCWPPPGZYAFBOQP3UODPTUBVGWYZIVVTOAYQPSYE7YCRT24NNHF4FP557ZIRCIYURULEQ2S5MWMRRBIAS4NGFFKIAWMNYOGSMSMZ5HIQEQJ2NIP5KVJTJZ46S3EXAAZ7CJIA5UJ6WE2TF6QRK7ZCEAUGPI2PJ4QS2FL6XQEWSFMBVHJ234INSNVUV3K6I2QDAKHO5Q7I6ENSYRQC3E3UQ62VKWAC4WCHDXUZF2KFA2ZHD467C5ILZUZ6F7ZOPMUE5JQFYMCINZK5EXSJKNGYE25XT6KBSF223FHRFDFG4I5ABUMPIT7YEOLV4YFRHMCRJXLNNIR47VDRS62ALBR2YUBUBDWDB763Z4HSLSI64RWKRVSY2TJ7LSYDEBLG7ESVATDGDKS2PL5SBIMTTCO4TW22IN77ISZ6PDED62MAG3RB3W7D3QGAGDMSI6UZXADTNNQ5KC5B2GISUFI3DVIJP4S43QD4OJRWLGTYMSWTBJIQDNAYKGQVW6RFVUXDEDYDOZSDPGLNKLNU76HCMY7MR3RPXQBDYQWKOBZMMMMNGO54S5KBNNRBI5LC3EFDCYYA2P4OULSOUOUJCPKHKGX4S4C4M4EYXAE44UMB2YXO2CWXW3XIXPAAQCTRUNPYZRI4JFAY2XBYY5BQTOFZ5EXB5JJADMUCYKCYZBG3BQNOJC47RNS4CJ52KV5FBP644ODN64XXSCQET7A7QLSLBE66R6HY4UKAOYIPHAJ3NIHPGNXLJP3KVIUKDONYLSQVDKCX7LDTD6DNXUCJKKBQBQPPU52I3RRNI2UHEP7TBTP4SSUZX45ESZ7C2X22WUSIWLNCTMHJAG6J4GJW73CM7CUKGAIBTN2YKZMKXU4JXN3E667QVKSFFTGW2VFVTEHBRQ35L2QJISDS75AHBJMP22QPAVOXT6JGEDKCIE5PMROHXLRDAL6DDJ6ASRBR7LUW4KEKO2V5K2L2NV5PLUKJRE3XRS6BXOYVISBB6YRHWEQFYLJV2D4O667KUE36CGHNWQ46WLCIZ7LQEAL72ZRAGIASU4B562DL6XFQEKWDO4V7TDVKIQ6ZVVOE5B7LMKMWCWL5GBLDKT3EDDACK7EVX5SFYISVCHNOAG5ZMXCHYYZDE4ICTWFNURQ3SE2U3TK6UZPHNRMKADXSITCTI2SWFMTA3OBVUMYIN2KEXYMQIE3GPXBSJRSDKNXJKZZKMGFKU5EXXVZCSMZ34PCZGGIITE5GIV3OXEAXAOJN45TTPTESNUGBKIBVZG5SK5YWUCNCGJU3B5C7LTGRHIX76PNUDUVQ7XWDZ3HNCZ42DAHFAGDGN7SFSUGD6BWNKDUGZF2YGXAP4ZNFJQBHPFSQ22F, Charset: 32

Domain: svchost-telemetry.com, Data: XQ4UMQ54KSEA55JWJPHYWLCXG3UC3FDW62NYQKREATJ6XUMFX6KJBRBKZ6ZXF46NQUICHHY5ZLKSOBYI5HVBZYV4FHG7LIEFYBSXLOLXYIRPEGF2F455FKAL7J5L6GIZ43OXUF36WUYRNSHTTXGKRNXW7KRA5NFLFKGAJYK73QLFEFDWXJXR7UIE54KT5ZGYJ4KARENBUCNU4ACX7PTOKTDJJRBOXLLVXM6G7XXD3VCCN5PNHOC43OX4UVTJTBA6DIWNWCFGF7SUMZ6CIUJHBGQPDRAIGTSW5BMR5ALXFM6775HMEUBMDLWFX63XZ2DYC3ZHWHJOCNRYAR54KJZ2YQDEFDQJ3XJUIWM3CZ5AMH7DUN5ZG6RFJZTQFJMPQB7ZXAADRDV2E6TDYQ7GM6FEPWAYITTJAZW4TRJLRQRD6Y7YYYQAHV4DSOTYGBTC63YXNW6KSJ6OBBISBFQNW6WDV6D5QB3ZBJ3CVGDRZSIXW6KFWDCGLTZI2VUKDYFWMBFOPSVJYBDAR3YCEVVQ54CB7XF2JC5FAIP2FXAS6HDMJ2SW2Y66M6PVJ436QCJSKEKWHNZPUFCVIJ3QAT3PSQPUEIPRCTUX462PBAY3ZH3GFBAZ5LDIWI4PEKHWOMDDAHX7PLGAHGVP776OZC4VI7TTHRYMDNACIIHMJVPQKLBC7EJDZU2JQRN5ZJIJRLSVJF3HJHSXECXGADSH7WDMLYEV2ZJMIYLQRDWL5TPC4FG436U3JB6HXZGJHRZT2Q7SKXTAUVZO2PAL2V5WKYTLMKVGZEEP5SYMG3EZFPANFR2QYYZ3DLZEIXF4N2U73UHZNQVS6EB6ECYC32MLSMNYRL3SXK5XG3FRLTZYDVKB46XLFIKLAYGGOFW57DK4MRGVNX6N3WCYWGPLPRE2JFB657YM3A3BTI4KJP2CXDIQ7J7GT2APDIWLRVV3XDUZYH3G2YZGV4ZHOD4VUJEF7WJW3ZVLGFFCM2QZRW3MRRZSVOEXFA4M2ZU6DRQSWEAK2F7DF6OBNPY4ESO3CO6BUMKOGCLM4ODYCKX4Q3TVZDF35MWRCRESWN6U4W6APX6SM3EHCJAC6ML6TERKJE25CE4N4GJWUBMKESWNXK76RB5DOSES4UNDZD5ADCXNGEOYBDW4QGU5Q6ND7GXA3TLLUZCKQGJH4YNT2JOGKGVHNWLFB4J2V5A2OQ3PE3ECRG2DM4EGDN5U2ANS4YBVCVNTN23AHYEDUOMCMI5N2BCTWCLXNHO5WZALIN4MJ36ZEVGI565EM3O5R6TSA35SUEYKO5JJPMAXFAP7ZPLGOQ5PUTOAERWJXELRPMPO5BWV7C5OPTTQPUT2B3YLL244AHRR7ST5TGXQ4BLFYXE4TLYWJLLUTMJ4HPUUPBNKV2XJ2JPQ5VSC7B6HMSLTYCJ6F5OLCDQHW3RCRSF6DJNZ2BPJZEK6GL6ROOPE43VOY5XRBHMYG4U6FNUFVGOBAPQLIVANF7A6C7RR5MZL46RSOOXCRXBL6CIDBJ64F2ETMA25CDKUQDSE4G6WWOOQPXZNQ4F6FKSSC5JWJQO6NCI76HAF4R5PD23Z6WR6PJIBZWGL253N, Charset: 32
```

Saving and decoding without sorting shows that `windowsupdate-security.com` has an image
```bash
└─$ tshark -r challenge.pcap -Y "dns.qry.name" -T fields -e dns.qry.name | grep ^be > data.txt
```

Some parts are janky, but I think we can make it work.

![a-whisper-in-the-noise-1.png](/assets/ctf/dgactf/a-whisper-in-the-noise-1.png)

DNS queries are duplicated, that's why we are getting corrupted image.
```bash
└─$ tshark -r challenge.pcap -Y "dns.qry.name" -T fields -e dns.qry.name | sort | uniq -c | grep ' be' | head
      2 be8d.TMTSSTUUXJUP3X5KA6PBU5.adobe-licensing-svc.com
      2 be8e.2WJQ7VOF3YDIL.adobe-licensing-svc.com
      2 be8f.UZGUPU476KUZ5J.adobe-licensing-svc.com
      2 bea0.mdc47dblda4l3jl3jm334ojwz4w3qdk4.windowsupdate-security.com
      2 bea0.NOHHEC75XT3PUSRJFR7F6AZUXH.adobe-licensing-svc.com
      2 bea0.W2FJLP67XOELHZCBLX.ms-diagnostics-cdn.net
      2 bea0.XQ4UMQ54KSEA55JWJPHYW.svchost-telemetry.com
      2 bea1.47pccx44fu5w32lqvh7eepn2hmzkvbt5.windowsupdate-security.com
      2 bea1.EQQY2SSQDQ.ms-diagnostics-cdn.net
      2 bea1.LCXG3UC3FDW6.svchost-telemetry.com
```

```python
import base64
from collections import defaultdict

seen = set()
domains_data = defaultdict(str)
with open("data.txt") as f:
    for subdomain in f:
        sequence, data, domain = subdomain.strip().split(".", 2)
        if subdomain in seen:
            continue
        seen.add(subdomain)
        sequence = int(sequence, 16)
        domains_data[domain] += data

# for domain, data in domains_data.items():
#     print(f'Domain: {domain}, Data: {data}, Charset: {len(set(data))}')
#     print()

def decode_dns_data(raw_data):
    data = raw_data.upper()
    missing_padding = len(data) % 8
    if missing_padding:
        data += '=' * (8 - missing_padding)
    
    try:
        return base64.b32decode(data)
    except Exception as e:
        print(f"[Error decoding: {e}]")
        return data.encode()

# Process your domains_data
for domain, data in domains_data.items():
    decoded_bytes = decode_dns_data(data)
    with open(f'silence/{domain}.png', 'wb') as f:
        f.write(decoded_bytes)
```

![a-whisper-in-the-noise-2.png](/assets/ctf/dgactf/a-whisper-in-the-noise-2.png)

::: tip Flag
`DGA{dns_tunn3l_v1s10n_1337}`
:::

